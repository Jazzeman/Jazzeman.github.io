<html>
    <head>
        <link rel="stylesheet" href="styles.css" type="text/css">
    </head>

    <body style="background-color: rgb(40, 40, 40);">
        <canvas id="c" width="1800" height="900"></canvas>
        <div id="fps-container"><span id="fps"></span> FPS</div>
        <div class="controls">
            <div class="section">
                <h3>About</h3>
                <p>Use WASD -keys to move around and use mouse while holding mousebutton to look around.</p>
                <p>Check out the <a href="https://github.com/jassenousiainen/webgl-raytracer">repository</a></p>
            </div>
            <div class="section">
                <h3>Rendering settings</h3>
                Select shader:
                <input type="radio" id="fast" name="shader-select" class="shader-select" checked>
                <label for="fast">fast</label>
                <input type="radio" id="quality" name="shader-select" class="shader-select">
                <label for="quality">quality</label>
                <br><br>
                <label class='switch'>
                    <input type="checkbox" id="enableGI">
                    <span class='slider'></span>
                    Indirect lighting
                </label>
                <br>
                <label class='switch'>
                    <input type="checkbox" id="enableRefGI">
                    <span class='slider'></span>
                    Indirect in reflections
                </label>
                <br><br>
                number of indirect samples:
                <br>
                <div class="slider_container">
                    <input type="range" value="50" id="indirectsamples" min="1" max="100" oninput="this.nextElementSibling.value = this.value">
                    <output>50</output>
                </div>
                <br>
                number of direct samples:
                <br>
                <div class="slider_container">
                    <input type="range" list="tickmarks" value="9" id="shadowsamples" min="1" max="25" oninput="this.nextElementSibling.value = this.value">
                    <output>9</output>
                </div>
                <datalist id="tickmarks">
                    <option value="1" label="1"></option>
                    <option value="4" label="4"></option>
                    <option value="9" label="9"></option>
                    <option value="16" label="16"></option>
                    <option value="25" label="25"></option>
                </datalist>
                <br>
                reflection bounces:
                <br>
                <div class="slider_container">
                    <input type="range" value="3" id="reflectionbounces" min="0" max="5" step="1" oninput="this.nextElementSibling.value = this.value">
                    <output>3</output>
                </div>
            </div>
            <div class="section" id="lightcontrols">
                <h3>Lights</h3>
                <label class='switch'>
                    <input type="checkbox" id="arealightsenable" checked>
                    <span class='slider'></span>
                    Area lights on/off
                </label>
                <br><br>
                Attenuation:<br>
                <input type="range" min="0" max="10" step="0.01" value="1.5" id="quadratic" class="attenuation"> Quadratic
                <input type="range" min="0" max="10" step="0.01" value="0" id="linear" class="attenuation"> Linear
                <br>
            </div>
            <div class="section" id="planecontrols">
                <h3>Planes</h3>
                <input type="checkbox" id="planebacksides" checked> Intersect backsides
                <br><br>
            </div>
            <div class="section">
                <h3>Extras</h3>
                <input type="checkbox" id="enablemirrorworld"> Mirror world
                <br>
            </div>
        </div>

        <script id="vertex-shader" type="x-shader/x-vertex">#version 300 es
            precision highp float;
            uniform mat4 invprojview;
            uniform float near;
            uniform float far;
            
            out lowp vec3 origin;
            out lowp vec3 ray;
            
            void main() {
                // https://rauwendaal.net/2014/06/14/rendering-a-screen-covering-triangle-in-opengl/
                float x = -1.0 + float((gl_VertexID & 1) << 2);
                float y = -1.0 + float((gl_VertexID & 2) << 1);
                gl_Position = vec4(x, y, 0, 1);
                            
                // https://stackoverflow.com/a/52764898
                origin = (invprojview * vec4(x, y, -1.0, 1.0) * near).xyz;
                ray = (invprojview * vec4(vec2(x,y) * (far - near), far + near, far - near)).xyz;
            }
        </script>
        <!-- Fragment GLSL optimized with: https://zz85.github.io/glsl-optimizer/ -->
        <script id="fragment-shader-fast" type="x-shader/x-fragment">#version 300 es
          precision mediump float;
          float randomIncrement;
          uniform float randomseed;
          uniform highp int numLights;
          uniform vec3 lightPos[2];
          uniform vec2 lightSize[2];
          uniform vec3 lightIntensity[2];
          uniform vec2 lightSpot[2];
          uniform highp int shadowSamples;
          uniform float shadowDim;
          uniform vec2 attenuation;
          uniform highp int numSpheres;
          uniform vec3 sphereCenters[4];
          uniform vec3 sphereColors[4];
          uniform vec3 reflectiveColors[4];
          uniform vec3 sphereSpecColors[4];
          uniform float sphereRoughness[4];
          uniform highp int numPlanes;
          uniform float planeOffsets[6];
          uniform vec3 planeNormals[6];
          uniform vec3 planeColors[6];
          uniform float planeSpecular[6];
          uniform float planeRoughness[6];
          uniform highp int rayBounces;
          uniform vec3 ambientLight;
          uniform bool enableGI;
          uniform bool enableRefGI;
          uniform highp int indirectSamples;
          uniform bool enablePlaneMirrors;
          in lowp vec3 origin;
          in lowp vec3 ray;
          out lowp vec4 fragColor;
          void main ()
          {
            float roughness_1;
            vec3 reflectiveColor_2;
            vec3 specularColor_3;
            vec3 diffuseColor_4;
            lowp vec3 pixelColor_5;
            lowp vec3 tmpvar_6;
            tmpvar_6 = normalize(ray);
            randomIncrement = randomseed;
            lowp vec3 ray_origin_7;
            ray_origin_7 = origin;
            lowp vec3 ray_direction_8;
            ray_direction_8 = tmpvar_6;
            lowp float t_hit_9;
            t_hit_9 = sqrt(dot (ray, ray));
            lowp vec3 position_10;
            lowp vec3 normal_11;
            vec3 diffuseColor_12;
            diffuseColor_12 = diffuseColor_4;
            vec3 specularColor_13;
            specularColor_13 = specularColor_3;
            vec3 reflectiveColor_14;
            reflectiveColor_14 = reflectiveColor_2;
            float roughness_15;
            roughness_15 = roughness_1;
            bool intersectLight_16;
            intersectLight_16 = bool(1);
            highp int idx_19;
            highp int intersected_20;
            intersected_20 = 0;
            idx_19 = 0;
            for (highp int i_18 = 0; i_18 < numSpheres; i_18++) {
              lowp float t_hit_21;
              t_hit_21 = t_hit_9;
              bool tmpvar_22;
              lowp vec3 tmpvar_23;
              tmpvar_23 = (sphereCenters[i_18] - ray_origin_7);
              lowp float tmpvar_24;
              tmpvar_24 = dot (tmpvar_23, ray_direction_8);
              if ((tmpvar_24 < 0.0)) {
                tmpvar_22 = bool(0);
              } else {
                lowp float tmpvar_25;
                tmpvar_25 = (dot (tmpvar_23, tmpvar_23) - (tmpvar_24 * tmpvar_24));
                if ((tmpvar_25 > 0.64)) {
                  tmpvar_22 = bool(0);
                } else {
                  lowp float tmpvar_26;
                  tmpvar_26 = sqrt((0.64 - tmpvar_25));
                  lowp float tmpvar_27;
                  tmpvar_27 = (tmpvar_24 - tmpvar_26);
                  lowp float tmpvar_28;
                  tmpvar_28 = (tmpvar_24 + tmpvar_26);
                  lowp float tmpvar_29;
                  if ((tmpvar_27 < 0.0)) {
                    tmpvar_29 = tmpvar_28;
                  } else {
                    tmpvar_29 = tmpvar_27;
                  };
                  if (((tmpvar_29 < t_hit_9) && (tmpvar_29 > 0.0))) {
                    t_hit_21 = tmpvar_29;
                    tmpvar_22 = bool(1);
                  } else {
                    tmpvar_22 = bool(0);
                  };
                };
              };
              t_hit_9 = t_hit_21;
              if (tmpvar_22) {
                idx_19 = i_18;
                intersected_20 = 1;
              };
            };
            for (highp int i_17 = 0; i_17 < numPlanes; i_17++) {
              lowp vec3 tmpvar_30;
              tmpvar_30 = planeNormals[i_17];
              lowp float t_hit_31;
              t_hit_31 = t_hit_9;
              bool tmpvar_32;
              tmpvar_32 = bool(1);
              bool tmpvar_33;
              lowp vec3 tmpvar_34;
              tmpvar_34 = (tmpvar_30 * planeOffsets[i_17]);
              lowp float tmpvar_35;
              tmpvar_35 = (((
                (tmpvar_34.x + tmpvar_34.y)
               + tmpvar_34.z) - dot (tmpvar_30, ray_origin_7)) / dot (tmpvar_30, ray_direction_8));
              if (((tmpvar_35 < t_hit_9) && (tmpvar_35 > 0.0))) {
                t_hit_31 = tmpvar_35;
                tmpvar_33 = bool(1);
                tmpvar_32 = bool(0);
              };
              if (tmpvar_32) {
                tmpvar_33 = bool(0);
                tmpvar_32 = bool(0);
              };
              t_hit_9 = t_hit_31;
              if (tmpvar_33) {
                normal_11 = tmpvar_30;
                idx_19 = i_17;
                intersected_20 = 2;
              };
            };
            intersectLight_16 = bool(0);
            for (highp int i_36 = 0; i_36 < numLights; i_36++) {
              bool tmp_37;
              vec3 tmpvar_38;
              tmpvar_38 = lightPos[i_36];
              vec2 tmpvar_39;
              tmpvar_39 = lightSize[i_36];
              tmp_37 = bool(0);
              if (((tmpvar_39.x > 0.0) && (tmpvar_39.y > 0.0))) {
                lowp float t_hit_40;
                t_hit_40 = t_hit_9;
                bool tmpvar_41;
                tmpvar_41 = bool(1);
                bool tmpvar_42;
                vec3 tmpvar_43;
                tmpvar_43 = (vec3(0.0, 1.0, 0.0) * tmpvar_38.y);
                lowp float tmpvar_44;
                tmpvar_44 = (((
                  (tmpvar_43.x + tmpvar_43.y)
                 + tmpvar_43.z) - ray_origin_7.y) / ray_direction_8.y);
                if (((tmpvar_44 < t_hit_9) && (tmpvar_44 > 0.0))) {
                  lowp vec3 tmpvar_45;
                  tmpvar_45 = (ray_origin_7 + (ray_direction_8 * tmpvar_44));
                  if ((((tmpvar_39.x + tmpvar_39.y) == 0.0) || ((
                    ((tmpvar_45.x < (tmpvar_38.x + (tmpvar_39.x * 0.5))) && (tmpvar_45.x > (tmpvar_38.x - (tmpvar_39.x * 0.5))))
                   && 
                    (tmpvar_45.z < (tmpvar_38.z + (tmpvar_39.y * 0.5)))
                  ) && (tmpvar_45.z > 
                    (tmpvar_38.z - (tmpvar_39.y * 0.5))
                  )))) {
                    t_hit_40 = tmpvar_44;
                    tmpvar_42 = bool(1);
                    tmpvar_41 = bool(0);
                  };
                };
                if (tmpvar_41) {
                  tmpvar_42 = bool(0);
                  tmpvar_41 = bool(0);
                };
                t_hit_9 = t_hit_40;
                tmp_37 = tmpvar_42;
              } else {
                lowp float t_hit_46;
                t_hit_46 = t_hit_9;
                bool tmpvar_47;
                lowp vec3 tmpvar_48;
                tmpvar_48 = (tmpvar_38 - ray_origin_7);
                lowp float tmpvar_49;
                tmpvar_49 = dot (tmpvar_48, ray_direction_8);
                if ((tmpvar_49 < 0.0)) {
                  tmpvar_47 = bool(0);
                } else {
                  lowp float tmpvar_50;
                  tmpvar_50 = (dot (tmpvar_48, tmpvar_48) - (tmpvar_49 * tmpvar_49));
                  if ((tmpvar_50 > 0.01)) {
                    tmpvar_47 = bool(0);
                  } else {
                    lowp float tmpvar_51;
                    tmpvar_51 = sqrt((0.01 - tmpvar_50));
                    lowp float tmpvar_52;
                    tmpvar_52 = (tmpvar_49 - tmpvar_51);
                    lowp float tmpvar_53;
                    tmpvar_53 = (tmpvar_49 + tmpvar_51);
                    lowp float tmpvar_54;
                    if ((tmpvar_52 < 0.0)) {
                      tmpvar_54 = tmpvar_53;
                    } else {
                      tmpvar_54 = tmpvar_52;
                    };
                    if (((tmpvar_54 < t_hit_9) && (tmpvar_54 > 0.0))) {
                      t_hit_46 = tmpvar_54;
                      tmpvar_47 = bool(1);
                    } else {
                      tmpvar_47 = bool(0);
                    };
                  };
                };
                t_hit_9 = t_hit_46;
                tmp_37 = tmpvar_47;
              };
              if (tmp_37) {
                idx_19 = i_36;
                intersected_20 = 3;
              };
            };
            position_10 = (origin + (tmpvar_6 * t_hit_9));
            if ((intersected_20 == 1)) {
              diffuseColor_12 = sphereColors[idx_19];
              specularColor_13 = sphereSpecColors[idx_19];
              reflectiveColor_14 = reflectiveColors[idx_19];
              roughness_15 = sphereRoughness[idx_19];
              lowp vec3 tmpvar_55;
              tmpvar_55 = normalize((position_10 - sphereCenters[idx_19]));
              normal_11 = tmpvar_55;
              lowp float tmpvar_56;
              tmpvar_56 = dot (tmpvar_55, -(tmpvar_6));
              if ((tmpvar_56 < 0.0)) {
                normal_11 = -(tmpvar_55);
              };
            } else {
              if ((intersected_20 == 2)) {
                if (!(enablePlaneMirrors)) {
                  diffuseColor_12 = planeColors[idx_19];
                  specularColor_13 = vec3(planeSpecular[idx_19]);
                  reflectiveColor_14 = vec3(0.0, 0.0, 0.0);
                  roughness_15 = planeRoughness[idx_19];
                } else {
                  diffuseColor_12 = (planeColors[idx_19] * 0.01);
                  specularColor_13 = vec3(0.0, 0.0, 0.0);
                  reflectiveColor_14 = planeColors[idx_19];
                  roughness_15 = 1.0;
                };
                lowp float tmpvar_57;
                tmpvar_57 = dot (normal_11, -(tmpvar_6));
                if ((tmpvar_57 < 0.0)) {
                  normal_11 = -(normal_11);
                };
              } else {
                if ((intersected_20 == 3)) {
                  diffuseColor_12 = (lightIntensity[idx_19] * 0.04);
                  intersectLight_16 = bool(1);
                };
              };
            };
            diffuseColor_4 = diffuseColor_12;
            specularColor_3 = specularColor_13;
            reflectiveColor_2 = reflectiveColor_14;
            roughness_1 = roughness_15;
            if (intersectLight_16) {
              lowp vec4 tmpvar_58;
              tmpvar_58.w = 1.0;
              tmpvar_58.xyz = diffuseColor_12;
              fragColor = tmpvar_58;
              return;
            };
            if (!(enableGI)) {
              pixelColor_5 = (pixelColor_5 + (ambientLight * diffuseColor_12));
            };
            lowp vec3 point_59;
            point_59 = position_10;
            lowp vec3 ray_dir_60;
            ray_dir_60 = tmpvar_6;
            lowp vec3 normal_61;
            normal_61 = normal_11;
            vec3 diffuseColor_62;
            diffuseColor_62 = diffuseColor_12;
            vec3 specularColor_63;
            specularColor_63 = specularColor_13;
            lowp vec3 illuminationColor_65;
            for (highp int i_64 = 0; i_64 < numLights; i_64++) {
              highp int k_66;
              bool inShade_67;
              highp int areaShadowSamples_68;
              highp int testSamples_69;
              lowp vec3 light_sum_70;
              vec2 lightSpot_71;
              vec2 lightSize_72;
              vec3 lightIntensity_73;
              vec3 lightPos_74;
              lightPos_74 = lightPos[i_64];
              lightIntensity_73 = lightIntensity[i_64];
              vec2 tmpvar_75;
              tmpvar_75 = lightSize[i_64];
              lightSize_72 = tmpvar_75;
              lightSpot_71 = lightSpot[i_64];
              bool tmpvar_76;
              tmpvar_76 = ((tmpvar_75.x > 0.0) && (tmpvar_75.y > 0.0));
              highp int tmpvar_77;
              if (tmpvar_76) {
                tmpvar_77 = 5;
              } else {
                tmpvar_77 = 1;
              };
              testSamples_69 = tmpvar_77;
              areaShadowSamples_68 = 0;
              inShade_67 = bool(0);
              k_66 = 0;
              while (true) {
                vec3 testPos_78;
                if ((k_66 >= testSamples_69)) {
                  break;
                };
                if (inShade_67) {
                  break;
                };
                testPos_78 = lightPos_74;
                if ((k_66 == 1)) {
                  testPos_78.x = (lightPos_74.x - (lightSize_72.x * 0.5));
                  testPos_78.z = (lightPos_74.z - (lightSize_72.y * 0.5));
                } else {
                  if ((k_66 == 2)) {
                    testPos_78.x = (testPos_78.x + (lightSize_72.x * 0.5));
                    testPos_78.z = (testPos_78.z + (lightSize_72.y * 0.5));
                  } else {
                    if ((k_66 == 3)) {
                      testPos_78.x = (testPos_78.x + (lightSize_72.x * 0.5));
                      testPos_78.z = (testPos_78.z - (lightSize_72.y * 0.5));
                    } else {
                      if ((k_66 == 4)) {
                        testPos_78.x = (testPos_78.x - (lightSize_72.x * 0.5));
                        testPos_78.z = (testPos_78.z + (lightSize_72.y * 0.5));
                      };
                    };
                  };
                };
                lowp vec3 vec_to_light_79;
                lowp vec3 incident_intensity_80;
                lowp float spot_falloff_81;
                vec_to_light_79 = (testPos_78 - point_59);
                lowp float tmpvar_82;
                tmpvar_82 = sqrt(dot (vec_to_light_79, vec_to_light_79));
                lowp float tmpvar_83;
                tmpvar_83 = (1.0/(((attenuation.x * 
                  (tmpvar_82 * tmpvar_82)
                ) + (attenuation.y * tmpvar_82))));
                lowp vec3 tmpvar_84;
                tmpvar_84 = normalize(vec_to_light_79);
                vec_to_light_79 = tmpvar_84;
                spot_falloff_81 = 1.0;
                if ((lightSpot_71.x > 0.0)) {
                  lowp float tmpvar_85;
                  if ((tmpvar_84.y > lightSpot_71.x)) {
                    tmpvar_85 = pow (tmpvar_84.y, lightSpot_71.y);
                  } else {
                    tmpvar_85 = 0.0;
                  };
                  spot_falloff_81 = tmpvar_85;
                };
                incident_intensity_80 = ((lightIntensity_73 * tmpvar_83) * spot_falloff_81);
                lowp float tmpvar_86;
                tmpvar_86 = sqrt(dot (incident_intensity_80, incident_intensity_80));
                if ((tmpvar_86 > 0.01)) {
                  lowp vec3 ray_origin_87;
                  ray_origin_87 = point_59;
                  lowp vec3 ray_direction_88;
                  ray_direction_88 = tmpvar_84;
                  lowp float t_hit_89;
                  t_hit_89 = tmpvar_82;
                  bool tmpvar_90;
                  tmpvar_90 = bool(0);
                  highp int i_91;
                  highp int i_92;
                  i_92 = 0;
                  while (true) {
                    if ((i_92 >= numSpheres)) {
                      break;
                    };
                    lowp float t_hit_93;
                    t_hit_93 = t_hit_89;
                    bool tmpvar_94;
                    lowp vec3 tmpvar_95;
                    tmpvar_95 = (sphereCenters[i_92] - ray_origin_87);
                    lowp float tmpvar_96;
                    tmpvar_96 = dot (tmpvar_95, ray_direction_88);
                    if ((tmpvar_96 < 0.0)) {
                      tmpvar_94 = bool(0);
                    } else {
                      lowp float tmpvar_97;
                      tmpvar_97 = (dot (tmpvar_95, tmpvar_95) - (tmpvar_96 * tmpvar_96));
                      if ((tmpvar_97 > 0.64)) {
                        tmpvar_94 = bool(0);
                      } else {
                        lowp float tmpvar_98;
                        tmpvar_98 = sqrt((0.64 - tmpvar_97));
                        lowp float tmpvar_99;
                        tmpvar_99 = (tmpvar_96 - tmpvar_98);
                        lowp float tmpvar_100;
                        tmpvar_100 = (tmpvar_96 + tmpvar_98);
                        lowp float tmpvar_101;
                        if ((tmpvar_99 < 0.01)) {
                          tmpvar_101 = tmpvar_100;
                        } else {
                          tmpvar_101 = tmpvar_99;
                        };
                        if (((tmpvar_101 < t_hit_89) && (tmpvar_101 > 0.01))) {
                          t_hit_93 = tmpvar_101;
                          tmpvar_94 = bool(1);
                        } else {
                          tmpvar_94 = bool(0);
                        };
                      };
                    };
                    t_hit_89 = t_hit_93;
                    if (tmpvar_94) {
                      tmpvar_90 = bool(1);
                      break;
                    };
                    i_92++;
                  };
                  if (!(tmpvar_90)) {
                    i_91 = 0;
                    while (true) {
                      if ((i_91 >= numPlanes)) {
                        break;
                      };
                      vec3 normal_102;
                      normal_102 = planeNormals[i_91];
                      lowp float t_hit_103;
                      t_hit_103 = t_hit_89;
                      bool tmpvar_104;
                      tmpvar_104 = bool(1);
                      bool tmpvar_105;
                      vec3 tmpvar_106;
                      tmpvar_106 = (normal_102 * planeOffsets[i_91]);
                      lowp float tmpvar_107;
                      tmpvar_107 = (((
                        (tmpvar_106.x + tmpvar_106.y)
                       + tmpvar_106.z) - dot (normal_102, ray_origin_87)) / dot (normal_102, ray_direction_88));
                      if (((tmpvar_107 < t_hit_89) && (tmpvar_107 > 0.01))) {
                        t_hit_103 = tmpvar_107;
                        tmpvar_105 = bool(1);
                        tmpvar_104 = bool(0);
                      };
                      if (tmpvar_104) {
                        tmpvar_105 = bool(0);
                        tmpvar_104 = bool(0);
                      };
                      t_hit_89 = t_hit_103;
                      if (tmpvar_105) {
                        tmpvar_90 = bool(1);
                        break;
                      };
                      i_91++;
                    };
                    if (!(tmpvar_90)) {
                      tmpvar_90 = bool(1);
                    };
                  };
                  lowp float tmpvar_108;
                  tmpvar_108 = abs((t_hit_89 - tmpvar_82));
                  if ((tmpvar_108 < 0.001)) {
                    lowp vec3 tmpvar_109;
                    lowp float tmpvar_110;
                    tmpvar_110 = dot (normal_61, tmpvar_84);
                    if ((tmpvar_110 > 0.0)) {
                      tmpvar_109 = (incident_intensity_80 * ((diffuseColor_62 * 
                        max (0.0, dot (normal_61, tmpvar_84))
                      ) + (specularColor_63 * 
                        pow (max (0.0, dot ((
                          -(tmpvar_84)
                         - 
                          ((2.0 * dot (-(tmpvar_84), normal_61)) * normal_61)
                        ), -(ray_dir_60))), 128.0)
                      )));
                    } else {
                      tmpvar_109 = vec3(0.0, 0.0, 0.0);
                    };
                    light_sum_70 = (light_sum_70 + tmpvar_109);
                  } else {
                    inShade_67 = bool(1);
                  };
                } else {
                  inShade_67 = bool(1);
                };
                areaShadowSamples_68++;
                k_66++;
              };
              if ((tmpvar_76 && inShade_67)) {
                highp int k_111;
                areaShadowSamples_68 = shadowSamples;
                light_sum_70 = vec3(0.0, 0.0, 0.0);
                k_111 = 0;
                while (true) {
                  lowp vec3 incident_intensity_112;
                  if ((k_111 >= areaShadowSamples_68)) {
                    break;
                  };
                  float sample_i_113;
                  sample_i_113 = float(k_111);
                  lowp vec3 vec_to_light_114;
                  lowp float spot_falloff_115;
                  float tmpvar_116;
                  tmpvar_116 = (1.0/(shadowDim));
                  randomIncrement += 0.02;
                  lowp float tmpvar_117;
                  tmpvar_117 = ((lightSize_72.x * tmpvar_116) * ((float(mod (sample_i_113, shadowDim))) + fract(
                    (cos(dot ((point_59.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                  )));
                  randomIncrement += 0.02;
                  lowp vec3 tmpvar_118;
                  tmpvar_118.x = ((lightPos_74.x - (lightSize_72.x * 0.5)) + tmpvar_117);
                  tmpvar_118.y = lightPos_74.y;
                  tmpvar_118.z = ((lightPos_74.z - (lightSize_72.y * 0.5)) + ((lightSize_72.y * tmpvar_116) * (
                    floor((sample_i_113 * tmpvar_116))
                   + 
                    fract((cos(dot (
                      (point_59.yx + randomIncrement)
                    , vec2(23.14069, 2.665144))) * 12345.68))
                  )));
                  vec_to_light_114 = (tmpvar_118 - point_59);
                  lowp float tmpvar_119;
                  tmpvar_119 = sqrt(dot (vec_to_light_114, vec_to_light_114));
                  lowp float tmpvar_120;
                  tmpvar_120 = (1.0/(((attenuation.x * 
                    (tmpvar_119 * tmpvar_119)
                  ) + (attenuation.y * tmpvar_119))));
                  lowp vec3 tmpvar_121;
                  tmpvar_121 = normalize(vec_to_light_114);
                  vec_to_light_114 = tmpvar_121;
                  spot_falloff_115 = 1.0;
                  if ((lightSpot_71.x > 0.0)) {
                    lowp float tmpvar_122;
                    if ((tmpvar_121.y > lightSpot_71.x)) {
                      tmpvar_122 = pow (tmpvar_121.y, lightSpot_71.y);
                    } else {
                      tmpvar_122 = 0.0;
                    };
                    spot_falloff_115 = tmpvar_122;
                  };
                  incident_intensity_112 = ((lightIntensity_73 * tmpvar_120) * spot_falloff_115);
                  lowp vec3 ray_origin_123;
                  ray_origin_123 = point_59;
                  lowp vec3 ray_direction_124;
                  ray_direction_124 = tmpvar_121;
                  lowp float t_hit_125;
                  t_hit_125 = tmpvar_119;
                  bool tmpvar_126;
                  tmpvar_126 = bool(0);
                  highp int i_127;
                  highp int i_128;
                  i_128 = 0;
                  while (true) {
                    if ((i_128 >= numSpheres)) {
                      break;
                    };
                    lowp float t_hit_129;
                    t_hit_129 = t_hit_125;
                    bool tmpvar_130;
                    lowp vec3 tmpvar_131;
                    tmpvar_131 = (sphereCenters[i_128] - ray_origin_123);
                    lowp float tmpvar_132;
                    tmpvar_132 = dot (tmpvar_131, ray_direction_124);
                    if ((tmpvar_132 < 0.0)) {
                      tmpvar_130 = bool(0);
                    } else {
                      lowp float tmpvar_133;
                      tmpvar_133 = (dot (tmpvar_131, tmpvar_131) - (tmpvar_132 * tmpvar_132));
                      if ((tmpvar_133 > 0.64)) {
                        tmpvar_130 = bool(0);
                      } else {
                        lowp float tmpvar_134;
                        tmpvar_134 = sqrt((0.64 - tmpvar_133));
                        lowp float tmpvar_135;
                        tmpvar_135 = (tmpvar_132 - tmpvar_134);
                        lowp float tmpvar_136;
                        tmpvar_136 = (tmpvar_132 + tmpvar_134);
                        lowp float tmpvar_137;
                        if ((tmpvar_135 < 0.01)) {
                          tmpvar_137 = tmpvar_136;
                        } else {
                          tmpvar_137 = tmpvar_135;
                        };
                        if (((tmpvar_137 < t_hit_125) && (tmpvar_137 > 0.01))) {
                          t_hit_129 = tmpvar_137;
                          tmpvar_130 = bool(1);
                        } else {
                          tmpvar_130 = bool(0);
                        };
                      };
                    };
                    t_hit_125 = t_hit_129;
                    if (tmpvar_130) {
                      tmpvar_126 = bool(1);
                      break;
                    };
                    i_128++;
                  };
                  if (!(tmpvar_126)) {
                    i_127 = 0;
                    while (true) {
                      if ((i_127 >= numPlanes)) {
                        break;
                      };
                      vec3 normal_138;
                      normal_138 = planeNormals[i_127];
                      lowp float t_hit_139;
                      t_hit_139 = t_hit_125;
                      bool tmpvar_140;
                      tmpvar_140 = bool(1);
                      bool tmpvar_141;
                      vec3 tmpvar_142;
                      tmpvar_142 = (normal_138 * planeOffsets[i_127]);
                      lowp float tmpvar_143;
                      tmpvar_143 = (((
                        (tmpvar_142.x + tmpvar_142.y)
                       + tmpvar_142.z) - dot (normal_138, ray_origin_123)) / dot (normal_138, ray_direction_124));
                      if (((tmpvar_143 < t_hit_125) && (tmpvar_143 > 0.01))) {
                        t_hit_139 = tmpvar_143;
                        tmpvar_141 = bool(1);
                        tmpvar_140 = bool(0);
                      };
                      if (tmpvar_140) {
                        tmpvar_141 = bool(0);
                        tmpvar_140 = bool(0);
                      };
                      t_hit_125 = t_hit_139;
                      if (tmpvar_141) {
                        tmpvar_126 = bool(1);
                        break;
                      };
                      i_127++;
                    };
                    if (!(tmpvar_126)) {
                      tmpvar_126 = bool(1);
                    };
                  };
                  lowp float tmpvar_144;
                  tmpvar_144 = abs((t_hit_125 - tmpvar_119));
                  if ((tmpvar_144 < 0.001)) {
                    lowp vec3 tmpvar_145;
                    lowp float tmpvar_146;
                    tmpvar_146 = dot (normal_61, tmpvar_121);
                    if ((tmpvar_146 > 0.0)) {
                      tmpvar_145 = (incident_intensity_112 * ((diffuseColor_62 * 
                        max (0.0, dot (normal_61, tmpvar_121))
                      ) + (specularColor_63 * 
                        pow (max (0.0, dot ((
                          -(tmpvar_121)
                         - 
                          ((2.0 * dot (-(tmpvar_121), normal_61)) * normal_61)
                        ), -(ray_dir_60))), 128.0)
                      )));
                    } else {
                      tmpvar_145 = vec3(0.0, 0.0, 0.0);
                    };
                    light_sum_70 = (light_sum_70 + tmpvar_145);
                  };
                  k_111++;
                };
              };
              illuminationColor_65 = (illuminationColor_65 + (light_sum_70 / float(areaShadowSamples_68)));
            };
            pixelColor_5 = (pixelColor_5 + illuminationColor_65);
            if (enableGI) {
              lowp vec3 point_147;
              point_147 = position_10;
              lowp vec3 rayDir_148;
              rayDir_148 = tmpvar_6;
              lowp vec3 normal_149;
              normal_149 = normal_11;
              float roughness_150;
              roughness_150 = roughness_15;
              lowp vec3 tmpvar_151;
              lowp vec3 indirect_sampling_sum_153;
              float tmpvar_154;
              tmpvar_154 = sqrt(dot (diffuseColor_12, diffuseColor_12));
              if ((tmpvar_154 == 0.0)) {
                tmpvar_151 = vec3(0.0, 0.0, 0.0);
              } else {
                for (highp int k_152 = 0; k_152 < indirectSamples; k_152++) {
                  float indirectRoughness_155;
                  vec3 indirectRefColor_156;
                  vec3 indirectSpecularColor_157;
                  vec3 indirectDiffuseColor_158;
                  float sampleIdx_159;
                  sampleIdx_159 = float(k_152);
                  randomIncrement += 0.02;
                  lowp float tmpvar_160;
                  tmpvar_160 = ((1.0 - (
                    (sampleIdx_159 / float((indirectSamples - 1)))
                   * 2.0)) + ((
                    fract((cos(dot (
                      (point_147.xy + randomIncrement)
                    , vec2(23.14069, 2.665144))) * 12345.68))
                   * 0.4) - 0.2));
                  lowp float tmpvar_161;
                  tmpvar_161 = sqrt((1.0 - (tmpvar_160 * tmpvar_160)));
                  randomIncrement += 0.02;
                  lowp float tmpvar_162;
                  tmpvar_162 = ((2.399963 * sampleIdx_159) + ((
                    fract((cos(dot (
                      (point_147.xy + randomIncrement)
                    , vec2(23.14069, 2.665144))) * 12345.68))
                   * 0.5) - 0.25));
                  lowp vec3 tmpvar_163;
                  tmpvar_163.x = (cos(tmpvar_162) * tmpvar_161);
                  tmpvar_163.y = tmpvar_160;
                  tmpvar_163.z = (sin(tmpvar_162) * tmpvar_161);
                  lowp vec3 tmpvar_164;
                  tmpvar_164 = normalize(mix ((rayDir_148 - 
                    (2.0 * (dot (normal_149, rayDir_148) * normal_149))
                  ), normalize(
                    (normal_149 + tmpvar_163)
                  ), roughness_150));
                  lowp vec3 ray_origin_165;
                  ray_origin_165 = point_147;
                  lowp vec3 ray_direction_166;
                  ray_direction_166 = tmpvar_164;
                  lowp float t_hit_167;
                  t_hit_167 = 10.0;
                  lowp vec3 position_168;
                  lowp vec3 normal_169;
                  vec3 diffuseColor_170;
                  diffuseColor_170 = indirectDiffuseColor_158;
                  vec3 specularColor_171;
                  specularColor_171 = indirectSpecularColor_157;
                  vec3 reflectiveColor_172;
                  reflectiveColor_172 = indirectRefColor_156;
                  float roughness_173;
                  roughness_173 = indirectRoughness_155;
                  highp int idx_176;
                  highp int intersected_177;
                  intersected_177 = 0;
                  idx_176 = 0;
                  for (highp int i_175 = 0; i_175 < numSpheres; i_175++) {
                    lowp float t_hit_178;
                    t_hit_178 = t_hit_167;
                    bool tmpvar_179;
                    lowp vec3 tmpvar_180;
                    tmpvar_180 = (sphereCenters[i_175] - ray_origin_165);
                    lowp float tmpvar_181;
                    tmpvar_181 = dot (tmpvar_180, ray_direction_166);
                    if ((tmpvar_181 < 0.0)) {
                      tmpvar_179 = bool(0);
                    } else {
                      lowp float tmpvar_182;
                      tmpvar_182 = (dot (tmpvar_180, tmpvar_180) - (tmpvar_181 * tmpvar_181));
                      if ((tmpvar_182 > 0.64)) {
                        tmpvar_179 = bool(0);
                      } else {
                        lowp float tmpvar_183;
                        tmpvar_183 = sqrt((0.64 - tmpvar_182));
                        lowp float tmpvar_184;
                        tmpvar_184 = (tmpvar_181 - tmpvar_183);
                        lowp float tmpvar_185;
                        tmpvar_185 = (tmpvar_181 + tmpvar_183);
                        lowp float tmpvar_186;
                        if ((tmpvar_184 < 0.01)) {
                          tmpvar_186 = tmpvar_185;
                        } else {
                          tmpvar_186 = tmpvar_184;
                        };
                        if (((tmpvar_186 < t_hit_167) && (tmpvar_186 > 0.01))) {
                          t_hit_178 = tmpvar_186;
                          tmpvar_179 = bool(1);
                        } else {
                          tmpvar_179 = bool(0);
                        };
                      };
                    };
                    t_hit_167 = t_hit_178;
                    if (tmpvar_179) {
                      idx_176 = i_175;
                      intersected_177 = 1;
                    };
                  };
                  for (highp int i_174 = 0; i_174 < numPlanes; i_174++) {
                    lowp vec3 tmpvar_187;
                    tmpvar_187 = planeNormals[i_174];
                    lowp float t_hit_188;
                    t_hit_188 = t_hit_167;
                    bool tmpvar_189;
                    tmpvar_189 = bool(1);
                    bool tmpvar_190;
                    lowp vec3 tmpvar_191;
                    tmpvar_191 = (tmpvar_187 * planeOffsets[i_174]);
                    lowp float tmpvar_192;
                    tmpvar_192 = (((
                      (tmpvar_191.x + tmpvar_191.y)
                     + tmpvar_191.z) - dot (tmpvar_187, ray_origin_165)) / dot (tmpvar_187, ray_direction_166));
                    if (((tmpvar_192 < t_hit_167) && (tmpvar_192 > 0.01))) {
                      t_hit_188 = tmpvar_192;
                      tmpvar_190 = bool(1);
                      tmpvar_189 = bool(0);
                    };
                    if (tmpvar_189) {
                      tmpvar_190 = bool(0);
                      tmpvar_189 = bool(0);
                    };
                    t_hit_167 = t_hit_188;
                    if (tmpvar_190) {
                      normal_169 = tmpvar_187;
                      idx_176 = i_174;
                      intersected_177 = 2;
                    };
                  };
                  position_168 = (point_147 + (tmpvar_164 * t_hit_167));
                  if ((intersected_177 == 1)) {
                    diffuseColor_170 = sphereColors[idx_176];
                    specularColor_171 = sphereSpecColors[idx_176];
                    reflectiveColor_172 = reflectiveColors[idx_176];
                    roughness_173 = sphereRoughness[idx_176];
                    lowp vec3 tmpvar_193;
                    tmpvar_193 = normalize((position_168 - sphereCenters[idx_176]));
                    normal_169 = tmpvar_193;
                    lowp float tmpvar_194;
                    tmpvar_194 = dot (tmpvar_193, -(tmpvar_164));
                    if ((tmpvar_194 < 0.0)) {
                      normal_169 = -(tmpvar_193);
                    };
                  } else {
                    if ((intersected_177 == 2)) {
                      if (!(enablePlaneMirrors)) {
                        diffuseColor_170 = planeColors[idx_176];
                        specularColor_171 = vec3(planeSpecular[idx_176]);
                        reflectiveColor_172 = vec3(0.0, 0.0, 0.0);
                        roughness_173 = planeRoughness[idx_176];
                      } else {
                        diffuseColor_170 = (planeColors[idx_176] * 0.01);
                        specularColor_171 = vec3(0.0, 0.0, 0.0);
                        reflectiveColor_172 = planeColors[idx_176];
                        roughness_173 = 1.0;
                      };
                      lowp float tmpvar_195;
                      tmpvar_195 = dot (normal_169, -(tmpvar_164));
                      if ((tmpvar_195 < 0.0)) {
                        normal_169 = -(normal_169);
                      };
                    } else {
                      if ((intersected_177 == 3)) {
                        diffuseColor_170 = (lightIntensity[idx_176] * 0.04);
                      };
                    };
                  };
                  indirectDiffuseColor_158 = diffuseColor_170;
                  indirectSpecularColor_157 = specularColor_171;
                  indirectRefColor_156 = reflectiveColor_172;
                  indirectRoughness_155 = roughness_173;
                  lowp vec3 point_196;
                  point_196 = position_168;
                  lowp vec3 ray_dir_197;
                  ray_dir_197 = tmpvar_164;
                  lowp vec3 normal_198;
                  normal_198 = normal_169;
                  vec3 diffuseColor_199;
                  diffuseColor_199 = (diffuseColor_170 + reflectiveColor_172);
                  vec3 specularColor_200;
                  specularColor_200 = specularColor_171;
                  lowp vec3 illuminationColor_202;
                  for (highp int i_201 = 0; i_201 < numLights; i_201++) {
                    highp int k_203;
                    bool inShade_204;
                    highp int areaShadowSamples_205;
                    lowp vec3 light_sum_206;
                    vec2 lightSpot_207;
                    vec2 lightSize_208;
                    vec3 lightIntensity_209;
                    vec3 lightPos_210;
                    lightPos_210 = lightPos[i_201];
                    lightIntensity_209 = lightIntensity[i_201];
                    lightSize_208 = lightSize[i_201];
                    lightSpot_207 = lightSpot[i_201];
                    areaShadowSamples_205 = 0;
                    inShade_204 = bool(0);
                    k_203 = 0;
                    while (true) {
                      vec3 testPos_211;
                      if ((k_203 >= 1)) {
                        break;
                      };
                      if (inShade_204) {
                        break;
                      };
                      testPos_211 = lightPos_210;
                      if ((k_203 == 1)) {
                        testPos_211.x = (lightPos_210.x - (lightSize_208.x * 0.5));
                        testPos_211.z = (lightPos_210.z - (lightSize_208.y * 0.5));
                      } else {
                        if ((k_203 == 2)) {
                          testPos_211.x = (testPos_211.x + (lightSize_208.x * 0.5));
                          testPos_211.z = (testPos_211.z + (lightSize_208.y * 0.5));
                        } else {
                          if ((k_203 == 3)) {
                            testPos_211.x = (testPos_211.x + (lightSize_208.x * 0.5));
                            testPos_211.z = (testPos_211.z - (lightSize_208.y * 0.5));
                          } else {
                            if ((k_203 == 4)) {
                              testPos_211.x = (testPos_211.x - (lightSize_208.x * 0.5));
                              testPos_211.z = (testPos_211.z + (lightSize_208.y * 0.5));
                            };
                          };
                        };
                      };
                      lowp vec3 vec_to_light_212;
                      lowp vec3 incident_intensity_213;
                      lowp float spot_falloff_214;
                      vec_to_light_212 = (testPos_211 - point_196);
                      lowp float tmpvar_215;
                      tmpvar_215 = sqrt(dot (vec_to_light_212, vec_to_light_212));
                      lowp float tmpvar_216;
                      tmpvar_216 = (1.0/(((attenuation.x * 
                        (tmpvar_215 * tmpvar_215)
                      ) + (attenuation.y * tmpvar_215))));
                      lowp vec3 tmpvar_217;
                      tmpvar_217 = normalize(vec_to_light_212);
                      vec_to_light_212 = tmpvar_217;
                      spot_falloff_214 = 1.0;
                      if ((lightSpot_207.x > 0.0)) {
                        lowp float tmpvar_218;
                        if ((tmpvar_217.y > lightSpot_207.x)) {
                          tmpvar_218 = pow (tmpvar_217.y, lightSpot_207.y);
                        } else {
                          tmpvar_218 = 0.0;
                        };
                        spot_falloff_214 = tmpvar_218;
                      };
                      incident_intensity_213 = ((lightIntensity_209 * tmpvar_216) * spot_falloff_214);
                      lowp float tmpvar_219;
                      tmpvar_219 = sqrt(dot (incident_intensity_213, incident_intensity_213));
                      if ((tmpvar_219 > 0.01)) {
                        lowp vec3 ray_origin_220;
                        ray_origin_220 = point_196;
                        lowp vec3 ray_direction_221;
                        ray_direction_221 = tmpvar_217;
                        lowp float t_hit_222;
                        t_hit_222 = tmpvar_215;
                        bool tmpvar_223;
                        tmpvar_223 = bool(0);
                        highp int i_224;
                        highp int i_225;
                        i_225 = 0;
                        while (true) {
                          if ((i_225 >= numSpheres)) {
                            break;
                          };
                          lowp float t_hit_226;
                          t_hit_226 = t_hit_222;
                          bool tmpvar_227;
                          lowp vec3 tmpvar_228;
                          tmpvar_228 = (sphereCenters[i_225] - ray_origin_220);
                          lowp float tmpvar_229;
                          tmpvar_229 = dot (tmpvar_228, ray_direction_221);
                          if ((tmpvar_229 < 0.0)) {
                            tmpvar_227 = bool(0);
                          } else {
                            lowp float tmpvar_230;
                            tmpvar_230 = (dot (tmpvar_228, tmpvar_228) - (tmpvar_229 * tmpvar_229));
                            if ((tmpvar_230 > 0.64)) {
                              tmpvar_227 = bool(0);
                            } else {
                              lowp float tmpvar_231;
                              tmpvar_231 = sqrt((0.64 - tmpvar_230));
                              lowp float tmpvar_232;
                              tmpvar_232 = (tmpvar_229 - tmpvar_231);
                              lowp float tmpvar_233;
                              tmpvar_233 = (tmpvar_229 + tmpvar_231);
                              lowp float tmpvar_234;
                              if ((tmpvar_232 < 0.01)) {
                                tmpvar_234 = tmpvar_233;
                              } else {
                                tmpvar_234 = tmpvar_232;
                              };
                              if (((tmpvar_234 < t_hit_222) && (tmpvar_234 > 0.01))) {
                                t_hit_226 = tmpvar_234;
                                tmpvar_227 = bool(1);
                              } else {
                                tmpvar_227 = bool(0);
                              };
                            };
                          };
                          t_hit_222 = t_hit_226;
                          if (tmpvar_227) {
                            tmpvar_223 = bool(1);
                            break;
                          };
                          i_225++;
                        };
                        if (!(tmpvar_223)) {
                          i_224 = 0;
                          while (true) {
                            if ((i_224 >= numPlanes)) {
                              break;
                            };
                            vec3 normal_235;
                            normal_235 = planeNormals[i_224];
                            lowp float t_hit_236;
                            t_hit_236 = t_hit_222;
                            bool tmpvar_237;
                            tmpvar_237 = bool(1);
                            bool tmpvar_238;
                            vec3 tmpvar_239;
                            tmpvar_239 = (normal_235 * planeOffsets[i_224]);
                            lowp float tmpvar_240;
                            tmpvar_240 = (((
                              (tmpvar_239.x + tmpvar_239.y)
                             + tmpvar_239.z) - dot (normal_235, ray_origin_220)) / dot (normal_235, ray_direction_221));
                            if (((tmpvar_240 < t_hit_222) && (tmpvar_240 > 0.01))) {
                              t_hit_236 = tmpvar_240;
                              tmpvar_238 = bool(1);
                              tmpvar_237 = bool(0);
                            };
                            if (tmpvar_237) {
                              tmpvar_238 = bool(0);
                              tmpvar_237 = bool(0);
                            };
                            t_hit_222 = t_hit_236;
                            if (tmpvar_238) {
                              tmpvar_223 = bool(1);
                              break;
                            };
                            i_224++;
                          };
                          if (!(tmpvar_223)) {
                            tmpvar_223 = bool(1);
                          };
                        };
                        lowp float tmpvar_241;
                        tmpvar_241 = abs((t_hit_222 - tmpvar_215));
                        if ((tmpvar_241 < 0.001)) {
                          lowp vec3 tmpvar_242;
                          lowp float tmpvar_243;
                          tmpvar_243 = dot (normal_198, tmpvar_217);
                          if ((tmpvar_243 > 0.0)) {
                            tmpvar_242 = (incident_intensity_213 * ((diffuseColor_199 * 
                              max (0.0, dot (normal_198, tmpvar_217))
                            ) + (specularColor_200 * 
                              pow (max (0.0, dot ((
                                -(tmpvar_217)
                               - 
                                ((2.0 * dot (-(tmpvar_217), normal_198)) * normal_198)
                              ), -(ray_dir_197))), 128.0)
                            )));
                          } else {
                            tmpvar_242 = vec3(0.0, 0.0, 0.0);
                          };
                          light_sum_206 = (light_sum_206 + tmpvar_242);
                        } else {
                          inShade_204 = bool(1);
                        };
                      } else {
                        inShade_204 = bool(1);
                      };
                      areaShadowSamples_205++;
                      k_203++;
                    };
                    illuminationColor_202 = (illuminationColor_202 + (light_sum_206 / float(areaShadowSamples_205)));
                  };
                  indirect_sampling_sum_153 = (indirect_sampling_sum_153 + illuminationColor_202);
                };
                tmpvar_151 = ((indirect_sampling_sum_153 / float(indirectSamples)) * diffuseColor_12);
              };
              pixelColor_5 = (pixelColor_5 + tmpvar_151);
            };
            bool tmpvar_244;
            if ((rayBounces > 0)) {
              tmpvar_244 = (sqrt(dot (reflectiveColor_14, reflectiveColor_14)) > 0.0);
            } else {
              tmpvar_244 = bool(0);
            };
            if (tmpvar_244) {
              lowp vec3 origin_245;
              origin_245 = position_10;
              lowp vec3 rayDir_246;
              rayDir_246 = tmpvar_6;
              lowp vec3 normal_247;
              normal_247 = normal_11;
              vec3 refColor_248;
              refColor_248 = reflectiveColor_14;
              highp int i_249;
              lowp vec3 reflectionSum_250;
              i_249 = 0;
              while (true) {
                lowp vec3 mirror_sample_color_251;
                float hitRoughness_252;
                vec3 bounceRefColor_253;
                vec3 bounceSpecularColor_254;
                vec3 bounceDiffuseColor_255;
                if ((i_249 >= rayBounces)) {
                  break;
                };
                if ((((refColor_248.x + refColor_248.y) + refColor_248.z) == 0.0)) {
                  break;
                };
                lowp vec3 tmpvar_256;
                tmpvar_256 = (rayDir_246 - (2.0 * (
                  dot (normal_247, rayDir_246)
                 * normal_247)));
                lowp vec3 ray_origin_257;
                ray_origin_257 = origin_245;
                lowp vec3 ray_direction_258;
                ray_direction_258 = tmpvar_256;
                lowp float t_hit_259;
                t_hit_259 = 50.0;
                lowp vec3 position_260;
                lowp vec3 normal_261;
                vec3 diffuseColor_262;
                diffuseColor_262 = bounceDiffuseColor_255;
                vec3 specularColor_263;
                specularColor_263 = bounceSpecularColor_254;
                vec3 reflectiveColor_264;
                reflectiveColor_264 = bounceRefColor_253;
                float roughness_265;
                roughness_265 = hitRoughness_252;
                bool intersectLight_266;
                intersectLight_266 = bool(1);
                highp int idx_269;
                highp int intersected_270;
                intersected_270 = 0;
                idx_269 = 0;
                for (highp int i_268 = 0; i_268 < numSpheres; i_268++) {
                  lowp float t_hit_271;
                  t_hit_271 = t_hit_259;
                  bool tmpvar_272;
                  lowp vec3 tmpvar_273;
                  tmpvar_273 = (sphereCenters[i_268] - ray_origin_257);
                  lowp float tmpvar_274;
                  tmpvar_274 = dot (tmpvar_273, ray_direction_258);
                  if ((tmpvar_274 < 0.0)) {
                    tmpvar_272 = bool(0);
                  } else {
                    lowp float tmpvar_275;
                    tmpvar_275 = (dot (tmpvar_273, tmpvar_273) - (tmpvar_274 * tmpvar_274));
                    if ((tmpvar_275 > 0.64)) {
                      tmpvar_272 = bool(0);
                    } else {
                      lowp float tmpvar_276;
                      tmpvar_276 = sqrt((0.64 - tmpvar_275));
                      lowp float tmpvar_277;
                      tmpvar_277 = (tmpvar_274 - tmpvar_276);
                      lowp float tmpvar_278;
                      tmpvar_278 = (tmpvar_274 + tmpvar_276);
                      lowp float tmpvar_279;
                      if ((tmpvar_277 < 0.01)) {
                        tmpvar_279 = tmpvar_278;
                      } else {
                        tmpvar_279 = tmpvar_277;
                      };
                      if (((tmpvar_279 < t_hit_259) && (tmpvar_279 > 0.01))) {
                        t_hit_271 = tmpvar_279;
                        tmpvar_272 = bool(1);
                      } else {
                        tmpvar_272 = bool(0);
                      };
                    };
                  };
                  t_hit_259 = t_hit_271;
                  if (tmpvar_272) {
                    idx_269 = i_268;
                    intersected_270 = 1;
                  };
                };
                for (highp int i_267 = 0; i_267 < numPlanes; i_267++) {
                  lowp vec3 tmpvar_280;
                  tmpvar_280 = planeNormals[i_267];
                  lowp float t_hit_281;
                  t_hit_281 = t_hit_259;
                  bool tmpvar_282;
                  tmpvar_282 = bool(1);
                  bool tmpvar_283;
                  lowp vec3 tmpvar_284;
                  tmpvar_284 = (tmpvar_280 * planeOffsets[i_267]);
                  lowp float tmpvar_285;
                  tmpvar_285 = (((
                    (tmpvar_284.x + tmpvar_284.y)
                   + tmpvar_284.z) - dot (tmpvar_280, ray_origin_257)) / dot (tmpvar_280, ray_direction_258));
                  if (((tmpvar_285 < t_hit_259) && (tmpvar_285 > 0.01))) {
                    t_hit_281 = tmpvar_285;
                    tmpvar_283 = bool(1);
                    tmpvar_282 = bool(0);
                  };
                  if (tmpvar_282) {
                    tmpvar_283 = bool(0);
                    tmpvar_282 = bool(0);
                  };
                  t_hit_259 = t_hit_281;
                  if (tmpvar_283) {
                    normal_261 = tmpvar_280;
                    idx_269 = i_267;
                    intersected_270 = 2;
                  };
                };
                intersectLight_266 = bool(0);
                for (highp int i_286 = 0; i_286 < numLights; i_286++) {
                  bool tmp_287;
                  vec3 tmpvar_288;
                  tmpvar_288 = lightPos[i_286];
                  vec2 tmpvar_289;
                  tmpvar_289 = lightSize[i_286];
                  tmp_287 = bool(0);
                  if (((tmpvar_289.x > 0.0) && (tmpvar_289.y > 0.0))) {
                    lowp float t_hit_290;
                    t_hit_290 = t_hit_259;
                    bool tmpvar_291;
                    tmpvar_291 = bool(1);
                    bool tmpvar_292;
                    vec3 tmpvar_293;
                    tmpvar_293 = (vec3(0.0, 1.0, 0.0) * tmpvar_288.y);
                    lowp float tmpvar_294;
                    tmpvar_294 = (((
                      (tmpvar_293.x + tmpvar_293.y)
                     + tmpvar_293.z) - ray_origin_257.y) / ray_direction_258.y);
                    if (((tmpvar_294 < t_hit_259) && (tmpvar_294 > 0.01))) {
                      lowp vec3 tmpvar_295;
                      tmpvar_295 = (ray_origin_257 + (ray_direction_258 * tmpvar_294));
                      if ((((tmpvar_289.x + tmpvar_289.y) == 0.0) || ((
                        ((tmpvar_295.x < (tmpvar_288.x + (tmpvar_289.x * 0.5))) && (tmpvar_295.x > (tmpvar_288.x - (tmpvar_289.x * 0.5))))
                       && 
                        (tmpvar_295.z < (tmpvar_288.z + (tmpvar_289.y * 0.5)))
                      ) && (tmpvar_295.z > 
                        (tmpvar_288.z - (tmpvar_289.y * 0.5))
                      )))) {
                        t_hit_290 = tmpvar_294;
                        tmpvar_292 = bool(1);
                        tmpvar_291 = bool(0);
                      };
                    };
                    if (tmpvar_291) {
                      tmpvar_292 = bool(0);
                      tmpvar_291 = bool(0);
                    };
                    t_hit_259 = t_hit_290;
                    tmp_287 = tmpvar_292;
                  } else {
                    lowp float t_hit_296;
                    t_hit_296 = t_hit_259;
                    bool tmpvar_297;
                    lowp vec3 tmpvar_298;
                    tmpvar_298 = (tmpvar_288 - ray_origin_257);
                    lowp float tmpvar_299;
                    tmpvar_299 = dot (tmpvar_298, ray_direction_258);
                    if ((tmpvar_299 < 0.0)) {
                      tmpvar_297 = bool(0);
                    } else {
                      lowp float tmpvar_300;
                      tmpvar_300 = (dot (tmpvar_298, tmpvar_298) - (tmpvar_299 * tmpvar_299));
                      if ((tmpvar_300 > 0.01)) {
                        tmpvar_297 = bool(0);
                      } else {
                        lowp float tmpvar_301;
                        tmpvar_301 = sqrt((0.01 - tmpvar_300));
                        lowp float tmpvar_302;
                        tmpvar_302 = (tmpvar_299 - tmpvar_301);
                        lowp float tmpvar_303;
                        tmpvar_303 = (tmpvar_299 + tmpvar_301);
                        lowp float tmpvar_304;
                        if ((tmpvar_302 < 0.01)) {
                          tmpvar_304 = tmpvar_303;
                        } else {
                          tmpvar_304 = tmpvar_302;
                        };
                        if (((tmpvar_304 < t_hit_259) && (tmpvar_304 > 0.01))) {
                          t_hit_296 = tmpvar_304;
                          tmpvar_297 = bool(1);
                        } else {
                          tmpvar_297 = bool(0);
                        };
                      };
                    };
                    t_hit_259 = t_hit_296;
                    tmp_287 = tmpvar_297;
                  };
                  if (tmp_287) {
                    idx_269 = i_286;
                    intersected_270 = 3;
                  };
                };
                position_260 = (origin_245 + (tmpvar_256 * t_hit_259));
                if ((intersected_270 == 1)) {
                  diffuseColor_262 = sphereColors[idx_269];
                  specularColor_263 = sphereSpecColors[idx_269];
                  reflectiveColor_264 = reflectiveColors[idx_269];
                  roughness_265 = sphereRoughness[idx_269];
                  lowp vec3 tmpvar_305;
                  tmpvar_305 = normalize((position_260 - sphereCenters[idx_269]));
                  normal_261 = tmpvar_305;
                  lowp float tmpvar_306;
                  tmpvar_306 = dot (tmpvar_305, -(tmpvar_256));
                  if ((tmpvar_306 < 0.0)) {
                    normal_261 = -(tmpvar_305);
                  };
                } else {
                  if ((intersected_270 == 2)) {
                    if (!(enablePlaneMirrors)) {
                      diffuseColor_262 = planeColors[idx_269];
                      specularColor_263 = vec3(planeSpecular[idx_269]);
                      reflectiveColor_264 = vec3(0.0, 0.0, 0.0);
                      roughness_265 = planeRoughness[idx_269];
                    } else {
                      diffuseColor_262 = (planeColors[idx_269] * 0.01);
                      specularColor_263 = vec3(0.0, 0.0, 0.0);
                      reflectiveColor_264 = planeColors[idx_269];
                      roughness_265 = 1.0;
                    };
                    lowp float tmpvar_307;
                    tmpvar_307 = dot (normal_261, -(tmpvar_256));
                    if ((tmpvar_307 < 0.0)) {
                      normal_261 = -(normal_261);
                    };
                  } else {
                    if ((intersected_270 == 3)) {
                      diffuseColor_262 = (lightIntensity[idx_269] * 0.04);
                      intersectLight_266 = bool(1);
                    };
                  };
                };
                normal_247 = normal_261;
                bounceDiffuseColor_255 = diffuseColor_262;
                bounceSpecularColor_254 = specularColor_263;
                bounceRefColor_253 = reflectiveColor_264;
                hitRoughness_252 = roughness_265;
                lowp vec3 tmpvar_308;
                if (intersectLight_266) {
                  tmpvar_308 = diffuseColor_262;
                } else {
                  lowp vec3 point_309;
                  point_309 = position_260;
                  lowp vec3 ray_dir_310;
                  ray_dir_310 = tmpvar_256;
                  lowp vec3 normal_311;
                  normal_311 = normal_261;
                  vec3 diffuseColor_312;
                  diffuseColor_312 = diffuseColor_262;
                  vec3 specularColor_313;
                  specularColor_313 = specularColor_263;
                  highp int i_314;
                  lowp vec3 illuminationColor_315;
                  i_314 = 0;
                  while (true) {
                    highp int k_316;
                    bool inShade_317;
                    highp int areaShadowSamples_318;
                    lowp vec3 light_sum_319;
                    vec2 lightSpot_320;
                    vec2 lightSize_321;
                    vec3 lightIntensity_322;
                    vec3 lightPos_323;
                    if ((i_314 >= numLights)) {
                      break;
                    };
                    lightPos_323 = lightPos[i_314];
                    lightIntensity_322 = lightIntensity[i_314];
                    lightSize_321 = lightSize[i_314];
                    lightSpot_320 = lightSpot[i_314];
                    areaShadowSamples_318 = 0;
                    inShade_317 = bool(0);
                    k_316 = 0;
                    while (true) {
                      vec3 testPos_324;
                      if ((k_316 >= 1)) {
                        break;
                      };
                      if (inShade_317) {
                        break;
                      };
                      testPos_324 = lightPos_323;
                      if ((k_316 == 1)) {
                        testPos_324.x = (lightPos_323.x - (lightSize_321.x * 0.5));
                        testPos_324.z = (lightPos_323.z - (lightSize_321.y * 0.5));
                      } else {
                        if ((k_316 == 2)) {
                          testPos_324.x = (testPos_324.x + (lightSize_321.x * 0.5));
                          testPos_324.z = (testPos_324.z + (lightSize_321.y * 0.5));
                        } else {
                          if ((k_316 == 3)) {
                            testPos_324.x = (testPos_324.x + (lightSize_321.x * 0.5));
                            testPos_324.z = (testPos_324.z - (lightSize_321.y * 0.5));
                          } else {
                            if ((k_316 == 4)) {
                              testPos_324.x = (testPos_324.x - (lightSize_321.x * 0.5));
                              testPos_324.z = (testPos_324.z + (lightSize_321.y * 0.5));
                            };
                          };
                        };
                      };
                      lowp vec3 vec_to_light_325;
                      lowp vec3 incident_intensity_326;
                      lowp float spot_falloff_327;
                      vec_to_light_325 = (testPos_324 - point_309);
                      lowp float tmpvar_328;
                      tmpvar_328 = sqrt(dot (vec_to_light_325, vec_to_light_325));
                      lowp float tmpvar_329;
                      tmpvar_329 = (1.0/(((attenuation.x * 
                        (tmpvar_328 * tmpvar_328)
                      ) + (attenuation.y * tmpvar_328))));
                      lowp vec3 tmpvar_330;
                      tmpvar_330 = normalize(vec_to_light_325);
                      vec_to_light_325 = tmpvar_330;
                      spot_falloff_327 = 1.0;
                      if ((lightSpot_320.x > 0.0)) {
                        lowp float tmpvar_331;
                        if ((tmpvar_330.y > lightSpot_320.x)) {
                          tmpvar_331 = pow (tmpvar_330.y, lightSpot_320.y);
                        } else {
                          tmpvar_331 = 0.0;
                        };
                        spot_falloff_327 = tmpvar_331;
                      };
                      incident_intensity_326 = ((lightIntensity_322 * tmpvar_329) * spot_falloff_327);
                      lowp float tmpvar_332;
                      tmpvar_332 = sqrt(dot (incident_intensity_326, incident_intensity_326));
                      if ((tmpvar_332 > 0.01)) {
                        lowp vec3 ray_origin_333;
                        ray_origin_333 = point_309;
                        lowp vec3 ray_direction_334;
                        ray_direction_334 = tmpvar_330;
                        lowp float t_hit_335;
                        t_hit_335 = tmpvar_328;
                        bool tmpvar_336;
                        tmpvar_336 = bool(0);
                        highp int i_337;
                        highp int i_338;
                        i_338 = 0;
                        while (true) {
                          if ((i_338 >= numSpheres)) {
                            break;
                          };
                          lowp float t_hit_339;
                          t_hit_339 = t_hit_335;
                          bool tmpvar_340;
                          lowp vec3 tmpvar_341;
                          tmpvar_341 = (sphereCenters[i_338] - ray_origin_333);
                          lowp float tmpvar_342;
                          tmpvar_342 = dot (tmpvar_341, ray_direction_334);
                          if ((tmpvar_342 < 0.0)) {
                            tmpvar_340 = bool(0);
                          } else {
                            lowp float tmpvar_343;
                            tmpvar_343 = (dot (tmpvar_341, tmpvar_341) - (tmpvar_342 * tmpvar_342));
                            if ((tmpvar_343 > 0.64)) {
                              tmpvar_340 = bool(0);
                            } else {
                              lowp float tmpvar_344;
                              tmpvar_344 = sqrt((0.64 - tmpvar_343));
                              lowp float tmpvar_345;
                              tmpvar_345 = (tmpvar_342 - tmpvar_344);
                              lowp float tmpvar_346;
                              tmpvar_346 = (tmpvar_342 + tmpvar_344);
                              lowp float tmpvar_347;
                              if ((tmpvar_345 < 0.01)) {
                                tmpvar_347 = tmpvar_346;
                              } else {
                                tmpvar_347 = tmpvar_345;
                              };
                              if (((tmpvar_347 < t_hit_335) && (tmpvar_347 > 0.01))) {
                                t_hit_339 = tmpvar_347;
                                tmpvar_340 = bool(1);
                              } else {
                                tmpvar_340 = bool(0);
                              };
                            };
                          };
                          t_hit_335 = t_hit_339;
                          if (tmpvar_340) {
                            tmpvar_336 = bool(1);
                            break;
                          };
                          i_338++;
                        };
                        if (!(tmpvar_336)) {
                          i_337 = 0;
                          while (true) {
                            if ((i_337 >= numPlanes)) {
                              break;
                            };
                            vec3 normal_348;
                            normal_348 = planeNormals[i_337];
                            lowp float t_hit_349;
                            t_hit_349 = t_hit_335;
                            bool tmpvar_350;
                            tmpvar_350 = bool(1);
                            bool tmpvar_351;
                            vec3 tmpvar_352;
                            tmpvar_352 = (normal_348 * planeOffsets[i_337]);
                            lowp float tmpvar_353;
                            tmpvar_353 = (((
                              (tmpvar_352.x + tmpvar_352.y)
                             + tmpvar_352.z) - dot (normal_348, ray_origin_333)) / dot (normal_348, ray_direction_334));
                            if (((tmpvar_353 < t_hit_335) && (tmpvar_353 > 0.01))) {
                              t_hit_349 = tmpvar_353;
                              tmpvar_351 = bool(1);
                              tmpvar_350 = bool(0);
                            };
                            if (tmpvar_350) {
                              tmpvar_351 = bool(0);
                              tmpvar_350 = bool(0);
                            };
                            t_hit_335 = t_hit_349;
                            if (tmpvar_351) {
                              tmpvar_336 = bool(1);
                              break;
                            };
                            i_337++;
                          };
                          if (!(tmpvar_336)) {
                            tmpvar_336 = bool(1);
                          };
                        };
                        lowp float tmpvar_354;
                        tmpvar_354 = abs((t_hit_335 - tmpvar_328));
                        if ((tmpvar_354 < 0.001)) {
                          lowp vec3 tmpvar_355;
                          lowp float tmpvar_356;
                          tmpvar_356 = dot (normal_311, tmpvar_330);
                          if ((tmpvar_356 > 0.0)) {
                            tmpvar_355 = (incident_intensity_326 * ((diffuseColor_312 * 
                              max (0.0, dot (normal_311, tmpvar_330))
                            ) + (specularColor_313 * 
                              pow (max (0.0, dot ((
                                -(tmpvar_330)
                               - 
                                ((2.0 * dot (-(tmpvar_330), normal_311)) * normal_311)
                              ), -(ray_dir_310))), 128.0)
                            )));
                          } else {
                            tmpvar_355 = vec3(0.0, 0.0, 0.0);
                          };
                          light_sum_319 = (light_sum_319 + tmpvar_355);
                        } else {
                          inShade_317 = bool(1);
                        };
                      } else {
                        inShade_317 = bool(1);
                      };
                      areaShadowSamples_318++;
                      k_316++;
                    };
                    illuminationColor_315 = (illuminationColor_315 + (light_sum_319 / float(areaShadowSamples_318)));
                    i_314++;
                  };
                  tmpvar_308 = illuminationColor_315;
                };
                mirror_sample_color_251 = tmpvar_308;
                if (enableRefGI) {
                  lowp vec3 point_357;
                  point_357 = position_260;
                  lowp vec3 rayDir_358;
                  rayDir_358 = tmpvar_256;
                  lowp vec3 normal_359;
                  normal_359 = normal_261;
                  float roughness_360;
                  roughness_360 = roughness_265;
                  lowp vec3 tmpvar_361;
                  highp int k_362;
                  lowp vec3 indirect_sampling_sum_363;
                  float tmpvar_364;
                  tmpvar_364 = sqrt(dot (diffuseColor_262, diffuseColor_262));
                  if ((tmpvar_364 == 0.0)) {
                    tmpvar_361 = vec3(0.0, 0.0, 0.0);
                  } else {
                    k_362 = 0;
                    while (true) {
                      float indirectRoughness_365;
                      vec3 indirectRefColor_366;
                      vec3 indirectSpecularColor_367;
                      vec3 indirectDiffuseColor_368;
                      if ((k_362 >= indirectSamples)) {
                        break;
                      };
                      float sampleIdx_369;
                      sampleIdx_369 = float(k_362);
                      randomIncrement += 0.02;
                      lowp float tmpvar_370;
                      tmpvar_370 = ((1.0 - (
                        (sampleIdx_369 / float((indirectSamples - 1)))
                       * 2.0)) + ((
                        fract((cos(dot (
                          (point_357.xy + randomIncrement)
                        , vec2(23.14069, 2.665144))) * 12345.68))
                       * 0.4) - 0.2));
                      lowp float tmpvar_371;
                      tmpvar_371 = sqrt((1.0 - (tmpvar_370 * tmpvar_370)));
                      randomIncrement += 0.02;
                      lowp float tmpvar_372;
                      tmpvar_372 = ((2.399963 * sampleIdx_369) + ((
                        fract((cos(dot (
                          (point_357.xy + randomIncrement)
                        , vec2(23.14069, 2.665144))) * 12345.68))
                       * 0.5) - 0.25));
                      lowp vec3 tmpvar_373;
                      tmpvar_373.x = (cos(tmpvar_372) * tmpvar_371);
                      tmpvar_373.y = tmpvar_370;
                      tmpvar_373.z = (sin(tmpvar_372) * tmpvar_371);
                      lowp vec3 tmpvar_374;
                      tmpvar_374 = normalize(mix ((rayDir_358 - 
                        (2.0 * (dot (normal_359, rayDir_358) * normal_359))
                      ), normalize(
                        (normal_359 + tmpvar_373)
                      ), roughness_360));
                      lowp vec3 ray_origin_375;
                      ray_origin_375 = point_357;
                      lowp vec3 ray_direction_376;
                      ray_direction_376 = tmpvar_374;
                      lowp float t_hit_377;
                      t_hit_377 = 10.0;
                      lowp vec3 position_378;
                      lowp vec3 normal_379;
                      vec3 diffuseColor_380;
                      diffuseColor_380 = indirectDiffuseColor_368;
                      vec3 specularColor_381;
                      specularColor_381 = indirectSpecularColor_367;
                      vec3 reflectiveColor_382;
                      reflectiveColor_382 = indirectRefColor_366;
                      float roughness_383;
                      roughness_383 = indirectRoughness_365;
                      highp int i_384;
                      highp int i_385;
                      highp int idx_386;
                      highp int intersected_387;
                      intersected_387 = 0;
                      idx_386 = 0;
                      i_385 = 0;
                      while (true) {
                        if ((i_385 >= numSpheres)) {
                          break;
                        };
                        lowp float t_hit_388;
                        t_hit_388 = t_hit_377;
                        bool tmpvar_389;
                        lowp vec3 tmpvar_390;
                        tmpvar_390 = (sphereCenters[i_385] - ray_origin_375);
                        lowp float tmpvar_391;
                        tmpvar_391 = dot (tmpvar_390, ray_direction_376);
                        if ((tmpvar_391 < 0.0)) {
                          tmpvar_389 = bool(0);
                        } else {
                          lowp float tmpvar_392;
                          tmpvar_392 = (dot (tmpvar_390, tmpvar_390) - (tmpvar_391 * tmpvar_391));
                          if ((tmpvar_392 > 0.64)) {
                            tmpvar_389 = bool(0);
                          } else {
                            lowp float tmpvar_393;
                            tmpvar_393 = sqrt((0.64 - tmpvar_392));
                            lowp float tmpvar_394;
                            tmpvar_394 = (tmpvar_391 - tmpvar_393);
                            lowp float tmpvar_395;
                            tmpvar_395 = (tmpvar_391 + tmpvar_393);
                            lowp float tmpvar_396;
                            if ((tmpvar_394 < 0.01)) {
                              tmpvar_396 = tmpvar_395;
                            } else {
                              tmpvar_396 = tmpvar_394;
                            };
                            if (((tmpvar_396 < t_hit_377) && (tmpvar_396 > 0.01))) {
                              t_hit_388 = tmpvar_396;
                              tmpvar_389 = bool(1);
                            } else {
                              tmpvar_389 = bool(0);
                            };
                          };
                        };
                        t_hit_377 = t_hit_388;
                        if (tmpvar_389) {
                          idx_386 = i_385;
                          intersected_387 = 1;
                        };
                        i_385++;
                      };
                      i_384 = 0;
                      while (true) {
                        if ((i_384 >= numPlanes)) {
                          break;
                        };
                        lowp vec3 tmpvar_397;
                        tmpvar_397 = planeNormals[i_384];
                        lowp float t_hit_398;
                        t_hit_398 = t_hit_377;
                        bool tmpvar_399;
                        tmpvar_399 = bool(1);
                        bool tmpvar_400;
                        lowp vec3 tmpvar_401;
                        tmpvar_401 = (tmpvar_397 * planeOffsets[i_384]);
                        lowp float tmpvar_402;
                        tmpvar_402 = (((
                          (tmpvar_401.x + tmpvar_401.y)
                         + tmpvar_401.z) - dot (tmpvar_397, ray_origin_375)) / dot (tmpvar_397, ray_direction_376));
                        if (((tmpvar_402 < t_hit_377) && (tmpvar_402 > 0.01))) {
                          t_hit_398 = tmpvar_402;
                          tmpvar_400 = bool(1);
                          tmpvar_399 = bool(0);
                        };
                        if (tmpvar_399) {
                          tmpvar_400 = bool(0);
                          tmpvar_399 = bool(0);
                        };
                        t_hit_377 = t_hit_398;
                        if (tmpvar_400) {
                          normal_379 = tmpvar_397;
                          idx_386 = i_384;
                          intersected_387 = 2;
                        };
                        i_384++;
                      };
                      position_378 = (point_357 + (tmpvar_374 * t_hit_377));
                      if ((intersected_387 == 1)) {
                        diffuseColor_380 = sphereColors[idx_386];
                        specularColor_381 = sphereSpecColors[idx_386];
                        reflectiveColor_382 = reflectiveColors[idx_386];
                        roughness_383 = sphereRoughness[idx_386];
                        lowp vec3 tmpvar_403;
                        tmpvar_403 = normalize((position_378 - sphereCenters[idx_386]));
                        normal_379 = tmpvar_403;
                        lowp float tmpvar_404;
                        tmpvar_404 = dot (tmpvar_403, -(tmpvar_374));
                        if ((tmpvar_404 < 0.0)) {
                          normal_379 = -(tmpvar_403);
                        };
                      } else {
                        if ((intersected_387 == 2)) {
                          if (!(enablePlaneMirrors)) {
                            diffuseColor_380 = planeColors[idx_386];
                            specularColor_381 = vec3(planeSpecular[idx_386]);
                            reflectiveColor_382 = vec3(0.0, 0.0, 0.0);
                            roughness_383 = planeRoughness[idx_386];
                          } else {
                            diffuseColor_380 = (planeColors[idx_386] * 0.01);
                            specularColor_381 = vec3(0.0, 0.0, 0.0);
                            reflectiveColor_382 = planeColors[idx_386];
                            roughness_383 = 1.0;
                          };
                          lowp float tmpvar_405;
                          tmpvar_405 = dot (normal_379, -(tmpvar_374));
                          if ((tmpvar_405 < 0.0)) {
                            normal_379 = -(normal_379);
                          };
                        } else {
                          if ((intersected_387 == 3)) {
                            diffuseColor_380 = (lightIntensity[idx_386] * 0.04);
                          };
                        };
                      };
                      indirectDiffuseColor_368 = diffuseColor_380;
                      indirectSpecularColor_367 = specularColor_381;
                      indirectRefColor_366 = reflectiveColor_382;
                      indirectRoughness_365 = roughness_383;
                      lowp vec3 point_406;
                      point_406 = position_378;
                      lowp vec3 ray_dir_407;
                      ray_dir_407 = tmpvar_374;
                      lowp vec3 normal_408;
                      normal_408 = normal_379;
                      vec3 diffuseColor_409;
                      diffuseColor_409 = (diffuseColor_380 + reflectiveColor_382);
                      vec3 specularColor_410;
                      specularColor_410 = specularColor_381;
                      highp int i_411;
                      lowp vec3 illuminationColor_412;
                      i_411 = 0;
                      while (true) {
                        highp int k_413;
                        bool inShade_414;
                        highp int areaShadowSamples_415;
                        lowp vec3 light_sum_416;
                        vec2 lightSpot_417;
                        vec2 lightSize_418;
                        vec3 lightIntensity_419;
                        vec3 lightPos_420;
                        if ((i_411 >= numLights)) {
                          break;
                        };
                        lightPos_420 = lightPos[i_411];
                        lightIntensity_419 = lightIntensity[i_411];
                        lightSize_418 = lightSize[i_411];
                        lightSpot_417 = lightSpot[i_411];
                        areaShadowSamples_415 = 0;
                        inShade_414 = bool(0);
                        k_413 = 0;
                        while (true) {
                          vec3 testPos_421;
                          if ((k_413 >= 1)) {
                            break;
                          };
                          if (inShade_414) {
                            break;
                          };
                          testPos_421 = lightPos_420;
                          if ((k_413 == 1)) {
                            testPos_421.x = (lightPos_420.x - (lightSize_418.x * 0.5));
                            testPos_421.z = (lightPos_420.z - (lightSize_418.y * 0.5));
                          } else {
                            if ((k_413 == 2)) {
                              testPos_421.x = (testPos_421.x + (lightSize_418.x * 0.5));
                              testPos_421.z = (testPos_421.z + (lightSize_418.y * 0.5));
                            } else {
                              if ((k_413 == 3)) {
                                testPos_421.x = (testPos_421.x + (lightSize_418.x * 0.5));
                                testPos_421.z = (testPos_421.z - (lightSize_418.y * 0.5));
                              } else {
                                if ((k_413 == 4)) {
                                  testPos_421.x = (testPos_421.x - (lightSize_418.x * 0.5));
                                  testPos_421.z = (testPos_421.z + (lightSize_418.y * 0.5));
                                };
                              };
                            };
                          };
                          lowp vec3 vec_to_light_422;
                          lowp vec3 incident_intensity_423;
                          lowp float spot_falloff_424;
                          vec_to_light_422 = (testPos_421 - point_406);
                          lowp float tmpvar_425;
                          tmpvar_425 = sqrt(dot (vec_to_light_422, vec_to_light_422));
                          lowp float tmpvar_426;
                          tmpvar_426 = (1.0/(((attenuation.x * 
                            (tmpvar_425 * tmpvar_425)
                          ) + (attenuation.y * tmpvar_425))));
                          lowp vec3 tmpvar_427;
                          tmpvar_427 = normalize(vec_to_light_422);
                          vec_to_light_422 = tmpvar_427;
                          spot_falloff_424 = 1.0;
                          if ((lightSpot_417.x > 0.0)) {
                            lowp float tmpvar_428;
                            if ((tmpvar_427.y > lightSpot_417.x)) {
                              tmpvar_428 = pow (tmpvar_427.y, lightSpot_417.y);
                            } else {
                              tmpvar_428 = 0.0;
                            };
                            spot_falloff_424 = tmpvar_428;
                          };
                          incident_intensity_423 = ((lightIntensity_419 * tmpvar_426) * spot_falloff_424);
                          lowp float tmpvar_429;
                          tmpvar_429 = sqrt(dot (incident_intensity_423, incident_intensity_423));
                          if ((tmpvar_429 > 0.01)) {
                            lowp vec3 ray_origin_430;
                            ray_origin_430 = point_406;
                            lowp vec3 ray_direction_431;
                            ray_direction_431 = tmpvar_427;
                            lowp float t_hit_432;
                            t_hit_432 = tmpvar_425;
                            bool tmpvar_433;
                            tmpvar_433 = bool(0);
                            highp int i_434;
                            highp int i_435;
                            i_435 = 0;
                            while (true) {
                              if ((i_435 >= numSpheres)) {
                                break;
                              };
                              lowp float t_hit_436;
                              t_hit_436 = t_hit_432;
                              bool tmpvar_437;
                              lowp vec3 tmpvar_438;
                              tmpvar_438 = (sphereCenters[i_435] - ray_origin_430);
                              lowp float tmpvar_439;
                              tmpvar_439 = dot (tmpvar_438, ray_direction_431);
                              if ((tmpvar_439 < 0.0)) {
                                tmpvar_437 = bool(0);
                              } else {
                                lowp float tmpvar_440;
                                tmpvar_440 = (dot (tmpvar_438, tmpvar_438) - (tmpvar_439 * tmpvar_439));
                                if ((tmpvar_440 > 0.64)) {
                                  tmpvar_437 = bool(0);
                                } else {
                                  lowp float tmpvar_441;
                                  tmpvar_441 = sqrt((0.64 - tmpvar_440));
                                  lowp float tmpvar_442;
                                  tmpvar_442 = (tmpvar_439 - tmpvar_441);
                                  lowp float tmpvar_443;
                                  tmpvar_443 = (tmpvar_439 + tmpvar_441);
                                  lowp float tmpvar_444;
                                  if ((tmpvar_442 < 0.01)) {
                                    tmpvar_444 = tmpvar_443;
                                  } else {
                                    tmpvar_444 = tmpvar_442;
                                  };
                                  if (((tmpvar_444 < t_hit_432) && (tmpvar_444 > 0.01))) {
                                    t_hit_436 = tmpvar_444;
                                    tmpvar_437 = bool(1);
                                  } else {
                                    tmpvar_437 = bool(0);
                                  };
                                };
                              };
                              t_hit_432 = t_hit_436;
                              if (tmpvar_437) {
                                tmpvar_433 = bool(1);
                                break;
                              };
                              i_435++;
                            };
                            if (!(tmpvar_433)) {
                              i_434 = 0;
                              while (true) {
                                if ((i_434 >= numPlanes)) {
                                  break;
                                };
                                vec3 normal_445;
                                normal_445 = planeNormals[i_434];
                                lowp float t_hit_446;
                                t_hit_446 = t_hit_432;
                                bool tmpvar_447;
                                tmpvar_447 = bool(1);
                                bool tmpvar_448;
                                vec3 tmpvar_449;
                                tmpvar_449 = (normal_445 * planeOffsets[i_434]);
                                lowp float tmpvar_450;
                                tmpvar_450 = (((
                                  (tmpvar_449.x + tmpvar_449.y)
                                 + tmpvar_449.z) - dot (normal_445, ray_origin_430)) / dot (normal_445, ray_direction_431));
                                if (((tmpvar_450 < t_hit_432) && (tmpvar_450 > 0.01))) {
                                  t_hit_446 = tmpvar_450;
                                  tmpvar_448 = bool(1);
                                  tmpvar_447 = bool(0);
                                };
                                if (tmpvar_447) {
                                  tmpvar_448 = bool(0);
                                  tmpvar_447 = bool(0);
                                };
                                t_hit_432 = t_hit_446;
                                if (tmpvar_448) {
                                  tmpvar_433 = bool(1);
                                  break;
                                };
                                i_434++;
                              };
                              if (!(tmpvar_433)) {
                                tmpvar_433 = bool(1);
                              };
                            };
                            lowp float tmpvar_451;
                            tmpvar_451 = abs((t_hit_432 - tmpvar_425));
                            if ((tmpvar_451 < 0.001)) {
                              lowp vec3 tmpvar_452;
                              lowp float tmpvar_453;
                              tmpvar_453 = dot (normal_408, tmpvar_427);
                              if ((tmpvar_453 > 0.0)) {
                                tmpvar_452 = (incident_intensity_423 * ((diffuseColor_409 * 
                                  max (0.0, dot (normal_408, tmpvar_427))
                                ) + (specularColor_410 * 
                                  pow (max (0.0, dot ((
                                    -(tmpvar_427)
                                   - 
                                    ((2.0 * dot (-(tmpvar_427), normal_408)) * normal_408)
                                  ), -(ray_dir_407))), 128.0)
                                )));
                              } else {
                                tmpvar_452 = vec3(0.0, 0.0, 0.0);
                              };
                              light_sum_416 = (light_sum_416 + tmpvar_452);
                            } else {
                              inShade_414 = bool(1);
                            };
                          } else {
                            inShade_414 = bool(1);
                          };
                          areaShadowSamples_415++;
                          k_413++;
                        };
                        illuminationColor_412 = (illuminationColor_412 + (light_sum_416 / float(areaShadowSamples_415)));
                        i_411++;
                      };
                      indirect_sampling_sum_363 = (indirect_sampling_sum_363 + illuminationColor_412);
                      k_362++;
                    };
                    tmpvar_361 = ((indirect_sampling_sum_363 / float(indirectSamples)) * diffuseColor_262);
                  };
                  mirror_sample_color_251 = (tmpvar_308 + tmpvar_361);
                } else {
                  mirror_sample_color_251 = (mirror_sample_color_251 + (ambientLight * diffuseColor_262));
                };
                reflectionSum_250 = (reflectionSum_250 + (mirror_sample_color_251 * refColor_248));
                origin_245 = position_260;
                rayDir_246 = tmpvar_256;
                refColor_248 = (reflectiveColor_264 * refColor_248);
                i_249++;
              };
              pixelColor_5 = (pixelColor_5 + reflectionSum_250);
            };
            lowp vec3 x_454;
            x_454 = (mat3(0.59719, 0.076, 0.0284, 0.35458, 0.90834, 0.13383, 0.04823, 0.01566, 0.83777) * pixelColor_5);
            x_454 = (((x_454 * 
              (x_454 + 0.0245786)
            ) - 9.0537e-05) / ((x_454 * 
              ((0.983729 * x_454) + 0.432951)
            ) + 0.238081));
            x_454 = (mat3(1.60475, -0.10208, -0.00327, -0.53108, 1.10813, -0.07276, -0.07367, -0.00605, 1.07602) * x_454);
            lowp vec3 tmpvar_455;
            tmpvar_455 = clamp (x_454, 0.0, 1.0);
            pixelColor_5 = tmpvar_455;
            lowp vec3 tmpvar_456;
            tmpvar_456 = pow (tmpvar_455, vec3(0.4545454, 0.4545454, 0.4545454));
            float tmpvar_457;
            if ((tmpvar_455.x < 0.0031308)) {
              tmpvar_457 = 1.0;
            } else {
              tmpvar_457 = 0.0;
            };
            float tmpvar_458;
            if ((tmpvar_455.y < 0.0031308)) {
              tmpvar_458 = 1.0;
            } else {
              tmpvar_458 = 0.0;
            };
            float tmpvar_459;
            if ((tmpvar_455.z < 0.0031308)) {
              tmpvar_459 = 1.0;
            } else {
              tmpvar_459 = 0.0;
            };
            vec3 tmpvar_460;
            tmpvar_460.x = tmpvar_457;
            tmpvar_460.y = tmpvar_458;
            tmpvar_460.z = tmpvar_459;
            lowp vec3 tmpvar_461;
            tmpvar_461 = mix (((tmpvar_456 * 1.055) - 0.055), (tmpvar_455 * 12.92), tmpvar_460);
            pixelColor_5 = tmpvar_461;
            lowp vec4 tmpvar_462;
            tmpvar_462.w = 1.0;
            tmpvar_462.xyz = tmpvar_461;
            fragColor = tmpvar_462;
          }
          
          
        </script>
        <script id="fragment-shader-quality" type="x-shader/x-vertex">#version 300 es
          precision mediump float;
          float randomIncrement;
          uniform float randomseed;
          uniform highp int numLights;
          uniform vec3 lightPos[2];
          uniform vec2 lightSize[2];
          uniform vec3 lightIntensity[2];
          uniform vec2 lightSpot[2];
          uniform highp int shadowSamples;
          uniform float shadowDim;
          uniform vec2 attenuation;
          uniform highp int numSpheres;
          uniform vec3 sphereCenters[5];
          uniform vec3 sphereColors[5];
          uniform vec3 reflectiveColors[5];
          uniform vec3 sphereSpecColors[5];
          uniform float sphereRoughness[5];
          uniform highp int numPlanes;
          uniform float planeOffsets[6];
          uniform vec3 planeNormals[6];
          uniform vec3 planeColors[6];
          uniform float planeSpecular[6];
          uniform float planeRoughness[6];
          uniform highp int rayBounces;
          uniform vec3 ambientLight;
          uniform bool enableGI;
          uniform bool enableRefGI;
          uniform highp int indirectSamples;
          uniform bool enablePlaneBacksides;
          uniform bool enablePlaneMirrors;
          in lowp vec3 origin;
          in lowp vec3 ray;
          out lowp vec4 fragColor;
          void main ()
          {
            float roughness_1;
            vec3 reflectiveColor_2;
            vec3 specularColor_3;
            vec3 diffuseColor_4;
            lowp vec3 pixelColor_5;
            lowp vec3 tmpvar_6;
            tmpvar_6 = normalize(ray);
            randomIncrement = randomseed;
            lowp vec3 ray_origin_7;
            ray_origin_7 = origin;
            lowp vec3 ray_direction_8;
            ray_direction_8 = tmpvar_6;
            lowp float t_hit_9;
            t_hit_9 = sqrt(dot (ray, ray));
            lowp vec3 position_10;
            lowp vec3 normal_11;
            vec3 diffuseColor_12;
            diffuseColor_12 = diffuseColor_4;
            vec3 specularColor_13;
            specularColor_13 = specularColor_3;
            vec3 reflectiveColor_14;
            reflectiveColor_14 = reflectiveColor_2;
            float roughness_15;
            roughness_15 = roughness_1;
            bool isLight_16;
            isLight_16 = bool(0);
            highp int i_17;
            highp int i_18;
            highp int i_19;
            highp int idx_20;
            highp int intersected_21;
            intersected_21 = 0;
            idx_20 = 0;
            i_19 = 0;
            if ((0 != numSpheres)) {
              lowp float t_hit_22;
              t_hit_22 = t_hit_9;
              bool tmpvar_23;
              lowp vec3 tmpvar_24;
              tmpvar_24 = (sphereCenters[0] - origin);
              lowp float tmpvar_25;
              tmpvar_25 = dot (tmpvar_24, tmpvar_6);
              if ((tmpvar_25 < 0.0)) {
                tmpvar_23 = bool(0);
              } else {
                lowp float tmpvar_26;
                tmpvar_26 = (dot (tmpvar_24, tmpvar_24) - (tmpvar_25 * tmpvar_25));
                if ((tmpvar_26 > 0.64)) {
                  tmpvar_23 = bool(0);
                } else {
                  lowp float tmpvar_27;
                  tmpvar_27 = sqrt((0.64 - tmpvar_26));
                  lowp float tmpvar_28;
                  tmpvar_28 = (tmpvar_25 - tmpvar_27);
                  lowp float tmpvar_29;
                  tmpvar_29 = (tmpvar_25 + tmpvar_27);
                  lowp float tmpvar_30;
                  if ((tmpvar_28 < 0.0)) {
                    tmpvar_30 = tmpvar_29;
                  } else {
                    tmpvar_30 = tmpvar_28;
                  };
                  if (((tmpvar_30 < t_hit_9) && (tmpvar_30 > 0.0))) {
                    t_hit_22 = tmpvar_30;
                    tmpvar_23 = bool(1);
                  } else {
                    tmpvar_23 = bool(0);
                  };
                };
              };
              t_hit_9 = t_hit_22;
              if (tmpvar_23) {
                idx_20 = i_19;
                intersected_21 = 1;
              };
              i_19 = 1;
              if ((1 != numSpheres)) {
                lowp float t_hit_31;
                t_hit_31 = t_hit_22;
                bool tmpvar_32;
                lowp vec3 tmpvar_33;
                tmpvar_33 = (sphereCenters[1] - origin);
                lowp float tmpvar_34;
                tmpvar_34 = dot (tmpvar_33, tmpvar_6);
                if ((tmpvar_34 < 0.0)) {
                  tmpvar_32 = bool(0);
                } else {
                  lowp float tmpvar_35;
                  tmpvar_35 = (dot (tmpvar_33, tmpvar_33) - (tmpvar_34 * tmpvar_34));
                  if ((tmpvar_35 > 0.64)) {
                    tmpvar_32 = bool(0);
                  } else {
                    lowp float tmpvar_36;
                    tmpvar_36 = sqrt((0.64 - tmpvar_35));
                    lowp float tmpvar_37;
                    tmpvar_37 = (tmpvar_34 - tmpvar_36);
                    lowp float tmpvar_38;
                    tmpvar_38 = (tmpvar_34 + tmpvar_36);
                    lowp float tmpvar_39;
                    if ((tmpvar_37 < 0.0)) {
                      tmpvar_39 = tmpvar_38;
                    } else {
                      tmpvar_39 = tmpvar_37;
                    };
                    if (((tmpvar_39 < t_hit_22) && (tmpvar_39 > 0.0))) {
                      t_hit_31 = tmpvar_39;
                      tmpvar_32 = bool(1);
                    } else {
                      tmpvar_32 = bool(0);
                    };
                  };
                };
                t_hit_9 = t_hit_31;
                if (tmpvar_32) {
                  idx_20 = i_19;
                  intersected_21 = 1;
                };
                i_19 = 2;
                if ((2 != numSpheres)) {
                  lowp float t_hit_40;
                  t_hit_40 = t_hit_31;
                  bool tmpvar_41;
                  lowp vec3 tmpvar_42;
                  tmpvar_42 = (sphereCenters[2] - origin);
                  lowp float tmpvar_43;
                  tmpvar_43 = dot (tmpvar_42, tmpvar_6);
                  if ((tmpvar_43 < 0.0)) {
                    tmpvar_41 = bool(0);
                  } else {
                    lowp float tmpvar_44;
                    tmpvar_44 = (dot (tmpvar_42, tmpvar_42) - (tmpvar_43 * tmpvar_43));
                    if ((tmpvar_44 > 0.64)) {
                      tmpvar_41 = bool(0);
                    } else {
                      lowp float tmpvar_45;
                      tmpvar_45 = sqrt((0.64 - tmpvar_44));
                      lowp float tmpvar_46;
                      tmpvar_46 = (tmpvar_43 - tmpvar_45);
                      lowp float tmpvar_47;
                      tmpvar_47 = (tmpvar_43 + tmpvar_45);
                      lowp float tmpvar_48;
                      if ((tmpvar_46 < 0.0)) {
                        tmpvar_48 = tmpvar_47;
                      } else {
                        tmpvar_48 = tmpvar_46;
                      };
                      if (((tmpvar_48 < t_hit_31) && (tmpvar_48 > 0.0))) {
                        t_hit_40 = tmpvar_48;
                        tmpvar_41 = bool(1);
                      } else {
                        tmpvar_41 = bool(0);
                      };
                    };
                  };
                  t_hit_9 = t_hit_40;
                  if (tmpvar_41) {
                    idx_20 = i_19;
                    intersected_21 = 1;
                  };
                  i_19 = 3;
                  if ((3 != numSpheres)) {
                    lowp float t_hit_49;
                    t_hit_49 = t_hit_40;
                    bool tmpvar_50;
                    lowp vec3 tmpvar_51;
                    tmpvar_51 = (sphereCenters[3] - origin);
                    lowp float tmpvar_52;
                    tmpvar_52 = dot (tmpvar_51, tmpvar_6);
                    if ((tmpvar_52 < 0.0)) {
                      tmpvar_50 = bool(0);
                    } else {
                      lowp float tmpvar_53;
                      tmpvar_53 = (dot (tmpvar_51, tmpvar_51) - (tmpvar_52 * tmpvar_52));
                      if ((tmpvar_53 > 0.64)) {
                        tmpvar_50 = bool(0);
                      } else {
                        lowp float tmpvar_54;
                        tmpvar_54 = sqrt((0.64 - tmpvar_53));
                        lowp float tmpvar_55;
                        tmpvar_55 = (tmpvar_52 - tmpvar_54);
                        lowp float tmpvar_56;
                        tmpvar_56 = (tmpvar_52 + tmpvar_54);
                        lowp float tmpvar_57;
                        if ((tmpvar_55 < 0.0)) {
                          tmpvar_57 = tmpvar_56;
                        } else {
                          tmpvar_57 = tmpvar_55;
                        };
                        if (((tmpvar_57 < t_hit_40) && (tmpvar_57 > 0.0))) {
                          t_hit_49 = tmpvar_57;
                          tmpvar_50 = bool(1);
                        } else {
                          tmpvar_50 = bool(0);
                        };
                      };
                    };
                    t_hit_9 = t_hit_49;
                    if (tmpvar_50) {
                      idx_20 = i_19;
                      intersected_21 = 1;
                    };
                    i_19 = 4;
                    if ((4 != numSpheres)) {
                      lowp float t_hit_58;
                      t_hit_58 = t_hit_49;
                      bool tmpvar_59;
                      lowp vec3 tmpvar_60;
                      tmpvar_60 = (sphereCenters[4] - origin);
                      lowp float tmpvar_61;
                      tmpvar_61 = dot (tmpvar_60, tmpvar_6);
                      if ((tmpvar_61 < 0.0)) {
                        tmpvar_59 = bool(0);
                      } else {
                        lowp float tmpvar_62;
                        tmpvar_62 = (dot (tmpvar_60, tmpvar_60) - (tmpvar_61 * tmpvar_61));
                        if ((tmpvar_62 > 0.64)) {
                          tmpvar_59 = bool(0);
                        } else {
                          lowp float tmpvar_63;
                          tmpvar_63 = sqrt((0.64 - tmpvar_62));
                          lowp float tmpvar_64;
                          tmpvar_64 = (tmpvar_61 - tmpvar_63);
                          lowp float tmpvar_65;
                          tmpvar_65 = (tmpvar_61 + tmpvar_63);
                          lowp float tmpvar_66;
                          if ((tmpvar_64 < 0.0)) {
                            tmpvar_66 = tmpvar_65;
                          } else {
                            tmpvar_66 = tmpvar_64;
                          };
                          if (((tmpvar_66 < t_hit_49) && (tmpvar_66 > 0.0))) {
                            t_hit_58 = tmpvar_66;
                            tmpvar_59 = bool(1);
                          } else {
                            tmpvar_59 = bool(0);
                          };
                        };
                      };
                      t_hit_9 = t_hit_58;
                      if (tmpvar_59) {
                        idx_20 = i_19;
                        intersected_21 = 1;
                      };
                      i_19 = 5;
                    };
                  };
                };
              };
            };
            i_18 = 0;
            while (true) {
              bool tmp_67;
              if ((i_18 >= 6)) {
                break;
              };
              if ((i_18 == numPlanes)) {
                break;
              };
              lowp vec3 tmpvar_68;
              tmpvar_68 = planeNormals[i_18];
              tmp_67 = bool(0);
              bool tmpvar_69;
              if (enablePlaneBacksides) {
                tmpvar_69 = bool(1);
              } else {
                tmpvar_69 = (dot (ray_direction_8, tmpvar_68) < 0.0);
              };
              if (tmpvar_69) {
                lowp float t_hit_70;
                t_hit_70 = t_hit_9;
                bool tmpvar_71;
                tmpvar_71 = bool(1);
                bool tmpvar_72;
                lowp vec3 tmpvar_73;
                tmpvar_73 = (tmpvar_68 * planeOffsets[i_18]);
                lowp float tmpvar_74;
                tmpvar_74 = (((
                  (tmpvar_73.x + tmpvar_73.y)
                 + tmpvar_73.z) - dot (tmpvar_68, ray_origin_7)) / dot (tmpvar_68, ray_direction_8));
                if (((tmpvar_74 < t_hit_9) && (tmpvar_74 > 0.0))) {
                  t_hit_70 = tmpvar_74;
                  tmpvar_72 = bool(1);
                  tmpvar_71 = bool(0);
                };
                if (tmpvar_71) {
                  tmpvar_72 = bool(0);
                  tmpvar_71 = bool(0);
                };
                t_hit_9 = t_hit_70;
                tmp_67 = tmpvar_72;
              };
              if (tmp_67) {
                normal_11 = tmpvar_68;
                idx_20 = i_18;
                intersected_21 = 2;
              };
              i_18++;
            };
            i_17 = 0;
            bool tmp_75;
            if ((0 != numLights)) {
              vec3 tmpvar_76;
              tmpvar_76 = lightPos[0];
              vec2 tmpvar_77;
              tmpvar_77 = lightSize[0];
              tmp_75 = bool(0);
              if (((tmpvar_77.x > 0.0) && (tmpvar_77.y > 0.0))) {
                lowp float t_hit_78;
                t_hit_78 = t_hit_9;
                bool tmpvar_79;
                tmpvar_79 = bool(1);
                bool tmpvar_80;
                vec3 tmpvar_81;
                tmpvar_81 = (vec3(0.0, 1.0, 0.0) * tmpvar_76.y);
                lowp float tmpvar_82;
                tmpvar_82 = (((
                  (tmpvar_81.x + tmpvar_81.y)
                 + tmpvar_81.z) - origin.y) / tmpvar_6.y);
                if (((tmpvar_82 < t_hit_9) && (tmpvar_82 > 0.0))) {
                  lowp vec3 tmpvar_83;
                  tmpvar_83 = (origin + (tmpvar_6 * tmpvar_82));
                  if ((((tmpvar_77.x + tmpvar_77.y) == 0.0) || ((
                    ((tmpvar_83.x < (tmpvar_76.x + (tmpvar_77.x * 0.5))) && (tmpvar_83.x > (tmpvar_76.x - (tmpvar_77.x * 0.5))))
                   && 
                    (tmpvar_83.z < (tmpvar_76.z + (tmpvar_77.y * 0.5)))
                  ) && (tmpvar_83.z > 
                    (tmpvar_76.z - (tmpvar_77.y * 0.5))
                  )))) {
                    t_hit_78 = tmpvar_82;
                    tmpvar_80 = bool(1);
                    tmpvar_79 = bool(0);
                  };
                };
                if (tmpvar_79) {
                  tmpvar_80 = bool(0);
                  tmpvar_79 = bool(0);
                };
                t_hit_9 = t_hit_78;
                tmp_75 = tmpvar_80;
              } else {
                lowp float t_hit_84;
                t_hit_84 = t_hit_9;
                bool tmpvar_85;
                lowp vec3 tmpvar_86;
                tmpvar_86 = (tmpvar_76 - origin);
                lowp float tmpvar_87;
                tmpvar_87 = dot (tmpvar_86, tmpvar_6);
                if ((tmpvar_87 < 0.0)) {
                  tmpvar_85 = bool(0);
                } else {
                  lowp float tmpvar_88;
                  tmpvar_88 = (dot (tmpvar_86, tmpvar_86) - (tmpvar_87 * tmpvar_87));
                  if ((tmpvar_88 > 0.01)) {
                    tmpvar_85 = bool(0);
                  } else {
                    lowp float tmpvar_89;
                    tmpvar_89 = sqrt((0.01 - tmpvar_88));
                    lowp float tmpvar_90;
                    tmpvar_90 = (tmpvar_87 - tmpvar_89);
                    lowp float tmpvar_91;
                    tmpvar_91 = (tmpvar_87 + tmpvar_89);
                    lowp float tmpvar_92;
                    if ((tmpvar_90 < 0.0)) {
                      tmpvar_92 = tmpvar_91;
                    } else {
                      tmpvar_92 = tmpvar_90;
                    };
                    if (((tmpvar_92 < t_hit_9) && (tmpvar_92 > 0.0))) {
                      t_hit_84 = tmpvar_92;
                      tmpvar_85 = bool(1);
                    } else {
                      tmpvar_85 = bool(0);
                    };
                  };
                };
                t_hit_9 = t_hit_84;
                tmp_75 = tmpvar_85;
              };
              if (tmp_75) {
                idx_20 = i_17;
                intersected_21 = 3;
              };
              i_17 = 1;
              bool tmp_93;
              if ((1 != numLights)) {
                vec3 tmpvar_94;
                tmpvar_94 = lightPos[1];
                vec2 tmpvar_95;
                tmpvar_95 = lightSize[1];
                tmp_93 = bool(0);
                if (((tmpvar_95.x > 0.0) && (tmpvar_95.y > 0.0))) {
                  lowp float t_hit_96;
                  t_hit_96 = t_hit_9;
                  bool tmpvar_97;
                  tmpvar_97 = bool(1);
                  bool tmpvar_98;
                  vec3 tmpvar_99;
                  tmpvar_99 = (vec3(0.0, 1.0, 0.0) * tmpvar_94.y);
                  lowp float tmpvar_100;
                  tmpvar_100 = (((
                    (tmpvar_99.x + tmpvar_99.y)
                   + tmpvar_99.z) - origin.y) / tmpvar_6.y);
                  if (((tmpvar_100 < t_hit_9) && (tmpvar_100 > 0.0))) {
                    lowp vec3 tmpvar_101;
                    tmpvar_101 = (origin + (tmpvar_6 * tmpvar_100));
                    if ((((tmpvar_95.x + tmpvar_95.y) == 0.0) || ((
                      ((tmpvar_101.x < (tmpvar_94.x + (tmpvar_95.x * 0.5))) && (tmpvar_101.x > (tmpvar_94.x - (tmpvar_95.x * 0.5))))
                     && 
                      (tmpvar_101.z < (tmpvar_94.z + (tmpvar_95.y * 0.5)))
                    ) && (tmpvar_101.z > 
                      (tmpvar_94.z - (tmpvar_95.y * 0.5))
                    )))) {
                      t_hit_96 = tmpvar_100;
                      tmpvar_98 = bool(1);
                      tmpvar_97 = bool(0);
                    };
                  };
                  if (tmpvar_97) {
                    tmpvar_98 = bool(0);
                    tmpvar_97 = bool(0);
                  };
                  t_hit_9 = t_hit_96;
                  tmp_93 = tmpvar_98;
                } else {
                  lowp float t_hit_102;
                  t_hit_102 = t_hit_9;
                  bool tmpvar_103;
                  lowp vec3 tmpvar_104;
                  tmpvar_104 = (tmpvar_94 - origin);
                  lowp float tmpvar_105;
                  tmpvar_105 = dot (tmpvar_104, tmpvar_6);
                  if ((tmpvar_105 < 0.0)) {
                    tmpvar_103 = bool(0);
                  } else {
                    lowp float tmpvar_106;
                    tmpvar_106 = (dot (tmpvar_104, tmpvar_104) - (tmpvar_105 * tmpvar_105));
                    if ((tmpvar_106 > 0.01)) {
                      tmpvar_103 = bool(0);
                    } else {
                      lowp float tmpvar_107;
                      tmpvar_107 = sqrt((0.01 - tmpvar_106));
                      lowp float tmpvar_108;
                      tmpvar_108 = (tmpvar_105 - tmpvar_107);
                      lowp float tmpvar_109;
                      tmpvar_109 = (tmpvar_105 + tmpvar_107);
                      lowp float tmpvar_110;
                      if ((tmpvar_108 < 0.0)) {
                        tmpvar_110 = tmpvar_109;
                      } else {
                        tmpvar_110 = tmpvar_108;
                      };
                      if (((tmpvar_110 < t_hit_9) && (tmpvar_110 > 0.0))) {
                        t_hit_102 = tmpvar_110;
                        tmpvar_103 = bool(1);
                      } else {
                        tmpvar_103 = bool(0);
                      };
                    };
                  };
                  t_hit_9 = t_hit_102;
                  tmp_93 = tmpvar_103;
                };
                if (tmp_93) {
                  idx_20 = i_17;
                  intersected_21 = 3;
                };
                i_17 = 2;
              };
            };
            position_10 = (origin + (tmpvar_6 * t_hit_9));
            if ((intersected_21 == 1)) {
              diffuseColor_12 = sphereColors[idx_20];
              specularColor_13 = sphereSpecColors[idx_20];
              reflectiveColor_14 = reflectiveColors[idx_20];
              roughness_15 = sphereRoughness[idx_20];
              lowp vec3 tmpvar_111;
              tmpvar_111 = normalize((position_10 - sphereCenters[idx_20]));
              normal_11 = tmpvar_111;
              lowp float tmpvar_112;
              tmpvar_112 = dot (tmpvar_111, -(tmpvar_6));
              if ((tmpvar_112 < 0.0)) {
                normal_11 = -(tmpvar_111);
              };
            } else {
              if ((intersected_21 == 2)) {
                if (!(enablePlaneMirrors)) {
                  diffuseColor_12 = planeColors[idx_20];
                  specularColor_13 = vec3(planeSpecular[idx_20]);
                  reflectiveColor_14 = vec3(0.0, 0.0, 0.0);
                  roughness_15 = planeRoughness[idx_20];
                } else {
                  diffuseColor_12 = (planeColors[idx_20] * 0.01);
                  specularColor_13 = vec3(0.0, 0.0, 0.0);
                  reflectiveColor_14 = planeColors[idx_20];
                  roughness_15 = 1.0;
                };
                lowp float tmpvar_113;
                tmpvar_113 = dot (normal_11, -(tmpvar_6));
                if ((tmpvar_113 < 0.0)) {
                  normal_11 = -(normal_11);
                };
              } else {
                if ((intersected_21 == 3)) {
                  diffuseColor_12 = (lightIntensity[idx_20] / 25.0);
                  isLight_16 = bool(1);
                };
              };
            };
            diffuseColor_4 = diffuseColor_12;
            specularColor_3 = specularColor_13;
            reflectiveColor_2 = reflectiveColor_14;
            roughness_1 = roughness_15;
            if (isLight_16) {
              lowp vec4 tmpvar_114;
              tmpvar_114.w = 1.0;
              tmpvar_114.xyz = diffuseColor_12;
              fragColor = tmpvar_114;
              return;
            };
            if (!(enableGI)) {
              pixelColor_5 = (pixelColor_5 + (ambientLight * diffuseColor_12));
            };
            lowp vec3 point_115;
            point_115 = position_10;
            lowp vec3 ray_dir_116;
            ray_dir_116 = tmpvar_6;
            lowp vec3 normal_117;
            normal_117 = normal_11;
            vec3 diffuseColor_118;
            diffuseColor_118 = diffuseColor_12;
            vec3 specularColor_119;
            specularColor_119 = specularColor_13;
            highp int i_120;
            lowp vec3 illuminationColor_121;
            i_120 = 0;
            while (true) {
              highp int k_122;
              highp int areaShadowSamples_123;
              lowp vec3 light_sum_124;
              vec2 lightSpot_125;
              vec2 lightSize_126;
              vec3 lightIntensity_127;
              vec3 lightPos_128;
              if ((i_120 >= 2)) {
                break;
              };
              if ((i_120 == numLights)) {
                break;
              };
              lightPos_128 = lightPos[i_120];
              lightIntensity_127 = lightIntensity[i_120];
              vec2 tmpvar_129;
              tmpvar_129 = lightSize[i_120];
              lightSize_126 = tmpvar_129;
              lightSpot_125 = lightSpot[i_120];
              highp int tmpvar_130;
              if (((tmpvar_129.x > 0.0) && (tmpvar_129.y > 0.0))) {
                tmpvar_130 = shadowSamples;
              } else {
                tmpvar_130 = 1;
              };
              areaShadowSamples_123 = tmpvar_130;
              k_122 = 0;
              while (true) {
                if ((k_122 >= 25)) {
                  break;
                };
                if ((k_122 == areaShadowSamples_123)) {
                  break;
                };
                float sample_i_131;
                sample_i_131 = float(k_122);
                lowp vec3 vec_to_light_132;
                lowp vec3 incident_intensity_133;
                lowp float spot_falloff_134;
                if (((lightSize_126.x > 0.0) && (lightSize_126.y > 0.0))) {
                  float tmpvar_135;
                  tmpvar_135 = (1.0/(shadowDim));
                  randomIncrement += 0.02;
                  lowp float tmpvar_136;
                  tmpvar_136 = ((lightSize_126.x * tmpvar_135) * ((float(mod (sample_i_131, shadowDim))) + fract(
                    (cos(dot ((point_115.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                  )));
                  randomIncrement += 0.02;
                  lowp vec3 tmpvar_137;
                  tmpvar_137.x = ((lightPos_128.x - (lightSize_126.x * 0.5)) + tmpvar_136);
                  tmpvar_137.y = lightPos_128.y;
                  tmpvar_137.z = ((lightPos_128.z - (lightSize_126.y * 0.5)) + ((lightSize_126.y * tmpvar_135) * (
                    floor((sample_i_131 * tmpvar_135))
                   + 
                    fract((cos(dot (
                      (point_115.yx + randomIncrement)
                    , vec2(23.14069, 2.665144))) * 12345.68))
                  )));
                  vec_to_light_132 = (tmpvar_137 - point_115);
                } else {
                  vec_to_light_132 = (lightPos_128 - point_115);
                };
                lowp float tmpvar_138;
                tmpvar_138 = sqrt(dot (vec_to_light_132, vec_to_light_132));
                lowp float tmpvar_139;
                tmpvar_139 = (1.0/(((attenuation.x * 
                  (tmpvar_138 * tmpvar_138)
                ) + (attenuation.y * tmpvar_138))));
                lowp vec3 tmpvar_140;
                tmpvar_140 = normalize(vec_to_light_132);
                vec_to_light_132 = tmpvar_140;
                spot_falloff_134 = 1.0;
                if ((lightSpot_125.x > 0.0)) {
                  lowp float tmpvar_141;
                  if ((tmpvar_140.y > lightSpot_125.x)) {
                    tmpvar_141 = pow (tmpvar_140.y, lightSpot_125.y);
                  } else {
                    tmpvar_141 = 0.0;
                  };
                  spot_falloff_134 = tmpvar_141;
                };
                incident_intensity_133 = ((lightIntensity_127 * tmpvar_139) * spot_falloff_134);
                lowp float tmpvar_142;
                tmpvar_142 = sqrt(dot (incident_intensity_133, incident_intensity_133));
                if ((tmpvar_142 > 0.01)) {
                  lowp vec3 ray_origin_143;
                  ray_origin_143 = point_115;
                  lowp vec3 ray_direction_144;
                  ray_direction_144 = tmpvar_140;
                  lowp float t_hit_145;
                  t_hit_145 = tmpvar_138;
                  bool tmpvar_146;
                  tmpvar_146 = bool(0);
                  highp int i_147;
                  highp int i_148;
                  i_148 = 0;
                  while (true) {
                    if ((i_148 >= 5)) {
                      break;
                    };
                    if ((i_148 == numSpheres)) {
                      break;
                    };
                    lowp float t_hit_149;
                    t_hit_149 = t_hit_145;
                    bool tmpvar_150;
                    lowp vec3 tmpvar_151;
                    tmpvar_151 = (sphereCenters[i_148] - ray_origin_143);
                    lowp float tmpvar_152;
                    tmpvar_152 = dot (tmpvar_151, ray_direction_144);
                    if ((tmpvar_152 < 0.0)) {
                      tmpvar_150 = bool(0);
                    } else {
                      lowp float tmpvar_153;
                      tmpvar_153 = (dot (tmpvar_151, tmpvar_151) - (tmpvar_152 * tmpvar_152));
                      if ((tmpvar_153 > 0.64)) {
                        tmpvar_150 = bool(0);
                      } else {
                        lowp float tmpvar_154;
                        tmpvar_154 = sqrt((0.64 - tmpvar_153));
                        lowp float tmpvar_155;
                        tmpvar_155 = (tmpvar_152 - tmpvar_154);
                        lowp float tmpvar_156;
                        tmpvar_156 = (tmpvar_152 + tmpvar_154);
                        lowp float tmpvar_157;
                        if ((tmpvar_155 < 0.01)) {
                          tmpvar_157 = tmpvar_156;
                        } else {
                          tmpvar_157 = tmpvar_155;
                        };
                        if (((tmpvar_157 < t_hit_145) && (tmpvar_157 > 0.01))) {
                          t_hit_149 = tmpvar_157;
                          tmpvar_150 = bool(1);
                        } else {
                          tmpvar_150 = bool(0);
                        };
                      };
                    };
                    t_hit_145 = t_hit_149;
                    if (tmpvar_150) {
                      tmpvar_146 = bool(1);
                      break;
                    };
                    i_148++;
                  };
                  if (!(tmpvar_146)) {
                    i_147 = 0;
                    while (true) {
                      if ((i_147 >= 6)) {
                        break;
                      };
                      if ((i_147 == numPlanes)) {
                        break;
                      };
                      vec3 normal_158;
                      normal_158 = planeNormals[i_147];
                      lowp float t_hit_159;
                      t_hit_159 = t_hit_145;
                      bool tmpvar_160;
                      tmpvar_160 = bool(1);
                      bool tmpvar_161;
                      vec3 tmpvar_162;
                      tmpvar_162 = (normal_158 * planeOffsets[i_147]);
                      lowp float tmpvar_163;
                      tmpvar_163 = (((
                        (tmpvar_162.x + tmpvar_162.y)
                       + tmpvar_162.z) - dot (normal_158, ray_origin_143)) / dot (normal_158, ray_direction_144));
                      if (((tmpvar_163 < t_hit_145) && (tmpvar_163 > 0.01))) {
                        t_hit_159 = tmpvar_163;
                        tmpvar_161 = bool(1);
                        tmpvar_160 = bool(0);
                      };
                      if (tmpvar_160) {
                        tmpvar_161 = bool(0);
                        tmpvar_160 = bool(0);
                      };
                      t_hit_145 = t_hit_159;
                      if (tmpvar_161) {
                        tmpvar_146 = bool(1);
                        break;
                      };
                      i_147++;
                    };
                    if (!(tmpvar_146)) {
                      tmpvar_146 = bool(1);
                    };
                  };
                  lowp float tmpvar_164;
                  tmpvar_164 = abs((t_hit_145 - tmpvar_138));
                  if ((tmpvar_164 < 0.001)) {
                    lowp vec3 tmpvar_165;
                    lowp float tmpvar_166;
                    tmpvar_166 = dot (normal_117, tmpvar_140);
                    if ((tmpvar_166 > 0.0)) {
                      tmpvar_165 = (incident_intensity_133 * ((diffuseColor_118 * 
                        max (0.0, dot (normal_117, tmpvar_140))
                      ) + (specularColor_119 * 
                        pow (max (0.0, dot ((
                          -(tmpvar_140)
                         - 
                          ((2.0 * dot (-(tmpvar_140), normal_117)) * normal_117)
                        ), -(ray_dir_116))), 128.0)
                      )));
                    } else {
                      tmpvar_165 = vec3(0.0, 0.0, 0.0);
                    };
                    light_sum_124 = (light_sum_124 + tmpvar_165);
                  };
                };
                k_122++;
              };
              illuminationColor_121 = (illuminationColor_121 + (light_sum_124 / float(tmpvar_130)));
              i_120++;
            };
            pixelColor_5 = (pixelColor_5 + illuminationColor_121);
            if (enableGI) {
              lowp vec3 point_167;
              point_167 = position_10;
              lowp vec3 rayDir_168;
              rayDir_168 = tmpvar_6;
              lowp vec3 normal_169;
              normal_169 = normal_11;
              float roughness_170;
              roughness_170 = roughness_15;
              lowp vec3 tmpvar_171;
              highp int k_172;
              lowp vec3 indirect_sampling_sum_173;
              float tmpvar_174;
              tmpvar_174 = sqrt(dot (diffuseColor_12, diffuseColor_12));
              if ((tmpvar_174 == 0.0)) {
                tmpvar_171 = vec3(0.0, 0.0, 0.0);
              } else {
                k_172 = 0;
                while (true) {
                  float indirectRoughness_175;
                  vec3 indirectRefColor_176;
                  vec3 indirectSpecularColor_177;
                  vec3 indirectDiffuseColor_178;
                  if ((k_172 >= 100)) {
                    break;
                  };
                  if ((k_172 == indirectSamples)) {
                    break;
                  };
                  randomIncrement += 0.02;
                  lowp float tmpvar_179;
                  tmpvar_179 = ((fract(
                    (cos(dot ((point_167.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                  ) * 2.0) - 1.0);
                  randomIncrement += 0.02;
                  lowp float tmpvar_180;
                  tmpvar_180 = (fract((
                    cos(dot ((point_167.xy + randomIncrement), vec2(23.14069, 2.665144)))
                   * 12345.68)) * 6.283185);
                  lowp float tmpvar_181;
                  tmpvar_181 = sqrt((1.0 - (tmpvar_179 * tmpvar_179)));
                  lowp vec3 tmpvar_182;
                  tmpvar_182.x = (tmpvar_181 * cos(tmpvar_180));
                  tmpvar_182.y = (tmpvar_181 * sin(tmpvar_180));
                  tmpvar_182.z = tmpvar_179;
                  lowp vec3 tmpvar_183;
                  tmpvar_183 = normalize(mix ((rayDir_168 - 
                    (2.0 * (dot (normal_169, rayDir_168) * normal_169))
                  ), normalize(
                    (normal_169 + tmpvar_182)
                  ), roughness_170));
                  lowp vec3 ray_origin_184;
                  ray_origin_184 = point_167;
                  lowp vec3 ray_direction_185;
                  ray_direction_185 = tmpvar_183;
                  lowp float t_hit_186;
                  t_hit_186 = 10.0;
                  lowp vec3 position_187;
                  lowp vec3 normal_188;
                  vec3 diffuseColor_189;
                  diffuseColor_189 = indirectDiffuseColor_178;
                  vec3 specularColor_190;
                  specularColor_190 = indirectSpecularColor_177;
                  vec3 reflectiveColor_191;
                  reflectiveColor_191 = indirectRefColor_176;
                  float roughness_192;
                  roughness_192 = indirectRoughness_175;
                  bool isLight_193;
                  isLight_193 = bool(0);
                  highp int i_194;
                  highp int i_195;
                  highp int i_196;
                  highp int idx_197;
                  highp int intersected_198;
                  intersected_198 = 0;
                  idx_197 = 0;
                  i_196 = 0;
                  if ((0 != numSpheres)) {
                    lowp float t_hit_199;
                    t_hit_199 = t_hit_186;
                    bool tmpvar_200;
                    lowp vec3 tmpvar_201;
                    tmpvar_201 = (sphereCenters[0] - point_167);
                    lowp float tmpvar_202;
                    tmpvar_202 = dot (tmpvar_201, tmpvar_183);
                    if ((tmpvar_202 < 0.0)) {
                      tmpvar_200 = bool(0);
                    } else {
                      lowp float tmpvar_203;
                      tmpvar_203 = (dot (tmpvar_201, tmpvar_201) - (tmpvar_202 * tmpvar_202));
                      if ((tmpvar_203 > 0.64)) {
                        tmpvar_200 = bool(0);
                      } else {
                        lowp float tmpvar_204;
                        tmpvar_204 = sqrt((0.64 - tmpvar_203));
                        lowp float tmpvar_205;
                        tmpvar_205 = (tmpvar_202 - tmpvar_204);
                        lowp float tmpvar_206;
                        tmpvar_206 = (tmpvar_202 + tmpvar_204);
                        lowp float tmpvar_207;
                        if ((tmpvar_205 < 0.01)) {
                          tmpvar_207 = tmpvar_206;
                        } else {
                          tmpvar_207 = tmpvar_205;
                        };
                        if (((tmpvar_207 < 10.0) && (tmpvar_207 > 0.01))) {
                          t_hit_199 = tmpvar_207;
                          tmpvar_200 = bool(1);
                        } else {
                          tmpvar_200 = bool(0);
                        };
                      };
                    };
                    t_hit_186 = t_hit_199;
                    if (tmpvar_200) {
                      idx_197 = i_196;
                      intersected_198 = 1;
                    };
                    i_196 = 1;
                    if ((1 != numSpheres)) {
                      lowp float t_hit_208;
                      t_hit_208 = t_hit_199;
                      bool tmpvar_209;
                      lowp vec3 tmpvar_210;
                      tmpvar_210 = (sphereCenters[1] - point_167);
                      lowp float tmpvar_211;
                      tmpvar_211 = dot (tmpvar_210, tmpvar_183);
                      if ((tmpvar_211 < 0.0)) {
                        tmpvar_209 = bool(0);
                      } else {
                        lowp float tmpvar_212;
                        tmpvar_212 = (dot (tmpvar_210, tmpvar_210) - (tmpvar_211 * tmpvar_211));
                        if ((tmpvar_212 > 0.64)) {
                          tmpvar_209 = bool(0);
                        } else {
                          lowp float tmpvar_213;
                          tmpvar_213 = sqrt((0.64 - tmpvar_212));
                          lowp float tmpvar_214;
                          tmpvar_214 = (tmpvar_211 - tmpvar_213);
                          lowp float tmpvar_215;
                          tmpvar_215 = (tmpvar_211 + tmpvar_213);
                          lowp float tmpvar_216;
                          if ((tmpvar_214 < 0.01)) {
                            tmpvar_216 = tmpvar_215;
                          } else {
                            tmpvar_216 = tmpvar_214;
                          };
                          if (((tmpvar_216 < t_hit_199) && (tmpvar_216 > 0.01))) {
                            t_hit_208 = tmpvar_216;
                            tmpvar_209 = bool(1);
                          } else {
                            tmpvar_209 = bool(0);
                          };
                        };
                      };
                      t_hit_186 = t_hit_208;
                      if (tmpvar_209) {
                        idx_197 = i_196;
                        intersected_198 = 1;
                      };
                      i_196 = 2;
                      if ((2 != numSpheres)) {
                        lowp float t_hit_217;
                        t_hit_217 = t_hit_208;
                        bool tmpvar_218;
                        lowp vec3 tmpvar_219;
                        tmpvar_219 = (sphereCenters[2] - point_167);
                        lowp float tmpvar_220;
                        tmpvar_220 = dot (tmpvar_219, tmpvar_183);
                        if ((tmpvar_220 < 0.0)) {
                          tmpvar_218 = bool(0);
                        } else {
                          lowp float tmpvar_221;
                          tmpvar_221 = (dot (tmpvar_219, tmpvar_219) - (tmpvar_220 * tmpvar_220));
                          if ((tmpvar_221 > 0.64)) {
                            tmpvar_218 = bool(0);
                          } else {
                            lowp float tmpvar_222;
                            tmpvar_222 = sqrt((0.64 - tmpvar_221));
                            lowp float tmpvar_223;
                            tmpvar_223 = (tmpvar_220 - tmpvar_222);
                            lowp float tmpvar_224;
                            tmpvar_224 = (tmpvar_220 + tmpvar_222);
                            lowp float tmpvar_225;
                            if ((tmpvar_223 < 0.01)) {
                              tmpvar_225 = tmpvar_224;
                            } else {
                              tmpvar_225 = tmpvar_223;
                            };
                            if (((tmpvar_225 < t_hit_208) && (tmpvar_225 > 0.01))) {
                              t_hit_217 = tmpvar_225;
                              tmpvar_218 = bool(1);
                            } else {
                              tmpvar_218 = bool(0);
                            };
                          };
                        };
                        t_hit_186 = t_hit_217;
                        if (tmpvar_218) {
                          idx_197 = i_196;
                          intersected_198 = 1;
                        };
                        i_196 = 3;
                        if ((3 != numSpheres)) {
                          lowp float t_hit_226;
                          t_hit_226 = t_hit_217;
                          bool tmpvar_227;
                          lowp vec3 tmpvar_228;
                          tmpvar_228 = (sphereCenters[3] - point_167);
                          lowp float tmpvar_229;
                          tmpvar_229 = dot (tmpvar_228, tmpvar_183);
                          if ((tmpvar_229 < 0.0)) {
                            tmpvar_227 = bool(0);
                          } else {
                            lowp float tmpvar_230;
                            tmpvar_230 = (dot (tmpvar_228, tmpvar_228) - (tmpvar_229 * tmpvar_229));
                            if ((tmpvar_230 > 0.64)) {
                              tmpvar_227 = bool(0);
                            } else {
                              lowp float tmpvar_231;
                              tmpvar_231 = sqrt((0.64 - tmpvar_230));
                              lowp float tmpvar_232;
                              tmpvar_232 = (tmpvar_229 - tmpvar_231);
                              lowp float tmpvar_233;
                              tmpvar_233 = (tmpvar_229 + tmpvar_231);
                              lowp float tmpvar_234;
                              if ((tmpvar_232 < 0.01)) {
                                tmpvar_234 = tmpvar_233;
                              } else {
                                tmpvar_234 = tmpvar_232;
                              };
                              if (((tmpvar_234 < t_hit_217) && (tmpvar_234 > 0.01))) {
                                t_hit_226 = tmpvar_234;
                                tmpvar_227 = bool(1);
                              } else {
                                tmpvar_227 = bool(0);
                              };
                            };
                          };
                          t_hit_186 = t_hit_226;
                          if (tmpvar_227) {
                            idx_197 = i_196;
                            intersected_198 = 1;
                          };
                          i_196 = 4;
                          if ((4 != numSpheres)) {
                            lowp float t_hit_235;
                            t_hit_235 = t_hit_226;
                            bool tmpvar_236;
                            lowp vec3 tmpvar_237;
                            tmpvar_237 = (sphereCenters[4] - point_167);
                            lowp float tmpvar_238;
                            tmpvar_238 = dot (tmpvar_237, tmpvar_183);
                            if ((tmpvar_238 < 0.0)) {
                              tmpvar_236 = bool(0);
                            } else {
                              lowp float tmpvar_239;
                              tmpvar_239 = (dot (tmpvar_237, tmpvar_237) - (tmpvar_238 * tmpvar_238));
                              if ((tmpvar_239 > 0.64)) {
                                tmpvar_236 = bool(0);
                              } else {
                                lowp float tmpvar_240;
                                tmpvar_240 = sqrt((0.64 - tmpvar_239));
                                lowp float tmpvar_241;
                                tmpvar_241 = (tmpvar_238 - tmpvar_240);
                                lowp float tmpvar_242;
                                tmpvar_242 = (tmpvar_238 + tmpvar_240);
                                lowp float tmpvar_243;
                                if ((tmpvar_241 < 0.01)) {
                                  tmpvar_243 = tmpvar_242;
                                } else {
                                  tmpvar_243 = tmpvar_241;
                                };
                                if (((tmpvar_243 < t_hit_226) && (tmpvar_243 > 0.01))) {
                                  t_hit_235 = tmpvar_243;
                                  tmpvar_236 = bool(1);
                                } else {
                                  tmpvar_236 = bool(0);
                                };
                              };
                            };
                            t_hit_186 = t_hit_235;
                            if (tmpvar_236) {
                              idx_197 = i_196;
                              intersected_198 = 1;
                            };
                            i_196 = 5;
                          };
                        };
                      };
                    };
                  };
                  i_195 = 0;
                  while (true) {
                    bool tmp_244;
                    if ((i_195 >= 6)) {
                      break;
                    };
                    if ((i_195 == numPlanes)) {
                      break;
                    };
                    lowp vec3 tmpvar_245;
                    tmpvar_245 = planeNormals[i_195];
                    tmp_244 = bool(0);
                    bool tmpvar_246;
                    if (enablePlaneBacksides) {
                      tmpvar_246 = bool(1);
                    } else {
                      tmpvar_246 = (dot (ray_direction_185, tmpvar_245) < 0.0);
                    };
                    if (tmpvar_246) {
                      lowp float t_hit_247;
                      t_hit_247 = t_hit_186;
                      bool tmpvar_248;
                      tmpvar_248 = bool(1);
                      bool tmpvar_249;
                      lowp vec3 tmpvar_250;
                      tmpvar_250 = (tmpvar_245 * planeOffsets[i_195]);
                      lowp float tmpvar_251;
                      tmpvar_251 = (((
                        (tmpvar_250.x + tmpvar_250.y)
                       + tmpvar_250.z) - dot (tmpvar_245, ray_origin_184)) / dot (tmpvar_245, ray_direction_185));
                      if (((tmpvar_251 < t_hit_186) && (tmpvar_251 > 0.01))) {
                        t_hit_247 = tmpvar_251;
                        tmpvar_249 = bool(1);
                        tmpvar_248 = bool(0);
                      };
                      if (tmpvar_248) {
                        tmpvar_249 = bool(0);
                        tmpvar_248 = bool(0);
                      };
                      t_hit_186 = t_hit_247;
                      tmp_244 = tmpvar_249;
                    };
                    if (tmp_244) {
                      normal_188 = tmpvar_245;
                      idx_197 = i_195;
                      intersected_198 = 2;
                    };
                    i_195++;
                  };
                  i_194 = 0;
                  bool tmp_252;
                  if ((0 != numLights)) {
                    vec3 tmpvar_253;
                    tmpvar_253 = lightPos[0];
                    vec2 tmpvar_254;
                    tmpvar_254 = lightSize[0];
                    tmp_252 = bool(0);
                    if (((tmpvar_254.x > 0.0) && (tmpvar_254.y > 0.0))) {
                      lowp float t_hit_255;
                      t_hit_255 = t_hit_186;
                      bool tmpvar_256;
                      tmpvar_256 = bool(1);
                      bool tmpvar_257;
                      vec3 tmpvar_258;
                      tmpvar_258 = (vec3(0.0, 1.0, 0.0) * tmpvar_253.y);
                      lowp float tmpvar_259;
                      tmpvar_259 = (((
                        (tmpvar_258.x + tmpvar_258.y)
                       + tmpvar_258.z) - point_167.y) / tmpvar_183.y);
                      if (((tmpvar_259 < t_hit_186) && (tmpvar_259 > 0.01))) {
                        lowp vec3 tmpvar_260;
                        tmpvar_260 = (point_167 + (tmpvar_183 * tmpvar_259));
                        if ((((tmpvar_254.x + tmpvar_254.y) == 0.0) || ((
                          ((tmpvar_260.x < (tmpvar_253.x + (tmpvar_254.x * 0.5))) && (tmpvar_260.x > (tmpvar_253.x - (tmpvar_254.x * 0.5))))
                         && 
                          (tmpvar_260.z < (tmpvar_253.z + (tmpvar_254.y * 0.5)))
                        ) && (tmpvar_260.z > 
                          (tmpvar_253.z - (tmpvar_254.y * 0.5))
                        )))) {
                          t_hit_255 = tmpvar_259;
                          tmpvar_257 = bool(1);
                          tmpvar_256 = bool(0);
                        };
                      };
                      if (tmpvar_256) {
                        tmpvar_257 = bool(0);
                        tmpvar_256 = bool(0);
                      };
                      t_hit_186 = t_hit_255;
                      tmp_252 = tmpvar_257;
                    } else {
                      lowp float t_hit_261;
                      t_hit_261 = t_hit_186;
                      bool tmpvar_262;
                      lowp vec3 tmpvar_263;
                      tmpvar_263 = (tmpvar_253 - point_167);
                      lowp float tmpvar_264;
                      tmpvar_264 = dot (tmpvar_263, tmpvar_183);
                      if ((tmpvar_264 < 0.0)) {
                        tmpvar_262 = bool(0);
                      } else {
                        lowp float tmpvar_265;
                        tmpvar_265 = (dot (tmpvar_263, tmpvar_263) - (tmpvar_264 * tmpvar_264));
                        if ((tmpvar_265 > 0.01)) {
                          tmpvar_262 = bool(0);
                        } else {
                          lowp float tmpvar_266;
                          tmpvar_266 = sqrt((0.01 - tmpvar_265));
                          lowp float tmpvar_267;
                          tmpvar_267 = (tmpvar_264 - tmpvar_266);
                          lowp float tmpvar_268;
                          tmpvar_268 = (tmpvar_264 + tmpvar_266);
                          lowp float tmpvar_269;
                          if ((tmpvar_267 < 0.01)) {
                            tmpvar_269 = tmpvar_268;
                          } else {
                            tmpvar_269 = tmpvar_267;
                          };
                          if (((tmpvar_269 < t_hit_186) && (tmpvar_269 > 0.01))) {
                            t_hit_261 = tmpvar_269;
                            tmpvar_262 = bool(1);
                          } else {
                            tmpvar_262 = bool(0);
                          };
                        };
                      };
                      t_hit_186 = t_hit_261;
                      tmp_252 = tmpvar_262;
                    };
                    if (tmp_252) {
                      idx_197 = i_194;
                      intersected_198 = 3;
                    };
                    i_194 = 1;
                    bool tmp_270;
                    if ((1 != numLights)) {
                      vec3 tmpvar_271;
                      tmpvar_271 = lightPos[1];
                      vec2 tmpvar_272;
                      tmpvar_272 = lightSize[1];
                      tmp_270 = bool(0);
                      if (((tmpvar_272.x > 0.0) && (tmpvar_272.y > 0.0))) {
                        lowp float t_hit_273;
                        t_hit_273 = t_hit_186;
                        bool tmpvar_274;
                        tmpvar_274 = bool(1);
                        bool tmpvar_275;
                        vec3 tmpvar_276;
                        tmpvar_276 = (vec3(0.0, 1.0, 0.0) * tmpvar_271.y);
                        lowp float tmpvar_277;
                        tmpvar_277 = (((
                          (tmpvar_276.x + tmpvar_276.y)
                         + tmpvar_276.z) - point_167.y) / tmpvar_183.y);
                        if (((tmpvar_277 < t_hit_186) && (tmpvar_277 > 0.01))) {
                          lowp vec3 tmpvar_278;
                          tmpvar_278 = (point_167 + (tmpvar_183 * tmpvar_277));
                          if ((((tmpvar_272.x + tmpvar_272.y) == 0.0) || ((
                            ((tmpvar_278.x < (tmpvar_271.x + (tmpvar_272.x * 0.5))) && (tmpvar_278.x > (tmpvar_271.x - (tmpvar_272.x * 0.5))))
                           && 
                            (tmpvar_278.z < (tmpvar_271.z + (tmpvar_272.y * 0.5)))
                          ) && (tmpvar_278.z > 
                            (tmpvar_271.z - (tmpvar_272.y * 0.5))
                          )))) {
                            t_hit_273 = tmpvar_277;
                            tmpvar_275 = bool(1);
                            tmpvar_274 = bool(0);
                          };
                        };
                        if (tmpvar_274) {
                          tmpvar_275 = bool(0);
                          tmpvar_274 = bool(0);
                        };
                        t_hit_186 = t_hit_273;
                        tmp_270 = tmpvar_275;
                      } else {
                        lowp float t_hit_279;
                        t_hit_279 = t_hit_186;
                        bool tmpvar_280;
                        lowp vec3 tmpvar_281;
                        tmpvar_281 = (tmpvar_271 - point_167);
                        lowp float tmpvar_282;
                        tmpvar_282 = dot (tmpvar_281, tmpvar_183);
                        if ((tmpvar_282 < 0.0)) {
                          tmpvar_280 = bool(0);
                        } else {
                          lowp float tmpvar_283;
                          tmpvar_283 = (dot (tmpvar_281, tmpvar_281) - (tmpvar_282 * tmpvar_282));
                          if ((tmpvar_283 > 0.01)) {
                            tmpvar_280 = bool(0);
                          } else {
                            lowp float tmpvar_284;
                            tmpvar_284 = sqrt((0.01 - tmpvar_283));
                            lowp float tmpvar_285;
                            tmpvar_285 = (tmpvar_282 - tmpvar_284);
                            lowp float tmpvar_286;
                            tmpvar_286 = (tmpvar_282 + tmpvar_284);
                            lowp float tmpvar_287;
                            if ((tmpvar_285 < 0.01)) {
                              tmpvar_287 = tmpvar_286;
                            } else {
                              tmpvar_287 = tmpvar_285;
                            };
                            if (((tmpvar_287 < t_hit_186) && (tmpvar_287 > 0.01))) {
                              t_hit_279 = tmpvar_287;
                              tmpvar_280 = bool(1);
                            } else {
                              tmpvar_280 = bool(0);
                            };
                          };
                        };
                        t_hit_186 = t_hit_279;
                        tmp_270 = tmpvar_280;
                      };
                      if (tmp_270) {
                        idx_197 = i_194;
                        intersected_198 = 3;
                      };
                      i_194 = 2;
                    };
                  };
                  position_187 = (point_167 + (tmpvar_183 * t_hit_186));
                  if ((intersected_198 == 1)) {
                    diffuseColor_189 = sphereColors[idx_197];
                    specularColor_190 = sphereSpecColors[idx_197];
                    reflectiveColor_191 = reflectiveColors[idx_197];
                    roughness_192 = sphereRoughness[idx_197];
                    lowp vec3 tmpvar_288;
                    tmpvar_288 = normalize((position_187 - sphereCenters[idx_197]));
                    normal_188 = tmpvar_288;
                    lowp float tmpvar_289;
                    tmpvar_289 = dot (tmpvar_288, -(tmpvar_183));
                    if ((tmpvar_289 < 0.0)) {
                      normal_188 = -(tmpvar_288);
                    };
                  } else {
                    if ((intersected_198 == 2)) {
                      if (!(enablePlaneMirrors)) {
                        diffuseColor_189 = planeColors[idx_197];
                        specularColor_190 = vec3(planeSpecular[idx_197]);
                        reflectiveColor_191 = vec3(0.0, 0.0, 0.0);
                        roughness_192 = planeRoughness[idx_197];
                      } else {
                        diffuseColor_189 = (planeColors[idx_197] * 0.01);
                        specularColor_190 = vec3(0.0, 0.0, 0.0);
                        reflectiveColor_191 = planeColors[idx_197];
                        roughness_192 = 1.0;
                      };
                      lowp float tmpvar_290;
                      tmpvar_290 = dot (normal_188, -(tmpvar_183));
                      if ((tmpvar_290 < 0.0)) {
                        normal_188 = -(normal_188);
                      };
                    } else {
                      if ((intersected_198 == 3)) {
                        diffuseColor_189 = (lightIntensity[idx_197] / 25.0);
                        isLight_193 = bool(1);
                      };
                    };
                  };
                  indirectDiffuseColor_178 = diffuseColor_189;
                  indirectSpecularColor_177 = specularColor_190;
                  indirectRefColor_176 = reflectiveColor_191;
                  indirectRoughness_175 = roughness_192;
                  float tmpvar_291;
                  tmpvar_291 = sqrt(dot (reflectiveColor_191, reflectiveColor_191));
                  if ((tmpvar_291 > 0.0)) {
                    indirectDiffuseColor_178 = reflectiveColor_191;
                  };
                  lowp vec3 tmpvar_292;
                  if (isLight_193) {
                    tmpvar_292 = indirectDiffuseColor_178;
                  } else {
                    lowp vec3 point_293;
                    point_293 = position_187;
                    lowp vec3 ray_dir_294;
                    ray_dir_294 = tmpvar_183;
                    lowp vec3 normal_295;
                    normal_295 = normal_188;
                    vec3 diffuseColor_296;
                    diffuseColor_296 = indirectDiffuseColor_178;
                    vec3 specularColor_297;
                    specularColor_297 = specularColor_190;
                    highp int i_298;
                    lowp vec3 illuminationColor_299;
                    i_298 = 0;
                    while (true) {
                      highp int k_300;
                      highp int areaShadowSamples_301;
                      lowp vec3 light_sum_302;
                      vec2 lightSpot_303;
                      vec2 lightSize_304;
                      vec3 lightIntensity_305;
                      vec3 lightPos_306;
                      if ((i_298 >= 2)) {
                        break;
                      };
                      if ((i_298 == numLights)) {
                        break;
                      };
                      lightPos_306 = lightPos[i_298];
                      lightIntensity_305 = lightIntensity[i_298];
                      vec2 tmpvar_307;
                      tmpvar_307 = lightSize[i_298];
                      lightSize_304 = tmpvar_307;
                      lightSpot_303 = lightSpot[i_298];
                      highp int tmpvar_308;
                      if (((tmpvar_307.x > 0.0) && (tmpvar_307.y > 0.0))) {
                        tmpvar_308 = shadowSamples;
                      } else {
                        tmpvar_308 = 1;
                      };
                      areaShadowSamples_301 = tmpvar_308;
                      k_300 = 0;
                      while (true) {
                        if ((k_300 >= 25)) {
                          break;
                        };
                        if ((k_300 == areaShadowSamples_301)) {
                          break;
                        };
                        float sample_i_309;
                        sample_i_309 = float(k_300);
                        lowp vec3 vec_to_light_310;
                        lowp vec3 incident_intensity_311;
                        lowp float spot_falloff_312;
                        if (((lightSize_304.x > 0.0) && (lightSize_304.y > 0.0))) {
                          float tmpvar_313;
                          tmpvar_313 = (1.0/(shadowDim));
                          randomIncrement += 0.02;
                          lowp float tmpvar_314;
                          tmpvar_314 = ((lightSize_304.x * tmpvar_313) * ((float(mod (sample_i_309, shadowDim))) + fract(
                            (cos(dot ((point_293.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                          )));
                          randomIncrement += 0.02;
                          lowp vec3 tmpvar_315;
                          tmpvar_315.x = ((lightPos_306.x - (lightSize_304.x * 0.5)) + tmpvar_314);
                          tmpvar_315.y = lightPos_306.y;
                          tmpvar_315.z = ((lightPos_306.z - (lightSize_304.y * 0.5)) + ((lightSize_304.y * tmpvar_313) * (
                            floor((sample_i_309 * tmpvar_313))
                           + 
                            fract((cos(dot (
                              (point_293.yx + randomIncrement)
                            , vec2(23.14069, 2.665144))) * 12345.68))
                          )));
                          vec_to_light_310 = (tmpvar_315 - point_293);
                        } else {
                          vec_to_light_310 = (lightPos_306 - point_293);
                        };
                        lowp float tmpvar_316;
                        tmpvar_316 = sqrt(dot (vec_to_light_310, vec_to_light_310));
                        lowp float tmpvar_317;
                        tmpvar_317 = (1.0/(((attenuation.x * 
                          (tmpvar_316 * tmpvar_316)
                        ) + (attenuation.y * tmpvar_316))));
                        lowp vec3 tmpvar_318;
                        tmpvar_318 = normalize(vec_to_light_310);
                        vec_to_light_310 = tmpvar_318;
                        spot_falloff_312 = 1.0;
                        if ((lightSpot_303.x > 0.0)) {
                          lowp float tmpvar_319;
                          if ((tmpvar_318.y > lightSpot_303.x)) {
                            tmpvar_319 = pow (tmpvar_318.y, lightSpot_303.y);
                          } else {
                            tmpvar_319 = 0.0;
                          };
                          spot_falloff_312 = tmpvar_319;
                        };
                        incident_intensity_311 = ((lightIntensity_305 * tmpvar_317) * spot_falloff_312);
                        lowp float tmpvar_320;
                        tmpvar_320 = sqrt(dot (incident_intensity_311, incident_intensity_311));
                        if ((tmpvar_320 > 0.01)) {
                          lowp vec3 ray_origin_321;
                          ray_origin_321 = point_293;
                          lowp vec3 ray_direction_322;
                          ray_direction_322 = tmpvar_318;
                          lowp float t_hit_323;
                          t_hit_323 = tmpvar_316;
                          bool tmpvar_324;
                          tmpvar_324 = bool(0);
                          highp int i_325;
                          highp int i_326;
                          i_326 = 0;
                          while (true) {
                            if ((i_326 >= 5)) {
                              break;
                            };
                            if ((i_326 == numSpheres)) {
                              break;
                            };
                            lowp float t_hit_327;
                            t_hit_327 = t_hit_323;
                            bool tmpvar_328;
                            lowp vec3 tmpvar_329;
                            tmpvar_329 = (sphereCenters[i_326] - ray_origin_321);
                            lowp float tmpvar_330;
                            tmpvar_330 = dot (tmpvar_329, ray_direction_322);
                            if ((tmpvar_330 < 0.0)) {
                              tmpvar_328 = bool(0);
                            } else {
                              lowp float tmpvar_331;
                              tmpvar_331 = (dot (tmpvar_329, tmpvar_329) - (tmpvar_330 * tmpvar_330));
                              if ((tmpvar_331 > 0.64)) {
                                tmpvar_328 = bool(0);
                              } else {
                                lowp float tmpvar_332;
                                tmpvar_332 = sqrt((0.64 - tmpvar_331));
                                lowp float tmpvar_333;
                                tmpvar_333 = (tmpvar_330 - tmpvar_332);
                                lowp float tmpvar_334;
                                tmpvar_334 = (tmpvar_330 + tmpvar_332);
                                lowp float tmpvar_335;
                                if ((tmpvar_333 < 0.01)) {
                                  tmpvar_335 = tmpvar_334;
                                } else {
                                  tmpvar_335 = tmpvar_333;
                                };
                                if (((tmpvar_335 < t_hit_323) && (tmpvar_335 > 0.01))) {
                                  t_hit_327 = tmpvar_335;
                                  tmpvar_328 = bool(1);
                                } else {
                                  tmpvar_328 = bool(0);
                                };
                              };
                            };
                            t_hit_323 = t_hit_327;
                            if (tmpvar_328) {
                              tmpvar_324 = bool(1);
                              break;
                            };
                            i_326++;
                          };
                          if (!(tmpvar_324)) {
                            i_325 = 0;
                            while (true) {
                              if ((i_325 >= 6)) {
                                break;
                              };
                              if ((i_325 == numPlanes)) {
                                break;
                              };
                              vec3 normal_336;
                              normal_336 = planeNormals[i_325];
                              lowp float t_hit_337;
                              t_hit_337 = t_hit_323;
                              bool tmpvar_338;
                              tmpvar_338 = bool(1);
                              bool tmpvar_339;
                              vec3 tmpvar_340;
                              tmpvar_340 = (normal_336 * planeOffsets[i_325]);
                              lowp float tmpvar_341;
                              tmpvar_341 = (((
                                (tmpvar_340.x + tmpvar_340.y)
                               + tmpvar_340.z) - dot (normal_336, ray_origin_321)) / dot (normal_336, ray_direction_322));
                              if (((tmpvar_341 < t_hit_323) && (tmpvar_341 > 0.01))) {
                                t_hit_337 = tmpvar_341;
                                tmpvar_339 = bool(1);
                                tmpvar_338 = bool(0);
                              };
                              if (tmpvar_338) {
                                tmpvar_339 = bool(0);
                                tmpvar_338 = bool(0);
                              };
                              t_hit_323 = t_hit_337;
                              if (tmpvar_339) {
                                tmpvar_324 = bool(1);
                                break;
                              };
                              i_325++;
                            };
                            if (!(tmpvar_324)) {
                              tmpvar_324 = bool(1);
                            };
                          };
                          lowp float tmpvar_342;
                          tmpvar_342 = abs((t_hit_323 - tmpvar_316));
                          if ((tmpvar_342 < 0.001)) {
                            lowp vec3 tmpvar_343;
                            lowp float tmpvar_344;
                            tmpvar_344 = dot (normal_295, tmpvar_318);
                            if ((tmpvar_344 > 0.0)) {
                              tmpvar_343 = (incident_intensity_311 * ((diffuseColor_296 * 
                                max (0.0, dot (normal_295, tmpvar_318))
                              ) + (specularColor_297 * 
                                pow (max (0.0, dot ((
                                  -(tmpvar_318)
                                 - 
                                  ((2.0 * dot (-(tmpvar_318), normal_295)) * normal_295)
                                ), -(ray_dir_294))), 128.0)
                              )));
                            } else {
                              tmpvar_343 = vec3(0.0, 0.0, 0.0);
                            };
                            light_sum_302 = (light_sum_302 + tmpvar_343);
                          };
                        };
                        k_300++;
                      };
                      illuminationColor_299 = (illuminationColor_299 + (light_sum_302 / float(tmpvar_308)));
                      i_298++;
                    };
                    tmpvar_292 = illuminationColor_299;
                  };
                  indirect_sampling_sum_173 = (indirect_sampling_sum_173 + tmpvar_292);
                  k_172++;
                };
                tmpvar_171 = ((indirect_sampling_sum_173 / float(indirectSamples)) * diffuseColor_12);
              };
              pixelColor_5 = (pixelColor_5 + tmpvar_171);
            };
            bool tmpvar_345;
            if ((rayBounces > 0)) {
              tmpvar_345 = (sqrt(dot (reflectiveColor_14, reflectiveColor_14)) > 0.0);
            } else {
              tmpvar_345 = bool(0);
            };
            if (tmpvar_345) {
              lowp vec3 origin_346;
              origin_346 = position_10;
              lowp vec3 rayDir_347;
              rayDir_347 = tmpvar_6;
              lowp vec3 normal_348;
              normal_348 = normal_11;
              vec3 refColor_349;
              refColor_349 = reflectiveColor_14;
              lowp vec3 reflectionSum_351;
              for (highp int i_350 = 0; i_350 < 5; i_350++) {
                lowp vec3 mirror_sample_color_352;
                float hitRoughness_353;
                vec3 bounceRefColor_354;
                vec3 bounceSpecularColor_355;
                vec3 bounceDiffuseColor_356;
                bool tmpvar_357;
                if ((i_350 == rayBounces)) {
                  tmpvar_357 = bool(1);
                } else {
                  tmpvar_357 = (sqrt(dot (refColor_349, refColor_349)) == 0.0);
                };
                if (tmpvar_357) {
                  break;
                };
                lowp vec3 tmpvar_358;
                tmpvar_358 = (rayDir_347 - (2.0 * (
                  dot (normal_348, rayDir_347)
                 * normal_348)));
                lowp vec3 ray_origin_359;
                ray_origin_359 = origin_346;
                lowp vec3 ray_direction_360;
                ray_direction_360 = tmpvar_358;
                lowp float t_hit_361;
                t_hit_361 = 50.0;
                lowp vec3 position_362;
                lowp vec3 normal_363;
                vec3 diffuseColor_364;
                diffuseColor_364 = bounceDiffuseColor_356;
                vec3 specularColor_365;
                specularColor_365 = bounceSpecularColor_355;
                vec3 reflectiveColor_366;
                reflectiveColor_366 = bounceRefColor_354;
                float roughness_367;
                roughness_367 = hitRoughness_353;
                bool isLight_368;
                isLight_368 = bool(0);
                highp int i_369;
                highp int i_370;
                highp int i_371;
                highp int idx_372;
                highp int intersected_373;
                intersected_373 = 0;
                idx_372 = 0;
                i_371 = 0;
                if ((0 != numSpheres)) {
                  lowp float t_hit_374;
                  t_hit_374 = t_hit_361;
                  bool tmpvar_375;
                  lowp vec3 tmpvar_376;
                  tmpvar_376 = (sphereCenters[0] - origin_346);
                  lowp float tmpvar_377;
                  tmpvar_377 = dot (tmpvar_376, tmpvar_358);
                  if ((tmpvar_377 < 0.0)) {
                    tmpvar_375 = bool(0);
                  } else {
                    lowp float tmpvar_378;
                    tmpvar_378 = (dot (tmpvar_376, tmpvar_376) - (tmpvar_377 * tmpvar_377));
                    if ((tmpvar_378 > 0.64)) {
                      tmpvar_375 = bool(0);
                    } else {
                      lowp float tmpvar_379;
                      tmpvar_379 = sqrt((0.64 - tmpvar_378));
                      lowp float tmpvar_380;
                      tmpvar_380 = (tmpvar_377 - tmpvar_379);
                      lowp float tmpvar_381;
                      tmpvar_381 = (tmpvar_377 + tmpvar_379);
                      lowp float tmpvar_382;
                      if ((tmpvar_380 < 0.01)) {
                        tmpvar_382 = tmpvar_381;
                      } else {
                        tmpvar_382 = tmpvar_380;
                      };
                      if (((tmpvar_382 < 50.0) && (tmpvar_382 > 0.01))) {
                        t_hit_374 = tmpvar_382;
                        tmpvar_375 = bool(1);
                      } else {
                        tmpvar_375 = bool(0);
                      };
                    };
                  };
                  t_hit_361 = t_hit_374;
                  if (tmpvar_375) {
                    idx_372 = i_371;
                    intersected_373 = 1;
                  };
                  i_371 = 1;
                  if ((1 != numSpheres)) {
                    lowp float t_hit_383;
                    t_hit_383 = t_hit_374;
                    bool tmpvar_384;
                    lowp vec3 tmpvar_385;
                    tmpvar_385 = (sphereCenters[1] - origin_346);
                    lowp float tmpvar_386;
                    tmpvar_386 = dot (tmpvar_385, tmpvar_358);
                    if ((tmpvar_386 < 0.0)) {
                      tmpvar_384 = bool(0);
                    } else {
                      lowp float tmpvar_387;
                      tmpvar_387 = (dot (tmpvar_385, tmpvar_385) - (tmpvar_386 * tmpvar_386));
                      if ((tmpvar_387 > 0.64)) {
                        tmpvar_384 = bool(0);
                      } else {
                        lowp float tmpvar_388;
                        tmpvar_388 = sqrt((0.64 - tmpvar_387));
                        lowp float tmpvar_389;
                        tmpvar_389 = (tmpvar_386 - tmpvar_388);
                        lowp float tmpvar_390;
                        tmpvar_390 = (tmpvar_386 + tmpvar_388);
                        lowp float tmpvar_391;
                        if ((tmpvar_389 < 0.01)) {
                          tmpvar_391 = tmpvar_390;
                        } else {
                          tmpvar_391 = tmpvar_389;
                        };
                        if (((tmpvar_391 < t_hit_374) && (tmpvar_391 > 0.01))) {
                          t_hit_383 = tmpvar_391;
                          tmpvar_384 = bool(1);
                        } else {
                          tmpvar_384 = bool(0);
                        };
                      };
                    };
                    t_hit_361 = t_hit_383;
                    if (tmpvar_384) {
                      idx_372 = i_371;
                      intersected_373 = 1;
                    };
                    i_371 = 2;
                    if ((2 != numSpheres)) {
                      lowp float t_hit_392;
                      t_hit_392 = t_hit_383;
                      bool tmpvar_393;
                      lowp vec3 tmpvar_394;
                      tmpvar_394 = (sphereCenters[2] - origin_346);
                      lowp float tmpvar_395;
                      tmpvar_395 = dot (tmpvar_394, tmpvar_358);
                      if ((tmpvar_395 < 0.0)) {
                        tmpvar_393 = bool(0);
                      } else {
                        lowp float tmpvar_396;
                        tmpvar_396 = (dot (tmpvar_394, tmpvar_394) - (tmpvar_395 * tmpvar_395));
                        if ((tmpvar_396 > 0.64)) {
                          tmpvar_393 = bool(0);
                        } else {
                          lowp float tmpvar_397;
                          tmpvar_397 = sqrt((0.64 - tmpvar_396));
                          lowp float tmpvar_398;
                          tmpvar_398 = (tmpvar_395 - tmpvar_397);
                          lowp float tmpvar_399;
                          tmpvar_399 = (tmpvar_395 + tmpvar_397);
                          lowp float tmpvar_400;
                          if ((tmpvar_398 < 0.01)) {
                            tmpvar_400 = tmpvar_399;
                          } else {
                            tmpvar_400 = tmpvar_398;
                          };
                          if (((tmpvar_400 < t_hit_383) && (tmpvar_400 > 0.01))) {
                            t_hit_392 = tmpvar_400;
                            tmpvar_393 = bool(1);
                          } else {
                            tmpvar_393 = bool(0);
                          };
                        };
                      };
                      t_hit_361 = t_hit_392;
                      if (tmpvar_393) {
                        idx_372 = i_371;
                        intersected_373 = 1;
                      };
                      i_371 = 3;
                      if ((3 != numSpheres)) {
                        lowp float t_hit_401;
                        t_hit_401 = t_hit_392;
                        bool tmpvar_402;
                        lowp vec3 tmpvar_403;
                        tmpvar_403 = (sphereCenters[3] - origin_346);
                        lowp float tmpvar_404;
                        tmpvar_404 = dot (tmpvar_403, tmpvar_358);
                        if ((tmpvar_404 < 0.0)) {
                          tmpvar_402 = bool(0);
                        } else {
                          lowp float tmpvar_405;
                          tmpvar_405 = (dot (tmpvar_403, tmpvar_403) - (tmpvar_404 * tmpvar_404));
                          if ((tmpvar_405 > 0.64)) {
                            tmpvar_402 = bool(0);
                          } else {
                            lowp float tmpvar_406;
                            tmpvar_406 = sqrt((0.64 - tmpvar_405));
                            lowp float tmpvar_407;
                            tmpvar_407 = (tmpvar_404 - tmpvar_406);
                            lowp float tmpvar_408;
                            tmpvar_408 = (tmpvar_404 + tmpvar_406);
                            lowp float tmpvar_409;
                            if ((tmpvar_407 < 0.01)) {
                              tmpvar_409 = tmpvar_408;
                            } else {
                              tmpvar_409 = tmpvar_407;
                            };
                            if (((tmpvar_409 < t_hit_392) && (tmpvar_409 > 0.01))) {
                              t_hit_401 = tmpvar_409;
                              tmpvar_402 = bool(1);
                            } else {
                              tmpvar_402 = bool(0);
                            };
                          };
                        };
                        t_hit_361 = t_hit_401;
                        if (tmpvar_402) {
                          idx_372 = i_371;
                          intersected_373 = 1;
                        };
                        i_371 = 4;
                        if ((4 != numSpheres)) {
                          lowp float t_hit_410;
                          t_hit_410 = t_hit_401;
                          bool tmpvar_411;
                          lowp vec3 tmpvar_412;
                          tmpvar_412 = (sphereCenters[4] - origin_346);
                          lowp float tmpvar_413;
                          tmpvar_413 = dot (tmpvar_412, tmpvar_358);
                          if ((tmpvar_413 < 0.0)) {
                            tmpvar_411 = bool(0);
                          } else {
                            lowp float tmpvar_414;
                            tmpvar_414 = (dot (tmpvar_412, tmpvar_412) - (tmpvar_413 * tmpvar_413));
                            if ((tmpvar_414 > 0.64)) {
                              tmpvar_411 = bool(0);
                            } else {
                              lowp float tmpvar_415;
                              tmpvar_415 = sqrt((0.64 - tmpvar_414));
                              lowp float tmpvar_416;
                              tmpvar_416 = (tmpvar_413 - tmpvar_415);
                              lowp float tmpvar_417;
                              tmpvar_417 = (tmpvar_413 + tmpvar_415);
                              lowp float tmpvar_418;
                              if ((tmpvar_416 < 0.01)) {
                                tmpvar_418 = tmpvar_417;
                              } else {
                                tmpvar_418 = tmpvar_416;
                              };
                              if (((tmpvar_418 < t_hit_401) && (tmpvar_418 > 0.01))) {
                                t_hit_410 = tmpvar_418;
                                tmpvar_411 = bool(1);
                              } else {
                                tmpvar_411 = bool(0);
                              };
                            };
                          };
                          t_hit_361 = t_hit_410;
                          if (tmpvar_411) {
                            idx_372 = i_371;
                            intersected_373 = 1;
                          };
                          i_371 = 5;
                        };
                      };
                    };
                  };
                };
                i_370 = 0;
                while (true) {
                  bool tmp_419;
                  if ((i_370 >= 6)) {
                    break;
                  };
                  if ((i_370 == numPlanes)) {
                    break;
                  };
                  lowp vec3 tmpvar_420;
                  tmpvar_420 = planeNormals[i_370];
                  tmp_419 = bool(0);
                  bool tmpvar_421;
                  if (enablePlaneBacksides) {
                    tmpvar_421 = bool(1);
                  } else {
                    tmpvar_421 = (dot (ray_direction_360, tmpvar_420) < 0.0);
                  };
                  if (tmpvar_421) {
                    lowp float t_hit_422;
                    t_hit_422 = t_hit_361;
                    bool tmpvar_423;
                    tmpvar_423 = bool(1);
                    bool tmpvar_424;
                    lowp vec3 tmpvar_425;
                    tmpvar_425 = (tmpvar_420 * planeOffsets[i_370]);
                    lowp float tmpvar_426;
                    tmpvar_426 = (((
                      (tmpvar_425.x + tmpvar_425.y)
                     + tmpvar_425.z) - dot (tmpvar_420, ray_origin_359)) / dot (tmpvar_420, ray_direction_360));
                    if (((tmpvar_426 < t_hit_361) && (tmpvar_426 > 0.01))) {
                      t_hit_422 = tmpvar_426;
                      tmpvar_424 = bool(1);
                      tmpvar_423 = bool(0);
                    };
                    if (tmpvar_423) {
                      tmpvar_424 = bool(0);
                      tmpvar_423 = bool(0);
                    };
                    t_hit_361 = t_hit_422;
                    tmp_419 = tmpvar_424;
                  };
                  if (tmp_419) {
                    normal_363 = tmpvar_420;
                    idx_372 = i_370;
                    intersected_373 = 2;
                  };
                  i_370++;
                };
                i_369 = 0;
                bool tmp_427;
                if ((0 != numLights)) {
                  vec3 tmpvar_428;
                  tmpvar_428 = lightPos[0];
                  vec2 tmpvar_429;
                  tmpvar_429 = lightSize[0];
                  tmp_427 = bool(0);
                  if (((tmpvar_429.x > 0.0) && (tmpvar_429.y > 0.0))) {
                    lowp float t_hit_430;
                    t_hit_430 = t_hit_361;
                    bool tmpvar_431;
                    tmpvar_431 = bool(1);
                    bool tmpvar_432;
                    vec3 tmpvar_433;
                    tmpvar_433 = (vec3(0.0, 1.0, 0.0) * tmpvar_428.y);
                    lowp float tmpvar_434;
                    tmpvar_434 = (((
                      (tmpvar_433.x + tmpvar_433.y)
                     + tmpvar_433.z) - origin_346.y) / tmpvar_358.y);
                    if (((tmpvar_434 < t_hit_361) && (tmpvar_434 > 0.01))) {
                      lowp vec3 tmpvar_435;
                      tmpvar_435 = (origin_346 + (tmpvar_358 * tmpvar_434));
                      if ((((tmpvar_429.x + tmpvar_429.y) == 0.0) || ((
                        ((tmpvar_435.x < (tmpvar_428.x + (tmpvar_429.x * 0.5))) && (tmpvar_435.x > (tmpvar_428.x - (tmpvar_429.x * 0.5))))
                       && 
                        (tmpvar_435.z < (tmpvar_428.z + (tmpvar_429.y * 0.5)))
                      ) && (tmpvar_435.z > 
                        (tmpvar_428.z - (tmpvar_429.y * 0.5))
                      )))) {
                        t_hit_430 = tmpvar_434;
                        tmpvar_432 = bool(1);
                        tmpvar_431 = bool(0);
                      };
                    };
                    if (tmpvar_431) {
                      tmpvar_432 = bool(0);
                      tmpvar_431 = bool(0);
                    };
                    t_hit_361 = t_hit_430;
                    tmp_427 = tmpvar_432;
                  } else {
                    lowp float t_hit_436;
                    t_hit_436 = t_hit_361;
                    bool tmpvar_437;
                    lowp vec3 tmpvar_438;
                    tmpvar_438 = (tmpvar_428 - origin_346);
                    lowp float tmpvar_439;
                    tmpvar_439 = dot (tmpvar_438, tmpvar_358);
                    if ((tmpvar_439 < 0.0)) {
                      tmpvar_437 = bool(0);
                    } else {
                      lowp float tmpvar_440;
                      tmpvar_440 = (dot (tmpvar_438, tmpvar_438) - (tmpvar_439 * tmpvar_439));
                      if ((tmpvar_440 > 0.01)) {
                        tmpvar_437 = bool(0);
                      } else {
                        lowp float tmpvar_441;
                        tmpvar_441 = sqrt((0.01 - tmpvar_440));
                        lowp float tmpvar_442;
                        tmpvar_442 = (tmpvar_439 - tmpvar_441);
                        lowp float tmpvar_443;
                        tmpvar_443 = (tmpvar_439 + tmpvar_441);
                        lowp float tmpvar_444;
                        if ((tmpvar_442 < 0.01)) {
                          tmpvar_444 = tmpvar_443;
                        } else {
                          tmpvar_444 = tmpvar_442;
                        };
                        if (((tmpvar_444 < t_hit_361) && (tmpvar_444 > 0.01))) {
                          t_hit_436 = tmpvar_444;
                          tmpvar_437 = bool(1);
                        } else {
                          tmpvar_437 = bool(0);
                        };
                      };
                    };
                    t_hit_361 = t_hit_436;
                    tmp_427 = tmpvar_437;
                  };
                  if (tmp_427) {
                    idx_372 = i_369;
                    intersected_373 = 3;
                  };
                  i_369 = 1;
                  bool tmp_445;
                  if ((1 != numLights)) {
                    vec3 tmpvar_446;
                    tmpvar_446 = lightPos[1];
                    vec2 tmpvar_447;
                    tmpvar_447 = lightSize[1];
                    tmp_445 = bool(0);
                    if (((tmpvar_447.x > 0.0) && (tmpvar_447.y > 0.0))) {
                      lowp float t_hit_448;
                      t_hit_448 = t_hit_361;
                      bool tmpvar_449;
                      tmpvar_449 = bool(1);
                      bool tmpvar_450;
                      vec3 tmpvar_451;
                      tmpvar_451 = (vec3(0.0, 1.0, 0.0) * tmpvar_446.y);
                      lowp float tmpvar_452;
                      tmpvar_452 = (((
                        (tmpvar_451.x + tmpvar_451.y)
                       + tmpvar_451.z) - origin_346.y) / tmpvar_358.y);
                      if (((tmpvar_452 < t_hit_361) && (tmpvar_452 > 0.01))) {
                        lowp vec3 tmpvar_453;
                        tmpvar_453 = (origin_346 + (tmpvar_358 * tmpvar_452));
                        if ((((tmpvar_447.x + tmpvar_447.y) == 0.0) || ((
                          ((tmpvar_453.x < (tmpvar_446.x + (tmpvar_447.x * 0.5))) && (tmpvar_453.x > (tmpvar_446.x - (tmpvar_447.x * 0.5))))
                         && 
                          (tmpvar_453.z < (tmpvar_446.z + (tmpvar_447.y * 0.5)))
                        ) && (tmpvar_453.z > 
                          (tmpvar_446.z - (tmpvar_447.y * 0.5))
                        )))) {
                          t_hit_448 = tmpvar_452;
                          tmpvar_450 = bool(1);
                          tmpvar_449 = bool(0);
                        };
                      };
                      if (tmpvar_449) {
                        tmpvar_450 = bool(0);
                        tmpvar_449 = bool(0);
                      };
                      t_hit_361 = t_hit_448;
                      tmp_445 = tmpvar_450;
                    } else {
                      lowp float t_hit_454;
                      t_hit_454 = t_hit_361;
                      bool tmpvar_455;
                      lowp vec3 tmpvar_456;
                      tmpvar_456 = (tmpvar_446 - origin_346);
                      lowp float tmpvar_457;
                      tmpvar_457 = dot (tmpvar_456, tmpvar_358);
                      if ((tmpvar_457 < 0.0)) {
                        tmpvar_455 = bool(0);
                      } else {
                        lowp float tmpvar_458;
                        tmpvar_458 = (dot (tmpvar_456, tmpvar_456) - (tmpvar_457 * tmpvar_457));
                        if ((tmpvar_458 > 0.01)) {
                          tmpvar_455 = bool(0);
                        } else {
                          lowp float tmpvar_459;
                          tmpvar_459 = sqrt((0.01 - tmpvar_458));
                          lowp float tmpvar_460;
                          tmpvar_460 = (tmpvar_457 - tmpvar_459);
                          lowp float tmpvar_461;
                          tmpvar_461 = (tmpvar_457 + tmpvar_459);
                          lowp float tmpvar_462;
                          if ((tmpvar_460 < 0.01)) {
                            tmpvar_462 = tmpvar_461;
                          } else {
                            tmpvar_462 = tmpvar_460;
                          };
                          if (((tmpvar_462 < t_hit_361) && (tmpvar_462 > 0.01))) {
                            t_hit_454 = tmpvar_462;
                            tmpvar_455 = bool(1);
                          } else {
                            tmpvar_455 = bool(0);
                          };
                        };
                      };
                      t_hit_361 = t_hit_454;
                      tmp_445 = tmpvar_455;
                    };
                    if (tmp_445) {
                      idx_372 = i_369;
                      intersected_373 = 3;
                    };
                    i_369 = 2;
                  };
                };
                position_362 = (origin_346 + (tmpvar_358 * t_hit_361));
                if ((intersected_373 == 1)) {
                  diffuseColor_364 = sphereColors[idx_372];
                  specularColor_365 = sphereSpecColors[idx_372];
                  reflectiveColor_366 = reflectiveColors[idx_372];
                  roughness_367 = sphereRoughness[idx_372];
                  lowp vec3 tmpvar_463;
                  tmpvar_463 = normalize((position_362 - sphereCenters[idx_372]));
                  normal_363 = tmpvar_463;
                  lowp float tmpvar_464;
                  tmpvar_464 = dot (tmpvar_463, -(tmpvar_358));
                  if ((tmpvar_464 < 0.0)) {
                    normal_363 = -(tmpvar_463);
                  };
                } else {
                  if ((intersected_373 == 2)) {
                    if (!(enablePlaneMirrors)) {
                      diffuseColor_364 = planeColors[idx_372];
                      specularColor_365 = vec3(planeSpecular[idx_372]);
                      reflectiveColor_366 = vec3(0.0, 0.0, 0.0);
                      roughness_367 = planeRoughness[idx_372];
                    } else {
                      diffuseColor_364 = (planeColors[idx_372] * 0.01);
                      specularColor_365 = vec3(0.0, 0.0, 0.0);
                      reflectiveColor_366 = planeColors[idx_372];
                      roughness_367 = 1.0;
                    };
                    lowp float tmpvar_465;
                    tmpvar_465 = dot (normal_363, -(tmpvar_358));
                    if ((tmpvar_465 < 0.0)) {
                      normal_363 = -(normal_363);
                    };
                  } else {
                    if ((intersected_373 == 3)) {
                      diffuseColor_364 = (lightIntensity[idx_372] / 25.0);
                      isLight_368 = bool(1);
                    };
                  };
                };
                normal_348 = normal_363;
                bounceDiffuseColor_356 = diffuseColor_364;
                bounceSpecularColor_355 = specularColor_365;
                bounceRefColor_354 = reflectiveColor_366;
                hitRoughness_353 = roughness_367;
                lowp vec3 tmpvar_466;
                if (isLight_368) {
                  tmpvar_466 = diffuseColor_364;
                } else {
                  lowp vec3 point_467;
                  point_467 = position_362;
                  lowp vec3 ray_dir_468;
                  ray_dir_468 = tmpvar_358;
                  lowp vec3 normal_469;
                  normal_469 = normal_363;
                  vec3 diffuseColor_470;
                  diffuseColor_470 = diffuseColor_364;
                  vec3 specularColor_471;
                  specularColor_471 = specularColor_365;
                  highp int i_472;
                  lowp vec3 illuminationColor_473;
                  i_472 = 0;
                  while (true) {
                    highp int k_474;
                    highp int areaShadowSamples_475;
                    lowp vec3 light_sum_476;
                    vec2 lightSpot_477;
                    vec2 lightSize_478;
                    vec3 lightIntensity_479;
                    vec3 lightPos_480;
                    if ((i_472 >= 2)) {
                      break;
                    };
                    if ((i_472 == numLights)) {
                      break;
                    };
                    lightPos_480 = lightPos[i_472];
                    lightIntensity_479 = lightIntensity[i_472];
                    vec2 tmpvar_481;
                    tmpvar_481 = lightSize[i_472];
                    lightSize_478 = tmpvar_481;
                    lightSpot_477 = lightSpot[i_472];
                    highp int tmpvar_482;
                    if (((tmpvar_481.x > 0.0) && (tmpvar_481.y > 0.0))) {
                      tmpvar_482 = shadowSamples;
                    } else {
                      tmpvar_482 = 1;
                    };
                    areaShadowSamples_475 = tmpvar_482;
                    k_474 = 0;
                    while (true) {
                      if ((k_474 >= 25)) {
                        break;
                      };
                      if ((k_474 == areaShadowSamples_475)) {
                        break;
                      };
                      float sample_i_483;
                      sample_i_483 = float(k_474);
                      lowp vec3 vec_to_light_484;
                      lowp vec3 incident_intensity_485;
                      lowp float spot_falloff_486;
                      if (((lightSize_478.x > 0.0) && (lightSize_478.y > 0.0))) {
                        float tmpvar_487;
                        tmpvar_487 = (1.0/(shadowDim));
                        randomIncrement += 0.02;
                        lowp float tmpvar_488;
                        tmpvar_488 = ((lightSize_478.x * tmpvar_487) * ((float(mod (sample_i_483, shadowDim))) + fract(
                          (cos(dot ((point_467.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                        )));
                        randomIncrement += 0.02;
                        lowp vec3 tmpvar_489;
                        tmpvar_489.x = ((lightPos_480.x - (lightSize_478.x * 0.5)) + tmpvar_488);
                        tmpvar_489.y = lightPos_480.y;
                        tmpvar_489.z = ((lightPos_480.z - (lightSize_478.y * 0.5)) + ((lightSize_478.y * tmpvar_487) * (
                          floor((sample_i_483 * tmpvar_487))
                         + 
                          fract((cos(dot (
                            (point_467.yx + randomIncrement)
                          , vec2(23.14069, 2.665144))) * 12345.68))
                        )));
                        vec_to_light_484 = (tmpvar_489 - point_467);
                      } else {
                        vec_to_light_484 = (lightPos_480 - point_467);
                      };
                      lowp float tmpvar_490;
                      tmpvar_490 = sqrt(dot (vec_to_light_484, vec_to_light_484));
                      lowp float tmpvar_491;
                      tmpvar_491 = (1.0/(((attenuation.x * 
                        (tmpvar_490 * tmpvar_490)
                      ) + (attenuation.y * tmpvar_490))));
                      lowp vec3 tmpvar_492;
                      tmpvar_492 = normalize(vec_to_light_484);
                      vec_to_light_484 = tmpvar_492;
                      spot_falloff_486 = 1.0;
                      if ((lightSpot_477.x > 0.0)) {
                        lowp float tmpvar_493;
                        if ((tmpvar_492.y > lightSpot_477.x)) {
                          tmpvar_493 = pow (tmpvar_492.y, lightSpot_477.y);
                        } else {
                          tmpvar_493 = 0.0;
                        };
                        spot_falloff_486 = tmpvar_493;
                      };
                      incident_intensity_485 = ((lightIntensity_479 * tmpvar_491) * spot_falloff_486);
                      lowp float tmpvar_494;
                      tmpvar_494 = sqrt(dot (incident_intensity_485, incident_intensity_485));
                      if ((tmpvar_494 > 0.01)) {
                        lowp vec3 ray_origin_495;
                        ray_origin_495 = point_467;
                        lowp vec3 ray_direction_496;
                        ray_direction_496 = tmpvar_492;
                        lowp float t_hit_497;
                        t_hit_497 = tmpvar_490;
                        bool tmpvar_498;
                        tmpvar_498 = bool(0);
                        highp int i_499;
                        highp int i_500;
                        i_500 = 0;
                        while (true) {
                          if ((i_500 >= 5)) {
                            break;
                          };
                          if ((i_500 == numSpheres)) {
                            break;
                          };
                          lowp float t_hit_501;
                          t_hit_501 = t_hit_497;
                          bool tmpvar_502;
                          lowp vec3 tmpvar_503;
                          tmpvar_503 = (sphereCenters[i_500] - ray_origin_495);
                          lowp float tmpvar_504;
                          tmpvar_504 = dot (tmpvar_503, ray_direction_496);
                          if ((tmpvar_504 < 0.0)) {
                            tmpvar_502 = bool(0);
                          } else {
                            lowp float tmpvar_505;
                            tmpvar_505 = (dot (tmpvar_503, tmpvar_503) - (tmpvar_504 * tmpvar_504));
                            if ((tmpvar_505 > 0.64)) {
                              tmpvar_502 = bool(0);
                            } else {
                              lowp float tmpvar_506;
                              tmpvar_506 = sqrt((0.64 - tmpvar_505));
                              lowp float tmpvar_507;
                              tmpvar_507 = (tmpvar_504 - tmpvar_506);
                              lowp float tmpvar_508;
                              tmpvar_508 = (tmpvar_504 + tmpvar_506);
                              lowp float tmpvar_509;
                              if ((tmpvar_507 < 0.01)) {
                                tmpvar_509 = tmpvar_508;
                              } else {
                                tmpvar_509 = tmpvar_507;
                              };
                              if (((tmpvar_509 < t_hit_497) && (tmpvar_509 > 0.01))) {
                                t_hit_501 = tmpvar_509;
                                tmpvar_502 = bool(1);
                              } else {
                                tmpvar_502 = bool(0);
                              };
                            };
                          };
                          t_hit_497 = t_hit_501;
                          if (tmpvar_502) {
                            tmpvar_498 = bool(1);
                            break;
                          };
                          i_500++;
                        };
                        if (!(tmpvar_498)) {
                          i_499 = 0;
                          while (true) {
                            if ((i_499 >= 6)) {
                              break;
                            };
                            if ((i_499 == numPlanes)) {
                              break;
                            };
                            vec3 normal_510;
                            normal_510 = planeNormals[i_499];
                            lowp float t_hit_511;
                            t_hit_511 = t_hit_497;
                            bool tmpvar_512;
                            tmpvar_512 = bool(1);
                            bool tmpvar_513;
                            vec3 tmpvar_514;
                            tmpvar_514 = (normal_510 * planeOffsets[i_499]);
                            lowp float tmpvar_515;
                            tmpvar_515 = (((
                              (tmpvar_514.x + tmpvar_514.y)
                             + tmpvar_514.z) - dot (normal_510, ray_origin_495)) / dot (normal_510, ray_direction_496));
                            if (((tmpvar_515 < t_hit_497) && (tmpvar_515 > 0.01))) {
                              t_hit_511 = tmpvar_515;
                              tmpvar_513 = bool(1);
                              tmpvar_512 = bool(0);
                            };
                            if (tmpvar_512) {
                              tmpvar_513 = bool(0);
                              tmpvar_512 = bool(0);
                            };
                            t_hit_497 = t_hit_511;
                            if (tmpvar_513) {
                              tmpvar_498 = bool(1);
                              break;
                            };
                            i_499++;
                          };
                          if (!(tmpvar_498)) {
                            tmpvar_498 = bool(1);
                          };
                        };
                        lowp float tmpvar_516;
                        tmpvar_516 = abs((t_hit_497 - tmpvar_490));
                        if ((tmpvar_516 < 0.001)) {
                          lowp vec3 tmpvar_517;
                          lowp float tmpvar_518;
                          tmpvar_518 = dot (normal_469, tmpvar_492);
                          if ((tmpvar_518 > 0.0)) {
                            tmpvar_517 = (incident_intensity_485 * ((diffuseColor_470 * 
                              max (0.0, dot (normal_469, tmpvar_492))
                            ) + (specularColor_471 * 
                              pow (max (0.0, dot ((
                                -(tmpvar_492)
                               - 
                                ((2.0 * dot (-(tmpvar_492), normal_469)) * normal_469)
                              ), -(ray_dir_468))), 128.0)
                            )));
                          } else {
                            tmpvar_517 = vec3(0.0, 0.0, 0.0);
                          };
                          light_sum_476 = (light_sum_476 + tmpvar_517);
                        };
                      };
                      k_474++;
                    };
                    illuminationColor_473 = (illuminationColor_473 + (light_sum_476 / float(tmpvar_482)));
                    i_472++;
                  };
                  tmpvar_466 = illuminationColor_473;
                };
                mirror_sample_color_352 = tmpvar_466;
                if (enableRefGI) {
                  lowp vec3 point_519;
                  point_519 = position_362;
                  lowp vec3 rayDir_520;
                  rayDir_520 = tmpvar_358;
                  lowp vec3 normal_521;
                  normal_521 = normal_363;
                  float roughness_522;
                  roughness_522 = roughness_367;
                  lowp vec3 tmpvar_523;
                  highp int k_524;
                  lowp vec3 indirect_sampling_sum_525;
                  float tmpvar_526;
                  tmpvar_526 = sqrt(dot (diffuseColor_364, diffuseColor_364));
                  if ((tmpvar_526 == 0.0)) {
                    tmpvar_523 = vec3(0.0, 0.0, 0.0);
                  } else {
                    k_524 = 0;
                    while (true) {
                      float indirectRoughness_527;
                      vec3 indirectRefColor_528;
                      vec3 indirectSpecularColor_529;
                      vec3 indirectDiffuseColor_530;
                      if ((k_524 >= 100)) {
                        break;
                      };
                      if ((k_524 == indirectSamples)) {
                        break;
                      };
                      randomIncrement += 0.02;
                      lowp float tmpvar_531;
                      tmpvar_531 = ((fract(
                        (cos(dot ((point_519.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                      ) * 2.0) - 1.0);
                      randomIncrement += 0.02;
                      lowp float tmpvar_532;
                      tmpvar_532 = (fract((
                        cos(dot ((point_519.xy + randomIncrement), vec2(23.14069, 2.665144)))
                       * 12345.68)) * 6.283185);
                      lowp float tmpvar_533;
                      tmpvar_533 = sqrt((1.0 - (tmpvar_531 * tmpvar_531)));
                      lowp vec3 tmpvar_534;
                      tmpvar_534.x = (tmpvar_533 * cos(tmpvar_532));
                      tmpvar_534.y = (tmpvar_533 * sin(tmpvar_532));
                      tmpvar_534.z = tmpvar_531;
                      lowp vec3 tmpvar_535;
                      tmpvar_535 = normalize(mix ((rayDir_520 - 
                        (2.0 * (dot (normal_521, rayDir_520) * normal_521))
                      ), normalize(
                        (normal_521 + tmpvar_534)
                      ), roughness_522));
                      lowp vec3 ray_origin_536;
                      ray_origin_536 = point_519;
                      lowp vec3 ray_direction_537;
                      ray_direction_537 = tmpvar_535;
                      lowp float t_hit_538;
                      t_hit_538 = 10.0;
                      lowp vec3 position_539;
                      lowp vec3 normal_540;
                      vec3 diffuseColor_541;
                      diffuseColor_541 = indirectDiffuseColor_530;
                      vec3 specularColor_542;
                      specularColor_542 = indirectSpecularColor_529;
                      vec3 reflectiveColor_543;
                      reflectiveColor_543 = indirectRefColor_528;
                      float roughness_544;
                      roughness_544 = indirectRoughness_527;
                      bool isLight_545;
                      isLight_545 = bool(0);
                      highp int i_546;
                      highp int i_547;
                      highp int i_548;
                      highp int idx_549;
                      highp int intersected_550;
                      intersected_550 = 0;
                      idx_549 = 0;
                      i_548 = 0;
                      while (true) {
                        if ((i_548 >= 5)) {
                          break;
                        };
                        if ((i_548 == numSpheres)) {
                          break;
                        };
                        lowp float t_hit_551;
                        t_hit_551 = t_hit_538;
                        bool tmpvar_552;
                        lowp vec3 tmpvar_553;
                        tmpvar_553 = (sphereCenters[i_548] - ray_origin_536);
                        lowp float tmpvar_554;
                        tmpvar_554 = dot (tmpvar_553, ray_direction_537);
                        if ((tmpvar_554 < 0.0)) {
                          tmpvar_552 = bool(0);
                        } else {
                          lowp float tmpvar_555;
                          tmpvar_555 = (dot (tmpvar_553, tmpvar_553) - (tmpvar_554 * tmpvar_554));
                          if ((tmpvar_555 > 0.64)) {
                            tmpvar_552 = bool(0);
                          } else {
                            lowp float tmpvar_556;
                            tmpvar_556 = sqrt((0.64 - tmpvar_555));
                            lowp float tmpvar_557;
                            tmpvar_557 = (tmpvar_554 - tmpvar_556);
                            lowp float tmpvar_558;
                            tmpvar_558 = (tmpvar_554 + tmpvar_556);
                            lowp float tmpvar_559;
                            if ((tmpvar_557 < 0.01)) {
                              tmpvar_559 = tmpvar_558;
                            } else {
                              tmpvar_559 = tmpvar_557;
                            };
                            if (((tmpvar_559 < t_hit_538) && (tmpvar_559 > 0.01))) {
                              t_hit_551 = tmpvar_559;
                              tmpvar_552 = bool(1);
                            } else {
                              tmpvar_552 = bool(0);
                            };
                          };
                        };
                        t_hit_538 = t_hit_551;
                        if (tmpvar_552) {
                          idx_549 = i_548;
                          intersected_550 = 1;
                        };
                        i_548++;
                      };
                      i_547 = 0;
                      while (true) {
                        bool tmp_560;
                        if ((i_547 >= 6)) {
                          break;
                        };
                        if ((i_547 == numPlanes)) {
                          break;
                        };
                        lowp vec3 tmpvar_561;
                        tmpvar_561 = planeNormals[i_547];
                        tmp_560 = bool(0);
                        bool tmpvar_562;
                        if (enablePlaneBacksides) {
                          tmpvar_562 = bool(1);
                        } else {
                          tmpvar_562 = (dot (ray_direction_537, tmpvar_561) < 0.0);
                        };
                        if (tmpvar_562) {
                          lowp float t_hit_563;
                          t_hit_563 = t_hit_538;
                          bool tmpvar_564;
                          tmpvar_564 = bool(1);
                          bool tmpvar_565;
                          lowp vec3 tmpvar_566;
                          tmpvar_566 = (tmpvar_561 * planeOffsets[i_547]);
                          lowp float tmpvar_567;
                          tmpvar_567 = (((
                            (tmpvar_566.x + tmpvar_566.y)
                           + tmpvar_566.z) - dot (tmpvar_561, ray_origin_536)) / dot (tmpvar_561, ray_direction_537));
                          if (((tmpvar_567 < t_hit_538) && (tmpvar_567 > 0.01))) {
                            t_hit_563 = tmpvar_567;
                            tmpvar_565 = bool(1);
                            tmpvar_564 = bool(0);
                          };
                          if (tmpvar_564) {
                            tmpvar_565 = bool(0);
                            tmpvar_564 = bool(0);
                          };
                          t_hit_538 = t_hit_563;
                          tmp_560 = tmpvar_565;
                        };
                        if (tmp_560) {
                          normal_540 = tmpvar_561;
                          idx_549 = i_547;
                          intersected_550 = 2;
                        };
                        i_547++;
                      };
                      i_546 = 0;
                      while (true) {
                        bool tmp_568;
                        if ((i_546 >= 2)) {
                          break;
                        };
                        if ((i_546 == numLights)) {
                          break;
                        };
                        vec3 tmpvar_569;
                        tmpvar_569 = lightPos[i_546];
                        vec2 tmpvar_570;
                        tmpvar_570 = lightSize[i_546];
                        tmp_568 = bool(0);
                        if (((tmpvar_570.x > 0.0) && (tmpvar_570.y > 0.0))) {
                          lowp float t_hit_571;
                          t_hit_571 = t_hit_538;
                          bool tmpvar_572;
                          tmpvar_572 = bool(1);
                          bool tmpvar_573;
                          vec3 tmpvar_574;
                          tmpvar_574 = (vec3(0.0, 1.0, 0.0) * tmpvar_569.y);
                          lowp float tmpvar_575;
                          tmpvar_575 = (((
                            (tmpvar_574.x + tmpvar_574.y)
                           + tmpvar_574.z) - ray_origin_536.y) / ray_direction_537.y);
                          if (((tmpvar_575 < t_hit_538) && (tmpvar_575 > 0.01))) {
                            lowp vec3 tmpvar_576;
                            tmpvar_576 = (ray_origin_536 + (ray_direction_537 * tmpvar_575));
                            if ((((tmpvar_570.x + tmpvar_570.y) == 0.0) || ((
                              ((tmpvar_576.x < (tmpvar_569.x + (tmpvar_570.x * 0.5))) && (tmpvar_576.x > (tmpvar_569.x - (tmpvar_570.x * 0.5))))
                             && 
                              (tmpvar_576.z < (tmpvar_569.z + (tmpvar_570.y * 0.5)))
                            ) && (tmpvar_576.z > 
                              (tmpvar_569.z - (tmpvar_570.y * 0.5))
                            )))) {
                              t_hit_571 = tmpvar_575;
                              tmpvar_573 = bool(1);
                              tmpvar_572 = bool(0);
                            };
                          };
                          if (tmpvar_572) {
                            tmpvar_573 = bool(0);
                            tmpvar_572 = bool(0);
                          };
                          t_hit_538 = t_hit_571;
                          tmp_568 = tmpvar_573;
                        } else {
                          lowp float t_hit_577;
                          t_hit_577 = t_hit_538;
                          bool tmpvar_578;
                          lowp vec3 tmpvar_579;
                          tmpvar_579 = (tmpvar_569 - ray_origin_536);
                          lowp float tmpvar_580;
                          tmpvar_580 = dot (tmpvar_579, ray_direction_537);
                          if ((tmpvar_580 < 0.0)) {
                            tmpvar_578 = bool(0);
                          } else {
                            lowp float tmpvar_581;
                            tmpvar_581 = (dot (tmpvar_579, tmpvar_579) - (tmpvar_580 * tmpvar_580));
                            if ((tmpvar_581 > 0.01)) {
                              tmpvar_578 = bool(0);
                            } else {
                              lowp float tmpvar_582;
                              tmpvar_582 = sqrt((0.01 - tmpvar_581));
                              lowp float tmpvar_583;
                              tmpvar_583 = (tmpvar_580 - tmpvar_582);
                              lowp float tmpvar_584;
                              tmpvar_584 = (tmpvar_580 + tmpvar_582);
                              lowp float tmpvar_585;
                              if ((tmpvar_583 < 0.01)) {
                                tmpvar_585 = tmpvar_584;
                              } else {
                                tmpvar_585 = tmpvar_583;
                              };
                              if (((tmpvar_585 < t_hit_538) && (tmpvar_585 > 0.01))) {
                                t_hit_577 = tmpvar_585;
                                tmpvar_578 = bool(1);
                              } else {
                                tmpvar_578 = bool(0);
                              };
                            };
                          };
                          t_hit_538 = t_hit_577;
                          tmp_568 = tmpvar_578;
                        };
                        if (tmp_568) {
                          idx_549 = i_546;
                          intersected_550 = 3;
                        };
                        i_546++;
                      };
                      position_539 = (point_519 + (tmpvar_535 * t_hit_538));
                      if ((intersected_550 == 1)) {
                        diffuseColor_541 = sphereColors[idx_549];
                        specularColor_542 = sphereSpecColors[idx_549];
                        reflectiveColor_543 = reflectiveColors[idx_549];
                        roughness_544 = sphereRoughness[idx_549];
                        lowp vec3 tmpvar_586;
                        tmpvar_586 = normalize((position_539 - sphereCenters[idx_549]));
                        normal_540 = tmpvar_586;
                        lowp float tmpvar_587;
                        tmpvar_587 = dot (tmpvar_586, -(tmpvar_535));
                        if ((tmpvar_587 < 0.0)) {
                          normal_540 = -(tmpvar_586);
                        };
                      } else {
                        if ((intersected_550 == 2)) {
                          if (!(enablePlaneMirrors)) {
                            diffuseColor_541 = planeColors[idx_549];
                            specularColor_542 = vec3(planeSpecular[idx_549]);
                            reflectiveColor_543 = vec3(0.0, 0.0, 0.0);
                            roughness_544 = planeRoughness[idx_549];
                          } else {
                            diffuseColor_541 = (planeColors[idx_549] * 0.01);
                            specularColor_542 = vec3(0.0, 0.0, 0.0);
                            reflectiveColor_543 = planeColors[idx_549];
                            roughness_544 = 1.0;
                          };
                          lowp float tmpvar_588;
                          tmpvar_588 = dot (normal_540, -(tmpvar_535));
                          if ((tmpvar_588 < 0.0)) {
                            normal_540 = -(normal_540);
                          };
                        } else {
                          if ((intersected_550 == 3)) {
                            diffuseColor_541 = (lightIntensity[idx_549] / 25.0);
                            isLight_545 = bool(1);
                          };
                        };
                      };
                      indirectDiffuseColor_530 = diffuseColor_541;
                      indirectSpecularColor_529 = specularColor_542;
                      indirectRefColor_528 = reflectiveColor_543;
                      indirectRoughness_527 = roughness_544;
                      float tmpvar_589;
                      tmpvar_589 = sqrt(dot (reflectiveColor_543, reflectiveColor_543));
                      if ((tmpvar_589 > 0.0)) {
                        indirectDiffuseColor_530 = reflectiveColor_543;
                      };
                      lowp vec3 tmpvar_590;
                      if (isLight_545) {
                        tmpvar_590 = indirectDiffuseColor_530;
                      } else {
                        lowp vec3 point_591;
                        point_591 = position_539;
                        lowp vec3 ray_dir_592;
                        ray_dir_592 = tmpvar_535;
                        lowp vec3 normal_593;
                        normal_593 = normal_540;
                        vec3 diffuseColor_594;
                        diffuseColor_594 = indirectDiffuseColor_530;
                        vec3 specularColor_595;
                        specularColor_595 = specularColor_542;
                        highp int i_596;
                        lowp vec3 illuminationColor_597;
                        i_596 = 0;
                        while (true) {
                          highp int k_598;
                          highp int areaShadowSamples_599;
                          lowp vec3 light_sum_600;
                          vec2 lightSpot_601;
                          vec2 lightSize_602;
                          vec3 lightIntensity_603;
                          vec3 lightPos_604;
                          if ((i_596 >= 2)) {
                            break;
                          };
                          if ((i_596 == numLights)) {
                            break;
                          };
                          lightPos_604 = lightPos[i_596];
                          lightIntensity_603 = lightIntensity[i_596];
                          vec2 tmpvar_605;
                          tmpvar_605 = lightSize[i_596];
                          lightSize_602 = tmpvar_605;
                          lightSpot_601 = lightSpot[i_596];
                          highp int tmpvar_606;
                          if (((tmpvar_605.x > 0.0) && (tmpvar_605.y > 0.0))) {
                            tmpvar_606 = shadowSamples;
                          } else {
                            tmpvar_606 = 1;
                          };
                          areaShadowSamples_599 = tmpvar_606;
                          k_598 = 0;
                          while (true) {
                            if ((k_598 >= 25)) {
                              break;
                            };
                            if ((k_598 == areaShadowSamples_599)) {
                              break;
                            };
                            float sample_i_607;
                            sample_i_607 = float(k_598);
                            lowp vec3 vec_to_light_608;
                            lowp vec3 incident_intensity_609;
                            lowp float spot_falloff_610;
                            if (((lightSize_602.x > 0.0) && (lightSize_602.y > 0.0))) {
                              float tmpvar_611;
                              tmpvar_611 = (1.0/(shadowDim));
                              randomIncrement += 0.02;
                              lowp float tmpvar_612;
                              tmpvar_612 = ((lightSize_602.x * tmpvar_611) * ((float(mod (sample_i_607, shadowDim))) + fract(
                                (cos(dot ((point_591.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                              )));
                              randomIncrement += 0.02;
                              lowp vec3 tmpvar_613;
                              tmpvar_613.x = ((lightPos_604.x - (lightSize_602.x * 0.5)) + tmpvar_612);
                              tmpvar_613.y = lightPos_604.y;
                              tmpvar_613.z = ((lightPos_604.z - (lightSize_602.y * 0.5)) + ((lightSize_602.y * tmpvar_611) * (
                                floor((sample_i_607 * tmpvar_611))
                               + 
                                fract((cos(dot (
                                  (point_591.yx + randomIncrement)
                                , vec2(23.14069, 2.665144))) * 12345.68))
                              )));
                              vec_to_light_608 = (tmpvar_613 - point_591);
                            } else {
                              vec_to_light_608 = (lightPos_604 - point_591);
                            };
                            lowp float tmpvar_614;
                            tmpvar_614 = sqrt(dot (vec_to_light_608, vec_to_light_608));
                            lowp float tmpvar_615;
                            tmpvar_615 = (1.0/(((attenuation.x * 
                              (tmpvar_614 * tmpvar_614)
                            ) + (attenuation.y * tmpvar_614))));
                            lowp vec3 tmpvar_616;
                            tmpvar_616 = normalize(vec_to_light_608);
                            vec_to_light_608 = tmpvar_616;
                            spot_falloff_610 = 1.0;
                            if ((lightSpot_601.x > 0.0)) {
                              lowp float tmpvar_617;
                              if ((tmpvar_616.y > lightSpot_601.x)) {
                                tmpvar_617 = pow (tmpvar_616.y, lightSpot_601.y);
                              } else {
                                tmpvar_617 = 0.0;
                              };
                              spot_falloff_610 = tmpvar_617;
                            };
                            incident_intensity_609 = ((lightIntensity_603 * tmpvar_615) * spot_falloff_610);
                            lowp float tmpvar_618;
                            tmpvar_618 = sqrt(dot (incident_intensity_609, incident_intensity_609));
                            if ((tmpvar_618 > 0.01)) {
                              lowp vec3 ray_origin_619;
                              ray_origin_619 = point_591;
                              lowp vec3 ray_direction_620;
                              ray_direction_620 = tmpvar_616;
                              lowp float t_hit_621;
                              t_hit_621 = tmpvar_614;
                              bool tmpvar_622;
                              tmpvar_622 = bool(0);
                              highp int i_623;
                              highp int i_624;
                              i_624 = 0;
                              while (true) {
                                if ((i_624 >= 5)) {
                                  break;
                                };
                                if ((i_624 == numSpheres)) {
                                  break;
                                };
                                lowp float t_hit_625;
                                t_hit_625 = t_hit_621;
                                bool tmpvar_626;
                                lowp vec3 tmpvar_627;
                                tmpvar_627 = (sphereCenters[i_624] - ray_origin_619);
                                lowp float tmpvar_628;
                                tmpvar_628 = dot (tmpvar_627, ray_direction_620);
                                if ((tmpvar_628 < 0.0)) {
                                  tmpvar_626 = bool(0);
                                } else {
                                  lowp float tmpvar_629;
                                  tmpvar_629 = (dot (tmpvar_627, tmpvar_627) - (tmpvar_628 * tmpvar_628));
                                  if ((tmpvar_629 > 0.64)) {
                                    tmpvar_626 = bool(0);
                                  } else {
                                    lowp float tmpvar_630;
                                    tmpvar_630 = sqrt((0.64 - tmpvar_629));
                                    lowp float tmpvar_631;
                                    tmpvar_631 = (tmpvar_628 - tmpvar_630);
                                    lowp float tmpvar_632;
                                    tmpvar_632 = (tmpvar_628 + tmpvar_630);
                                    lowp float tmpvar_633;
                                    if ((tmpvar_631 < 0.01)) {
                                      tmpvar_633 = tmpvar_632;
                                    } else {
                                      tmpvar_633 = tmpvar_631;
                                    };
                                    if (((tmpvar_633 < t_hit_621) && (tmpvar_633 > 0.01))) {
                                      t_hit_625 = tmpvar_633;
                                      tmpvar_626 = bool(1);
                                    } else {
                                      tmpvar_626 = bool(0);
                                    };
                                  };
                                };
                                t_hit_621 = t_hit_625;
                                if (tmpvar_626) {
                                  tmpvar_622 = bool(1);
                                  break;
                                };
                                i_624++;
                              };
                              if (!(tmpvar_622)) {
                                i_623 = 0;
                                while (true) {
                                  if ((i_623 >= 6)) {
                                    break;
                                  };
                                  if ((i_623 == numPlanes)) {
                                    break;
                                  };
                                  vec3 normal_634;
                                  normal_634 = planeNormals[i_623];
                                  lowp float t_hit_635;
                                  t_hit_635 = t_hit_621;
                                  bool tmpvar_636;
                                  tmpvar_636 = bool(1);
                                  bool tmpvar_637;
                                  vec3 tmpvar_638;
                                  tmpvar_638 = (normal_634 * planeOffsets[i_623]);
                                  lowp float tmpvar_639;
                                  tmpvar_639 = (((
                                    (tmpvar_638.x + tmpvar_638.y)
                                   + tmpvar_638.z) - dot (normal_634, ray_origin_619)) / dot (normal_634, ray_direction_620));
                                  if (((tmpvar_639 < t_hit_621) && (tmpvar_639 > 0.01))) {
                                    t_hit_635 = tmpvar_639;
                                    tmpvar_637 = bool(1);
                                    tmpvar_636 = bool(0);
                                  };
                                  if (tmpvar_636) {
                                    tmpvar_637 = bool(0);
                                    tmpvar_636 = bool(0);
                                  };
                                  t_hit_621 = t_hit_635;
                                  if (tmpvar_637) {
                                    tmpvar_622 = bool(1);
                                    break;
                                  };
                                  i_623++;
                                };
                                if (!(tmpvar_622)) {
                                  tmpvar_622 = bool(1);
                                };
                              };
                              lowp float tmpvar_640;
                              tmpvar_640 = abs((t_hit_621 - tmpvar_614));
                              if ((tmpvar_640 < 0.001)) {
                                lowp vec3 tmpvar_641;
                                lowp float tmpvar_642;
                                tmpvar_642 = dot (normal_593, tmpvar_616);
                                if ((tmpvar_642 > 0.0)) {
                                  tmpvar_641 = (incident_intensity_609 * ((diffuseColor_594 * 
                                    max (0.0, dot (normal_593, tmpvar_616))
                                  ) + (specularColor_595 * 
                                    pow (max (0.0, dot ((
                                      -(tmpvar_616)
                                     - 
                                      ((2.0 * dot (-(tmpvar_616), normal_593)) * normal_593)
                                    ), -(ray_dir_592))), 128.0)
                                  )));
                                } else {
                                  tmpvar_641 = vec3(0.0, 0.0, 0.0);
                                };
                                light_sum_600 = (light_sum_600 + tmpvar_641);
                              };
                            };
                            k_598++;
                          };
                          illuminationColor_597 = (illuminationColor_597 + (light_sum_600 / float(tmpvar_606)));
                          i_596++;
                        };
                        tmpvar_590 = illuminationColor_597;
                      };
                      indirect_sampling_sum_525 = (indirect_sampling_sum_525 + tmpvar_590);
                      k_524++;
                    };
                    tmpvar_523 = ((indirect_sampling_sum_525 / float(indirectSamples)) * diffuseColor_364);
                  };
                  mirror_sample_color_352 = (tmpvar_466 + tmpvar_523);
                } else {
                  mirror_sample_color_352 = (mirror_sample_color_352 + (ambientLight * diffuseColor_364));
                };
                reflectionSum_351 = (reflectionSum_351 + (mirror_sample_color_352 * refColor_349));
                origin_346 = position_362;
                rayDir_347 = tmpvar_358;
                refColor_349 = (reflectiveColor_366 * refColor_349);
              };
              pixelColor_5 = (pixelColor_5 + reflectionSum_351);
            };
            lowp vec3 x_643;
            x_643 = (mat3(0.59719, 0.076, 0.0284, 0.35458, 0.90834, 0.13383, 0.04823, 0.01566, 0.83777) * pixelColor_5);
            x_643 = (((x_643 * 
              (x_643 + 0.0245786)
            ) - 9.0537e-05) / ((x_643 * 
              ((0.983729 * x_643) + 0.432951)
            ) + 0.238081));
            x_643 = (mat3(1.60475, -0.10208, -0.00327, -0.53108, 1.10813, -0.07276, -0.07367, -0.00605, 1.07602) * x_643);
            lowp vec3 tmpvar_644;
            tmpvar_644 = clamp (x_643, 0.0, 1.0);
            pixelColor_5 = tmpvar_644;
            lowp vec3 tmpvar_645;
            tmpvar_645 = pow (tmpvar_644, vec3(0.4545454, 0.4545454, 0.4545454));
            float tmpvar_646;
            if ((tmpvar_644.x < 0.0031308)) {
              tmpvar_646 = 1.0;
            } else {
              tmpvar_646 = 0.0;
            };
            float tmpvar_647;
            if ((tmpvar_644.y < 0.0031308)) {
              tmpvar_647 = 1.0;
            } else {
              tmpvar_647 = 0.0;
            };
            float tmpvar_648;
            if ((tmpvar_644.z < 0.0031308)) {
              tmpvar_648 = 1.0;
            } else {
              tmpvar_648 = 0.0;
            };
            vec3 tmpvar_649;
            tmpvar_649.x = tmpvar_646;
            tmpvar_649.y = tmpvar_647;
            tmpvar_649.z = tmpvar_648;
            lowp vec3 tmpvar_650;
            tmpvar_650 = mix (((tmpvar_645 * 1.055) - 0.055), (tmpvar_644 * 12.92), tmpvar_649);
            pixelColor_5 = tmpvar_650;
            lowp vec4 tmpvar_651;
            tmpvar_651.w = 1.0;
            tmpvar_651.xyz = tmpvar_650;
            fragColor = tmpvar_651;
          }
        </script>
        <script src="webgl-utils.js"></script>
        <script src='gl-matrix-min.js'></script>
        <script src='world-state.js'></script>
        <script src='raytracer.js'></script>
    </body>
</html>