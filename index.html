<html>
    <head>
        <link rel="stylesheet" href="styles.css" type="text/css">
    </head>

    <body style="background-color: rgb(40, 40, 40);">
        <canvas id="c" width="1800" height="900"></canvas>
        <div id="fps-container"><span id="fps"></span> FPS</div>
        <div class="controls">
            <div class="section">
                <h3>About</h3>
                <p>Use WASD -keys to move around and use mouse while holding mousebutton to look around.</p>
                <p>Check out the <a href="https://github.com/jassenousiainen/webgl-raytracer">repository</a></p>
            </div>
            <div class="section">
                <h3>Rendering settings</h3>
                Select shader:
                <input type="radio" id="fast" name="shader-select" class="shader-select" checked>
                <label for="fast">fast</label>
                <input type="radio" id="quality" name="shader-select" class="shader-select">
                <label for="quality">quality</label>
                <br><br>
                <label class='switch'>
                    <input type="checkbox" id="enableGI">
                    <span class='slider'></span>
                    Indirect lighting
                </label>
                <br>
                <label class='switch'>
                    <input type="checkbox" id="enableRefGI">
                    <span class='slider'></span>
                    Indirect in reflections
                </label>
                <br><br>
                number of indirect samples:
                <br>
                <div class="slider_container">
                    <input type="range" value="50" id="indirectsamples" min="1" max="100" oninput="this.nextElementSibling.value = this.value">
                    <output>50</output>
                </div>
                <br>
                number of direct samples:
                <br>
                <div class="slider_container">
                    <input type="range" list="tickmarks" value="9" id="shadowsamples" min="1" max="25" oninput="this.nextElementSibling.value = this.value">
                    <output>9</output>
                </div>
                <datalist id="tickmarks">
                    <option value="1" label="1"></option>
                    <option value="4" label="4"></option>
                    <option value="9" label="9"></option>
                    <option value="16" label="16"></option>
                    <option value="25" label="25"></option>
                </datalist>
                <br>
                reflection bounces:
                <br>
                <div class="slider_container">
                    <input type="range" value="3" id="reflectionbounces" min="0" max="5" step="1" oninput="this.nextElementSibling.value = this.value">
                    <output>3</output>
                </div>
            </div>
            <div class="section" id="lightcontrols">
                <h3>Lights</h3>
                <label class='switch'>
                    <input type="checkbox" id="arealightsenable" checked>
                    <span class='slider'></span>
                    Area lights on/off
                </label>
                <br><br>
                Attenuation:<br>
                <input type="range" min="0" max="10" step="0.01" value="1.5" id="quadratic" class="attenuation"> Quadratic
                <input type="range" min="0" max="10" step="0.01" value="0" id="linear" class="attenuation"> Linear
                <br>
            </div>
            <div class="section" id="planecontrols">
                <h3>Planes</h3>
                <input type="checkbox" id="planebacksides" checked> Intersect backsides
                <br><br>
            </div>
            <div class="section">
                <h3>Extras</h3>
                <input type="checkbox" id="enablemirrorworld"> Mirror world
                <br>
            </div>
        </div>

        <script id="vertex-shader" type="x-shader/x-vertex">#version 300 es
            precision highp float;
            uniform mat4 invprojview;
            uniform float near;
            uniform float far;
            
            out lowp vec3 origin;
            out lowp vec3 ray;
            
            void main() {
                // https://rauwendaal.net/2014/06/14/rendering-a-screen-covering-triangle-in-opengl/
                float x = -1.0 + float((gl_VertexID & 1) << 2);
                float y = -1.0 + float((gl_VertexID & 2) << 1);
                gl_Position = vec4(x, y, 0, 1);
                            
                // https://stackoverflow.com/a/52764898
                origin = (invprojview * vec4(x, y, -1.0, 1.0) * near).xyz;
                ray = (invprojview * vec4(vec2(x,y) * (far - near), far + near, far - near)).xyz;
            }
        </script>
        <!-- Fragment GLSL optimized with: https://zz85.github.io/glsl-optimizer/ -->
        <script id="fragment-shader-quality" type="x-shader/x-fragment">#version 300 es
          precision mediump float;
          float randomIncrement;
          uniform float randomseed;
          uniform highp int numLights;
          uniform vec3 lightPos[2];
          uniform vec2 lightSize[2];
          uniform vec3 lightIntensity[2];
          uniform vec2 lightSpot[2];
          uniform highp int shadowSamples;
          uniform float shadowDim;
          uniform vec2 attenuation;
          uniform highp int numSpheres;
          uniform vec3 sphereCenters[5];
          uniform vec3 sphereColors[5];
          uniform vec3 reflectiveColors[5];
          uniform highp int numPlanes;
          uniform float planeOffsets[6];
          uniform vec3 planeNormals[6];
          uniform vec3 planeColors[6];
          uniform highp int rayBounces;
          uniform vec3 ambientLight;
          uniform bool enableGI;
          uniform bool enableRefGI;
          uniform highp int indirectSamples;
          uniform bool enablePlaneBacksides;
          uniform bool enablePlaneMirrors;
          in lowp vec3 origin;
          in lowp vec3 ray;
          out lowp vec4 fragColor;
          void main ()
          {
            vec3 reflectiveColor_1;
            vec3 specularColor_2;
            vec3 diffuseColor_3;
            lowp vec3 pixelColor_4;
            lowp vec3 tmpvar_5;
            tmpvar_5 = normalize(ray);
            randomIncrement = randomseed;
            lowp vec3 ray_origin_6;
            ray_origin_6 = origin;
            lowp vec3 ray_direction_7;
            ray_direction_7 = tmpvar_5;
            lowp float t_hit_8;
            t_hit_8 = sqrt(dot (ray, ray));
            lowp vec3 position_9;
            lowp vec3 normal_10;
            vec3 diffuseColor_11;
            diffuseColor_11 = diffuseColor_3;
            vec3 specularColor_12;
            specularColor_12 = specularColor_2;
            vec3 reflectiveColor_13;
            reflectiveColor_13 = reflectiveColor_1;
            bool isLight_14;
            isLight_14 = bool(0);
            highp int i_15;
            highp int i_16;
            highp int i_17;
            highp int idx_18;
            highp int intersected_19;
            intersected_19 = 0;
            idx_18 = 0;
            i_17 = 0;
            if ((0 < numSpheres)) {
              lowp float t_hit_20;
              t_hit_20 = t_hit_8;
              bool tmpvar_21;
              lowp vec3 tmpvar_22;
              tmpvar_22 = (sphereCenters[0] - origin);
              lowp float tmpvar_23;
              tmpvar_23 = dot (tmpvar_22, tmpvar_5);
              if ((tmpvar_23 < 0.0)) {
                tmpvar_21 = bool(0);
              } else {
                lowp float tmpvar_24;
                tmpvar_24 = (dot (tmpvar_22, tmpvar_22) - (tmpvar_23 * tmpvar_23));
                if ((tmpvar_24 > 0.64)) {
                  tmpvar_21 = bool(0);
                } else {
                  lowp float tmpvar_25;
                  tmpvar_25 = sqrt((0.64 - tmpvar_24));
                  lowp float tmpvar_26;
                  tmpvar_26 = (tmpvar_23 - tmpvar_25);
                  lowp float tmpvar_27;
                  tmpvar_27 = (tmpvar_23 + tmpvar_25);
                  lowp float tmpvar_28;
                  if ((tmpvar_26 < 0.0)) {
                    tmpvar_28 = tmpvar_27;
                  } else {
                    tmpvar_28 = tmpvar_26;
                  };
                  if (((tmpvar_28 < t_hit_8) && (tmpvar_28 > 0.0))) {
                    t_hit_20 = tmpvar_28;
                    tmpvar_21 = bool(1);
                  } else {
                    tmpvar_21 = bool(0);
                  };
                };
              };
              t_hit_8 = t_hit_20;
              if (tmpvar_21) {
                idx_18 = i_17;
                intersected_19 = 1;
              };
              i_17 = 1;
              if ((1 < numSpheres)) {
                lowp float t_hit_29;
                t_hit_29 = t_hit_20;
                bool tmpvar_30;
                lowp vec3 tmpvar_31;
                tmpvar_31 = (sphereCenters[1] - origin);
                lowp float tmpvar_32;
                tmpvar_32 = dot (tmpvar_31, tmpvar_5);
                if ((tmpvar_32 < 0.0)) {
                  tmpvar_30 = bool(0);
                } else {
                  lowp float tmpvar_33;
                  tmpvar_33 = (dot (tmpvar_31, tmpvar_31) - (tmpvar_32 * tmpvar_32));
                  if ((tmpvar_33 > 0.64)) {
                    tmpvar_30 = bool(0);
                  } else {
                    lowp float tmpvar_34;
                    tmpvar_34 = sqrt((0.64 - tmpvar_33));
                    lowp float tmpvar_35;
                    tmpvar_35 = (tmpvar_32 - tmpvar_34);
                    lowp float tmpvar_36;
                    tmpvar_36 = (tmpvar_32 + tmpvar_34);
                    lowp float tmpvar_37;
                    if ((tmpvar_35 < 0.0)) {
                      tmpvar_37 = tmpvar_36;
                    } else {
                      tmpvar_37 = tmpvar_35;
                    };
                    if (((tmpvar_37 < t_hit_20) && (tmpvar_37 > 0.0))) {
                      t_hit_29 = tmpvar_37;
                      tmpvar_30 = bool(1);
                    } else {
                      tmpvar_30 = bool(0);
                    };
                  };
                };
                t_hit_8 = t_hit_29;
                if (tmpvar_30) {
                  idx_18 = i_17;
                  intersected_19 = 1;
                };
                i_17 = 2;
                if ((2 < numSpheres)) {
                  lowp float t_hit_38;
                  t_hit_38 = t_hit_29;
                  bool tmpvar_39;
                  lowp vec3 tmpvar_40;
                  tmpvar_40 = (sphereCenters[2] - origin);
                  lowp float tmpvar_41;
                  tmpvar_41 = dot (tmpvar_40, tmpvar_5);
                  if ((tmpvar_41 < 0.0)) {
                    tmpvar_39 = bool(0);
                  } else {
                    lowp float tmpvar_42;
                    tmpvar_42 = (dot (tmpvar_40, tmpvar_40) - (tmpvar_41 * tmpvar_41));
                    if ((tmpvar_42 > 0.64)) {
                      tmpvar_39 = bool(0);
                    } else {
                      lowp float tmpvar_43;
                      tmpvar_43 = sqrt((0.64 - tmpvar_42));
                      lowp float tmpvar_44;
                      tmpvar_44 = (tmpvar_41 - tmpvar_43);
                      lowp float tmpvar_45;
                      tmpvar_45 = (tmpvar_41 + tmpvar_43);
                      lowp float tmpvar_46;
                      if ((tmpvar_44 < 0.0)) {
                        tmpvar_46 = tmpvar_45;
                      } else {
                        tmpvar_46 = tmpvar_44;
                      };
                      if (((tmpvar_46 < t_hit_29) && (tmpvar_46 > 0.0))) {
                        t_hit_38 = tmpvar_46;
                        tmpvar_39 = bool(1);
                      } else {
                        tmpvar_39 = bool(0);
                      };
                    };
                  };
                  t_hit_8 = t_hit_38;
                  if (tmpvar_39) {
                    idx_18 = i_17;
                    intersected_19 = 1;
                  };
                  i_17 = 3;
                  if ((3 < numSpheres)) {
                    lowp float t_hit_47;
                    t_hit_47 = t_hit_38;
                    bool tmpvar_48;
                    lowp vec3 tmpvar_49;
                    tmpvar_49 = (sphereCenters[3] - origin);
                    lowp float tmpvar_50;
                    tmpvar_50 = dot (tmpvar_49, tmpvar_5);
                    if ((tmpvar_50 < 0.0)) {
                      tmpvar_48 = bool(0);
                    } else {
                      lowp float tmpvar_51;
                      tmpvar_51 = (dot (tmpvar_49, tmpvar_49) - (tmpvar_50 * tmpvar_50));
                      if ((tmpvar_51 > 0.64)) {
                        tmpvar_48 = bool(0);
                      } else {
                        lowp float tmpvar_52;
                        tmpvar_52 = sqrt((0.64 - tmpvar_51));
                        lowp float tmpvar_53;
                        tmpvar_53 = (tmpvar_50 - tmpvar_52);
                        lowp float tmpvar_54;
                        tmpvar_54 = (tmpvar_50 + tmpvar_52);
                        lowp float tmpvar_55;
                        if ((tmpvar_53 < 0.0)) {
                          tmpvar_55 = tmpvar_54;
                        } else {
                          tmpvar_55 = tmpvar_53;
                        };
                        if (((tmpvar_55 < t_hit_38) && (tmpvar_55 > 0.0))) {
                          t_hit_47 = tmpvar_55;
                          tmpvar_48 = bool(1);
                        } else {
                          tmpvar_48 = bool(0);
                        };
                      };
                    };
                    t_hit_8 = t_hit_47;
                    if (tmpvar_48) {
                      idx_18 = i_17;
                      intersected_19 = 1;
                    };
                    i_17 = 4;
                    if ((4 < numSpheres)) {
                      lowp float t_hit_56;
                      t_hit_56 = t_hit_47;
                      bool tmpvar_57;
                      lowp vec3 tmpvar_58;
                      tmpvar_58 = (sphereCenters[4] - origin);
                      lowp float tmpvar_59;
                      tmpvar_59 = dot (tmpvar_58, tmpvar_5);
                      if ((tmpvar_59 < 0.0)) {
                        tmpvar_57 = bool(0);
                      } else {
                        lowp float tmpvar_60;
                        tmpvar_60 = (dot (tmpvar_58, tmpvar_58) - (tmpvar_59 * tmpvar_59));
                        if ((tmpvar_60 > 0.64)) {
                          tmpvar_57 = bool(0);
                        } else {
                          lowp float tmpvar_61;
                          tmpvar_61 = sqrt((0.64 - tmpvar_60));
                          lowp float tmpvar_62;
                          tmpvar_62 = (tmpvar_59 - tmpvar_61);
                          lowp float tmpvar_63;
                          tmpvar_63 = (tmpvar_59 + tmpvar_61);
                          lowp float tmpvar_64;
                          if ((tmpvar_62 < 0.0)) {
                            tmpvar_64 = tmpvar_63;
                          } else {
                            tmpvar_64 = tmpvar_62;
                          };
                          if (((tmpvar_64 < t_hit_47) && (tmpvar_64 > 0.0))) {
                            t_hit_56 = tmpvar_64;
                            tmpvar_57 = bool(1);
                          } else {
                            tmpvar_57 = bool(0);
                          };
                        };
                      };
                      t_hit_8 = t_hit_56;
                      if (tmpvar_57) {
                        idx_18 = i_17;
                        intersected_19 = 1;
                      };
                      i_17 = 5;
                    };
                  };
                };
              };
            };
            i_16 = 0;
            while (true) {
              bool tmp_65;
              if ((i_16 >= 6)) {
                break;
              };
              if ((i_16 >= numPlanes)) {
                break;
              };
              lowp vec3 tmpvar_66;
              tmpvar_66 = planeNormals[i_16];
              tmp_65 = bool(0);
              bool tmpvar_67;
              if (enablePlaneBacksides) {
                tmpvar_67 = bool(1);
              } else {
                tmpvar_67 = (dot (ray_direction_7, tmpvar_66) < 0.0);
              };
              if (tmpvar_67) {
                lowp float t_hit_68;
                t_hit_68 = t_hit_8;
                bool tmpvar_69;
                tmpvar_69 = bool(1);
                bool tmpvar_70;
                lowp vec3 tmpvar_71;
                tmpvar_71 = (tmpvar_66 * planeOffsets[i_16]);
                lowp float tmpvar_72;
                tmpvar_72 = (((
                  (tmpvar_71.x + tmpvar_71.y)
                 + tmpvar_71.z) - dot (tmpvar_66, ray_origin_6)) / dot (tmpvar_66, ray_direction_7));
                if (((tmpvar_72 < t_hit_8) && (tmpvar_72 > 0.0))) {
                  t_hit_68 = tmpvar_72;
                  tmpvar_70 = bool(1);
                  tmpvar_69 = bool(0);
                };
                if (tmpvar_69) {
                  tmpvar_70 = bool(0);
                  tmpvar_69 = bool(0);
                };
                t_hit_8 = t_hit_68;
                tmp_65 = tmpvar_70;
              };
              if (tmp_65) {
                normal_10 = tmpvar_66;
                idx_18 = i_16;
                intersected_19 = 2;
              };
              i_16++;
            };
            i_15 = 0;
            bool tmp_73;
            if ((0 < numLights)) {
              vec3 tmpvar_74;
              tmpvar_74 = lightPos[0];
              vec2 tmpvar_75;
              tmpvar_75 = lightSize[0];
              tmp_73 = bool(0);
              if (((tmpvar_75.x > 0.0) && (tmpvar_75.y > 0.0))) {
                lowp float t_hit_76;
                t_hit_76 = t_hit_8;
                bool tmpvar_77;
                tmpvar_77 = bool(1);
                bool tmpvar_78;
                vec3 tmpvar_79;
                tmpvar_79 = (vec3(0.0, 1.0, 0.0) * tmpvar_74.y);
                lowp float tmpvar_80;
                tmpvar_80 = (((
                  (tmpvar_79.x + tmpvar_79.y)
                 + tmpvar_79.z) - origin.y) / tmpvar_5.y);
                if (((tmpvar_80 < t_hit_8) && (tmpvar_80 > 0.0))) {
                  lowp vec3 tmpvar_81;
                  tmpvar_81 = (origin + (tmpvar_5 * tmpvar_80));
                  float tmpvar_82;
                  tmpvar_82 = sqrt(dot (tmpvar_75, tmpvar_75));
                  if (((tmpvar_82 == 0.0) || ((
                    ((tmpvar_81.x < (tmpvar_74.x + (tmpvar_75.x * 0.5))) && (tmpvar_81.x > (tmpvar_74.x - (tmpvar_75.x * 0.5))))
                   && 
                    (tmpvar_81.z < (tmpvar_74.z + (tmpvar_75.y * 0.5)))
                  ) && (tmpvar_81.z > 
                    (tmpvar_74.z - (tmpvar_75.y * 0.5))
                  )))) {
                    t_hit_76 = tmpvar_80;
                    tmpvar_78 = bool(1);
                    tmpvar_77 = bool(0);
                  };
                };
                if (tmpvar_77) {
                  tmpvar_78 = bool(0);
                  tmpvar_77 = bool(0);
                };
                t_hit_8 = t_hit_76;
                tmp_73 = tmpvar_78;
              } else {
                lowp float t_hit_83;
                t_hit_83 = t_hit_8;
                bool tmpvar_84;
                lowp vec3 tmpvar_85;
                tmpvar_85 = (tmpvar_74 - origin);
                lowp float tmpvar_86;
                tmpvar_86 = dot (tmpvar_85, tmpvar_5);
                if ((tmpvar_86 < 0.0)) {
                  tmpvar_84 = bool(0);
                } else {
                  lowp float tmpvar_87;
                  tmpvar_87 = (dot (tmpvar_85, tmpvar_85) - (tmpvar_86 * tmpvar_86));
                  if ((tmpvar_87 > 0.01)) {
                    tmpvar_84 = bool(0);
                  } else {
                    lowp float tmpvar_88;
                    tmpvar_88 = sqrt((0.01 - tmpvar_87));
                    lowp float tmpvar_89;
                    tmpvar_89 = (tmpvar_86 - tmpvar_88);
                    lowp float tmpvar_90;
                    tmpvar_90 = (tmpvar_86 + tmpvar_88);
                    lowp float tmpvar_91;
                    if ((tmpvar_89 < 0.0)) {
                      tmpvar_91 = tmpvar_90;
                    } else {
                      tmpvar_91 = tmpvar_89;
                    };
                    if (((tmpvar_91 < t_hit_8) && (tmpvar_91 > 0.0))) {
                      t_hit_83 = tmpvar_91;
                      tmpvar_84 = bool(1);
                    } else {
                      tmpvar_84 = bool(0);
                    };
                  };
                };
                t_hit_8 = t_hit_83;
                tmp_73 = tmpvar_84;
              };
              if (tmp_73) {
                idx_18 = i_15;
                intersected_19 = 3;
              };
              i_15 = 1;
              bool tmp_92;
              if ((1 < numLights)) {
                vec3 tmpvar_93;
                tmpvar_93 = lightPos[1];
                vec2 tmpvar_94;
                tmpvar_94 = lightSize[1];
                tmp_92 = bool(0);
                if (((tmpvar_94.x > 0.0) && (tmpvar_94.y > 0.0))) {
                  lowp float t_hit_95;
                  t_hit_95 = t_hit_8;
                  bool tmpvar_96;
                  tmpvar_96 = bool(1);
                  bool tmpvar_97;
                  vec3 tmpvar_98;
                  tmpvar_98 = (vec3(0.0, 1.0, 0.0) * tmpvar_93.y);
                  lowp float tmpvar_99;
                  tmpvar_99 = (((
                    (tmpvar_98.x + tmpvar_98.y)
                   + tmpvar_98.z) - origin.y) / tmpvar_5.y);
                  if (((tmpvar_99 < t_hit_8) && (tmpvar_99 > 0.0))) {
                    lowp vec3 tmpvar_100;
                    tmpvar_100 = (origin + (tmpvar_5 * tmpvar_99));
                    float tmpvar_101;
                    tmpvar_101 = sqrt(dot (tmpvar_94, tmpvar_94));
                    if (((tmpvar_101 == 0.0) || ((
                      ((tmpvar_100.x < (tmpvar_93.x + (tmpvar_94.x * 0.5))) && (tmpvar_100.x > (tmpvar_93.x - (tmpvar_94.x * 0.5))))
                     && 
                      (tmpvar_100.z < (tmpvar_93.z + (tmpvar_94.y * 0.5)))
                    ) && (tmpvar_100.z > 
                      (tmpvar_93.z - (tmpvar_94.y * 0.5))
                    )))) {
                      t_hit_95 = tmpvar_99;
                      tmpvar_97 = bool(1);
                      tmpvar_96 = bool(0);
                    };
                  };
                  if (tmpvar_96) {
                    tmpvar_97 = bool(0);
                    tmpvar_96 = bool(0);
                  };
                  t_hit_8 = t_hit_95;
                  tmp_92 = tmpvar_97;
                } else {
                  lowp float t_hit_102;
                  t_hit_102 = t_hit_8;
                  bool tmpvar_103;
                  lowp vec3 tmpvar_104;
                  tmpvar_104 = (tmpvar_93 - origin);
                  lowp float tmpvar_105;
                  tmpvar_105 = dot (tmpvar_104, tmpvar_5);
                  if ((tmpvar_105 < 0.0)) {
                    tmpvar_103 = bool(0);
                  } else {
                    lowp float tmpvar_106;
                    tmpvar_106 = (dot (tmpvar_104, tmpvar_104) - (tmpvar_105 * tmpvar_105));
                    if ((tmpvar_106 > 0.01)) {
                      tmpvar_103 = bool(0);
                    } else {
                      lowp float tmpvar_107;
                      tmpvar_107 = sqrt((0.01 - tmpvar_106));
                      lowp float tmpvar_108;
                      tmpvar_108 = (tmpvar_105 - tmpvar_107);
                      lowp float tmpvar_109;
                      tmpvar_109 = (tmpvar_105 + tmpvar_107);
                      lowp float tmpvar_110;
                      if ((tmpvar_108 < 0.0)) {
                        tmpvar_110 = tmpvar_109;
                      } else {
                        tmpvar_110 = tmpvar_108;
                      };
                      if (((tmpvar_110 < t_hit_8) && (tmpvar_110 > 0.0))) {
                        t_hit_102 = tmpvar_110;
                        tmpvar_103 = bool(1);
                      } else {
                        tmpvar_103 = bool(0);
                      };
                    };
                  };
                  t_hit_8 = t_hit_102;
                  tmp_92 = tmpvar_103;
                };
                if (tmp_92) {
                  idx_18 = i_15;
                  intersected_19 = 3;
                };
                i_15 = 2;
              };
            };
            position_9 = (origin + (tmpvar_5 * t_hit_8));
            if ((intersected_19 == 1)) {
              diffuseColor_11 = sphereColors[idx_18];
              specularColor_12 = vec3(1.0, 1.0, 1.0);
              reflectiveColor_13 = reflectiveColors[idx_18];
              lowp vec3 tmpvar_111;
              tmpvar_111 = normalize((position_9 - sphereCenters[idx_18]));
              normal_10 = tmpvar_111;
              lowp float tmpvar_112;
              tmpvar_112 = dot (tmpvar_111, -(tmpvar_5));
              if ((tmpvar_112 < 0.0)) {
                normal_10 = -(tmpvar_111);
              };
            } else {
              if ((intersected_19 == 2)) {
                if (enablePlaneMirrors) {
                  diffuseColor_11 = (planeColors[idx_18] * 0.01);
                  specularColor_12 = vec3(0.0, 0.0, 0.0);
                  reflectiveColor_13 = planeColors[idx_18];
                } else {
                  diffuseColor_11 = planeColors[idx_18];
                  specularColor_12 = vec3(0.5, 0.5, 0.5);
                  reflectiveColor_13 = vec3(0.0, 0.0, 0.0);
                };
                lowp float tmpvar_113;
                tmpvar_113 = dot (normal_10, -(tmpvar_5));
                if ((tmpvar_113 < 0.0)) {
                  normal_10 = -(normal_10);
                };
              } else {
                if ((intersected_19 == 3)) {
                  diffuseColor_11 = (lightIntensity[idx_18] / 25.0);
                  isLight_14 = bool(1);
                };
              };
            };
            diffuseColor_3 = diffuseColor_11;
            specularColor_2 = specularColor_12;
            reflectiveColor_1 = reflectiveColor_13;
            if (isLight_14) {
              lowp vec4 tmpvar_114;
              tmpvar_114.w = 1.0;
              tmpvar_114.xyz = diffuseColor_11;
              fragColor = tmpvar_114;
              return;
            };
            if (!(enableGI)) {
              pixelColor_4 = (pixelColor_4 + (ambientLight * diffuseColor_11));
            };
            lowp vec3 point_115;
            point_115 = position_9;
            lowp vec3 ray_dir_116;
            ray_dir_116 = tmpvar_5;
            lowp vec3 normal_117;
            normal_117 = normal_10;
            vec3 diffuseColor_118;
            diffuseColor_118 = diffuseColor_11;
            vec3 specularColor_119;
            specularColor_119 = specularColor_12;
            highp int i_120;
            lowp vec3 illuminationColor_121;
            i_120 = 0;
            while (true) {
              highp int k_122;
              highp int areaShadowSamples_123;
              lowp vec3 light_sum_124;
              vec2 lightSpot_125;
              vec2 lightSize_126;
              vec3 lightIntensity_127;
              vec3 lightPos_128;
              if ((i_120 >= 2)) {
                break;
              };
              if ((i_120 == numLights)) {
                break;
              };
              lightPos_128 = lightPos[i_120];
              lightIntensity_127 = lightIntensity[i_120];
              vec2 tmpvar_129;
              tmpvar_129 = lightSize[i_120];
              lightSize_126 = tmpvar_129;
              lightSpot_125 = lightSpot[i_120];
              highp int tmpvar_130;
              if (((tmpvar_129.x > 0.0) && (tmpvar_129.y > 0.0))) {
                tmpvar_130 = shadowSamples;
              } else {
                tmpvar_130 = 1;
              };
              areaShadowSamples_123 = tmpvar_130;
              k_122 = 0;
              while (true) {
                if ((k_122 >= 49)) {
                  break;
                };
                if ((k_122 == areaShadowSamples_123)) {
                  break;
                };
                float sample_i_131;
                sample_i_131 = float(k_122);
                lowp vec3 vec_to_light_132;
                lowp vec3 incident_intensity_133;
                lowp float spot_falloff_134;
                if (((lightSize_126.x > 0.0) && (lightSize_126.y > 0.0))) {
                  float tmpvar_135;
                  tmpvar_135 = (1.0/(shadowDim));
                  randomIncrement += 0.02;
                  lowp float tmpvar_136;
                  tmpvar_136 = ((lightSize_126.x * tmpvar_135) * ((float(mod (sample_i_131, shadowDim))) + fract(
                    (cos(dot ((point_115.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                  )));
                  randomIncrement += 0.02;
                  lowp vec3 tmpvar_137;
                  tmpvar_137.x = ((lightPos_128.x - (lightSize_126.x * 0.5)) + tmpvar_136);
                  tmpvar_137.y = lightPos_128.y;
                  tmpvar_137.z = ((lightPos_128.z - (lightSize_126.y * 0.5)) + ((lightSize_126.y * tmpvar_135) * (
                    floor((sample_i_131 * tmpvar_135))
                   + 
                    fract((cos(dot (
                      (point_115.yx + randomIncrement)
                    , vec2(23.14069, 2.665144))) * 12345.68))
                  )));
                  vec_to_light_132 = (tmpvar_137 - point_115);
                } else {
                  vec_to_light_132 = (lightPos_128 - point_115);
                };
                lowp float tmpvar_138;
                tmpvar_138 = sqrt(dot (vec_to_light_132, vec_to_light_132));
                lowp float tmpvar_139;
                tmpvar_139 = (1.0/(((attenuation.x * 
                  (tmpvar_138 * tmpvar_138)
                ) + (attenuation.y * tmpvar_138))));
                lowp vec3 tmpvar_140;
                tmpvar_140 = normalize(vec_to_light_132);
                vec_to_light_132 = tmpvar_140;
                spot_falloff_134 = 1.0;
                if ((lightSpot_125.x > 0.0)) {
                  lowp float tmpvar_141;
                  if ((tmpvar_140.y > lightSpot_125.x)) {
                    tmpvar_141 = pow (tmpvar_140.y, lightSpot_125.y);
                  } else {
                    tmpvar_141 = 0.0;
                  };
                  spot_falloff_134 = tmpvar_141;
                };
                incident_intensity_133 = ((lightIntensity_127 * tmpvar_139) * spot_falloff_134);
                lowp float tmpvar_142;
                tmpvar_142 = sqrt(dot (incident_intensity_133, incident_intensity_133));
                if ((tmpvar_142 > 0.01)) {
                  lowp vec3 ray_origin_143;
                  ray_origin_143 = point_115;
                  lowp vec3 ray_direction_144;
                  ray_direction_144 = tmpvar_140;
                  lowp float t_hit_145;
                  t_hit_145 = tmpvar_138;
                  bool tmpvar_146;
                  tmpvar_146 = bool(0);
                  highp int i_147;
                  highp int i_148;
                  i_148 = 0;
                  while (true) {
                    if ((i_148 >= 5)) {
                      break;
                    };
                    if ((i_148 == numSpheres)) {
                      break;
                    };
                    lowp float t_hit_149;
                    t_hit_149 = t_hit_145;
                    bool tmpvar_150;
                    lowp vec3 tmpvar_151;
                    tmpvar_151 = (sphereCenters[i_148] - ray_origin_143);
                    lowp float tmpvar_152;
                    tmpvar_152 = dot (tmpvar_151, ray_direction_144);
                    if ((tmpvar_152 < 0.0)) {
                      tmpvar_150 = bool(0);
                    } else {
                      lowp float tmpvar_153;
                      tmpvar_153 = (dot (tmpvar_151, tmpvar_151) - (tmpvar_152 * tmpvar_152));
                      if ((tmpvar_153 > 0.64)) {
                        tmpvar_150 = bool(0);
                      } else {
                        lowp float tmpvar_154;
                        tmpvar_154 = sqrt((0.64 - tmpvar_153));
                        lowp float tmpvar_155;
                        tmpvar_155 = (tmpvar_152 - tmpvar_154);
                        lowp float tmpvar_156;
                        tmpvar_156 = (tmpvar_152 + tmpvar_154);
                        lowp float tmpvar_157;
                        if ((tmpvar_155 < 0.01)) {
                          tmpvar_157 = tmpvar_156;
                        } else {
                          tmpvar_157 = tmpvar_155;
                        };
                        if (((tmpvar_157 < t_hit_145) && (tmpvar_157 > 0.01))) {
                          t_hit_149 = tmpvar_157;
                          tmpvar_150 = bool(1);
                        } else {
                          tmpvar_150 = bool(0);
                        };
                      };
                    };
                    t_hit_145 = t_hit_149;
                    if (tmpvar_150) {
                      tmpvar_146 = bool(1);
                      break;
                    };
                    i_148++;
                  };
                  if (!(tmpvar_146)) {
                    i_147 = 0;
                    while (true) {
                      if ((i_147 >= 6)) {
                        break;
                      };
                      if ((i_147 == numPlanes)) {
                        break;
                      };
                      vec3 normal_158;
                      normal_158 = planeNormals[i_147];
                      lowp float t_hit_159;
                      t_hit_159 = t_hit_145;
                      bool tmpvar_160;
                      tmpvar_160 = bool(1);
                      bool tmpvar_161;
                      vec3 tmpvar_162;
                      tmpvar_162 = (normal_158 * planeOffsets[i_147]);
                      lowp float tmpvar_163;
                      tmpvar_163 = (((
                        (tmpvar_162.x + tmpvar_162.y)
                       + tmpvar_162.z) - dot (normal_158, ray_origin_143)) / dot (normal_158, ray_direction_144));
                      if (((tmpvar_163 < t_hit_145) && (tmpvar_163 > 0.01))) {
                        t_hit_159 = tmpvar_163;
                        tmpvar_161 = bool(1);
                        tmpvar_160 = bool(0);
                      };
                      if (tmpvar_160) {
                        tmpvar_161 = bool(0);
                        tmpvar_160 = bool(0);
                      };
                      t_hit_145 = t_hit_159;
                      if (tmpvar_161) {
                        tmpvar_146 = bool(1);
                        break;
                      };
                      i_147++;
                    };
                    if (!(tmpvar_146)) {
                      tmpvar_146 = bool(1);
                    };
                  };
                  lowp float tmpvar_164;
                  tmpvar_164 = abs((t_hit_145 - tmpvar_138));
                  if ((tmpvar_164 < 0.001)) {
                    lowp vec3 tmpvar_165;
                    lowp float tmpvar_166;
                    tmpvar_166 = dot (normal_117, tmpvar_140);
                    if ((tmpvar_166 > 0.0)) {
                      tmpvar_165 = (incident_intensity_133 * ((diffuseColor_118 * 
                        max (0.0, dot (normal_117, tmpvar_140))
                      ) + (specularColor_119 * 
                        pow (max (0.0, dot ((
                          -(tmpvar_140)
                         - 
                          ((2.0 * dot (-(tmpvar_140), normal_117)) * normal_117)
                        ), -(ray_dir_116))), 32.0)
                      )));
                    } else {
                      tmpvar_165 = vec3(0.0, 0.0, 0.0);
                    };
                    light_sum_124 = (light_sum_124 + tmpvar_165);
                  };
                };
                k_122++;
              };
              illuminationColor_121 = (illuminationColor_121 + (light_sum_124 / float(tmpvar_130)));
              i_120++;
            };
            pixelColor_4 = (pixelColor_4 + illuminationColor_121);
            if (enableGI) {
              lowp vec3 point_167;
              point_167 = position_9;
              lowp vec3 tmpvar_168;
              highp int k_169;
              lowp vec3 indirect_sampling_sum_170;
              lowp mat3 transform_171;
              float tmpvar_172;
              tmpvar_172 = sqrt(dot (diffuseColor_11, diffuseColor_11));
              if ((tmpvar_172 == 0.0)) {
                tmpvar_168 = vec3(0.0, 0.0, 0.0);
              } else {
                lowp float tmpvar_173;
                tmpvar_173 = abs(normal_10.x);
                lowp float tmpvar_174;
                tmpvar_174 = abs(normal_10.y);
                if ((tmpvar_173 > tmpvar_174)) {
                  lowp vec3 tmpvar_175;
                  tmpvar_175.y = 0.0;
                  tmpvar_175.x = normal_10.z;
                  tmpvar_175.z = -(normal_10.x);
                  transform_171[2] = (tmpvar_175 / sqrt((
                    (normal_10.x * normal_10.x)
                   + 
                    (normal_10.z * normal_10.z)
                  )));
                } else {
                  lowp vec3 tmpvar_176;
                  tmpvar_176.x = 0.0;
                  tmpvar_176.y = -(normal_10.z);
                  tmpvar_176.z = normal_10.y;
                  transform_171[2] = (tmpvar_176 / sqrt((
                    (normal_10.y * normal_10.y)
                   + 
                    (normal_10.z * normal_10.z)
                  )));
                };
                lowp vec3 b_177;
                b_177 = transform_171[2];
                transform_171[0] = ((normal_10.yzx * b_177.zxy) - (normal_10.zxy * b_177.yzx));
                transform_171[1] = normal_10;
                k_169 = 0;
                while (true) {
                  vec3 indirectReflectiveColor_178;
                  vec3 indirectSpecularColor_179;
                  vec3 indirectDiffuseColor_180;
                  if ((k_169 >= 100)) {
                    break;
                  };
                  if ((k_169 >= indirectSamples)) {
                    break;
                  };
                  randomIncrement += 0.02;
                  lowp float tmpvar_181;
                  tmpvar_181 = fract((cos(
                    dot ((point_167.xy + randomIncrement), vec2(23.14069, 2.665144))
                  ) * 12345.68));
                  lowp float tmpvar_182;
                  tmpvar_182 = sqrt((1.0 - (tmpvar_181 * tmpvar_181)));
                  randomIncrement += 0.02;
                  lowp float tmpvar_183;
                  tmpvar_183 = (6.283186 * fract((
                    cos(dot ((point_167.yx + randomIncrement), vec2(23.14069, 2.665144)))
                   * 12345.68)));
                  lowp vec3 tmpvar_184;
                  tmpvar_184.x = (cos(tmpvar_183) * tmpvar_182);
                  tmpvar_184.y = tmpvar_181;
                  tmpvar_184.z = (sin(tmpvar_183) * tmpvar_182);
                  lowp vec3 tmpvar_185;
                  tmpvar_185 = (transform_171 * tmpvar_184);
                  lowp vec3 ray_origin_186;
                  ray_origin_186 = point_167;
                  lowp vec3 ray_direction_187;
                  ray_direction_187 = tmpvar_185;
                  lowp float t_hit_188;
                  t_hit_188 = 10.0;
                  lowp vec3 position_189;
                  lowp vec3 normal_190;
                  vec3 diffuseColor_191;
                  diffuseColor_191 = indirectDiffuseColor_180;
                  vec3 specularColor_192;
                  specularColor_192 = indirectSpecularColor_179;
                  vec3 reflectiveColor_193;
                  reflectiveColor_193 = indirectReflectiveColor_178;
                  bool isLight_194;
                  isLight_194 = bool(0);
                  highp int i_195;
                  highp int i_196;
                  highp int i_197;
                  highp int idx_198;
                  highp int intersected_199;
                  intersected_199 = 0;
                  idx_198 = 0;
                  i_197 = 0;
                  if ((0 < numSpheres)) {
                    lowp float t_hit_200;
                    t_hit_200 = t_hit_188;
                    bool tmpvar_201;
                    lowp vec3 tmpvar_202;
                    tmpvar_202 = (sphereCenters[0] - point_167);
                    lowp float tmpvar_203;
                    tmpvar_203 = dot (tmpvar_202, tmpvar_185);
                    if ((tmpvar_203 < 0.0)) {
                      tmpvar_201 = bool(0);
                    } else {
                      lowp float tmpvar_204;
                      tmpvar_204 = (dot (tmpvar_202, tmpvar_202) - (tmpvar_203 * tmpvar_203));
                      if ((tmpvar_204 > 0.64)) {
                        tmpvar_201 = bool(0);
                      } else {
                        lowp float tmpvar_205;
                        tmpvar_205 = sqrt((0.64 - tmpvar_204));
                        lowp float tmpvar_206;
                        tmpvar_206 = (tmpvar_203 - tmpvar_205);
                        lowp float tmpvar_207;
                        tmpvar_207 = (tmpvar_203 + tmpvar_205);
                        lowp float tmpvar_208;
                        if ((tmpvar_206 < 0.01)) {
                          tmpvar_208 = tmpvar_207;
                        } else {
                          tmpvar_208 = tmpvar_206;
                        };
                        if (((tmpvar_208 < 10.0) && (tmpvar_208 > 0.01))) {
                          t_hit_200 = tmpvar_208;
                          tmpvar_201 = bool(1);
                        } else {
                          tmpvar_201 = bool(0);
                        };
                      };
                    };
                    t_hit_188 = t_hit_200;
                    if (tmpvar_201) {
                      idx_198 = i_197;
                      intersected_199 = 1;
                    };
                    i_197 = 1;
                    if ((1 < numSpheres)) {
                      lowp float t_hit_209;
                      t_hit_209 = t_hit_200;
                      bool tmpvar_210;
                      lowp vec3 tmpvar_211;
                      tmpvar_211 = (sphereCenters[1] - point_167);
                      lowp float tmpvar_212;
                      tmpvar_212 = dot (tmpvar_211, tmpvar_185);
                      if ((tmpvar_212 < 0.0)) {
                        tmpvar_210 = bool(0);
                      } else {
                        lowp float tmpvar_213;
                        tmpvar_213 = (dot (tmpvar_211, tmpvar_211) - (tmpvar_212 * tmpvar_212));
                        if ((tmpvar_213 > 0.64)) {
                          tmpvar_210 = bool(0);
                        } else {
                          lowp float tmpvar_214;
                          tmpvar_214 = sqrt((0.64 - tmpvar_213));
                          lowp float tmpvar_215;
                          tmpvar_215 = (tmpvar_212 - tmpvar_214);
                          lowp float tmpvar_216;
                          tmpvar_216 = (tmpvar_212 + tmpvar_214);
                          lowp float tmpvar_217;
                          if ((tmpvar_215 < 0.01)) {
                            tmpvar_217 = tmpvar_216;
                          } else {
                            tmpvar_217 = tmpvar_215;
                          };
                          if (((tmpvar_217 < t_hit_200) && (tmpvar_217 > 0.01))) {
                            t_hit_209 = tmpvar_217;
                            tmpvar_210 = bool(1);
                          } else {
                            tmpvar_210 = bool(0);
                          };
                        };
                      };
                      t_hit_188 = t_hit_209;
                      if (tmpvar_210) {
                        idx_198 = i_197;
                        intersected_199 = 1;
                      };
                      i_197 = 2;
                      if ((2 < numSpheres)) {
                        lowp float t_hit_218;
                        t_hit_218 = t_hit_209;
                        bool tmpvar_219;
                        lowp vec3 tmpvar_220;
                        tmpvar_220 = (sphereCenters[2] - point_167);
                        lowp float tmpvar_221;
                        tmpvar_221 = dot (tmpvar_220, tmpvar_185);
                        if ((tmpvar_221 < 0.0)) {
                          tmpvar_219 = bool(0);
                        } else {
                          lowp float tmpvar_222;
                          tmpvar_222 = (dot (tmpvar_220, tmpvar_220) - (tmpvar_221 * tmpvar_221));
                          if ((tmpvar_222 > 0.64)) {
                            tmpvar_219 = bool(0);
                          } else {
                            lowp float tmpvar_223;
                            tmpvar_223 = sqrt((0.64 - tmpvar_222));
                            lowp float tmpvar_224;
                            tmpvar_224 = (tmpvar_221 - tmpvar_223);
                            lowp float tmpvar_225;
                            tmpvar_225 = (tmpvar_221 + tmpvar_223);
                            lowp float tmpvar_226;
                            if ((tmpvar_224 < 0.01)) {
                              tmpvar_226 = tmpvar_225;
                            } else {
                              tmpvar_226 = tmpvar_224;
                            };
                            if (((tmpvar_226 < t_hit_209) && (tmpvar_226 > 0.01))) {
                              t_hit_218 = tmpvar_226;
                              tmpvar_219 = bool(1);
                            } else {
                              tmpvar_219 = bool(0);
                            };
                          };
                        };
                        t_hit_188 = t_hit_218;
                        if (tmpvar_219) {
                          idx_198 = i_197;
                          intersected_199 = 1;
                        };
                        i_197 = 3;
                        if ((3 < numSpheres)) {
                          lowp float t_hit_227;
                          t_hit_227 = t_hit_218;
                          bool tmpvar_228;
                          lowp vec3 tmpvar_229;
                          tmpvar_229 = (sphereCenters[3] - point_167);
                          lowp float tmpvar_230;
                          tmpvar_230 = dot (tmpvar_229, tmpvar_185);
                          if ((tmpvar_230 < 0.0)) {
                            tmpvar_228 = bool(0);
                          } else {
                            lowp float tmpvar_231;
                            tmpvar_231 = (dot (tmpvar_229, tmpvar_229) - (tmpvar_230 * tmpvar_230));
                            if ((tmpvar_231 > 0.64)) {
                              tmpvar_228 = bool(0);
                            } else {
                              lowp float tmpvar_232;
                              tmpvar_232 = sqrt((0.64 - tmpvar_231));
                              lowp float tmpvar_233;
                              tmpvar_233 = (tmpvar_230 - tmpvar_232);
                              lowp float tmpvar_234;
                              tmpvar_234 = (tmpvar_230 + tmpvar_232);
                              lowp float tmpvar_235;
                              if ((tmpvar_233 < 0.01)) {
                                tmpvar_235 = tmpvar_234;
                              } else {
                                tmpvar_235 = tmpvar_233;
                              };
                              if (((tmpvar_235 < t_hit_218) && (tmpvar_235 > 0.01))) {
                                t_hit_227 = tmpvar_235;
                                tmpvar_228 = bool(1);
                              } else {
                                tmpvar_228 = bool(0);
                              };
                            };
                          };
                          t_hit_188 = t_hit_227;
                          if (tmpvar_228) {
                            idx_198 = i_197;
                            intersected_199 = 1;
                          };
                          i_197 = 4;
                          if ((4 < numSpheres)) {
                            lowp float t_hit_236;
                            t_hit_236 = t_hit_227;
                            bool tmpvar_237;
                            lowp vec3 tmpvar_238;
                            tmpvar_238 = (sphereCenters[4] - point_167);
                            lowp float tmpvar_239;
                            tmpvar_239 = dot (tmpvar_238, tmpvar_185);
                            if ((tmpvar_239 < 0.0)) {
                              tmpvar_237 = bool(0);
                            } else {
                              lowp float tmpvar_240;
                              tmpvar_240 = (dot (tmpvar_238, tmpvar_238) - (tmpvar_239 * tmpvar_239));
                              if ((tmpvar_240 > 0.64)) {
                                tmpvar_237 = bool(0);
                              } else {
                                lowp float tmpvar_241;
                                tmpvar_241 = sqrt((0.64 - tmpvar_240));
                                lowp float tmpvar_242;
                                tmpvar_242 = (tmpvar_239 - tmpvar_241);
                                lowp float tmpvar_243;
                                tmpvar_243 = (tmpvar_239 + tmpvar_241);
                                lowp float tmpvar_244;
                                if ((tmpvar_242 < 0.01)) {
                                  tmpvar_244 = tmpvar_243;
                                } else {
                                  tmpvar_244 = tmpvar_242;
                                };
                                if (((tmpvar_244 < t_hit_227) && (tmpvar_244 > 0.01))) {
                                  t_hit_236 = tmpvar_244;
                                  tmpvar_237 = bool(1);
                                } else {
                                  tmpvar_237 = bool(0);
                                };
                              };
                            };
                            t_hit_188 = t_hit_236;
                            if (tmpvar_237) {
                              idx_198 = i_197;
                              intersected_199 = 1;
                            };
                            i_197 = 5;
                          };
                        };
                      };
                    };
                  };
                  i_196 = 0;
                  while (true) {
                    bool tmp_245;
                    if ((i_196 >= 6)) {
                      break;
                    };
                    if ((i_196 >= numPlanes)) {
                      break;
                    };
                    lowp vec3 tmpvar_246;
                    tmpvar_246 = planeNormals[i_196];
                    tmp_245 = bool(0);
                    bool tmpvar_247;
                    if (enablePlaneBacksides) {
                      tmpvar_247 = bool(1);
                    } else {
                      tmpvar_247 = (dot (ray_direction_187, tmpvar_246) < 0.0);
                    };
                    if (tmpvar_247) {
                      lowp float t_hit_248;
                      t_hit_248 = t_hit_188;
                      bool tmpvar_249;
                      tmpvar_249 = bool(1);
                      bool tmpvar_250;
                      lowp vec3 tmpvar_251;
                      tmpvar_251 = (tmpvar_246 * planeOffsets[i_196]);
                      lowp float tmpvar_252;
                      tmpvar_252 = (((
                        (tmpvar_251.x + tmpvar_251.y)
                       + tmpvar_251.z) - dot (tmpvar_246, ray_origin_186)) / dot (tmpvar_246, ray_direction_187));
                      if (((tmpvar_252 < t_hit_188) && (tmpvar_252 > 0.01))) {
                        t_hit_248 = tmpvar_252;
                        tmpvar_250 = bool(1);
                        tmpvar_249 = bool(0);
                      };
                      if (tmpvar_249) {
                        tmpvar_250 = bool(0);
                        tmpvar_249 = bool(0);
                      };
                      t_hit_188 = t_hit_248;
                      tmp_245 = tmpvar_250;
                    };
                    if (tmp_245) {
                      normal_190 = tmpvar_246;
                      idx_198 = i_196;
                      intersected_199 = 2;
                    };
                    i_196++;
                  };
                  i_195 = 0;
                  bool tmp_253;
                  if ((0 < numLights)) {
                    vec3 tmpvar_254;
                    tmpvar_254 = lightPos[0];
                    vec2 tmpvar_255;
                    tmpvar_255 = lightSize[0];
                    tmp_253 = bool(0);
                    if (((tmpvar_255.x > 0.0) && (tmpvar_255.y > 0.0))) {
                      lowp float t_hit_256;
                      t_hit_256 = t_hit_188;
                      bool tmpvar_257;
                      tmpvar_257 = bool(1);
                      bool tmpvar_258;
                      vec3 tmpvar_259;
                      tmpvar_259 = (vec3(0.0, 1.0, 0.0) * tmpvar_254.y);
                      lowp float tmpvar_260;
                      tmpvar_260 = (((
                        (tmpvar_259.x + tmpvar_259.y)
                       + tmpvar_259.z) - point_167.y) / tmpvar_185.y);
                      if (((tmpvar_260 < t_hit_188) && (tmpvar_260 > 0.01))) {
                        lowp vec3 tmpvar_261;
                        tmpvar_261 = (point_167 + (tmpvar_185 * tmpvar_260));
                        float tmpvar_262;
                        tmpvar_262 = sqrt(dot (tmpvar_255, tmpvar_255));
                        if (((tmpvar_262 == 0.0) || ((
                          ((tmpvar_261.x < (tmpvar_254.x + (tmpvar_255.x * 0.5))) && (tmpvar_261.x > (tmpvar_254.x - (tmpvar_255.x * 0.5))))
                         && 
                          (tmpvar_261.z < (tmpvar_254.z + (tmpvar_255.y * 0.5)))
                        ) && (tmpvar_261.z > 
                          (tmpvar_254.z - (tmpvar_255.y * 0.5))
                        )))) {
                          t_hit_256 = tmpvar_260;
                          tmpvar_258 = bool(1);
                          tmpvar_257 = bool(0);
                        };
                      };
                      if (tmpvar_257) {
                        tmpvar_258 = bool(0);
                        tmpvar_257 = bool(0);
                      };
                      t_hit_188 = t_hit_256;
                      tmp_253 = tmpvar_258;
                    } else {
                      lowp float t_hit_263;
                      t_hit_263 = t_hit_188;
                      bool tmpvar_264;
                      lowp vec3 tmpvar_265;
                      tmpvar_265 = (tmpvar_254 - point_167);
                      lowp float tmpvar_266;
                      tmpvar_266 = dot (tmpvar_265, tmpvar_185);
                      if ((tmpvar_266 < 0.0)) {
                        tmpvar_264 = bool(0);
                      } else {
                        lowp float tmpvar_267;
                        tmpvar_267 = (dot (tmpvar_265, tmpvar_265) - (tmpvar_266 * tmpvar_266));
                        if ((tmpvar_267 > 0.01)) {
                          tmpvar_264 = bool(0);
                        } else {
                          lowp float tmpvar_268;
                          tmpvar_268 = sqrt((0.01 - tmpvar_267));
                          lowp float tmpvar_269;
                          tmpvar_269 = (tmpvar_266 - tmpvar_268);
                          lowp float tmpvar_270;
                          tmpvar_270 = (tmpvar_266 + tmpvar_268);
                          lowp float tmpvar_271;
                          if ((tmpvar_269 < 0.01)) {
                            tmpvar_271 = tmpvar_270;
                          } else {
                            tmpvar_271 = tmpvar_269;
                          };
                          if (((tmpvar_271 < t_hit_188) && (tmpvar_271 > 0.01))) {
                            t_hit_263 = tmpvar_271;
                            tmpvar_264 = bool(1);
                          } else {
                            tmpvar_264 = bool(0);
                          };
                        };
                      };
                      t_hit_188 = t_hit_263;
                      tmp_253 = tmpvar_264;
                    };
                    if (tmp_253) {
                      idx_198 = i_195;
                      intersected_199 = 3;
                    };
                    i_195 = 1;
                    bool tmp_272;
                    if ((1 < numLights)) {
                      vec3 tmpvar_273;
                      tmpvar_273 = lightPos[1];
                      vec2 tmpvar_274;
                      tmpvar_274 = lightSize[1];
                      tmp_272 = bool(0);
                      if (((tmpvar_274.x > 0.0) && (tmpvar_274.y > 0.0))) {
                        lowp float t_hit_275;
                        t_hit_275 = t_hit_188;
                        bool tmpvar_276;
                        tmpvar_276 = bool(1);
                        bool tmpvar_277;
                        vec3 tmpvar_278;
                        tmpvar_278 = (vec3(0.0, 1.0, 0.0) * tmpvar_273.y);
                        lowp float tmpvar_279;
                        tmpvar_279 = (((
                          (tmpvar_278.x + tmpvar_278.y)
                         + tmpvar_278.z) - point_167.y) / tmpvar_185.y);
                        if (((tmpvar_279 < t_hit_188) && (tmpvar_279 > 0.01))) {
                          lowp vec3 tmpvar_280;
                          tmpvar_280 = (point_167 + (tmpvar_185 * tmpvar_279));
                          float tmpvar_281;
                          tmpvar_281 = sqrt(dot (tmpvar_274, tmpvar_274));
                          if (((tmpvar_281 == 0.0) || ((
                            ((tmpvar_280.x < (tmpvar_273.x + (tmpvar_274.x * 0.5))) && (tmpvar_280.x > (tmpvar_273.x - (tmpvar_274.x * 0.5))))
                           && 
                            (tmpvar_280.z < (tmpvar_273.z + (tmpvar_274.y * 0.5)))
                          ) && (tmpvar_280.z > 
                            (tmpvar_273.z - (tmpvar_274.y * 0.5))
                          )))) {
                            t_hit_275 = tmpvar_279;
                            tmpvar_277 = bool(1);
                            tmpvar_276 = bool(0);
                          };
                        };
                        if (tmpvar_276) {
                          tmpvar_277 = bool(0);
                          tmpvar_276 = bool(0);
                        };
                        t_hit_188 = t_hit_275;
                        tmp_272 = tmpvar_277;
                      } else {
                        lowp float t_hit_282;
                        t_hit_282 = t_hit_188;
                        bool tmpvar_283;
                        lowp vec3 tmpvar_284;
                        tmpvar_284 = (tmpvar_273 - point_167);
                        lowp float tmpvar_285;
                        tmpvar_285 = dot (tmpvar_284, tmpvar_185);
                        if ((tmpvar_285 < 0.0)) {
                          tmpvar_283 = bool(0);
                        } else {
                          lowp float tmpvar_286;
                          tmpvar_286 = (dot (tmpvar_284, tmpvar_284) - (tmpvar_285 * tmpvar_285));
                          if ((tmpvar_286 > 0.01)) {
                            tmpvar_283 = bool(0);
                          } else {
                            lowp float tmpvar_287;
                            tmpvar_287 = sqrt((0.01 - tmpvar_286));
                            lowp float tmpvar_288;
                            tmpvar_288 = (tmpvar_285 - tmpvar_287);
                            lowp float tmpvar_289;
                            tmpvar_289 = (tmpvar_285 + tmpvar_287);
                            lowp float tmpvar_290;
                            if ((tmpvar_288 < 0.01)) {
                              tmpvar_290 = tmpvar_289;
                            } else {
                              tmpvar_290 = tmpvar_288;
                            };
                            if (((tmpvar_290 < t_hit_188) && (tmpvar_290 > 0.01))) {
                              t_hit_282 = tmpvar_290;
                              tmpvar_283 = bool(1);
                            } else {
                              tmpvar_283 = bool(0);
                            };
                          };
                        };
                        t_hit_188 = t_hit_282;
                        tmp_272 = tmpvar_283;
                      };
                      if (tmp_272) {
                        idx_198 = i_195;
                        intersected_199 = 3;
                      };
                      i_195 = 2;
                    };
                  };
                  position_189 = (point_167 + (tmpvar_185 * t_hit_188));
                  if ((intersected_199 == 1)) {
                    diffuseColor_191 = sphereColors[idx_198];
                    specularColor_192 = vec3(1.0, 1.0, 1.0);
                    reflectiveColor_193 = reflectiveColors[idx_198];
                    lowp vec3 tmpvar_291;
                    tmpvar_291 = normalize((position_189 - sphereCenters[idx_198]));
                    normal_190 = tmpvar_291;
                    lowp float tmpvar_292;
                    tmpvar_292 = dot (tmpvar_291, -(tmpvar_185));
                    if ((tmpvar_292 < 0.0)) {
                      normal_190 = -(tmpvar_291);
                    };
                  } else {
                    if ((intersected_199 == 2)) {
                      if (enablePlaneMirrors) {
                        diffuseColor_191 = (planeColors[idx_198] * 0.01);
                        specularColor_192 = vec3(0.0, 0.0, 0.0);
                        reflectiveColor_193 = planeColors[idx_198];
                      } else {
                        diffuseColor_191 = planeColors[idx_198];
                        specularColor_192 = vec3(0.5, 0.5, 0.5);
                        reflectiveColor_193 = vec3(0.0, 0.0, 0.0);
                      };
                      lowp float tmpvar_293;
                      tmpvar_293 = dot (normal_190, -(tmpvar_185));
                      if ((tmpvar_293 < 0.0)) {
                        normal_190 = -(normal_190);
                      };
                    } else {
                      if ((intersected_199 == 3)) {
                        diffuseColor_191 = (lightIntensity[idx_198] / 25.0);
                        isLight_194 = bool(1);
                      };
                    };
                  };
                  indirectDiffuseColor_180 = diffuseColor_191;
                  indirectSpecularColor_179 = specularColor_192;
                  indirectReflectiveColor_178 = reflectiveColor_193;
                  lowp vec3 tmpvar_294;
                  if (isLight_194) {
                    tmpvar_294 = vec3(0.0, 0.0, 0.0);
                  } else {
                    lowp vec3 point_295;
                    point_295 = position_189;
                    lowp vec3 ray_dir_296;
                    ray_dir_296 = tmpvar_185;
                    lowp vec3 normal_297;
                    normal_297 = normal_190;
                    vec3 diffuseColor_298;
                    diffuseColor_298 = diffuseColor_191;
                    vec3 specularColor_299;
                    specularColor_299 = specularColor_192;
                    highp int i_300;
                    lowp vec3 illuminationColor_301;
                    i_300 = 0;
                    while (true) {
                      highp int k_302;
                      highp int areaShadowSamples_303;
                      lowp vec3 light_sum_304;
                      vec2 lightSpot_305;
                      vec2 lightSize_306;
                      vec3 lightIntensity_307;
                      vec3 lightPos_308;
                      if ((i_300 >= 2)) {
                        break;
                      };
                      if ((i_300 == numLights)) {
                        break;
                      };
                      lightPos_308 = lightPos[i_300];
                      lightIntensity_307 = lightIntensity[i_300];
                      vec2 tmpvar_309;
                      tmpvar_309 = lightSize[i_300];
                      lightSize_306 = tmpvar_309;
                      lightSpot_305 = lightSpot[i_300];
                      highp int tmpvar_310;
                      if (((tmpvar_309.x > 0.0) && (tmpvar_309.y > 0.0))) {
                        tmpvar_310 = shadowSamples;
                      } else {
                        tmpvar_310 = 1;
                      };
                      areaShadowSamples_303 = tmpvar_310;
                      k_302 = 0;
                      while (true) {
                        if ((k_302 >= 49)) {
                          break;
                        };
                        if ((k_302 == areaShadowSamples_303)) {
                          break;
                        };
                        float sample_i_311;
                        sample_i_311 = float(k_302);
                        lowp vec3 vec_to_light_312;
                        lowp vec3 incident_intensity_313;
                        lowp float spot_falloff_314;
                        if (((lightSize_306.x > 0.0) && (lightSize_306.y > 0.0))) {
                          float tmpvar_315;
                          tmpvar_315 = (1.0/(shadowDim));
                          randomIncrement += 0.02;
                          lowp float tmpvar_316;
                          tmpvar_316 = ((lightSize_306.x * tmpvar_315) * ((float(mod (sample_i_311, shadowDim))) + fract(
                            (cos(dot ((point_295.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                          )));
                          randomIncrement += 0.02;
                          lowp vec3 tmpvar_317;
                          tmpvar_317.x = ((lightPos_308.x - (lightSize_306.x * 0.5)) + tmpvar_316);
                          tmpvar_317.y = lightPos_308.y;
                          tmpvar_317.z = ((lightPos_308.z - (lightSize_306.y * 0.5)) + ((lightSize_306.y * tmpvar_315) * (
                            floor((sample_i_311 * tmpvar_315))
                           + 
                            fract((cos(dot (
                              (point_295.yx + randomIncrement)
                            , vec2(23.14069, 2.665144))) * 12345.68))
                          )));
                          vec_to_light_312 = (tmpvar_317 - point_295);
                        } else {
                          vec_to_light_312 = (lightPos_308 - point_295);
                        };
                        lowp float tmpvar_318;
                        tmpvar_318 = sqrt(dot (vec_to_light_312, vec_to_light_312));
                        lowp float tmpvar_319;
                        tmpvar_319 = (1.0/(((attenuation.x * 
                          (tmpvar_318 * tmpvar_318)
                        ) + (attenuation.y * tmpvar_318))));
                        lowp vec3 tmpvar_320;
                        tmpvar_320 = normalize(vec_to_light_312);
                        vec_to_light_312 = tmpvar_320;
                        spot_falloff_314 = 1.0;
                        if ((lightSpot_305.x > 0.0)) {
                          lowp float tmpvar_321;
                          if ((tmpvar_320.y > lightSpot_305.x)) {
                            tmpvar_321 = pow (tmpvar_320.y, lightSpot_305.y);
                          } else {
                            tmpvar_321 = 0.0;
                          };
                          spot_falloff_314 = tmpvar_321;
                        };
                        incident_intensity_313 = ((lightIntensity_307 * tmpvar_319) * spot_falloff_314);
                        lowp float tmpvar_322;
                        tmpvar_322 = sqrt(dot (incident_intensity_313, incident_intensity_313));
                        if ((tmpvar_322 > 0.01)) {
                          lowp vec3 ray_origin_323;
                          ray_origin_323 = point_295;
                          lowp vec3 ray_direction_324;
                          ray_direction_324 = tmpvar_320;
                          lowp float t_hit_325;
                          t_hit_325 = tmpvar_318;
                          bool tmpvar_326;
                          tmpvar_326 = bool(0);
                          highp int i_327;
                          highp int i_328;
                          i_328 = 0;
                          while (true) {
                            if ((i_328 >= 5)) {
                              break;
                            };
                            if ((i_328 == numSpheres)) {
                              break;
                            };
                            lowp float t_hit_329;
                            t_hit_329 = t_hit_325;
                            bool tmpvar_330;
                            lowp vec3 tmpvar_331;
                            tmpvar_331 = (sphereCenters[i_328] - ray_origin_323);
                            lowp float tmpvar_332;
                            tmpvar_332 = dot (tmpvar_331, ray_direction_324);
                            if ((tmpvar_332 < 0.0)) {
                              tmpvar_330 = bool(0);
                            } else {
                              lowp float tmpvar_333;
                              tmpvar_333 = (dot (tmpvar_331, tmpvar_331) - (tmpvar_332 * tmpvar_332));
                              if ((tmpvar_333 > 0.64)) {
                                tmpvar_330 = bool(0);
                              } else {
                                lowp float tmpvar_334;
                                tmpvar_334 = sqrt((0.64 - tmpvar_333));
                                lowp float tmpvar_335;
                                tmpvar_335 = (tmpvar_332 - tmpvar_334);
                                lowp float tmpvar_336;
                                tmpvar_336 = (tmpvar_332 + tmpvar_334);
                                lowp float tmpvar_337;
                                if ((tmpvar_335 < 0.01)) {
                                  tmpvar_337 = tmpvar_336;
                                } else {
                                  tmpvar_337 = tmpvar_335;
                                };
                                if (((tmpvar_337 < t_hit_325) && (tmpvar_337 > 0.01))) {
                                  t_hit_329 = tmpvar_337;
                                  tmpvar_330 = bool(1);
                                } else {
                                  tmpvar_330 = bool(0);
                                };
                              };
                            };
                            t_hit_325 = t_hit_329;
                            if (tmpvar_330) {
                              tmpvar_326 = bool(1);
                              break;
                            };
                            i_328++;
                          };
                          if (!(tmpvar_326)) {
                            i_327 = 0;
                            while (true) {
                              if ((i_327 >= 6)) {
                                break;
                              };
                              if ((i_327 == numPlanes)) {
                                break;
                              };
                              vec3 normal_338;
                              normal_338 = planeNormals[i_327];
                              lowp float t_hit_339;
                              t_hit_339 = t_hit_325;
                              bool tmpvar_340;
                              tmpvar_340 = bool(1);
                              bool tmpvar_341;
                              vec3 tmpvar_342;
                              tmpvar_342 = (normal_338 * planeOffsets[i_327]);
                              lowp float tmpvar_343;
                              tmpvar_343 = (((
                                (tmpvar_342.x + tmpvar_342.y)
                               + tmpvar_342.z) - dot (normal_338, ray_origin_323)) / dot (normal_338, ray_direction_324));
                              if (((tmpvar_343 < t_hit_325) && (tmpvar_343 > 0.01))) {
                                t_hit_339 = tmpvar_343;
                                tmpvar_341 = bool(1);
                                tmpvar_340 = bool(0);
                              };
                              if (tmpvar_340) {
                                tmpvar_341 = bool(0);
                                tmpvar_340 = bool(0);
                              };
                              t_hit_325 = t_hit_339;
                              if (tmpvar_341) {
                                tmpvar_326 = bool(1);
                                break;
                              };
                              i_327++;
                            };
                            if (!(tmpvar_326)) {
                              tmpvar_326 = bool(1);
                            };
                          };
                          lowp float tmpvar_344;
                          tmpvar_344 = abs((t_hit_325 - tmpvar_318));
                          if ((tmpvar_344 < 0.001)) {
                            lowp vec3 tmpvar_345;
                            lowp float tmpvar_346;
                            tmpvar_346 = dot (normal_297, tmpvar_320);
                            if ((tmpvar_346 > 0.0)) {
                              tmpvar_345 = (incident_intensity_313 * ((diffuseColor_298 * 
                                max (0.0, dot (normal_297, tmpvar_320))
                              ) + (specularColor_299 * 
                                pow (max (0.0, dot ((
                                  -(tmpvar_320)
                                 - 
                                  ((2.0 * dot (-(tmpvar_320), normal_297)) * normal_297)
                                ), -(ray_dir_296))), 32.0)
                              )));
                            } else {
                              tmpvar_345 = vec3(0.0, 0.0, 0.0);
                            };
                            light_sum_304 = (light_sum_304 + tmpvar_345);
                          };
                        };
                        k_302++;
                      };
                      illuminationColor_301 = (illuminationColor_301 + (light_sum_304 / float(tmpvar_310)));
                      i_300++;
                    };
                    tmpvar_294 = (tmpvar_181 * illuminationColor_301);
                  };
                  indirect_sampling_sum_170 = (indirect_sampling_sum_170 + tmpvar_294);
                  k_169++;
                };
                tmpvar_168 = (((2.0 * indirect_sampling_sum_170) / float(indirectSamples)) * diffuseColor_11);
              };
              pixelColor_4 = (pixelColor_4 + tmpvar_168);
            };
            bool tmpvar_347;
            if ((rayBounces > 0)) {
              tmpvar_347 = (sqrt(dot (reflectiveColor_13, reflectiveColor_13)) > 0.0);
            } else {
              tmpvar_347 = bool(0);
            };
            if (tmpvar_347) {
              lowp vec3 origin_348;
              origin_348 = position_9;
              lowp vec3 rayDir_349;
              rayDir_349 = tmpvar_5;
              lowp vec3 normal_350;
              normal_350 = normal_10;
              vec3 reflectiveColor_351;
              reflectiveColor_351 = reflectiveColor_13;
              lowp vec3 reflectionSum_353;
              for (highp int i_352 = 0; i_352 < 5; i_352++) {
                lowp vec3 mirror_sample_color_354;
                vec3 bounceReflectiveColor_355;
                vec3 bounceSpecularColor_356;
                vec3 bounceDiffuseColor_357;
                bool tmpvar_358;
                if ((i_352 >= rayBounces)) {
                  tmpvar_358 = bool(1);
                } else {
                  tmpvar_358 = (sqrt(dot (reflectiveColor_351, reflectiveColor_351)) == 0.0);
                };
                if (tmpvar_358) {
                  break;
                };
                lowp vec3 tmpvar_359;
                tmpvar_359 = (rayDir_349 - ((2.0 * 
                  dot (rayDir_349, normal_350)
                ) * normal_350));
                lowp vec3 ray_origin_360;
                ray_origin_360 = origin_348;
                lowp vec3 ray_direction_361;
                ray_direction_361 = tmpvar_359;
                lowp float t_hit_362;
                t_hit_362 = 50.0;
                lowp vec3 position_363;
                lowp vec3 normal_364;
                vec3 diffuseColor_365;
                diffuseColor_365 = bounceDiffuseColor_357;
                vec3 specularColor_366;
                specularColor_366 = bounceSpecularColor_356;
                vec3 reflectiveColor_367;
                reflectiveColor_367 = bounceReflectiveColor_355;
                bool isLight_368;
                isLight_368 = bool(0);
                highp int i_369;
                highp int i_370;
                highp int i_371;
                highp int idx_372;
                highp int intersected_373;
                intersected_373 = 0;
                idx_372 = 0;
                i_371 = 0;
                if ((0 < numSpheres)) {
                  lowp float t_hit_374;
                  t_hit_374 = t_hit_362;
                  bool tmpvar_375;
                  lowp vec3 tmpvar_376;
                  tmpvar_376 = (sphereCenters[0] - origin_348);
                  lowp float tmpvar_377;
                  tmpvar_377 = dot (tmpvar_376, tmpvar_359);
                  if ((tmpvar_377 < 0.0)) {
                    tmpvar_375 = bool(0);
                  } else {
                    lowp float tmpvar_378;
                    tmpvar_378 = (dot (tmpvar_376, tmpvar_376) - (tmpvar_377 * tmpvar_377));
                    if ((tmpvar_378 > 0.64)) {
                      tmpvar_375 = bool(0);
                    } else {
                      lowp float tmpvar_379;
                      tmpvar_379 = sqrt((0.64 - tmpvar_378));
                      lowp float tmpvar_380;
                      tmpvar_380 = (tmpvar_377 - tmpvar_379);
                      lowp float tmpvar_381;
                      tmpvar_381 = (tmpvar_377 + tmpvar_379);
                      lowp float tmpvar_382;
                      if ((tmpvar_380 < 0.01)) {
                        tmpvar_382 = tmpvar_381;
                      } else {
                        tmpvar_382 = tmpvar_380;
                      };
                      if (((tmpvar_382 < 50.0) && (tmpvar_382 > 0.01))) {
                        t_hit_374 = tmpvar_382;
                        tmpvar_375 = bool(1);
                      } else {
                        tmpvar_375 = bool(0);
                      };
                    };
                  };
                  t_hit_362 = t_hit_374;
                  if (tmpvar_375) {
                    idx_372 = i_371;
                    intersected_373 = 1;
                  };
                  i_371 = 1;
                  if ((1 < numSpheres)) {
                    lowp float t_hit_383;
                    t_hit_383 = t_hit_374;
                    bool tmpvar_384;
                    lowp vec3 tmpvar_385;
                    tmpvar_385 = (sphereCenters[1] - origin_348);
                    lowp float tmpvar_386;
                    tmpvar_386 = dot (tmpvar_385, tmpvar_359);
                    if ((tmpvar_386 < 0.0)) {
                      tmpvar_384 = bool(0);
                    } else {
                      lowp float tmpvar_387;
                      tmpvar_387 = (dot (tmpvar_385, tmpvar_385) - (tmpvar_386 * tmpvar_386));
                      if ((tmpvar_387 > 0.64)) {
                        tmpvar_384 = bool(0);
                      } else {
                        lowp float tmpvar_388;
                        tmpvar_388 = sqrt((0.64 - tmpvar_387));
                        lowp float tmpvar_389;
                        tmpvar_389 = (tmpvar_386 - tmpvar_388);
                        lowp float tmpvar_390;
                        tmpvar_390 = (tmpvar_386 + tmpvar_388);
                        lowp float tmpvar_391;
                        if ((tmpvar_389 < 0.01)) {
                          tmpvar_391 = tmpvar_390;
                        } else {
                          tmpvar_391 = tmpvar_389;
                        };
                        if (((tmpvar_391 < t_hit_374) && (tmpvar_391 > 0.01))) {
                          t_hit_383 = tmpvar_391;
                          tmpvar_384 = bool(1);
                        } else {
                          tmpvar_384 = bool(0);
                        };
                      };
                    };
                    t_hit_362 = t_hit_383;
                    if (tmpvar_384) {
                      idx_372 = i_371;
                      intersected_373 = 1;
                    };
                    i_371 = 2;
                    if ((2 < numSpheres)) {
                      lowp float t_hit_392;
                      t_hit_392 = t_hit_383;
                      bool tmpvar_393;
                      lowp vec3 tmpvar_394;
                      tmpvar_394 = (sphereCenters[2] - origin_348);
                      lowp float tmpvar_395;
                      tmpvar_395 = dot (tmpvar_394, tmpvar_359);
                      if ((tmpvar_395 < 0.0)) {
                        tmpvar_393 = bool(0);
                      } else {
                        lowp float tmpvar_396;
                        tmpvar_396 = (dot (tmpvar_394, tmpvar_394) - (tmpvar_395 * tmpvar_395));
                        if ((tmpvar_396 > 0.64)) {
                          tmpvar_393 = bool(0);
                        } else {
                          lowp float tmpvar_397;
                          tmpvar_397 = sqrt((0.64 - tmpvar_396));
                          lowp float tmpvar_398;
                          tmpvar_398 = (tmpvar_395 - tmpvar_397);
                          lowp float tmpvar_399;
                          tmpvar_399 = (tmpvar_395 + tmpvar_397);
                          lowp float tmpvar_400;
                          if ((tmpvar_398 < 0.01)) {
                            tmpvar_400 = tmpvar_399;
                          } else {
                            tmpvar_400 = tmpvar_398;
                          };
                          if (((tmpvar_400 < t_hit_383) && (tmpvar_400 > 0.01))) {
                            t_hit_392 = tmpvar_400;
                            tmpvar_393 = bool(1);
                          } else {
                            tmpvar_393 = bool(0);
                          };
                        };
                      };
                      t_hit_362 = t_hit_392;
                      if (tmpvar_393) {
                        idx_372 = i_371;
                        intersected_373 = 1;
                      };
                      i_371 = 3;
                      if ((3 < numSpheres)) {
                        lowp float t_hit_401;
                        t_hit_401 = t_hit_392;
                        bool tmpvar_402;
                        lowp vec3 tmpvar_403;
                        tmpvar_403 = (sphereCenters[3] - origin_348);
                        lowp float tmpvar_404;
                        tmpvar_404 = dot (tmpvar_403, tmpvar_359);
                        if ((tmpvar_404 < 0.0)) {
                          tmpvar_402 = bool(0);
                        } else {
                          lowp float tmpvar_405;
                          tmpvar_405 = (dot (tmpvar_403, tmpvar_403) - (tmpvar_404 * tmpvar_404));
                          if ((tmpvar_405 > 0.64)) {
                            tmpvar_402 = bool(0);
                          } else {
                            lowp float tmpvar_406;
                            tmpvar_406 = sqrt((0.64 - tmpvar_405));
                            lowp float tmpvar_407;
                            tmpvar_407 = (tmpvar_404 - tmpvar_406);
                            lowp float tmpvar_408;
                            tmpvar_408 = (tmpvar_404 + tmpvar_406);
                            lowp float tmpvar_409;
                            if ((tmpvar_407 < 0.01)) {
                              tmpvar_409 = tmpvar_408;
                            } else {
                              tmpvar_409 = tmpvar_407;
                            };
                            if (((tmpvar_409 < t_hit_392) && (tmpvar_409 > 0.01))) {
                              t_hit_401 = tmpvar_409;
                              tmpvar_402 = bool(1);
                            } else {
                              tmpvar_402 = bool(0);
                            };
                          };
                        };
                        t_hit_362 = t_hit_401;
                        if (tmpvar_402) {
                          idx_372 = i_371;
                          intersected_373 = 1;
                        };
                        i_371 = 4;
                        if ((4 < numSpheres)) {
                          lowp float t_hit_410;
                          t_hit_410 = t_hit_401;
                          bool tmpvar_411;
                          lowp vec3 tmpvar_412;
                          tmpvar_412 = (sphereCenters[4] - origin_348);
                          lowp float tmpvar_413;
                          tmpvar_413 = dot (tmpvar_412, tmpvar_359);
                          if ((tmpvar_413 < 0.0)) {
                            tmpvar_411 = bool(0);
                          } else {
                            lowp float tmpvar_414;
                            tmpvar_414 = (dot (tmpvar_412, tmpvar_412) - (tmpvar_413 * tmpvar_413));
                            if ((tmpvar_414 > 0.64)) {
                              tmpvar_411 = bool(0);
                            } else {
                              lowp float tmpvar_415;
                              tmpvar_415 = sqrt((0.64 - tmpvar_414));
                              lowp float tmpvar_416;
                              tmpvar_416 = (tmpvar_413 - tmpvar_415);
                              lowp float tmpvar_417;
                              tmpvar_417 = (tmpvar_413 + tmpvar_415);
                              lowp float tmpvar_418;
                              if ((tmpvar_416 < 0.01)) {
                                tmpvar_418 = tmpvar_417;
                              } else {
                                tmpvar_418 = tmpvar_416;
                              };
                              if (((tmpvar_418 < t_hit_401) && (tmpvar_418 > 0.01))) {
                                t_hit_410 = tmpvar_418;
                                tmpvar_411 = bool(1);
                              } else {
                                tmpvar_411 = bool(0);
                              };
                            };
                          };
                          t_hit_362 = t_hit_410;
                          if (tmpvar_411) {
                            idx_372 = i_371;
                            intersected_373 = 1;
                          };
                          i_371 = 5;
                        };
                      };
                    };
                  };
                };
                i_370 = 0;
                while (true) {
                  bool tmp_419;
                  if ((i_370 >= 6)) {
                    break;
                  };
                  if ((i_370 >= numPlanes)) {
                    break;
                  };
                  lowp vec3 tmpvar_420;
                  tmpvar_420 = planeNormals[i_370];
                  tmp_419 = bool(0);
                  bool tmpvar_421;
                  if (enablePlaneBacksides) {
                    tmpvar_421 = bool(1);
                  } else {
                    tmpvar_421 = (dot (ray_direction_361, tmpvar_420) < 0.0);
                  };
                  if (tmpvar_421) {
                    lowp float t_hit_422;
                    t_hit_422 = t_hit_362;
                    bool tmpvar_423;
                    tmpvar_423 = bool(1);
                    bool tmpvar_424;
                    lowp vec3 tmpvar_425;
                    tmpvar_425 = (tmpvar_420 * planeOffsets[i_370]);
                    lowp float tmpvar_426;
                    tmpvar_426 = (((
                      (tmpvar_425.x + tmpvar_425.y)
                     + tmpvar_425.z) - dot (tmpvar_420, ray_origin_360)) / dot (tmpvar_420, ray_direction_361));
                    if (((tmpvar_426 < t_hit_362) && (tmpvar_426 > 0.01))) {
                      t_hit_422 = tmpvar_426;
                      tmpvar_424 = bool(1);
                      tmpvar_423 = bool(0);
                    };
                    if (tmpvar_423) {
                      tmpvar_424 = bool(0);
                      tmpvar_423 = bool(0);
                    };
                    t_hit_362 = t_hit_422;
                    tmp_419 = tmpvar_424;
                  };
                  if (tmp_419) {
                    normal_364 = tmpvar_420;
                    idx_372 = i_370;
                    intersected_373 = 2;
                  };
                  i_370++;
                };
                i_369 = 0;
                bool tmp_427;
                if ((0 < numLights)) {
                  vec3 tmpvar_428;
                  tmpvar_428 = lightPos[0];
                  vec2 tmpvar_429;
                  tmpvar_429 = lightSize[0];
                  tmp_427 = bool(0);
                  if (((tmpvar_429.x > 0.0) && (tmpvar_429.y > 0.0))) {
                    lowp float t_hit_430;
                    t_hit_430 = t_hit_362;
                    bool tmpvar_431;
                    tmpvar_431 = bool(1);
                    bool tmpvar_432;
                    vec3 tmpvar_433;
                    tmpvar_433 = (vec3(0.0, 1.0, 0.0) * tmpvar_428.y);
                    lowp float tmpvar_434;
                    tmpvar_434 = (((
                      (tmpvar_433.x + tmpvar_433.y)
                     + tmpvar_433.z) - origin_348.y) / tmpvar_359.y);
                    if (((tmpvar_434 < t_hit_362) && (tmpvar_434 > 0.01))) {
                      lowp vec3 tmpvar_435;
                      tmpvar_435 = (origin_348 + (tmpvar_359 * tmpvar_434));
                      float tmpvar_436;
                      tmpvar_436 = sqrt(dot (tmpvar_429, tmpvar_429));
                      if (((tmpvar_436 == 0.0) || ((
                        ((tmpvar_435.x < (tmpvar_428.x + (tmpvar_429.x * 0.5))) && (tmpvar_435.x > (tmpvar_428.x - (tmpvar_429.x * 0.5))))
                       && 
                        (tmpvar_435.z < (tmpvar_428.z + (tmpvar_429.y * 0.5)))
                      ) && (tmpvar_435.z > 
                        (tmpvar_428.z - (tmpvar_429.y * 0.5))
                      )))) {
                        t_hit_430 = tmpvar_434;
                        tmpvar_432 = bool(1);
                        tmpvar_431 = bool(0);
                      };
                    };
                    if (tmpvar_431) {
                      tmpvar_432 = bool(0);
                      tmpvar_431 = bool(0);
                    };
                    t_hit_362 = t_hit_430;
                    tmp_427 = tmpvar_432;
                  } else {
                    lowp float t_hit_437;
                    t_hit_437 = t_hit_362;
                    bool tmpvar_438;
                    lowp vec3 tmpvar_439;
                    tmpvar_439 = (tmpvar_428 - origin_348);
                    lowp float tmpvar_440;
                    tmpvar_440 = dot (tmpvar_439, tmpvar_359);
                    if ((tmpvar_440 < 0.0)) {
                      tmpvar_438 = bool(0);
                    } else {
                      lowp float tmpvar_441;
                      tmpvar_441 = (dot (tmpvar_439, tmpvar_439) - (tmpvar_440 * tmpvar_440));
                      if ((tmpvar_441 > 0.01)) {
                        tmpvar_438 = bool(0);
                      } else {
                        lowp float tmpvar_442;
                        tmpvar_442 = sqrt((0.01 - tmpvar_441));
                        lowp float tmpvar_443;
                        tmpvar_443 = (tmpvar_440 - tmpvar_442);
                        lowp float tmpvar_444;
                        tmpvar_444 = (tmpvar_440 + tmpvar_442);
                        lowp float tmpvar_445;
                        if ((tmpvar_443 < 0.01)) {
                          tmpvar_445 = tmpvar_444;
                        } else {
                          tmpvar_445 = tmpvar_443;
                        };
                        if (((tmpvar_445 < t_hit_362) && (tmpvar_445 > 0.01))) {
                          t_hit_437 = tmpvar_445;
                          tmpvar_438 = bool(1);
                        } else {
                          tmpvar_438 = bool(0);
                        };
                      };
                    };
                    t_hit_362 = t_hit_437;
                    tmp_427 = tmpvar_438;
                  };
                  if (tmp_427) {
                    idx_372 = i_369;
                    intersected_373 = 3;
                  };
                  i_369 = 1;
                  bool tmp_446;
                  if ((1 < numLights)) {
                    vec3 tmpvar_447;
                    tmpvar_447 = lightPos[1];
                    vec2 tmpvar_448;
                    tmpvar_448 = lightSize[1];
                    tmp_446 = bool(0);
                    if (((tmpvar_448.x > 0.0) && (tmpvar_448.y > 0.0))) {
                      lowp float t_hit_449;
                      t_hit_449 = t_hit_362;
                      bool tmpvar_450;
                      tmpvar_450 = bool(1);
                      bool tmpvar_451;
                      vec3 tmpvar_452;
                      tmpvar_452 = (vec3(0.0, 1.0, 0.0) * tmpvar_447.y);
                      lowp float tmpvar_453;
                      tmpvar_453 = (((
                        (tmpvar_452.x + tmpvar_452.y)
                       + tmpvar_452.z) - origin_348.y) / tmpvar_359.y);
                      if (((tmpvar_453 < t_hit_362) && (tmpvar_453 > 0.01))) {
                        lowp vec3 tmpvar_454;
                        tmpvar_454 = (origin_348 + (tmpvar_359 * tmpvar_453));
                        float tmpvar_455;
                        tmpvar_455 = sqrt(dot (tmpvar_448, tmpvar_448));
                        if (((tmpvar_455 == 0.0) || ((
                          ((tmpvar_454.x < (tmpvar_447.x + (tmpvar_448.x * 0.5))) && (tmpvar_454.x > (tmpvar_447.x - (tmpvar_448.x * 0.5))))
                         && 
                          (tmpvar_454.z < (tmpvar_447.z + (tmpvar_448.y * 0.5)))
                        ) && (tmpvar_454.z > 
                          (tmpvar_447.z - (tmpvar_448.y * 0.5))
                        )))) {
                          t_hit_449 = tmpvar_453;
                          tmpvar_451 = bool(1);
                          tmpvar_450 = bool(0);
                        };
                      };
                      if (tmpvar_450) {
                        tmpvar_451 = bool(0);
                        tmpvar_450 = bool(0);
                      };
                      t_hit_362 = t_hit_449;
                      tmp_446 = tmpvar_451;
                    } else {
                      lowp float t_hit_456;
                      t_hit_456 = t_hit_362;
                      bool tmpvar_457;
                      lowp vec3 tmpvar_458;
                      tmpvar_458 = (tmpvar_447 - origin_348);
                      lowp float tmpvar_459;
                      tmpvar_459 = dot (tmpvar_458, tmpvar_359);
                      if ((tmpvar_459 < 0.0)) {
                        tmpvar_457 = bool(0);
                      } else {
                        lowp float tmpvar_460;
                        tmpvar_460 = (dot (tmpvar_458, tmpvar_458) - (tmpvar_459 * tmpvar_459));
                        if ((tmpvar_460 > 0.01)) {
                          tmpvar_457 = bool(0);
                        } else {
                          lowp float tmpvar_461;
                          tmpvar_461 = sqrt((0.01 - tmpvar_460));
                          lowp float tmpvar_462;
                          tmpvar_462 = (tmpvar_459 - tmpvar_461);
                          lowp float tmpvar_463;
                          tmpvar_463 = (tmpvar_459 + tmpvar_461);
                          lowp float tmpvar_464;
                          if ((tmpvar_462 < 0.01)) {
                            tmpvar_464 = tmpvar_463;
                          } else {
                            tmpvar_464 = tmpvar_462;
                          };
                          if (((tmpvar_464 < t_hit_362) && (tmpvar_464 > 0.01))) {
                            t_hit_456 = tmpvar_464;
                            tmpvar_457 = bool(1);
                          } else {
                            tmpvar_457 = bool(0);
                          };
                        };
                      };
                      t_hit_362 = t_hit_456;
                      tmp_446 = tmpvar_457;
                    };
                    if (tmp_446) {
                      idx_372 = i_369;
                      intersected_373 = 3;
                    };
                    i_369 = 2;
                  };
                };
                position_363 = (origin_348 + (tmpvar_359 * t_hit_362));
                if ((intersected_373 == 1)) {
                  diffuseColor_365 = sphereColors[idx_372];
                  specularColor_366 = vec3(1.0, 1.0, 1.0);
                  reflectiveColor_367 = reflectiveColors[idx_372];
                  lowp vec3 tmpvar_465;
                  tmpvar_465 = normalize((position_363 - sphereCenters[idx_372]));
                  normal_364 = tmpvar_465;
                  lowp float tmpvar_466;
                  tmpvar_466 = dot (tmpvar_465, -(tmpvar_359));
                  if ((tmpvar_466 < 0.0)) {
                    normal_364 = -(tmpvar_465);
                  };
                } else {
                  if ((intersected_373 == 2)) {
                    if (enablePlaneMirrors) {
                      diffuseColor_365 = (planeColors[idx_372] * 0.01);
                      specularColor_366 = vec3(0.0, 0.0, 0.0);
                      reflectiveColor_367 = planeColors[idx_372];
                    } else {
                      diffuseColor_365 = planeColors[idx_372];
                      specularColor_366 = vec3(0.5, 0.5, 0.5);
                      reflectiveColor_367 = vec3(0.0, 0.0, 0.0);
                    };
                    lowp float tmpvar_467;
                    tmpvar_467 = dot (normal_364, -(tmpvar_359));
                    if ((tmpvar_467 < 0.0)) {
                      normal_364 = -(normal_364);
                    };
                  } else {
                    if ((intersected_373 == 3)) {
                      diffuseColor_365 = (lightIntensity[idx_372] / 25.0);
                      isLight_368 = bool(1);
                    };
                  };
                };
                normal_350 = normal_364;
                bounceDiffuseColor_357 = diffuseColor_365;
                bounceSpecularColor_356 = specularColor_366;
                bounceReflectiveColor_355 = reflectiveColor_367;
                lowp vec3 tmpvar_468;
                if (isLight_368) {
                  tmpvar_468 = diffuseColor_365;
                } else {
                  lowp vec3 point_469;
                  point_469 = position_363;
                  lowp vec3 ray_dir_470;
                  ray_dir_470 = tmpvar_359;
                  lowp vec3 normal_471;
                  normal_471 = normal_364;
                  vec3 diffuseColor_472;
                  diffuseColor_472 = diffuseColor_365;
                  vec3 specularColor_473;
                  specularColor_473 = specularColor_366;
                  highp int i_474;
                  lowp vec3 illuminationColor_475;
                  i_474 = 0;
                  while (true) {
                    highp int k_476;
                    highp int areaShadowSamples_477;
                    lowp vec3 light_sum_478;
                    vec2 lightSpot_479;
                    vec2 lightSize_480;
                    vec3 lightIntensity_481;
                    vec3 lightPos_482;
                    if ((i_474 >= 2)) {
                      break;
                    };
                    if ((i_474 == numLights)) {
                      break;
                    };
                    lightPos_482 = lightPos[i_474];
                    lightIntensity_481 = lightIntensity[i_474];
                    vec2 tmpvar_483;
                    tmpvar_483 = lightSize[i_474];
                    lightSize_480 = tmpvar_483;
                    lightSpot_479 = lightSpot[i_474];
                    highp int tmpvar_484;
                    if (((tmpvar_483.x > 0.0) && (tmpvar_483.y > 0.0))) {
                      tmpvar_484 = shadowSamples;
                    } else {
                      tmpvar_484 = 1;
                    };
                    areaShadowSamples_477 = tmpvar_484;
                    k_476 = 0;
                    while (true) {
                      if ((k_476 >= 49)) {
                        break;
                      };
                      if ((k_476 == areaShadowSamples_477)) {
                        break;
                      };
                      float sample_i_485;
                      sample_i_485 = float(k_476);
                      lowp vec3 vec_to_light_486;
                      lowp vec3 incident_intensity_487;
                      lowp float spot_falloff_488;
                      if (((lightSize_480.x > 0.0) && (lightSize_480.y > 0.0))) {
                        float tmpvar_489;
                        tmpvar_489 = (1.0/(shadowDim));
                        randomIncrement += 0.02;
                        lowp float tmpvar_490;
                        tmpvar_490 = ((lightSize_480.x * tmpvar_489) * ((float(mod (sample_i_485, shadowDim))) + fract(
                          (cos(dot ((point_469.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                        )));
                        randomIncrement += 0.02;
                        lowp vec3 tmpvar_491;
                        tmpvar_491.x = ((lightPos_482.x - (lightSize_480.x * 0.5)) + tmpvar_490);
                        tmpvar_491.y = lightPos_482.y;
                        tmpvar_491.z = ((lightPos_482.z - (lightSize_480.y * 0.5)) + ((lightSize_480.y * tmpvar_489) * (
                          floor((sample_i_485 * tmpvar_489))
                         + 
                          fract((cos(dot (
                            (point_469.yx + randomIncrement)
                          , vec2(23.14069, 2.665144))) * 12345.68))
                        )));
                        vec_to_light_486 = (tmpvar_491 - point_469);
                      } else {
                        vec_to_light_486 = (lightPos_482 - point_469);
                      };
                      lowp float tmpvar_492;
                      tmpvar_492 = sqrt(dot (vec_to_light_486, vec_to_light_486));
                      lowp float tmpvar_493;
                      tmpvar_493 = (1.0/(((attenuation.x * 
                        (tmpvar_492 * tmpvar_492)
                      ) + (attenuation.y * tmpvar_492))));
                      lowp vec3 tmpvar_494;
                      tmpvar_494 = normalize(vec_to_light_486);
                      vec_to_light_486 = tmpvar_494;
                      spot_falloff_488 = 1.0;
                      if ((lightSpot_479.x > 0.0)) {
                        lowp float tmpvar_495;
                        if ((tmpvar_494.y > lightSpot_479.x)) {
                          tmpvar_495 = pow (tmpvar_494.y, lightSpot_479.y);
                        } else {
                          tmpvar_495 = 0.0;
                        };
                        spot_falloff_488 = tmpvar_495;
                      };
                      incident_intensity_487 = ((lightIntensity_481 * tmpvar_493) * spot_falloff_488);
                      lowp float tmpvar_496;
                      tmpvar_496 = sqrt(dot (incident_intensity_487, incident_intensity_487));
                      if ((tmpvar_496 > 0.01)) {
                        lowp vec3 ray_origin_497;
                        ray_origin_497 = point_469;
                        lowp vec3 ray_direction_498;
                        ray_direction_498 = tmpvar_494;
                        lowp float t_hit_499;
                        t_hit_499 = tmpvar_492;
                        bool tmpvar_500;
                        tmpvar_500 = bool(0);
                        highp int i_501;
                        highp int i_502;
                        i_502 = 0;
                        while (true) {
                          if ((i_502 >= 5)) {
                            break;
                          };
                          if ((i_502 == numSpheres)) {
                            break;
                          };
                          lowp float t_hit_503;
                          t_hit_503 = t_hit_499;
                          bool tmpvar_504;
                          lowp vec3 tmpvar_505;
                          tmpvar_505 = (sphereCenters[i_502] - ray_origin_497);
                          lowp float tmpvar_506;
                          tmpvar_506 = dot (tmpvar_505, ray_direction_498);
                          if ((tmpvar_506 < 0.0)) {
                            tmpvar_504 = bool(0);
                          } else {
                            lowp float tmpvar_507;
                            tmpvar_507 = (dot (tmpvar_505, tmpvar_505) - (tmpvar_506 * tmpvar_506));
                            if ((tmpvar_507 > 0.64)) {
                              tmpvar_504 = bool(0);
                            } else {
                              lowp float tmpvar_508;
                              tmpvar_508 = sqrt((0.64 - tmpvar_507));
                              lowp float tmpvar_509;
                              tmpvar_509 = (tmpvar_506 - tmpvar_508);
                              lowp float tmpvar_510;
                              tmpvar_510 = (tmpvar_506 + tmpvar_508);
                              lowp float tmpvar_511;
                              if ((tmpvar_509 < 0.01)) {
                                tmpvar_511 = tmpvar_510;
                              } else {
                                tmpvar_511 = tmpvar_509;
                              };
                              if (((tmpvar_511 < t_hit_499) && (tmpvar_511 > 0.01))) {
                                t_hit_503 = tmpvar_511;
                                tmpvar_504 = bool(1);
                              } else {
                                tmpvar_504 = bool(0);
                              };
                            };
                          };
                          t_hit_499 = t_hit_503;
                          if (tmpvar_504) {
                            tmpvar_500 = bool(1);
                            break;
                          };
                          i_502++;
                        };
                        if (!(tmpvar_500)) {
                          i_501 = 0;
                          while (true) {
                            if ((i_501 >= 6)) {
                              break;
                            };
                            if ((i_501 == numPlanes)) {
                              break;
                            };
                            vec3 normal_512;
                            normal_512 = planeNormals[i_501];
                            lowp float t_hit_513;
                            t_hit_513 = t_hit_499;
                            bool tmpvar_514;
                            tmpvar_514 = bool(1);
                            bool tmpvar_515;
                            vec3 tmpvar_516;
                            tmpvar_516 = (normal_512 * planeOffsets[i_501]);
                            lowp float tmpvar_517;
                            tmpvar_517 = (((
                              (tmpvar_516.x + tmpvar_516.y)
                             + tmpvar_516.z) - dot (normal_512, ray_origin_497)) / dot (normal_512, ray_direction_498));
                            if (((tmpvar_517 < t_hit_499) && (tmpvar_517 > 0.01))) {
                              t_hit_513 = tmpvar_517;
                              tmpvar_515 = bool(1);
                              tmpvar_514 = bool(0);
                            };
                            if (tmpvar_514) {
                              tmpvar_515 = bool(0);
                              tmpvar_514 = bool(0);
                            };
                            t_hit_499 = t_hit_513;
                            if (tmpvar_515) {
                              tmpvar_500 = bool(1);
                              break;
                            };
                            i_501++;
                          };
                          if (!(tmpvar_500)) {
                            tmpvar_500 = bool(1);
                          };
                        };
                        lowp float tmpvar_518;
                        tmpvar_518 = abs((t_hit_499 - tmpvar_492));
                        if ((tmpvar_518 < 0.001)) {
                          lowp vec3 tmpvar_519;
                          lowp float tmpvar_520;
                          tmpvar_520 = dot (normal_471, tmpvar_494);
                          if ((tmpvar_520 > 0.0)) {
                            tmpvar_519 = (incident_intensity_487 * ((diffuseColor_472 * 
                              max (0.0, dot (normal_471, tmpvar_494))
                            ) + (specularColor_473 * 
                              pow (max (0.0, dot ((
                                -(tmpvar_494)
                               - 
                                ((2.0 * dot (-(tmpvar_494), normal_471)) * normal_471)
                              ), -(ray_dir_470))), 32.0)
                            )));
                          } else {
                            tmpvar_519 = vec3(0.0, 0.0, 0.0);
                          };
                          light_sum_478 = (light_sum_478 + tmpvar_519);
                        };
                      };
                      k_476++;
                    };
                    illuminationColor_475 = (illuminationColor_475 + (light_sum_478 / float(tmpvar_484)));
                    i_474++;
                  };
                  tmpvar_468 = illuminationColor_475;
                };
                mirror_sample_color_354 = tmpvar_468;
                if (enableRefGI) {
                  lowp vec3 point_521;
                  point_521 = position_363;
                  lowp vec3 tmpvar_522;
                  highp int k_523;
                  lowp vec3 indirect_sampling_sum_524;
                  lowp mat3 transform_525;
                  float tmpvar_526;
                  tmpvar_526 = sqrt(dot (diffuseColor_365, diffuseColor_365));
                  if ((tmpvar_526 == 0.0)) {
                    tmpvar_522 = vec3(0.0, 0.0, 0.0);
                  } else {
                    lowp float tmpvar_527;
                    tmpvar_527 = abs(normal_364.x);
                    lowp float tmpvar_528;
                    tmpvar_528 = abs(normal_364.y);
                    if ((tmpvar_527 > tmpvar_528)) {
                      lowp vec3 tmpvar_529;
                      tmpvar_529.y = 0.0;
                      tmpvar_529.x = normal_364.z;
                      tmpvar_529.z = -(normal_364.x);
                      transform_525[2] = (tmpvar_529 / sqrt((
                        (normal_364.x * normal_364.x)
                       + 
                        (normal_364.z * normal_364.z)
                      )));
                    } else {
                      lowp vec3 tmpvar_530;
                      tmpvar_530.x = 0.0;
                      tmpvar_530.y = -(normal_364.z);
                      tmpvar_530.z = normal_364.y;
                      transform_525[2] = (tmpvar_530 / sqrt((
                        (normal_364.y * normal_364.y)
                       + 
                        (normal_364.z * normal_364.z)
                      )));
                    };
                    lowp vec3 b_531;
                    b_531 = transform_525[2];
                    transform_525[0] = ((normal_364.yzx * b_531.zxy) - (normal_364.zxy * b_531.yzx));
                    transform_525[1] = normal_364;
                    k_523 = 0;
                    while (true) {
                      vec3 indirectReflectiveColor_532;
                      vec3 indirectSpecularColor_533;
                      vec3 indirectDiffuseColor_534;
                      if ((k_523 >= 100)) {
                        break;
                      };
                      if ((k_523 >= indirectSamples)) {
                        break;
                      };
                      randomIncrement += 0.02;
                      lowp float tmpvar_535;
                      tmpvar_535 = fract((cos(
                        dot ((point_521.xy + randomIncrement), vec2(23.14069, 2.665144))
                      ) * 12345.68));
                      lowp float tmpvar_536;
                      tmpvar_536 = sqrt((1.0 - (tmpvar_535 * tmpvar_535)));
                      randomIncrement += 0.02;
                      lowp float tmpvar_537;
                      tmpvar_537 = (6.283186 * fract((
                        cos(dot ((point_521.yx + randomIncrement), vec2(23.14069, 2.665144)))
                       * 12345.68)));
                      lowp vec3 tmpvar_538;
                      tmpvar_538.x = (cos(tmpvar_537) * tmpvar_536);
                      tmpvar_538.y = tmpvar_535;
                      tmpvar_538.z = (sin(tmpvar_537) * tmpvar_536);
                      lowp vec3 tmpvar_539;
                      tmpvar_539 = (transform_525 * tmpvar_538);
                      lowp vec3 ray_origin_540;
                      ray_origin_540 = point_521;
                      lowp vec3 ray_direction_541;
                      ray_direction_541 = tmpvar_539;
                      lowp float t_hit_542;
                      t_hit_542 = 10.0;
                      lowp vec3 position_543;
                      lowp vec3 normal_544;
                      vec3 diffuseColor_545;
                      diffuseColor_545 = indirectDiffuseColor_534;
                      vec3 specularColor_546;
                      specularColor_546 = indirectSpecularColor_533;
                      vec3 reflectiveColor_547;
                      reflectiveColor_547 = indirectReflectiveColor_532;
                      bool isLight_548;
                      isLight_548 = bool(0);
                      highp int i_549;
                      highp int i_550;
                      highp int i_551;
                      highp int idx_552;
                      highp int intersected_553;
                      intersected_553 = 0;
                      idx_552 = 0;
                      i_551 = 0;
                      while (true) {
                        if ((i_551 >= 5)) {
                          break;
                        };
                        if ((i_551 >= numSpheres)) {
                          break;
                        };
                        lowp float t_hit_554;
                        t_hit_554 = t_hit_542;
                        bool tmpvar_555;
                        lowp vec3 tmpvar_556;
                        tmpvar_556 = (sphereCenters[i_551] - ray_origin_540);
                        lowp float tmpvar_557;
                        tmpvar_557 = dot (tmpvar_556, ray_direction_541);
                        if ((tmpvar_557 < 0.0)) {
                          tmpvar_555 = bool(0);
                        } else {
                          lowp float tmpvar_558;
                          tmpvar_558 = (dot (tmpvar_556, tmpvar_556) - (tmpvar_557 * tmpvar_557));
                          if ((tmpvar_558 > 0.64)) {
                            tmpvar_555 = bool(0);
                          } else {
                            lowp float tmpvar_559;
                            tmpvar_559 = sqrt((0.64 - tmpvar_558));
                            lowp float tmpvar_560;
                            tmpvar_560 = (tmpvar_557 - tmpvar_559);
                            lowp float tmpvar_561;
                            tmpvar_561 = (tmpvar_557 + tmpvar_559);
                            lowp float tmpvar_562;
                            if ((tmpvar_560 < 0.01)) {
                              tmpvar_562 = tmpvar_561;
                            } else {
                              tmpvar_562 = tmpvar_560;
                            };
                            if (((tmpvar_562 < t_hit_542) && (tmpvar_562 > 0.01))) {
                              t_hit_554 = tmpvar_562;
                              tmpvar_555 = bool(1);
                            } else {
                              tmpvar_555 = bool(0);
                            };
                          };
                        };
                        t_hit_542 = t_hit_554;
                        if (tmpvar_555) {
                          idx_552 = i_551;
                          intersected_553 = 1;
                        };
                        i_551++;
                      };
                      i_550 = 0;
                      while (true) {
                        bool tmp_563;
                        if ((i_550 >= 6)) {
                          break;
                        };
                        if ((i_550 >= numPlanes)) {
                          break;
                        };
                        lowp vec3 tmpvar_564;
                        tmpvar_564 = planeNormals[i_550];
                        tmp_563 = bool(0);
                        bool tmpvar_565;
                        if (enablePlaneBacksides) {
                          tmpvar_565 = bool(1);
                        } else {
                          tmpvar_565 = (dot (ray_direction_541, tmpvar_564) < 0.0);
                        };
                        if (tmpvar_565) {
                          lowp float t_hit_566;
                          t_hit_566 = t_hit_542;
                          bool tmpvar_567;
                          tmpvar_567 = bool(1);
                          bool tmpvar_568;
                          lowp vec3 tmpvar_569;
                          tmpvar_569 = (tmpvar_564 * planeOffsets[i_550]);
                          lowp float tmpvar_570;
                          tmpvar_570 = (((
                            (tmpvar_569.x + tmpvar_569.y)
                           + tmpvar_569.z) - dot (tmpvar_564, ray_origin_540)) / dot (tmpvar_564, ray_direction_541));
                          if (((tmpvar_570 < t_hit_542) && (tmpvar_570 > 0.01))) {
                            t_hit_566 = tmpvar_570;
                            tmpvar_568 = bool(1);
                            tmpvar_567 = bool(0);
                          };
                          if (tmpvar_567) {
                            tmpvar_568 = bool(0);
                            tmpvar_567 = bool(0);
                          };
                          t_hit_542 = t_hit_566;
                          tmp_563 = tmpvar_568;
                        };
                        if (tmp_563) {
                          normal_544 = tmpvar_564;
                          idx_552 = i_550;
                          intersected_553 = 2;
                        };
                        i_550++;
                      };
                      i_549 = 0;
                      while (true) {
                        bool tmp_571;
                        if ((i_549 >= 2)) {
                          break;
                        };
                        if ((i_549 >= numLights)) {
                          break;
                        };
                        vec3 tmpvar_572;
                        tmpvar_572 = lightPos[i_549];
                        vec2 tmpvar_573;
                        tmpvar_573 = lightSize[i_549];
                        tmp_571 = bool(0);
                        if (((tmpvar_573.x > 0.0) && (tmpvar_573.y > 0.0))) {
                          lowp float t_hit_574;
                          t_hit_574 = t_hit_542;
                          bool tmpvar_575;
                          tmpvar_575 = bool(1);
                          bool tmpvar_576;
                          vec3 tmpvar_577;
                          tmpvar_577 = (vec3(0.0, 1.0, 0.0) * tmpvar_572.y);
                          lowp float tmpvar_578;
                          tmpvar_578 = (((
                            (tmpvar_577.x + tmpvar_577.y)
                           + tmpvar_577.z) - ray_origin_540.y) / ray_direction_541.y);
                          if (((tmpvar_578 < t_hit_542) && (tmpvar_578 > 0.01))) {
                            lowp vec3 tmpvar_579;
                            tmpvar_579 = (ray_origin_540 + (ray_direction_541 * tmpvar_578));
                            float tmpvar_580;
                            tmpvar_580 = sqrt(dot (tmpvar_573, tmpvar_573));
                            if (((tmpvar_580 == 0.0) || ((
                              ((tmpvar_579.x < (tmpvar_572.x + (tmpvar_573.x * 0.5))) && (tmpvar_579.x > (tmpvar_572.x - (tmpvar_573.x * 0.5))))
                             && 
                              (tmpvar_579.z < (tmpvar_572.z + (tmpvar_573.y * 0.5)))
                            ) && (tmpvar_579.z > 
                              (tmpvar_572.z - (tmpvar_573.y * 0.5))
                            )))) {
                              t_hit_574 = tmpvar_578;
                              tmpvar_576 = bool(1);
                              tmpvar_575 = bool(0);
                            };
                          };
                          if (tmpvar_575) {
                            tmpvar_576 = bool(0);
                            tmpvar_575 = bool(0);
                          };
                          t_hit_542 = t_hit_574;
                          tmp_571 = tmpvar_576;
                        } else {
                          lowp float t_hit_581;
                          t_hit_581 = t_hit_542;
                          bool tmpvar_582;
                          lowp vec3 tmpvar_583;
                          tmpvar_583 = (tmpvar_572 - ray_origin_540);
                          lowp float tmpvar_584;
                          tmpvar_584 = dot (tmpvar_583, ray_direction_541);
                          if ((tmpvar_584 < 0.0)) {
                            tmpvar_582 = bool(0);
                          } else {
                            lowp float tmpvar_585;
                            tmpvar_585 = (dot (tmpvar_583, tmpvar_583) - (tmpvar_584 * tmpvar_584));
                            if ((tmpvar_585 > 0.01)) {
                              tmpvar_582 = bool(0);
                            } else {
                              lowp float tmpvar_586;
                              tmpvar_586 = sqrt((0.01 - tmpvar_585));
                              lowp float tmpvar_587;
                              tmpvar_587 = (tmpvar_584 - tmpvar_586);
                              lowp float tmpvar_588;
                              tmpvar_588 = (tmpvar_584 + tmpvar_586);
                              lowp float tmpvar_589;
                              if ((tmpvar_587 < 0.01)) {
                                tmpvar_589 = tmpvar_588;
                              } else {
                                tmpvar_589 = tmpvar_587;
                              };
                              if (((tmpvar_589 < t_hit_542) && (tmpvar_589 > 0.01))) {
                                t_hit_581 = tmpvar_589;
                                tmpvar_582 = bool(1);
                              } else {
                                tmpvar_582 = bool(0);
                              };
                            };
                          };
                          t_hit_542 = t_hit_581;
                          tmp_571 = tmpvar_582;
                        };
                        if (tmp_571) {
                          idx_552 = i_549;
                          intersected_553 = 3;
                        };
                        i_549++;
                      };
                      position_543 = (point_521 + (tmpvar_539 * t_hit_542));
                      if ((intersected_553 == 1)) {
                        diffuseColor_545 = sphereColors[idx_552];
                        specularColor_546 = vec3(1.0, 1.0, 1.0);
                        reflectiveColor_547 = reflectiveColors[idx_552];
                        lowp vec3 tmpvar_590;
                        tmpvar_590 = normalize((position_543 - sphereCenters[idx_552]));
                        normal_544 = tmpvar_590;
                        lowp float tmpvar_591;
                        tmpvar_591 = dot (tmpvar_590, -(tmpvar_539));
                        if ((tmpvar_591 < 0.0)) {
                          normal_544 = -(tmpvar_590);
                        };
                      } else {
                        if ((intersected_553 == 2)) {
                          if (enablePlaneMirrors) {
                            diffuseColor_545 = (planeColors[idx_552] * 0.01);
                            specularColor_546 = vec3(0.0, 0.0, 0.0);
                            reflectiveColor_547 = planeColors[idx_552];
                          } else {
                            diffuseColor_545 = planeColors[idx_552];
                            specularColor_546 = vec3(0.5, 0.5, 0.5);
                            reflectiveColor_547 = vec3(0.0, 0.0, 0.0);
                          };
                          lowp float tmpvar_592;
                          tmpvar_592 = dot (normal_544, -(tmpvar_539));
                          if ((tmpvar_592 < 0.0)) {
                            normal_544 = -(normal_544);
                          };
                        } else {
                          if ((intersected_553 == 3)) {
                            diffuseColor_545 = (lightIntensity[idx_552] / 25.0);
                            isLight_548 = bool(1);
                          };
                        };
                      };
                      indirectDiffuseColor_534 = diffuseColor_545;
                      indirectSpecularColor_533 = specularColor_546;
                      indirectReflectiveColor_532 = reflectiveColor_547;
                      lowp vec3 tmpvar_593;
                      if (isLight_548) {
                        tmpvar_593 = vec3(0.0, 0.0, 0.0);
                      } else {
                        lowp vec3 point_594;
                        point_594 = position_543;
                        lowp vec3 ray_dir_595;
                        ray_dir_595 = tmpvar_539;
                        lowp vec3 normal_596;
                        normal_596 = normal_544;
                        vec3 diffuseColor_597;
                        diffuseColor_597 = diffuseColor_545;
                        vec3 specularColor_598;
                        specularColor_598 = specularColor_546;
                        highp int i_599;
                        lowp vec3 illuminationColor_600;
                        i_599 = 0;
                        while (true) {
                          highp int k_601;
                          highp int areaShadowSamples_602;
                          lowp vec3 light_sum_603;
                          vec2 lightSpot_604;
                          vec2 lightSize_605;
                          vec3 lightIntensity_606;
                          vec3 lightPos_607;
                          if ((i_599 >= 2)) {
                            break;
                          };
                          if ((i_599 == numLights)) {
                            break;
                          };
                          lightPos_607 = lightPos[i_599];
                          lightIntensity_606 = lightIntensity[i_599];
                          vec2 tmpvar_608;
                          tmpvar_608 = lightSize[i_599];
                          lightSize_605 = tmpvar_608;
                          lightSpot_604 = lightSpot[i_599];
                          highp int tmpvar_609;
                          if (((tmpvar_608.x > 0.0) && (tmpvar_608.y > 0.0))) {
                            tmpvar_609 = shadowSamples;
                          } else {
                            tmpvar_609 = 1;
                          };
                          areaShadowSamples_602 = tmpvar_609;
                          k_601 = 0;
                          while (true) {
                            if ((k_601 >= 49)) {
                              break;
                            };
                            if ((k_601 == areaShadowSamples_602)) {
                              break;
                            };
                            float sample_i_610;
                            sample_i_610 = float(k_601);
                            lowp vec3 vec_to_light_611;
                            lowp vec3 incident_intensity_612;
                            lowp float spot_falloff_613;
                            if (((lightSize_605.x > 0.0) && (lightSize_605.y > 0.0))) {
                              float tmpvar_614;
                              tmpvar_614 = (1.0/(shadowDim));
                              randomIncrement += 0.02;
                              lowp float tmpvar_615;
                              tmpvar_615 = ((lightSize_605.x * tmpvar_614) * ((float(mod (sample_i_610, shadowDim))) + fract(
                                (cos(dot ((point_594.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                              )));
                              randomIncrement += 0.02;
                              lowp vec3 tmpvar_616;
                              tmpvar_616.x = ((lightPos_607.x - (lightSize_605.x * 0.5)) + tmpvar_615);
                              tmpvar_616.y = lightPos_607.y;
                              tmpvar_616.z = ((lightPos_607.z - (lightSize_605.y * 0.5)) + ((lightSize_605.y * tmpvar_614) * (
                                floor((sample_i_610 * tmpvar_614))
                               + 
                                fract((cos(dot (
                                  (point_594.yx + randomIncrement)
                                , vec2(23.14069, 2.665144))) * 12345.68))
                              )));
                              vec_to_light_611 = (tmpvar_616 - point_594);
                            } else {
                              vec_to_light_611 = (lightPos_607 - point_594);
                            };
                            lowp float tmpvar_617;
                            tmpvar_617 = sqrt(dot (vec_to_light_611, vec_to_light_611));
                            lowp float tmpvar_618;
                            tmpvar_618 = (1.0/(((attenuation.x * 
                              (tmpvar_617 * tmpvar_617)
                            ) + (attenuation.y * tmpvar_617))));
                            lowp vec3 tmpvar_619;
                            tmpvar_619 = normalize(vec_to_light_611);
                            vec_to_light_611 = tmpvar_619;
                            spot_falloff_613 = 1.0;
                            if ((lightSpot_604.x > 0.0)) {
                              lowp float tmpvar_620;
                              if ((tmpvar_619.y > lightSpot_604.x)) {
                                tmpvar_620 = pow (tmpvar_619.y, lightSpot_604.y);
                              } else {
                                tmpvar_620 = 0.0;
                              };
                              spot_falloff_613 = tmpvar_620;
                            };
                            incident_intensity_612 = ((lightIntensity_606 * tmpvar_618) * spot_falloff_613);
                            lowp float tmpvar_621;
                            tmpvar_621 = sqrt(dot (incident_intensity_612, incident_intensity_612));
                            if ((tmpvar_621 > 0.01)) {
                              lowp vec3 ray_origin_622;
                              ray_origin_622 = point_594;
                              lowp vec3 ray_direction_623;
                              ray_direction_623 = tmpvar_619;
                              lowp float t_hit_624;
                              t_hit_624 = tmpvar_617;
                              bool tmpvar_625;
                              tmpvar_625 = bool(0);
                              highp int i_626;
                              highp int i_627;
                              i_627 = 0;
                              while (true) {
                                if ((i_627 >= 5)) {
                                  break;
                                };
                                if ((i_627 == numSpheres)) {
                                  break;
                                };
                                lowp float t_hit_628;
                                t_hit_628 = t_hit_624;
                                bool tmpvar_629;
                                lowp vec3 tmpvar_630;
                                tmpvar_630 = (sphereCenters[i_627] - ray_origin_622);
                                lowp float tmpvar_631;
                                tmpvar_631 = dot (tmpvar_630, ray_direction_623);
                                if ((tmpvar_631 < 0.0)) {
                                  tmpvar_629 = bool(0);
                                } else {
                                  lowp float tmpvar_632;
                                  tmpvar_632 = (dot (tmpvar_630, tmpvar_630) - (tmpvar_631 * tmpvar_631));
                                  if ((tmpvar_632 > 0.64)) {
                                    tmpvar_629 = bool(0);
                                  } else {
                                    lowp float tmpvar_633;
                                    tmpvar_633 = sqrt((0.64 - tmpvar_632));
                                    lowp float tmpvar_634;
                                    tmpvar_634 = (tmpvar_631 - tmpvar_633);
                                    lowp float tmpvar_635;
                                    tmpvar_635 = (tmpvar_631 + tmpvar_633);
                                    lowp float tmpvar_636;
                                    if ((tmpvar_634 < 0.01)) {
                                      tmpvar_636 = tmpvar_635;
                                    } else {
                                      tmpvar_636 = tmpvar_634;
                                    };
                                    if (((tmpvar_636 < t_hit_624) && (tmpvar_636 > 0.01))) {
                                      t_hit_628 = tmpvar_636;
                                      tmpvar_629 = bool(1);
                                    } else {
                                      tmpvar_629 = bool(0);
                                    };
                                  };
                                };
                                t_hit_624 = t_hit_628;
                                if (tmpvar_629) {
                                  tmpvar_625 = bool(1);
                                  break;
                                };
                                i_627++;
                              };
                              if (!(tmpvar_625)) {
                                i_626 = 0;
                                while (true) {
                                  if ((i_626 >= 6)) {
                                    break;
                                  };
                                  if ((i_626 == numPlanes)) {
                                    break;
                                  };
                                  vec3 normal_637;
                                  normal_637 = planeNormals[i_626];
                                  lowp float t_hit_638;
                                  t_hit_638 = t_hit_624;
                                  bool tmpvar_639;
                                  tmpvar_639 = bool(1);
                                  bool tmpvar_640;
                                  vec3 tmpvar_641;
                                  tmpvar_641 = (normal_637 * planeOffsets[i_626]);
                                  lowp float tmpvar_642;
                                  tmpvar_642 = (((
                                    (tmpvar_641.x + tmpvar_641.y)
                                   + tmpvar_641.z) - dot (normal_637, ray_origin_622)) / dot (normal_637, ray_direction_623));
                                  if (((tmpvar_642 < t_hit_624) && (tmpvar_642 > 0.01))) {
                                    t_hit_638 = tmpvar_642;
                                    tmpvar_640 = bool(1);
                                    tmpvar_639 = bool(0);
                                  };
                                  if (tmpvar_639) {
                                    tmpvar_640 = bool(0);
                                    tmpvar_639 = bool(0);
                                  };
                                  t_hit_624 = t_hit_638;
                                  if (tmpvar_640) {
                                    tmpvar_625 = bool(1);
                                    break;
                                  };
                                  i_626++;
                                };
                                if (!(tmpvar_625)) {
                                  tmpvar_625 = bool(1);
                                };
                              };
                              lowp float tmpvar_643;
                              tmpvar_643 = abs((t_hit_624 - tmpvar_617));
                              if ((tmpvar_643 < 0.001)) {
                                lowp vec3 tmpvar_644;
                                lowp float tmpvar_645;
                                tmpvar_645 = dot (normal_596, tmpvar_619);
                                if ((tmpvar_645 > 0.0)) {
                                  tmpvar_644 = (incident_intensity_612 * ((diffuseColor_597 * 
                                    max (0.0, dot (normal_596, tmpvar_619))
                                  ) + (specularColor_598 * 
                                    pow (max (0.0, dot ((
                                      -(tmpvar_619)
                                     - 
                                      ((2.0 * dot (-(tmpvar_619), normal_596)) * normal_596)
                                    ), -(ray_dir_595))), 32.0)
                                  )));
                                } else {
                                  tmpvar_644 = vec3(0.0, 0.0, 0.0);
                                };
                                light_sum_603 = (light_sum_603 + tmpvar_644);
                              };
                            };
                            k_601++;
                          };
                          illuminationColor_600 = (illuminationColor_600 + (light_sum_603 / float(tmpvar_609)));
                          i_599++;
                        };
                        tmpvar_593 = (tmpvar_535 * illuminationColor_600);
                      };
                      indirect_sampling_sum_524 = (indirect_sampling_sum_524 + tmpvar_593);
                      k_523++;
                    };
                    tmpvar_522 = (((2.0 * indirect_sampling_sum_524) / float(indirectSamples)) * diffuseColor_365);
                  };
                  mirror_sample_color_354 = (tmpvar_468 + tmpvar_522);
                } else {
                  mirror_sample_color_354 = (mirror_sample_color_354 + (ambientLight * diffuseColor_365));
                };
                reflectionSum_353 = (reflectionSum_353 + (mirror_sample_color_354 * reflectiveColor_351));
                origin_348 = position_363;
                rayDir_349 = tmpvar_359;
                reflectiveColor_351 = (reflectiveColor_367 * reflectiveColor_351);
              };
              pixelColor_4 = (pixelColor_4 + reflectionSum_353);
            };
            pixelColor_4 = (mat3(0.59719, 0.076, 0.0284, 0.35458, 0.90834, 0.13383, 0.04823, 0.01566, 0.83777) * pixelColor_4);
            pixelColor_4 = (((pixelColor_4 * 
              (pixelColor_4 + 0.0245786)
            ) - 9.0537e-05) / ((pixelColor_4 * 
              ((0.983729 * pixelColor_4) + 0.432951)
            ) + 0.238081));
            pixelColor_4 = (mat3(1.60475, -0.10208, -0.00327, -0.53108, 1.10813, -0.07276, -0.07367, -0.00605, 1.07602) * pixelColor_4);
            lowp vec3 tmpvar_646;
            tmpvar_646 = clamp (pixelColor_4, 0.0, 1.0);
            pixelColor_4 = tmpvar_646;
            lowp vec4 tmpvar_647;
            tmpvar_647.w = 1.0;
            tmpvar_647.xyz = pow (tmpvar_646, vec3(0.45, 0.45, 0.45));
            fragColor = tmpvar_647;
          }
        </script>
        <script id="fragment-shader-fast" type="x-shader/x-vertex">#version 300 es
          precision mediump float;
          float randomIncrement;
          uniform float randomseed;
          uniform highp int numLights;
          uniform vec3 lightPos[2];
          uniform vec2 lightSize[2];
          uniform vec3 lightIntensity[2];
          uniform vec2 lightSpot[2];
          uniform highp int shadowSamples;
          uniform float shadowDim;
          uniform vec2 attenuation;
          uniform highp int numSpheres;
          uniform vec3 sphereCenters[5];
          uniform vec3 sphereColors[5];
          uniform vec3 reflectiveColors[5];
          uniform highp int numPlanes;
          uniform float planeOffsets[6];
          uniform vec3 planeNormals[6];
          uniform vec3 planeColors[6];
          uniform highp int rayBounces;
          uniform vec3 ambientLight;
          uniform bool enableGI;
          uniform bool enableRefGI;
          uniform highp int indirectSamples;
          uniform bool enablePlaneBacksides;
          uniform bool enablePlaneMirrors;
          in lowp vec3 origin;
          in lowp vec3 ray;
          out lowp vec4 fragColor;
          void main ()
          {
            vec3 reflectiveColor_1;
            vec3 specularColor_2;
            vec3 diffuseColor_3;
            lowp vec3 pixelColor_4;
            lowp vec3 tmpvar_5;
            tmpvar_5 = normalize(ray);
            randomIncrement = randomseed;
            lowp vec3 ray_origin_6;
            ray_origin_6 = origin;
            lowp vec3 ray_direction_7;
            ray_direction_7 = tmpvar_5;
            lowp float t_hit_8;
            t_hit_8 = sqrt(dot (ray, ray));
            lowp vec3 position_9;
            lowp vec3 normal_10;
            vec3 diffuseColor_11;
            diffuseColor_11 = diffuseColor_3;
            vec3 specularColor_12;
            specularColor_12 = specularColor_2;
            vec3 reflectiveColor_13;
            reflectiveColor_13 = reflectiveColor_1;
            bool isLight_14;
            isLight_14 = bool(0);
            highp int i_15;
            highp int i_16;
            highp int i_17;
            highp int idx_18;
            highp int intersected_19;
            intersected_19 = 0;
            idx_18 = 0;
            i_17 = 0;
            if ((0 < numSpheres)) {
              lowp float t_hit_20;
              t_hit_20 = t_hit_8;
              bool tmpvar_21;
              lowp vec3 tmpvar_22;
              tmpvar_22 = (sphereCenters[0] - origin);
              lowp float tmpvar_23;
              tmpvar_23 = dot (tmpvar_22, tmpvar_5);
              if ((tmpvar_23 < 0.0)) {
                tmpvar_21 = bool(0);
              } else {
                lowp float tmpvar_24;
                tmpvar_24 = (dot (tmpvar_22, tmpvar_22) - (tmpvar_23 * tmpvar_23));
                if ((tmpvar_24 > 0.64)) {
                  tmpvar_21 = bool(0);
                } else {
                  lowp float tmpvar_25;
                  tmpvar_25 = sqrt((0.64 - tmpvar_24));
                  lowp float tmpvar_26;
                  tmpvar_26 = (tmpvar_23 - tmpvar_25);
                  lowp float tmpvar_27;
                  tmpvar_27 = (tmpvar_23 + tmpvar_25);
                  lowp float tmpvar_28;
                  if ((tmpvar_26 < 0.0)) {
                    tmpvar_28 = tmpvar_27;
                  } else {
                    tmpvar_28 = tmpvar_26;
                  };
                  if (((tmpvar_28 < t_hit_8) && (tmpvar_28 > 0.0))) {
                    t_hit_20 = tmpvar_28;
                    tmpvar_21 = bool(1);
                  } else {
                    tmpvar_21 = bool(0);
                  };
                };
              };
              t_hit_8 = t_hit_20;
              if (tmpvar_21) {
                idx_18 = i_17;
                intersected_19 = 1;
              };
              i_17 = 1;
              if ((1 < numSpheres)) {
                lowp float t_hit_29;
                t_hit_29 = t_hit_20;
                bool tmpvar_30;
                lowp vec3 tmpvar_31;
                tmpvar_31 = (sphereCenters[1] - origin);
                lowp float tmpvar_32;
                tmpvar_32 = dot (tmpvar_31, tmpvar_5);
                if ((tmpvar_32 < 0.0)) {
                  tmpvar_30 = bool(0);
                } else {
                  lowp float tmpvar_33;
                  tmpvar_33 = (dot (tmpvar_31, tmpvar_31) - (tmpvar_32 * tmpvar_32));
                  if ((tmpvar_33 > 0.64)) {
                    tmpvar_30 = bool(0);
                  } else {
                    lowp float tmpvar_34;
                    tmpvar_34 = sqrt((0.64 - tmpvar_33));
                    lowp float tmpvar_35;
                    tmpvar_35 = (tmpvar_32 - tmpvar_34);
                    lowp float tmpvar_36;
                    tmpvar_36 = (tmpvar_32 + tmpvar_34);
                    lowp float tmpvar_37;
                    if ((tmpvar_35 < 0.0)) {
                      tmpvar_37 = tmpvar_36;
                    } else {
                      tmpvar_37 = tmpvar_35;
                    };
                    if (((tmpvar_37 < t_hit_20) && (tmpvar_37 > 0.0))) {
                      t_hit_29 = tmpvar_37;
                      tmpvar_30 = bool(1);
                    } else {
                      tmpvar_30 = bool(0);
                    };
                  };
                };
                t_hit_8 = t_hit_29;
                if (tmpvar_30) {
                  idx_18 = i_17;
                  intersected_19 = 1;
                };
                i_17 = 2;
                if ((2 < numSpheres)) {
                  lowp float t_hit_38;
                  t_hit_38 = t_hit_29;
                  bool tmpvar_39;
                  lowp vec3 tmpvar_40;
                  tmpvar_40 = (sphereCenters[2] - origin);
                  lowp float tmpvar_41;
                  tmpvar_41 = dot (tmpvar_40, tmpvar_5);
                  if ((tmpvar_41 < 0.0)) {
                    tmpvar_39 = bool(0);
                  } else {
                    lowp float tmpvar_42;
                    tmpvar_42 = (dot (tmpvar_40, tmpvar_40) - (tmpvar_41 * tmpvar_41));
                    if ((tmpvar_42 > 0.64)) {
                      tmpvar_39 = bool(0);
                    } else {
                      lowp float tmpvar_43;
                      tmpvar_43 = sqrt((0.64 - tmpvar_42));
                      lowp float tmpvar_44;
                      tmpvar_44 = (tmpvar_41 - tmpvar_43);
                      lowp float tmpvar_45;
                      tmpvar_45 = (tmpvar_41 + tmpvar_43);
                      lowp float tmpvar_46;
                      if ((tmpvar_44 < 0.0)) {
                        tmpvar_46 = tmpvar_45;
                      } else {
                        tmpvar_46 = tmpvar_44;
                      };
                      if (((tmpvar_46 < t_hit_29) && (tmpvar_46 > 0.0))) {
                        t_hit_38 = tmpvar_46;
                        tmpvar_39 = bool(1);
                      } else {
                        tmpvar_39 = bool(0);
                      };
                    };
                  };
                  t_hit_8 = t_hit_38;
                  if (tmpvar_39) {
                    idx_18 = i_17;
                    intersected_19 = 1;
                  };
                  i_17 = 3;
                  if ((3 < numSpheres)) {
                    lowp float t_hit_47;
                    t_hit_47 = t_hit_38;
                    bool tmpvar_48;
                    lowp vec3 tmpvar_49;
                    tmpvar_49 = (sphereCenters[3] - origin);
                    lowp float tmpvar_50;
                    tmpvar_50 = dot (tmpvar_49, tmpvar_5);
                    if ((tmpvar_50 < 0.0)) {
                      tmpvar_48 = bool(0);
                    } else {
                      lowp float tmpvar_51;
                      tmpvar_51 = (dot (tmpvar_49, tmpvar_49) - (tmpvar_50 * tmpvar_50));
                      if ((tmpvar_51 > 0.64)) {
                        tmpvar_48 = bool(0);
                      } else {
                        lowp float tmpvar_52;
                        tmpvar_52 = sqrt((0.64 - tmpvar_51));
                        lowp float tmpvar_53;
                        tmpvar_53 = (tmpvar_50 - tmpvar_52);
                        lowp float tmpvar_54;
                        tmpvar_54 = (tmpvar_50 + tmpvar_52);
                        lowp float tmpvar_55;
                        if ((tmpvar_53 < 0.0)) {
                          tmpvar_55 = tmpvar_54;
                        } else {
                          tmpvar_55 = tmpvar_53;
                        };
                        if (((tmpvar_55 < t_hit_38) && (tmpvar_55 > 0.0))) {
                          t_hit_47 = tmpvar_55;
                          tmpvar_48 = bool(1);
                        } else {
                          tmpvar_48 = bool(0);
                        };
                      };
                    };
                    t_hit_8 = t_hit_47;
                    if (tmpvar_48) {
                      idx_18 = i_17;
                      intersected_19 = 1;
                    };
                    i_17 = 4;
                    if ((4 < numSpheres)) {
                      lowp float t_hit_56;
                      t_hit_56 = t_hit_47;
                      bool tmpvar_57;
                      lowp vec3 tmpvar_58;
                      tmpvar_58 = (sphereCenters[4] - origin);
                      lowp float tmpvar_59;
                      tmpvar_59 = dot (tmpvar_58, tmpvar_5);
                      if ((tmpvar_59 < 0.0)) {
                        tmpvar_57 = bool(0);
                      } else {
                        lowp float tmpvar_60;
                        tmpvar_60 = (dot (tmpvar_58, tmpvar_58) - (tmpvar_59 * tmpvar_59));
                        if ((tmpvar_60 > 0.64)) {
                          tmpvar_57 = bool(0);
                        } else {
                          lowp float tmpvar_61;
                          tmpvar_61 = sqrt((0.64 - tmpvar_60));
                          lowp float tmpvar_62;
                          tmpvar_62 = (tmpvar_59 - tmpvar_61);
                          lowp float tmpvar_63;
                          tmpvar_63 = (tmpvar_59 + tmpvar_61);
                          lowp float tmpvar_64;
                          if ((tmpvar_62 < 0.0)) {
                            tmpvar_64 = tmpvar_63;
                          } else {
                            tmpvar_64 = tmpvar_62;
                          };
                          if (((tmpvar_64 < t_hit_47) && (tmpvar_64 > 0.0))) {
                            t_hit_56 = tmpvar_64;
                            tmpvar_57 = bool(1);
                          } else {
                            tmpvar_57 = bool(0);
                          };
                        };
                      };
                      t_hit_8 = t_hit_56;
                      if (tmpvar_57) {
                        idx_18 = i_17;
                        intersected_19 = 1;
                      };
                      i_17 = 5;
                    };
                  };
                };
              };
            };
            i_16 = 0;
            while (true) {
              bool tmp_65;
              if ((i_16 >= 6)) {
                break;
              };
              if ((i_16 >= numPlanes)) {
                break;
              };
              lowp vec3 tmpvar_66;
              tmpvar_66 = planeNormals[i_16];
              tmp_65 = bool(0);
              bool tmpvar_67;
              if (enablePlaneBacksides) {
                tmpvar_67 = bool(1);
              } else {
                tmpvar_67 = (dot (ray_direction_7, tmpvar_66) < 0.0);
              };
              if (tmpvar_67) {
                lowp float t_hit_68;
                t_hit_68 = t_hit_8;
                bool tmpvar_69;
                tmpvar_69 = bool(1);
                bool tmpvar_70;
                lowp vec3 tmpvar_71;
                tmpvar_71 = (tmpvar_66 * planeOffsets[i_16]);
                lowp float tmpvar_72;
                tmpvar_72 = (((
                  (tmpvar_71.x + tmpvar_71.y)
                 + tmpvar_71.z) - dot (tmpvar_66, ray_origin_6)) / dot (tmpvar_66, ray_direction_7));
                if (((tmpvar_72 < t_hit_8) && (tmpvar_72 > 0.0))) {
                  t_hit_68 = tmpvar_72;
                  tmpvar_70 = bool(1);
                  tmpvar_69 = bool(0);
                };
                if (tmpvar_69) {
                  tmpvar_70 = bool(0);
                  tmpvar_69 = bool(0);
                };
                t_hit_8 = t_hit_68;
                tmp_65 = tmpvar_70;
              };
              if (tmp_65) {
                normal_10 = tmpvar_66;
                idx_18 = i_16;
                intersected_19 = 2;
              };
              i_16++;
            };
            i_15 = 0;
            bool tmp_73;
            if ((0 < numLights)) {
              vec3 tmpvar_74;
              tmpvar_74 = lightPos[0];
              vec2 tmpvar_75;
              tmpvar_75 = lightSize[0];
              tmp_73 = bool(0);
              if (((tmpvar_75.x > 0.0) && (tmpvar_75.y > 0.0))) {
                lowp float t_hit_76;
                t_hit_76 = t_hit_8;
                bool tmpvar_77;
                tmpvar_77 = bool(1);
                bool tmpvar_78;
                vec3 tmpvar_79;
                tmpvar_79 = (vec3(0.0, 1.0, 0.0) * tmpvar_74.y);
                lowp float tmpvar_80;
                tmpvar_80 = (((
                  (tmpvar_79.x + tmpvar_79.y)
                 + tmpvar_79.z) - origin.y) / tmpvar_5.y);
                if (((tmpvar_80 < t_hit_8) && (tmpvar_80 > 0.0))) {
                  lowp vec3 tmpvar_81;
                  tmpvar_81 = (origin + (tmpvar_5 * tmpvar_80));
                  float tmpvar_82;
                  tmpvar_82 = sqrt(dot (tmpvar_75, tmpvar_75));
                  if (((tmpvar_82 == 0.0) || ((
                    ((tmpvar_81.x < (tmpvar_74.x + (tmpvar_75.x * 0.5))) && (tmpvar_81.x > (tmpvar_74.x - (tmpvar_75.x * 0.5))))
                   && 
                    (tmpvar_81.z < (tmpvar_74.z + (tmpvar_75.y * 0.5)))
                  ) && (tmpvar_81.z > 
                    (tmpvar_74.z - (tmpvar_75.y * 0.5))
                  )))) {
                    t_hit_76 = tmpvar_80;
                    tmpvar_78 = bool(1);
                    tmpvar_77 = bool(0);
                  };
                };
                if (tmpvar_77) {
                  tmpvar_78 = bool(0);
                  tmpvar_77 = bool(0);
                };
                t_hit_8 = t_hit_76;
                tmp_73 = tmpvar_78;
              } else {
                lowp float t_hit_83;
                t_hit_83 = t_hit_8;
                bool tmpvar_84;
                lowp vec3 tmpvar_85;
                tmpvar_85 = (tmpvar_74 - origin);
                lowp float tmpvar_86;
                tmpvar_86 = dot (tmpvar_85, tmpvar_5);
                if ((tmpvar_86 < 0.0)) {
                  tmpvar_84 = bool(0);
                } else {
                  lowp float tmpvar_87;
                  tmpvar_87 = (dot (tmpvar_85, tmpvar_85) - (tmpvar_86 * tmpvar_86));
                  if ((tmpvar_87 > 0.01)) {
                    tmpvar_84 = bool(0);
                  } else {
                    lowp float tmpvar_88;
                    tmpvar_88 = sqrt((0.01 - tmpvar_87));
                    lowp float tmpvar_89;
                    tmpvar_89 = (tmpvar_86 - tmpvar_88);
                    lowp float tmpvar_90;
                    tmpvar_90 = (tmpvar_86 + tmpvar_88);
                    lowp float tmpvar_91;
                    if ((tmpvar_89 < 0.0)) {
                      tmpvar_91 = tmpvar_90;
                    } else {
                      tmpvar_91 = tmpvar_89;
                    };
                    if (((tmpvar_91 < t_hit_8) && (tmpvar_91 > 0.0))) {
                      t_hit_83 = tmpvar_91;
                      tmpvar_84 = bool(1);
                    } else {
                      tmpvar_84 = bool(0);
                    };
                  };
                };
                t_hit_8 = t_hit_83;
                tmp_73 = tmpvar_84;
              };
              if (tmp_73) {
                idx_18 = i_15;
                intersected_19 = 3;
              };
              i_15 = 1;
              bool tmp_92;
              if ((1 < numLights)) {
                vec3 tmpvar_93;
                tmpvar_93 = lightPos[1];
                vec2 tmpvar_94;
                tmpvar_94 = lightSize[1];
                tmp_92 = bool(0);
                if (((tmpvar_94.x > 0.0) && (tmpvar_94.y > 0.0))) {
                  lowp float t_hit_95;
                  t_hit_95 = t_hit_8;
                  bool tmpvar_96;
                  tmpvar_96 = bool(1);
                  bool tmpvar_97;
                  vec3 tmpvar_98;
                  tmpvar_98 = (vec3(0.0, 1.0, 0.0) * tmpvar_93.y);
                  lowp float tmpvar_99;
                  tmpvar_99 = (((
                    (tmpvar_98.x + tmpvar_98.y)
                   + tmpvar_98.z) - origin.y) / tmpvar_5.y);
                  if (((tmpvar_99 < t_hit_8) && (tmpvar_99 > 0.0))) {
                    lowp vec3 tmpvar_100;
                    tmpvar_100 = (origin + (tmpvar_5 * tmpvar_99));
                    float tmpvar_101;
                    tmpvar_101 = sqrt(dot (tmpvar_94, tmpvar_94));
                    if (((tmpvar_101 == 0.0) || ((
                      ((tmpvar_100.x < (tmpvar_93.x + (tmpvar_94.x * 0.5))) && (tmpvar_100.x > (tmpvar_93.x - (tmpvar_94.x * 0.5))))
                     && 
                      (tmpvar_100.z < (tmpvar_93.z + (tmpvar_94.y * 0.5)))
                    ) && (tmpvar_100.z > 
                      (tmpvar_93.z - (tmpvar_94.y * 0.5))
                    )))) {
                      t_hit_95 = tmpvar_99;
                      tmpvar_97 = bool(1);
                      tmpvar_96 = bool(0);
                    };
                  };
                  if (tmpvar_96) {
                    tmpvar_97 = bool(0);
                    tmpvar_96 = bool(0);
                  };
                  t_hit_8 = t_hit_95;
                  tmp_92 = tmpvar_97;
                } else {
                  lowp float t_hit_102;
                  t_hit_102 = t_hit_8;
                  bool tmpvar_103;
                  lowp vec3 tmpvar_104;
                  tmpvar_104 = (tmpvar_93 - origin);
                  lowp float tmpvar_105;
                  tmpvar_105 = dot (tmpvar_104, tmpvar_5);
                  if ((tmpvar_105 < 0.0)) {
                    tmpvar_103 = bool(0);
                  } else {
                    lowp float tmpvar_106;
                    tmpvar_106 = (dot (tmpvar_104, tmpvar_104) - (tmpvar_105 * tmpvar_105));
                    if ((tmpvar_106 > 0.01)) {
                      tmpvar_103 = bool(0);
                    } else {
                      lowp float tmpvar_107;
                      tmpvar_107 = sqrt((0.01 - tmpvar_106));
                      lowp float tmpvar_108;
                      tmpvar_108 = (tmpvar_105 - tmpvar_107);
                      lowp float tmpvar_109;
                      tmpvar_109 = (tmpvar_105 + tmpvar_107);
                      lowp float tmpvar_110;
                      if ((tmpvar_108 < 0.0)) {
                        tmpvar_110 = tmpvar_109;
                      } else {
                        tmpvar_110 = tmpvar_108;
                      };
                      if (((tmpvar_110 < t_hit_8) && (tmpvar_110 > 0.0))) {
                        t_hit_102 = tmpvar_110;
                        tmpvar_103 = bool(1);
                      } else {
                        tmpvar_103 = bool(0);
                      };
                    };
                  };
                  t_hit_8 = t_hit_102;
                  tmp_92 = tmpvar_103;
                };
                if (tmp_92) {
                  idx_18 = i_15;
                  intersected_19 = 3;
                };
                i_15 = 2;
              };
            };
            position_9 = (origin + (tmpvar_5 * t_hit_8));
            if ((intersected_19 == 1)) {
              diffuseColor_11 = sphereColors[idx_18];
              specularColor_12 = vec3(1.0, 1.0, 1.0);
              reflectiveColor_13 = reflectiveColors[idx_18];
              lowp vec3 tmpvar_111;
              tmpvar_111 = normalize((position_9 - sphereCenters[idx_18]));
              normal_10 = tmpvar_111;
              lowp float tmpvar_112;
              tmpvar_112 = dot (tmpvar_111, -(tmpvar_5));
              if ((tmpvar_112 < 0.0)) {
                normal_10 = -(tmpvar_111);
              };
            } else {
              if ((intersected_19 == 2)) {
                if (enablePlaneMirrors) {
                  diffuseColor_11 = (planeColors[idx_18] * 0.01);
                  specularColor_12 = vec3(0.0, 0.0, 0.0);
                  reflectiveColor_13 = planeColors[idx_18];
                } else {
                  diffuseColor_11 = planeColors[idx_18];
                  specularColor_12 = vec3(0.5, 0.5, 0.5);
                  reflectiveColor_13 = vec3(0.0, 0.0, 0.0);
                };
                lowp float tmpvar_113;
                tmpvar_113 = dot (normal_10, -(tmpvar_5));
                if ((tmpvar_113 < 0.0)) {
                  normal_10 = -(normal_10);
                };
              } else {
                if ((intersected_19 == 3)) {
                  diffuseColor_11 = (lightIntensity[idx_18] / 25.0);
                  isLight_14 = bool(1);
                };
              };
            };
            diffuseColor_3 = diffuseColor_11;
            specularColor_2 = specularColor_12;
            reflectiveColor_1 = reflectiveColor_13;
            if (isLight_14) {
              lowp vec4 tmpvar_114;
              tmpvar_114.w = 1.0;
              tmpvar_114.xyz = diffuseColor_11;
              fragColor = tmpvar_114;
              return;
            };
            if (!(enableGI)) {
              pixelColor_4 = (pixelColor_4 + (ambientLight * diffuseColor_11));
            };
            lowp vec3 point_115;
            point_115 = position_9;
            lowp vec3 ray_dir_116;
            ray_dir_116 = tmpvar_5;
            lowp vec3 normal_117;
            normal_117 = normal_10;
            vec3 diffuseColor_118;
            diffuseColor_118 = diffuseColor_11;
            vec3 specularColor_119;
            specularColor_119 = specularColor_12;
            highp int i_120;
            lowp vec3 illuminationColor_121;
            i_120 = 0;
            while (true) {
              highp int k_122;
              bool inShade_123;
              highp int areaShadowSamples_124;
              bool isAreaLight_125;
              lowp vec3 light_sum_126;
              vec2 lightSpot_127;
              vec2 lightSize_128;
              vec3 lightIntensity_129;
              vec3 lightPos_130;
              if ((i_120 >= 2)) {
                break;
              };
              if ((i_120 == numLights)) {
                break;
              };
              lightPos_130 = lightPos[i_120];
              lightIntensity_129 = lightIntensity[i_120];
              vec2 tmpvar_131;
              tmpvar_131 = lightSize[i_120];
              lightSize_128 = tmpvar_131;
              lightSpot_127 = lightSpot[i_120];
              isAreaLight_125 = ((tmpvar_131.x > 0.0) && (tmpvar_131.y > 0.0));
              areaShadowSamples_124 = 0;
              inShade_123 = bool(0);
              k_122 = 0;
              while (true) {
                vec3 testPos_132;
                if ((k_122 >= 5)) {
                  break;
                };
                if (inShade_123) {
                  break;
                };
                if (((k_122 == 1) && !(isAreaLight_125))) {
                  break;
                };
                testPos_132 = lightPos_130;
                if ((k_122 == 1)) {
                  testPos_132.x = (lightPos_130.x - (lightSize_128.x * 0.5));
                  testPos_132.z = (lightPos_130.z - (lightSize_128.y * 0.5));
                } else {
                  if ((k_122 == 2)) {
                    testPos_132.x = (testPos_132.x + (lightSize_128.x * 0.5));
                    testPos_132.z = (testPos_132.z + (lightSize_128.y * 0.5));
                  } else {
                    if ((k_122 == 3)) {
                      testPos_132.x = (testPos_132.x + (lightSize_128.x * 0.5));
                      testPos_132.z = (testPos_132.z - (lightSize_128.y * 0.5));
                    } else {
                      if ((k_122 == 4)) {
                        testPos_132.x = (testPos_132.x - (lightSize_128.x * 0.5));
                        testPos_132.z = (testPos_132.z + (lightSize_128.y * 0.5));
                      };
                    };
                  };
                };
                lowp vec3 vec_to_light_133;
                lowp vec3 incident_intensity_134;
                lowp float spot_falloff_135;
                vec_to_light_133 = (testPos_132 - point_115);
                lowp float tmpvar_136;
                tmpvar_136 = sqrt(dot (vec_to_light_133, vec_to_light_133));
                lowp float tmpvar_137;
                tmpvar_137 = (1.0/(((attenuation.x * 
                  (tmpvar_136 * tmpvar_136)
                ) + (attenuation.y * tmpvar_136))));
                lowp vec3 tmpvar_138;
                tmpvar_138 = normalize(vec_to_light_133);
                vec_to_light_133 = tmpvar_138;
                spot_falloff_135 = 1.0;
                if ((lightSpot_127.x > 0.0)) {
                  lowp float tmpvar_139;
                  if ((tmpvar_138.y > lightSpot_127.x)) {
                    tmpvar_139 = pow (tmpvar_138.y, lightSpot_127.y);
                  } else {
                    tmpvar_139 = 0.0;
                  };
                  spot_falloff_135 = tmpvar_139;
                };
                incident_intensity_134 = ((lightIntensity_129 * tmpvar_137) * spot_falloff_135);
                lowp float tmpvar_140;
                tmpvar_140 = sqrt(dot (incident_intensity_134, incident_intensity_134));
                if ((tmpvar_140 > 0.01)) {
                  lowp vec3 ray_origin_141;
                  ray_origin_141 = point_115;
                  lowp vec3 ray_direction_142;
                  ray_direction_142 = tmpvar_138;
                  lowp float t_hit_143;
                  t_hit_143 = tmpvar_136;
                  bool tmpvar_144;
                  tmpvar_144 = bool(0);
                  highp int i_145;
                  highp int i_146;
                  i_146 = 0;
                  while (true) {
                    if ((i_146 >= 5)) {
                      break;
                    };
                    if ((i_146 == numSpheres)) {
                      break;
                    };
                    lowp float t_hit_147;
                    t_hit_147 = t_hit_143;
                    bool tmpvar_148;
                    lowp vec3 tmpvar_149;
                    tmpvar_149 = (sphereCenters[i_146] - ray_origin_141);
                    lowp float tmpvar_150;
                    tmpvar_150 = dot (tmpvar_149, ray_direction_142);
                    if ((tmpvar_150 < 0.0)) {
                      tmpvar_148 = bool(0);
                    } else {
                      lowp float tmpvar_151;
                      tmpvar_151 = (dot (tmpvar_149, tmpvar_149) - (tmpvar_150 * tmpvar_150));
                      if ((tmpvar_151 > 0.64)) {
                        tmpvar_148 = bool(0);
                      } else {
                        lowp float tmpvar_152;
                        tmpvar_152 = sqrt((0.64 - tmpvar_151));
                        lowp float tmpvar_153;
                        tmpvar_153 = (tmpvar_150 - tmpvar_152);
                        lowp float tmpvar_154;
                        tmpvar_154 = (tmpvar_150 + tmpvar_152);
                        lowp float tmpvar_155;
                        if ((tmpvar_153 < 0.01)) {
                          tmpvar_155 = tmpvar_154;
                        } else {
                          tmpvar_155 = tmpvar_153;
                        };
                        if (((tmpvar_155 < t_hit_143) && (tmpvar_155 > 0.01))) {
                          t_hit_147 = tmpvar_155;
                          tmpvar_148 = bool(1);
                        } else {
                          tmpvar_148 = bool(0);
                        };
                      };
                    };
                    t_hit_143 = t_hit_147;
                    if (tmpvar_148) {
                      tmpvar_144 = bool(1);
                      break;
                    };
                    i_146++;
                  };
                  if (!(tmpvar_144)) {
                    i_145 = 0;
                    while (true) {
                      if ((i_145 >= 6)) {
                        break;
                      };
                      if ((i_145 == numPlanes)) {
                        break;
                      };
                      vec3 normal_156;
                      normal_156 = planeNormals[i_145];
                      lowp float t_hit_157;
                      t_hit_157 = t_hit_143;
                      bool tmpvar_158;
                      tmpvar_158 = bool(1);
                      bool tmpvar_159;
                      vec3 tmpvar_160;
                      tmpvar_160 = (normal_156 * planeOffsets[i_145]);
                      lowp float tmpvar_161;
                      tmpvar_161 = (((
                        (tmpvar_160.x + tmpvar_160.y)
                       + tmpvar_160.z) - dot (normal_156, ray_origin_141)) / dot (normal_156, ray_direction_142));
                      if (((tmpvar_161 < t_hit_143) && (tmpvar_161 > 0.01))) {
                        t_hit_157 = tmpvar_161;
                        tmpvar_159 = bool(1);
                        tmpvar_158 = bool(0);
                      };
                      if (tmpvar_158) {
                        tmpvar_159 = bool(0);
                        tmpvar_158 = bool(0);
                      };
                      t_hit_143 = t_hit_157;
                      if (tmpvar_159) {
                        tmpvar_144 = bool(1);
                        break;
                      };
                      i_145++;
                    };
                    if (!(tmpvar_144)) {
                      tmpvar_144 = bool(1);
                    };
                  };
                  lowp float tmpvar_162;
                  tmpvar_162 = abs((t_hit_143 - tmpvar_136));
                  if ((tmpvar_162 < 0.001)) {
                    lowp vec3 tmpvar_163;
                    lowp float tmpvar_164;
                    tmpvar_164 = dot (normal_117, tmpvar_138);
                    if ((tmpvar_164 > 0.0)) {
                      tmpvar_163 = (incident_intensity_134 * ((diffuseColor_118 * 
                        max (0.0, dot (normal_117, tmpvar_138))
                      ) + (specularColor_119 * 
                        pow (max (0.0, dot ((
                          -(tmpvar_138)
                         - 
                          ((2.0 * dot (-(tmpvar_138), normal_117)) * normal_117)
                        ), -(ray_dir_116))), 32.0)
                      )));
                    } else {
                      tmpvar_163 = vec3(0.0, 0.0, 0.0);
                    };
                    light_sum_126 = (light_sum_126 + tmpvar_163);
                  } else {
                    inShade_123 = bool(1);
                  };
                } else {
                  inShade_123 = bool(1);
                };
                areaShadowSamples_124++;
                k_122++;
              };
              if ((isAreaLight_125 && inShade_123)) {
                highp int k_165;
                areaShadowSamples_124 = shadowSamples;
                light_sum_126 = vec3(0.0, 0.0, 0.0);
                k_165 = 0;
                while (true) {
                  lowp vec3 incident_intensity_166;
                  if ((k_165 >= 49)) {
                    break;
                  };
                  if ((k_165 == areaShadowSamples_124)) {
                    break;
                  };
                  float sample_i_167;
                  sample_i_167 = float(k_165);
                  lowp vec3 vec_to_light_168;
                  lowp float spot_falloff_169;
                  float tmpvar_170;
                  tmpvar_170 = (1.0/(shadowDim));
                  randomIncrement += 0.02;
                  lowp float tmpvar_171;
                  tmpvar_171 = ((lightSize_128.x * tmpvar_170) * ((float(mod (sample_i_167, shadowDim))) + fract(
                    (cos(dot ((point_115.xy + randomIncrement), vec2(23.14069, 2.665144))) * 12345.68)
                  )));
                  randomIncrement += 0.02;
                  lowp vec3 tmpvar_172;
                  tmpvar_172.x = ((lightPos_130.x - (lightSize_128.x * 0.5)) + tmpvar_171);
                  tmpvar_172.y = lightPos_130.y;
                  tmpvar_172.z = ((lightPos_130.z - (lightSize_128.y * 0.5)) + ((lightSize_128.y * tmpvar_170) * (
                    floor((sample_i_167 * tmpvar_170))
                   + 
                    fract((cos(dot (
                      (point_115.yx + randomIncrement)
                    , vec2(23.14069, 2.665144))) * 12345.68))
                  )));
                  vec_to_light_168 = (tmpvar_172 - point_115);
                  lowp float tmpvar_173;
                  tmpvar_173 = sqrt(dot (vec_to_light_168, vec_to_light_168));
                  lowp float tmpvar_174;
                  tmpvar_174 = (1.0/(((attenuation.x * 
                    (tmpvar_173 * tmpvar_173)
                  ) + (attenuation.y * tmpvar_173))));
                  lowp vec3 tmpvar_175;
                  tmpvar_175 = normalize(vec_to_light_168);
                  vec_to_light_168 = tmpvar_175;
                  spot_falloff_169 = 1.0;
                  if ((lightSpot_127.x > 0.0)) {
                    lowp float tmpvar_176;
                    if ((tmpvar_175.y > lightSpot_127.x)) {
                      tmpvar_176 = pow (tmpvar_175.y, lightSpot_127.y);
                    } else {
                      tmpvar_176 = 0.0;
                    };
                    spot_falloff_169 = tmpvar_176;
                  };
                  incident_intensity_166 = ((lightIntensity_129 * tmpvar_174) * spot_falloff_169);
                  lowp vec3 ray_origin_177;
                  ray_origin_177 = point_115;
                  lowp vec3 ray_direction_178;
                  ray_direction_178 = tmpvar_175;
                  lowp float t_hit_179;
                  t_hit_179 = tmpvar_173;
                  bool tmpvar_180;
                  tmpvar_180 = bool(0);
                  highp int i_181;
                  highp int i_182;
                  i_182 = 0;
                  while (true) {
                    if ((i_182 >= 5)) {
                      break;
                    };
                    if ((i_182 == numSpheres)) {
                      break;
                    };
                    lowp float t_hit_183;
                    t_hit_183 = t_hit_179;
                    bool tmpvar_184;
                    lowp vec3 tmpvar_185;
                    tmpvar_185 = (sphereCenters[i_182] - ray_origin_177);
                    lowp float tmpvar_186;
                    tmpvar_186 = dot (tmpvar_185, ray_direction_178);
                    if ((tmpvar_186 < 0.0)) {
                      tmpvar_184 = bool(0);
                    } else {
                      lowp float tmpvar_187;
                      tmpvar_187 = (dot (tmpvar_185, tmpvar_185) - (tmpvar_186 * tmpvar_186));
                      if ((tmpvar_187 > 0.64)) {
                        tmpvar_184 = bool(0);
                      } else {
                        lowp float tmpvar_188;
                        tmpvar_188 = sqrt((0.64 - tmpvar_187));
                        lowp float tmpvar_189;
                        tmpvar_189 = (tmpvar_186 - tmpvar_188);
                        lowp float tmpvar_190;
                        tmpvar_190 = (tmpvar_186 + tmpvar_188);
                        lowp float tmpvar_191;
                        if ((tmpvar_189 < 0.01)) {
                          tmpvar_191 = tmpvar_190;
                        } else {
                          tmpvar_191 = tmpvar_189;
                        };
                        if (((tmpvar_191 < t_hit_179) && (tmpvar_191 > 0.01))) {
                          t_hit_183 = tmpvar_191;
                          tmpvar_184 = bool(1);
                        } else {
                          tmpvar_184 = bool(0);
                        };
                      };
                    };
                    t_hit_179 = t_hit_183;
                    if (tmpvar_184) {
                      tmpvar_180 = bool(1);
                      break;
                    };
                    i_182++;
                  };
                  if (!(tmpvar_180)) {
                    i_181 = 0;
                    while (true) {
                      if ((i_181 >= 6)) {
                        break;
                      };
                      if ((i_181 == numPlanes)) {
                        break;
                      };
                      vec3 normal_192;
                      normal_192 = planeNormals[i_181];
                      lowp float t_hit_193;
                      t_hit_193 = t_hit_179;
                      bool tmpvar_194;
                      tmpvar_194 = bool(1);
                      bool tmpvar_195;
                      vec3 tmpvar_196;
                      tmpvar_196 = (normal_192 * planeOffsets[i_181]);
                      lowp float tmpvar_197;
                      tmpvar_197 = (((
                        (tmpvar_196.x + tmpvar_196.y)
                       + tmpvar_196.z) - dot (normal_192, ray_origin_177)) / dot (normal_192, ray_direction_178));
                      if (((tmpvar_197 < t_hit_179) && (tmpvar_197 > 0.01))) {
                        t_hit_193 = tmpvar_197;
                        tmpvar_195 = bool(1);
                        tmpvar_194 = bool(0);
                      };
                      if (tmpvar_194) {
                        tmpvar_195 = bool(0);
                        tmpvar_194 = bool(0);
                      };
                      t_hit_179 = t_hit_193;
                      if (tmpvar_195) {
                        tmpvar_180 = bool(1);
                        break;
                      };
                      i_181++;
                    };
                    if (!(tmpvar_180)) {
                      tmpvar_180 = bool(1);
                    };
                  };
                  lowp float tmpvar_198;
                  tmpvar_198 = abs((t_hit_179 - tmpvar_173));
                  if ((tmpvar_198 < 0.001)) {
                    lowp vec3 tmpvar_199;
                    lowp float tmpvar_200;
                    tmpvar_200 = dot (normal_117, tmpvar_175);
                    if ((tmpvar_200 > 0.0)) {
                      tmpvar_199 = (incident_intensity_166 * ((diffuseColor_118 * 
                        max (0.0, dot (normal_117, tmpvar_175))
                      ) + (specularColor_119 * 
                        pow (max (0.0, dot ((
                          -(tmpvar_175)
                         - 
                          ((2.0 * dot (-(tmpvar_175), normal_117)) * normal_117)
                        ), -(ray_dir_116))), 32.0)
                      )));
                    } else {
                      tmpvar_199 = vec3(0.0, 0.0, 0.0);
                    };
                    light_sum_126 = (light_sum_126 + tmpvar_199);
                  };
                  k_165++;
                };
              };
              illuminationColor_121 = (illuminationColor_121 + (light_sum_126 / float(areaShadowSamples_124)));
              i_120++;
            };
            pixelColor_4 = (pixelColor_4 + illuminationColor_121);
            if (enableGI) {
              lowp vec3 point_201;
              point_201 = position_9;
              lowp vec3 tmpvar_202;
              highp int k_203;
              lowp vec3 indirect_sampling_sum_204;
              lowp mat3 transform_205;
              float tmpvar_206;
              tmpvar_206 = sqrt(dot (diffuseColor_11, diffuseColor_11));
              if ((tmpvar_206 == 0.0)) {
                tmpvar_202 = vec3(0.0, 0.0, 0.0);
              } else {
                lowp float tmpvar_207;
                tmpvar_207 = abs(normal_10.x);
                lowp float tmpvar_208;
                tmpvar_208 = abs(normal_10.y);
                if ((tmpvar_207 > tmpvar_208)) {
                  lowp vec3 tmpvar_209;
                  tmpvar_209.y = 0.0;
                  tmpvar_209.x = normal_10.z;
                  tmpvar_209.z = -(normal_10.x);
                  transform_205[2] = (tmpvar_209 / sqrt((
                    (normal_10.x * normal_10.x)
                   + 
                    (normal_10.z * normal_10.z)
                  )));
                } else {
                  lowp vec3 tmpvar_210;
                  tmpvar_210.x = 0.0;
                  tmpvar_210.y = -(normal_10.z);
                  tmpvar_210.z = normal_10.y;
                  transform_205[2] = (tmpvar_210 / sqrt((
                    (normal_10.y * normal_10.y)
                   + 
                    (normal_10.z * normal_10.z)
                  )));
                };
                lowp vec3 b_211;
                b_211 = transform_205[2];
                transform_205[0] = ((normal_10.yzx * b_211.zxy) - (normal_10.zxy * b_211.yzx));
                transform_205[1] = normal_10;
                k_203 = 0;
                while (true) {
                  vec3 indirectReflectiveColor_212;
                  vec3 indirectSpecularColor_213;
                  vec3 indirectDiffuseColor_214;
                  if ((k_203 >= 100)) {
                    break;
                  };
                  if ((k_203 >= indirectSamples)) {
                    break;
                  };
                  randomIncrement += 0.02;
                  lowp float tmpvar_215;
                  tmpvar_215 = fract((cos(
                    dot ((point_201.xy + randomIncrement), vec2(23.14069, 2.665144))
                  ) * 12345.68));
                  lowp float tmpvar_216;
                  tmpvar_216 = sqrt((1.0 - (tmpvar_215 * tmpvar_215)));
                  randomIncrement += 0.02;
                  lowp float tmpvar_217;
                  tmpvar_217 = (6.283186 * fract((
                    cos(dot ((point_201.yx + randomIncrement), vec2(23.14069, 2.665144)))
                   * 12345.68)));
                  lowp vec3 tmpvar_218;
                  tmpvar_218.x = (cos(tmpvar_217) * tmpvar_216);
                  tmpvar_218.y = tmpvar_215;
                  tmpvar_218.z = (sin(tmpvar_217) * tmpvar_216);
                  lowp vec3 tmpvar_219;
                  tmpvar_219 = (transform_205 * tmpvar_218);
                  lowp vec3 ray_origin_220;
                  ray_origin_220 = point_201;
                  lowp vec3 ray_direction_221;
                  ray_direction_221 = tmpvar_219;
                  lowp float t_hit_222;
                  t_hit_222 = 10.0;
                  lowp vec3 position_223;
                  lowp vec3 normal_224;
                  vec3 diffuseColor_225;
                  diffuseColor_225 = indirectDiffuseColor_214;
                  vec3 specularColor_226;
                  specularColor_226 = indirectSpecularColor_213;
                  vec3 reflectiveColor_227;
                  reflectiveColor_227 = indirectReflectiveColor_212;
                  bool isLight_228;
                  isLight_228 = bool(0);
                  highp int i_229;
                  highp int i_230;
                  highp int i_231;
                  highp int idx_232;
                  highp int intersected_233;
                  intersected_233 = 0;
                  idx_232 = 0;
                  i_231 = 0;
                  if ((0 < numSpheres)) {
                    lowp float t_hit_234;
                    t_hit_234 = t_hit_222;
                    bool tmpvar_235;
                    lowp vec3 tmpvar_236;
                    tmpvar_236 = (sphereCenters[0] - point_201);
                    lowp float tmpvar_237;
                    tmpvar_237 = dot (tmpvar_236, tmpvar_219);
                    if ((tmpvar_237 < 0.0)) {
                      tmpvar_235 = bool(0);
                    } else {
                      lowp float tmpvar_238;
                      tmpvar_238 = (dot (tmpvar_236, tmpvar_236) - (tmpvar_237 * tmpvar_237));
                      if ((tmpvar_238 > 0.64)) {
                        tmpvar_235 = bool(0);
                      } else {
                        lowp float tmpvar_239;
                        tmpvar_239 = sqrt((0.64 - tmpvar_238));
                        lowp float tmpvar_240;
                        tmpvar_240 = (tmpvar_237 - tmpvar_239);
                        lowp float tmpvar_241;
                        tmpvar_241 = (tmpvar_237 + tmpvar_239);
                        lowp float tmpvar_242;
                        if ((tmpvar_240 < 0.01)) {
                          tmpvar_242 = tmpvar_241;
                        } else {
                          tmpvar_242 = tmpvar_240;
                        };
                        if (((tmpvar_242 < 10.0) && (tmpvar_242 > 0.01))) {
                          t_hit_234 = tmpvar_242;
                          tmpvar_235 = bool(1);
                        } else {
                          tmpvar_235 = bool(0);
                        };
                      };
                    };
                    t_hit_222 = t_hit_234;
                    if (tmpvar_235) {
                      idx_232 = i_231;
                      intersected_233 = 1;
                    };
                    i_231 = 1;
                    if ((1 < numSpheres)) {
                      lowp float t_hit_243;
                      t_hit_243 = t_hit_234;
                      bool tmpvar_244;
                      lowp vec3 tmpvar_245;
                      tmpvar_245 = (sphereCenters[1] - point_201);
                      lowp float tmpvar_246;
                      tmpvar_246 = dot (tmpvar_245, tmpvar_219);
                      if ((tmpvar_246 < 0.0)) {
                        tmpvar_244 = bool(0);
                      } else {
                        lowp float tmpvar_247;
                        tmpvar_247 = (dot (tmpvar_245, tmpvar_245) - (tmpvar_246 * tmpvar_246));
                        if ((tmpvar_247 > 0.64)) {
                          tmpvar_244 = bool(0);
                        } else {
                          lowp float tmpvar_248;
                          tmpvar_248 = sqrt((0.64 - tmpvar_247));
                          lowp float tmpvar_249;
                          tmpvar_249 = (tmpvar_246 - tmpvar_248);
                          lowp float tmpvar_250;
                          tmpvar_250 = (tmpvar_246 + tmpvar_248);
                          lowp float tmpvar_251;
                          if ((tmpvar_249 < 0.01)) {
                            tmpvar_251 = tmpvar_250;
                          } else {
                            tmpvar_251 = tmpvar_249;
                          };
                          if (((tmpvar_251 < t_hit_234) && (tmpvar_251 > 0.01))) {
                            t_hit_243 = tmpvar_251;
                            tmpvar_244 = bool(1);
                          } else {
                            tmpvar_244 = bool(0);
                          };
                        };
                      };
                      t_hit_222 = t_hit_243;
                      if (tmpvar_244) {
                        idx_232 = i_231;
                        intersected_233 = 1;
                      };
                      i_231 = 2;
                      if ((2 < numSpheres)) {
                        lowp float t_hit_252;
                        t_hit_252 = t_hit_243;
                        bool tmpvar_253;
                        lowp vec3 tmpvar_254;
                        tmpvar_254 = (sphereCenters[2] - point_201);
                        lowp float tmpvar_255;
                        tmpvar_255 = dot (tmpvar_254, tmpvar_219);
                        if ((tmpvar_255 < 0.0)) {
                          tmpvar_253 = bool(0);
                        } else {
                          lowp float tmpvar_256;
                          tmpvar_256 = (dot (tmpvar_254, tmpvar_254) - (tmpvar_255 * tmpvar_255));
                          if ((tmpvar_256 > 0.64)) {
                            tmpvar_253 = bool(0);
                          } else {
                            lowp float tmpvar_257;
                            tmpvar_257 = sqrt((0.64 - tmpvar_256));
                            lowp float tmpvar_258;
                            tmpvar_258 = (tmpvar_255 - tmpvar_257);
                            lowp float tmpvar_259;
                            tmpvar_259 = (tmpvar_255 + tmpvar_257);
                            lowp float tmpvar_260;
                            if ((tmpvar_258 < 0.01)) {
                              tmpvar_260 = tmpvar_259;
                            } else {
                              tmpvar_260 = tmpvar_258;
                            };
                            if (((tmpvar_260 < t_hit_243) && (tmpvar_260 > 0.01))) {
                              t_hit_252 = tmpvar_260;
                              tmpvar_253 = bool(1);
                            } else {
                              tmpvar_253 = bool(0);
                            };
                          };
                        };
                        t_hit_222 = t_hit_252;
                        if (tmpvar_253) {
                          idx_232 = i_231;
                          intersected_233 = 1;
                        };
                        i_231 = 3;
                        if ((3 < numSpheres)) {
                          lowp float t_hit_261;
                          t_hit_261 = t_hit_252;
                          bool tmpvar_262;
                          lowp vec3 tmpvar_263;
                          tmpvar_263 = (sphereCenters[3] - point_201);
                          lowp float tmpvar_264;
                          tmpvar_264 = dot (tmpvar_263, tmpvar_219);
                          if ((tmpvar_264 < 0.0)) {
                            tmpvar_262 = bool(0);
                          } else {
                            lowp float tmpvar_265;
                            tmpvar_265 = (dot (tmpvar_263, tmpvar_263) - (tmpvar_264 * tmpvar_264));
                            if ((tmpvar_265 > 0.64)) {
                              tmpvar_262 = bool(0);
                            } else {
                              lowp float tmpvar_266;
                              tmpvar_266 = sqrt((0.64 - tmpvar_265));
                              lowp float tmpvar_267;
                              tmpvar_267 = (tmpvar_264 - tmpvar_266);
                              lowp float tmpvar_268;
                              tmpvar_268 = (tmpvar_264 + tmpvar_266);
                              lowp float tmpvar_269;
                              if ((tmpvar_267 < 0.01)) {
                                tmpvar_269 = tmpvar_268;
                              } else {
                                tmpvar_269 = tmpvar_267;
                              };
                              if (((tmpvar_269 < t_hit_252) && (tmpvar_269 > 0.01))) {
                                t_hit_261 = tmpvar_269;
                                tmpvar_262 = bool(1);
                              } else {
                                tmpvar_262 = bool(0);
                              };
                            };
                          };
                          t_hit_222 = t_hit_261;
                          if (tmpvar_262) {
                            idx_232 = i_231;
                            intersected_233 = 1;
                          };
                          i_231 = 4;
                          if ((4 < numSpheres)) {
                            lowp float t_hit_270;
                            t_hit_270 = t_hit_261;
                            bool tmpvar_271;
                            lowp vec3 tmpvar_272;
                            tmpvar_272 = (sphereCenters[4] - point_201);
                            lowp float tmpvar_273;
                            tmpvar_273 = dot (tmpvar_272, tmpvar_219);
                            if ((tmpvar_273 < 0.0)) {
                              tmpvar_271 = bool(0);
                            } else {
                              lowp float tmpvar_274;
                              tmpvar_274 = (dot (tmpvar_272, tmpvar_272) - (tmpvar_273 * tmpvar_273));
                              if ((tmpvar_274 > 0.64)) {
                                tmpvar_271 = bool(0);
                              } else {
                                lowp float tmpvar_275;
                                tmpvar_275 = sqrt((0.64 - tmpvar_274));
                                lowp float tmpvar_276;
                                tmpvar_276 = (tmpvar_273 - tmpvar_275);
                                lowp float tmpvar_277;
                                tmpvar_277 = (tmpvar_273 + tmpvar_275);
                                lowp float tmpvar_278;
                                if ((tmpvar_276 < 0.01)) {
                                  tmpvar_278 = tmpvar_277;
                                } else {
                                  tmpvar_278 = tmpvar_276;
                                };
                                if (((tmpvar_278 < t_hit_261) && (tmpvar_278 > 0.01))) {
                                  t_hit_270 = tmpvar_278;
                                  tmpvar_271 = bool(1);
                                } else {
                                  tmpvar_271 = bool(0);
                                };
                              };
                            };
                            t_hit_222 = t_hit_270;
                            if (tmpvar_271) {
                              idx_232 = i_231;
                              intersected_233 = 1;
                            };
                            i_231 = 5;
                          };
                        };
                      };
                    };
                  };
                  i_230 = 0;
                  while (true) {
                    bool tmp_279;
                    if ((i_230 >= 6)) {
                      break;
                    };
                    if ((i_230 >= numPlanes)) {
                      break;
                    };
                    lowp vec3 tmpvar_280;
                    tmpvar_280 = planeNormals[i_230];
                    tmp_279 = bool(0);
                    bool tmpvar_281;
                    if (enablePlaneBacksides) {
                      tmpvar_281 = bool(1);
                    } else {
                      tmpvar_281 = (dot (ray_direction_221, tmpvar_280) < 0.0);
                    };
                    if (tmpvar_281) {
                      lowp float t_hit_282;
                      t_hit_282 = t_hit_222;
                      bool tmpvar_283;
                      tmpvar_283 = bool(1);
                      bool tmpvar_284;
                      lowp vec3 tmpvar_285;
                      tmpvar_285 = (tmpvar_280 * planeOffsets[i_230]);
                      lowp float tmpvar_286;
                      tmpvar_286 = (((
                        (tmpvar_285.x + tmpvar_285.y)
                       + tmpvar_285.z) - dot (tmpvar_280, ray_origin_220)) / dot (tmpvar_280, ray_direction_221));
                      if (((tmpvar_286 < t_hit_222) && (tmpvar_286 > 0.01))) {
                        t_hit_282 = tmpvar_286;
                        tmpvar_284 = bool(1);
                        tmpvar_283 = bool(0);
                      };
                      if (tmpvar_283) {
                        tmpvar_284 = bool(0);
                        tmpvar_283 = bool(0);
                      };
                      t_hit_222 = t_hit_282;
                      tmp_279 = tmpvar_284;
                    };
                    if (tmp_279) {
                      normal_224 = tmpvar_280;
                      idx_232 = i_230;
                      intersected_233 = 2;
                    };
                    i_230++;
                  };
                  i_229 = 0;
                  bool tmp_287;
                  if ((0 < numLights)) {
                    vec3 tmpvar_288;
                    tmpvar_288 = lightPos[0];
                    vec2 tmpvar_289;
                    tmpvar_289 = lightSize[0];
                    tmp_287 = bool(0);
                    if (((tmpvar_289.x > 0.0) && (tmpvar_289.y > 0.0))) {
                      lowp float t_hit_290;
                      t_hit_290 = t_hit_222;
                      bool tmpvar_291;
                      tmpvar_291 = bool(1);
                      bool tmpvar_292;
                      vec3 tmpvar_293;
                      tmpvar_293 = (vec3(0.0, 1.0, 0.0) * tmpvar_288.y);
                      lowp float tmpvar_294;
                      tmpvar_294 = (((
                        (tmpvar_293.x + tmpvar_293.y)
                       + tmpvar_293.z) - point_201.y) / tmpvar_219.y);
                      if (((tmpvar_294 < t_hit_222) && (tmpvar_294 > 0.01))) {
                        lowp vec3 tmpvar_295;
                        tmpvar_295 = (point_201 + (tmpvar_219 * tmpvar_294));
                        float tmpvar_296;
                        tmpvar_296 = sqrt(dot (tmpvar_289, tmpvar_289));
                        if (((tmpvar_296 == 0.0) || ((
                          ((tmpvar_295.x < (tmpvar_288.x + (tmpvar_289.x * 0.5))) && (tmpvar_295.x > (tmpvar_288.x - (tmpvar_289.x * 0.5))))
                         && 
                          (tmpvar_295.z < (tmpvar_288.z + (tmpvar_289.y * 0.5)))
                        ) && (tmpvar_295.z > 
                          (tmpvar_288.z - (tmpvar_289.y * 0.5))
                        )))) {
                          t_hit_290 = tmpvar_294;
                          tmpvar_292 = bool(1);
                          tmpvar_291 = bool(0);
                        };
                      };
                      if (tmpvar_291) {
                        tmpvar_292 = bool(0);
                        tmpvar_291 = bool(0);
                      };
                      t_hit_222 = t_hit_290;
                      tmp_287 = tmpvar_292;
                    } else {
                      lowp float t_hit_297;
                      t_hit_297 = t_hit_222;
                      bool tmpvar_298;
                      lowp vec3 tmpvar_299;
                      tmpvar_299 = (tmpvar_288 - point_201);
                      lowp float tmpvar_300;
                      tmpvar_300 = dot (tmpvar_299, tmpvar_219);
                      if ((tmpvar_300 < 0.0)) {
                        tmpvar_298 = bool(0);
                      } else {
                        lowp float tmpvar_301;
                        tmpvar_301 = (dot (tmpvar_299, tmpvar_299) - (tmpvar_300 * tmpvar_300));
                        if ((tmpvar_301 > 0.01)) {
                          tmpvar_298 = bool(0);
                        } else {
                          lowp float tmpvar_302;
                          tmpvar_302 = sqrt((0.01 - tmpvar_301));
                          lowp float tmpvar_303;
                          tmpvar_303 = (tmpvar_300 - tmpvar_302);
                          lowp float tmpvar_304;
                          tmpvar_304 = (tmpvar_300 + tmpvar_302);
                          lowp float tmpvar_305;
                          if ((tmpvar_303 < 0.01)) {
                            tmpvar_305 = tmpvar_304;
                          } else {
                            tmpvar_305 = tmpvar_303;
                          };
                          if (((tmpvar_305 < t_hit_222) && (tmpvar_305 > 0.01))) {
                            t_hit_297 = tmpvar_305;
                            tmpvar_298 = bool(1);
                          } else {
                            tmpvar_298 = bool(0);
                          };
                        };
                      };
                      t_hit_222 = t_hit_297;
                      tmp_287 = tmpvar_298;
                    };
                    if (tmp_287) {
                      idx_232 = i_229;
                      intersected_233 = 3;
                    };
                    i_229 = 1;
                    bool tmp_306;
                    if ((1 < numLights)) {
                      vec3 tmpvar_307;
                      tmpvar_307 = lightPos[1];
                      vec2 tmpvar_308;
                      tmpvar_308 = lightSize[1];
                      tmp_306 = bool(0);
                      if (((tmpvar_308.x > 0.0) && (tmpvar_308.y > 0.0))) {
                        lowp float t_hit_309;
                        t_hit_309 = t_hit_222;
                        bool tmpvar_310;
                        tmpvar_310 = bool(1);
                        bool tmpvar_311;
                        vec3 tmpvar_312;
                        tmpvar_312 = (vec3(0.0, 1.0, 0.0) * tmpvar_307.y);
                        lowp float tmpvar_313;
                        tmpvar_313 = (((
                          (tmpvar_312.x + tmpvar_312.y)
                         + tmpvar_312.z) - point_201.y) / tmpvar_219.y);
                        if (((tmpvar_313 < t_hit_222) && (tmpvar_313 > 0.01))) {
                          lowp vec3 tmpvar_314;
                          tmpvar_314 = (point_201 + (tmpvar_219 * tmpvar_313));
                          float tmpvar_315;
                          tmpvar_315 = sqrt(dot (tmpvar_308, tmpvar_308));
                          if (((tmpvar_315 == 0.0) || ((
                            ((tmpvar_314.x < (tmpvar_307.x + (tmpvar_308.x * 0.5))) && (tmpvar_314.x > (tmpvar_307.x - (tmpvar_308.x * 0.5))))
                           && 
                            (tmpvar_314.z < (tmpvar_307.z + (tmpvar_308.y * 0.5)))
                          ) && (tmpvar_314.z > 
                            (tmpvar_307.z - (tmpvar_308.y * 0.5))
                          )))) {
                            t_hit_309 = tmpvar_313;
                            tmpvar_311 = bool(1);
                            tmpvar_310 = bool(0);
                          };
                        };
                        if (tmpvar_310) {
                          tmpvar_311 = bool(0);
                          tmpvar_310 = bool(0);
                        };
                        t_hit_222 = t_hit_309;
                        tmp_306 = tmpvar_311;
                      } else {
                        lowp float t_hit_316;
                        t_hit_316 = t_hit_222;
                        bool tmpvar_317;
                        lowp vec3 tmpvar_318;
                        tmpvar_318 = (tmpvar_307 - point_201);
                        lowp float tmpvar_319;
                        tmpvar_319 = dot (tmpvar_318, tmpvar_219);
                        if ((tmpvar_319 < 0.0)) {
                          tmpvar_317 = bool(0);
                        } else {
                          lowp float tmpvar_320;
                          tmpvar_320 = (dot (tmpvar_318, tmpvar_318) - (tmpvar_319 * tmpvar_319));
                          if ((tmpvar_320 > 0.01)) {
                            tmpvar_317 = bool(0);
                          } else {
                            lowp float tmpvar_321;
                            tmpvar_321 = sqrt((0.01 - tmpvar_320));
                            lowp float tmpvar_322;
                            tmpvar_322 = (tmpvar_319 - tmpvar_321);
                            lowp float tmpvar_323;
                            tmpvar_323 = (tmpvar_319 + tmpvar_321);
                            lowp float tmpvar_324;
                            if ((tmpvar_322 < 0.01)) {
                              tmpvar_324 = tmpvar_323;
                            } else {
                              tmpvar_324 = tmpvar_322;
                            };
                            if (((tmpvar_324 < t_hit_222) && (tmpvar_324 > 0.01))) {
                              t_hit_316 = tmpvar_324;
                              tmpvar_317 = bool(1);
                            } else {
                              tmpvar_317 = bool(0);
                            };
                          };
                        };
                        t_hit_222 = t_hit_316;
                        tmp_306 = tmpvar_317;
                      };
                      if (tmp_306) {
                        idx_232 = i_229;
                        intersected_233 = 3;
                      };
                      i_229 = 2;
                    };
                  };
                  position_223 = (point_201 + (tmpvar_219 * t_hit_222));
                  if ((intersected_233 == 1)) {
                    diffuseColor_225 = sphereColors[idx_232];
                    specularColor_226 = vec3(1.0, 1.0, 1.0);
                    reflectiveColor_227 = reflectiveColors[idx_232];
                    lowp vec3 tmpvar_325;
                    tmpvar_325 = normalize((position_223 - sphereCenters[idx_232]));
                    normal_224 = tmpvar_325;
                    lowp float tmpvar_326;
                    tmpvar_326 = dot (tmpvar_325, -(tmpvar_219));
                    if ((tmpvar_326 < 0.0)) {
                      normal_224 = -(tmpvar_325);
                    };
                  } else {
                    if ((intersected_233 == 2)) {
                      if (enablePlaneMirrors) {
                        diffuseColor_225 = (planeColors[idx_232] * 0.01);
                        specularColor_226 = vec3(0.0, 0.0, 0.0);
                        reflectiveColor_227 = planeColors[idx_232];
                      } else {
                        diffuseColor_225 = planeColors[idx_232];
                        specularColor_226 = vec3(0.5, 0.5, 0.5);
                        reflectiveColor_227 = vec3(0.0, 0.0, 0.0);
                      };
                      lowp float tmpvar_327;
                      tmpvar_327 = dot (normal_224, -(tmpvar_219));
                      if ((tmpvar_327 < 0.0)) {
                        normal_224 = -(normal_224);
                      };
                    } else {
                      if ((intersected_233 == 3)) {
                        diffuseColor_225 = (lightIntensity[idx_232] / 25.0);
                        isLight_228 = bool(1);
                      };
                    };
                  };
                  indirectDiffuseColor_214 = diffuseColor_225;
                  indirectSpecularColor_213 = specularColor_226;
                  indirectReflectiveColor_212 = reflectiveColor_227;
                  lowp vec3 tmpvar_328;
                  if (isLight_228) {
                    tmpvar_328 = vec3(0.0, 0.0, 0.0);
                  } else {
                    lowp vec3 point_329;
                    point_329 = position_223;
                    lowp vec3 ray_dir_330;
                    ray_dir_330 = tmpvar_219;
                    lowp vec3 normal_331;
                    normal_331 = normal_224;
                    vec3 diffuseColor_332;
                    diffuseColor_332 = diffuseColor_225;
                    vec3 specularColor_333;
                    specularColor_333 = specularColor_226;
                    highp int i_334;
                    lowp vec3 illuminationColor_335;
                    i_334 = 0;
                    while (true) {
                      highp int k_336;
                      bool inShade_337;
                      highp int areaShadowSamples_338;
                      lowp vec3 light_sum_339;
                      vec2 lightSpot_340;
                      vec2 lightSize_341;
                      vec3 lightIntensity_342;
                      vec3 lightPos_343;
                      if ((i_334 >= 2)) {
                        break;
                      };
                      if ((i_334 == numLights)) {
                        break;
                      };
                      lightPos_343 = lightPos[i_334];
                      lightIntensity_342 = lightIntensity[i_334];
                      lightSize_341 = lightSize[i_334];
                      lightSpot_340 = lightSpot[i_334];
                      areaShadowSamples_338 = 0;
                      inShade_337 = bool(0);
                      k_336 = 0;
                      while (true) {
                        vec3 testPos_344;
                        if ((k_336 >= 5)) {
                          break;
                        };
                        if (inShade_337) {
                          break;
                        };
                        if ((k_336 == 1)) {
                          break;
                        };
                        testPos_344 = lightPos_343;
                        if ((k_336 == 1)) {
                          testPos_344.x = (lightPos_343.x - (lightSize_341.x * 0.5));
                          testPos_344.z = (lightPos_343.z - (lightSize_341.y * 0.5));
                        } else {
                          if ((k_336 == 2)) {
                            testPos_344.x = (testPos_344.x + (lightSize_341.x * 0.5));
                            testPos_344.z = (testPos_344.z + (lightSize_341.y * 0.5));
                          } else {
                            if ((k_336 == 3)) {
                              testPos_344.x = (testPos_344.x + (lightSize_341.x * 0.5));
                              testPos_344.z = (testPos_344.z - (lightSize_341.y * 0.5));
                            } else {
                              if ((k_336 == 4)) {
                                testPos_344.x = (testPos_344.x - (lightSize_341.x * 0.5));
                                testPos_344.z = (testPos_344.z + (lightSize_341.y * 0.5));
                              };
                            };
                          };
                        };
                        lowp vec3 vec_to_light_345;
                        lowp vec3 incident_intensity_346;
                        lowp float spot_falloff_347;
                        vec_to_light_345 = (testPos_344 - point_329);
                        lowp float tmpvar_348;
                        tmpvar_348 = sqrt(dot (vec_to_light_345, vec_to_light_345));
                        lowp float tmpvar_349;
                        tmpvar_349 = (1.0/(((attenuation.x * 
                          (tmpvar_348 * tmpvar_348)
                        ) + (attenuation.y * tmpvar_348))));
                        lowp vec3 tmpvar_350;
                        tmpvar_350 = normalize(vec_to_light_345);
                        vec_to_light_345 = tmpvar_350;
                        spot_falloff_347 = 1.0;
                        if ((lightSpot_340.x > 0.0)) {
                          lowp float tmpvar_351;
                          if ((tmpvar_350.y > lightSpot_340.x)) {
                            tmpvar_351 = pow (tmpvar_350.y, lightSpot_340.y);
                          } else {
                            tmpvar_351 = 0.0;
                          };
                          spot_falloff_347 = tmpvar_351;
                        };
                        incident_intensity_346 = ((lightIntensity_342 * tmpvar_349) * spot_falloff_347);
                        lowp float tmpvar_352;
                        tmpvar_352 = sqrt(dot (incident_intensity_346, incident_intensity_346));
                        if ((tmpvar_352 > 0.01)) {
                          lowp vec3 ray_origin_353;
                          ray_origin_353 = point_329;
                          lowp vec3 ray_direction_354;
                          ray_direction_354 = tmpvar_350;
                          lowp float t_hit_355;
                          t_hit_355 = tmpvar_348;
                          bool tmpvar_356;
                          tmpvar_356 = bool(0);
                          highp int i_357;
                          highp int i_358;
                          i_358 = 0;
                          while (true) {
                            if ((i_358 >= 5)) {
                              break;
                            };
                            if ((i_358 == numSpheres)) {
                              break;
                            };
                            lowp float t_hit_359;
                            t_hit_359 = t_hit_355;
                            bool tmpvar_360;
                            lowp vec3 tmpvar_361;
                            tmpvar_361 = (sphereCenters[i_358] - ray_origin_353);
                            lowp float tmpvar_362;
                            tmpvar_362 = dot (tmpvar_361, ray_direction_354);
                            if ((tmpvar_362 < 0.0)) {
                              tmpvar_360 = bool(0);
                            } else {
                              lowp float tmpvar_363;
                              tmpvar_363 = (dot (tmpvar_361, tmpvar_361) - (tmpvar_362 * tmpvar_362));
                              if ((tmpvar_363 > 0.64)) {
                                tmpvar_360 = bool(0);
                              } else {
                                lowp float tmpvar_364;
                                tmpvar_364 = sqrt((0.64 - tmpvar_363));
                                lowp float tmpvar_365;
                                tmpvar_365 = (tmpvar_362 - tmpvar_364);
                                lowp float tmpvar_366;
                                tmpvar_366 = (tmpvar_362 + tmpvar_364);
                                lowp float tmpvar_367;
                                if ((tmpvar_365 < 0.01)) {
                                  tmpvar_367 = tmpvar_366;
                                } else {
                                  tmpvar_367 = tmpvar_365;
                                };
                                if (((tmpvar_367 < t_hit_355) && (tmpvar_367 > 0.01))) {
                                  t_hit_359 = tmpvar_367;
                                  tmpvar_360 = bool(1);
                                } else {
                                  tmpvar_360 = bool(0);
                                };
                              };
                            };
                            t_hit_355 = t_hit_359;
                            if (tmpvar_360) {
                              tmpvar_356 = bool(1);
                              break;
                            };
                            i_358++;
                          };
                          if (!(tmpvar_356)) {
                            i_357 = 0;
                            while (true) {
                              if ((i_357 >= 6)) {
                                break;
                              };
                              if ((i_357 == numPlanes)) {
                                break;
                              };
                              vec3 normal_368;
                              normal_368 = planeNormals[i_357];
                              lowp float t_hit_369;
                              t_hit_369 = t_hit_355;
                              bool tmpvar_370;
                              tmpvar_370 = bool(1);
                              bool tmpvar_371;
                              vec3 tmpvar_372;
                              tmpvar_372 = (normal_368 * planeOffsets[i_357]);
                              lowp float tmpvar_373;
                              tmpvar_373 = (((
                                (tmpvar_372.x + tmpvar_372.y)
                               + tmpvar_372.z) - dot (normal_368, ray_origin_353)) / dot (normal_368, ray_direction_354));
                              if (((tmpvar_373 < t_hit_355) && (tmpvar_373 > 0.01))) {
                                t_hit_369 = tmpvar_373;
                                tmpvar_371 = bool(1);
                                tmpvar_370 = bool(0);
                              };
                              if (tmpvar_370) {
                                tmpvar_371 = bool(0);
                                tmpvar_370 = bool(0);
                              };
                              t_hit_355 = t_hit_369;
                              if (tmpvar_371) {
                                tmpvar_356 = bool(1);
                                break;
                              };
                              i_357++;
                            };
                            if (!(tmpvar_356)) {
                              tmpvar_356 = bool(1);
                            };
                          };
                          lowp float tmpvar_374;
                          tmpvar_374 = abs((t_hit_355 - tmpvar_348));
                          if ((tmpvar_374 < 0.001)) {
                            lowp vec3 tmpvar_375;
                            lowp float tmpvar_376;
                            tmpvar_376 = dot (normal_331, tmpvar_350);
                            if ((tmpvar_376 > 0.0)) {
                              tmpvar_375 = (incident_intensity_346 * ((diffuseColor_332 * 
                                max (0.0, dot (normal_331, tmpvar_350))
                              ) + (specularColor_333 * 
                                pow (max (0.0, dot ((
                                  -(tmpvar_350)
                                 - 
                                  ((2.0 * dot (-(tmpvar_350), normal_331)) * normal_331)
                                ), -(ray_dir_330))), 32.0)
                              )));
                            } else {
                              tmpvar_375 = vec3(0.0, 0.0, 0.0);
                            };
                            light_sum_339 = (light_sum_339 + tmpvar_375);
                          } else {
                            inShade_337 = bool(1);
                          };
                        } else {
                          inShade_337 = bool(1);
                        };
                        areaShadowSamples_338++;
                        k_336++;
                      };
                      illuminationColor_335 = (illuminationColor_335 + (light_sum_339 / float(areaShadowSamples_338)));
                      i_334++;
                    };
                    tmpvar_328 = (tmpvar_215 * illuminationColor_335);
                  };
                  indirect_sampling_sum_204 = (indirect_sampling_sum_204 + tmpvar_328);
                  k_203++;
                };
                tmpvar_202 = (((2.0 * indirect_sampling_sum_204) / float(indirectSamples)) * diffuseColor_11);
              };
              pixelColor_4 = (pixelColor_4 + tmpvar_202);
            };
            bool tmpvar_377;
            if ((rayBounces > 0)) {
              tmpvar_377 = (sqrt(dot (reflectiveColor_13, reflectiveColor_13)) > 0.0);
            } else {
              tmpvar_377 = bool(0);
            };
            if (tmpvar_377) {
              lowp vec3 origin_378;
              origin_378 = position_9;
              lowp vec3 rayDir_379;
              rayDir_379 = tmpvar_5;
              lowp vec3 normal_380;
              normal_380 = normal_10;
              vec3 reflectiveColor_381;
              reflectiveColor_381 = reflectiveColor_13;
              lowp vec3 reflectionSum_383;
              for (highp int i_382 = 0; i_382 < 5; i_382++) {
                lowp vec3 mirror_sample_color_384;
                vec3 bounceReflectiveColor_385;
                vec3 bounceSpecularColor_386;
                vec3 bounceDiffuseColor_387;
                bool tmpvar_388;
                if ((i_382 >= rayBounces)) {
                  tmpvar_388 = bool(1);
                } else {
                  tmpvar_388 = (sqrt(dot (reflectiveColor_381, reflectiveColor_381)) == 0.0);
                };
                if (tmpvar_388) {
                  break;
                };
                lowp vec3 tmpvar_389;
                tmpvar_389 = (rayDir_379 - ((2.0 * 
                  dot (rayDir_379, normal_380)
                ) * normal_380));
                lowp vec3 ray_origin_390;
                ray_origin_390 = origin_378;
                lowp vec3 ray_direction_391;
                ray_direction_391 = tmpvar_389;
                lowp float t_hit_392;
                t_hit_392 = 50.0;
                lowp vec3 position_393;
                lowp vec3 normal_394;
                vec3 diffuseColor_395;
                diffuseColor_395 = bounceDiffuseColor_387;
                vec3 specularColor_396;
                specularColor_396 = bounceSpecularColor_386;
                vec3 reflectiveColor_397;
                reflectiveColor_397 = bounceReflectiveColor_385;
                bool isLight_398;
                isLight_398 = bool(0);
                highp int i_399;
                highp int i_400;
                highp int i_401;
                highp int idx_402;
                highp int intersected_403;
                intersected_403 = 0;
                idx_402 = 0;
                i_401 = 0;
                if ((0 < numSpheres)) {
                  lowp float t_hit_404;
                  t_hit_404 = t_hit_392;
                  bool tmpvar_405;
                  lowp vec3 tmpvar_406;
                  tmpvar_406 = (sphereCenters[0] - origin_378);
                  lowp float tmpvar_407;
                  tmpvar_407 = dot (tmpvar_406, tmpvar_389);
                  if ((tmpvar_407 < 0.0)) {
                    tmpvar_405 = bool(0);
                  } else {
                    lowp float tmpvar_408;
                    tmpvar_408 = (dot (tmpvar_406, tmpvar_406) - (tmpvar_407 * tmpvar_407));
                    if ((tmpvar_408 > 0.64)) {
                      tmpvar_405 = bool(0);
                    } else {
                      lowp float tmpvar_409;
                      tmpvar_409 = sqrt((0.64 - tmpvar_408));
                      lowp float tmpvar_410;
                      tmpvar_410 = (tmpvar_407 - tmpvar_409);
                      lowp float tmpvar_411;
                      tmpvar_411 = (tmpvar_407 + tmpvar_409);
                      lowp float tmpvar_412;
                      if ((tmpvar_410 < 0.01)) {
                        tmpvar_412 = tmpvar_411;
                      } else {
                        tmpvar_412 = tmpvar_410;
                      };
                      if (((tmpvar_412 < 50.0) && (tmpvar_412 > 0.01))) {
                        t_hit_404 = tmpvar_412;
                        tmpvar_405 = bool(1);
                      } else {
                        tmpvar_405 = bool(0);
                      };
                    };
                  };
                  t_hit_392 = t_hit_404;
                  if (tmpvar_405) {
                    idx_402 = i_401;
                    intersected_403 = 1;
                  };
                  i_401 = 1;
                  if ((1 < numSpheres)) {
                    lowp float t_hit_413;
                    t_hit_413 = t_hit_404;
                    bool tmpvar_414;
                    lowp vec3 tmpvar_415;
                    tmpvar_415 = (sphereCenters[1] - origin_378);
                    lowp float tmpvar_416;
                    tmpvar_416 = dot (tmpvar_415, tmpvar_389);
                    if ((tmpvar_416 < 0.0)) {
                      tmpvar_414 = bool(0);
                    } else {
                      lowp float tmpvar_417;
                      tmpvar_417 = (dot (tmpvar_415, tmpvar_415) - (tmpvar_416 * tmpvar_416));
                      if ((tmpvar_417 > 0.64)) {
                        tmpvar_414 = bool(0);
                      } else {
                        lowp float tmpvar_418;
                        tmpvar_418 = sqrt((0.64 - tmpvar_417));
                        lowp float tmpvar_419;
                        tmpvar_419 = (tmpvar_416 - tmpvar_418);
                        lowp float tmpvar_420;
                        tmpvar_420 = (tmpvar_416 + tmpvar_418);
                        lowp float tmpvar_421;
                        if ((tmpvar_419 < 0.01)) {
                          tmpvar_421 = tmpvar_420;
                        } else {
                          tmpvar_421 = tmpvar_419;
                        };
                        if (((tmpvar_421 < t_hit_404) && (tmpvar_421 > 0.01))) {
                          t_hit_413 = tmpvar_421;
                          tmpvar_414 = bool(1);
                        } else {
                          tmpvar_414 = bool(0);
                        };
                      };
                    };
                    t_hit_392 = t_hit_413;
                    if (tmpvar_414) {
                      idx_402 = i_401;
                      intersected_403 = 1;
                    };
                    i_401 = 2;
                    if ((2 < numSpheres)) {
                      lowp float t_hit_422;
                      t_hit_422 = t_hit_413;
                      bool tmpvar_423;
                      lowp vec3 tmpvar_424;
                      tmpvar_424 = (sphereCenters[2] - origin_378);
                      lowp float tmpvar_425;
                      tmpvar_425 = dot (tmpvar_424, tmpvar_389);
                      if ((tmpvar_425 < 0.0)) {
                        tmpvar_423 = bool(0);
                      } else {
                        lowp float tmpvar_426;
                        tmpvar_426 = (dot (tmpvar_424, tmpvar_424) - (tmpvar_425 * tmpvar_425));
                        if ((tmpvar_426 > 0.64)) {
                          tmpvar_423 = bool(0);
                        } else {
                          lowp float tmpvar_427;
                          tmpvar_427 = sqrt((0.64 - tmpvar_426));
                          lowp float tmpvar_428;
                          tmpvar_428 = (tmpvar_425 - tmpvar_427);
                          lowp float tmpvar_429;
                          tmpvar_429 = (tmpvar_425 + tmpvar_427);
                          lowp float tmpvar_430;
                          if ((tmpvar_428 < 0.01)) {
                            tmpvar_430 = tmpvar_429;
                          } else {
                            tmpvar_430 = tmpvar_428;
                          };
                          if (((tmpvar_430 < t_hit_413) && (tmpvar_430 > 0.01))) {
                            t_hit_422 = tmpvar_430;
                            tmpvar_423 = bool(1);
                          } else {
                            tmpvar_423 = bool(0);
                          };
                        };
                      };
                      t_hit_392 = t_hit_422;
                      if (tmpvar_423) {
                        idx_402 = i_401;
                        intersected_403 = 1;
                      };
                      i_401 = 3;
                      if ((3 < numSpheres)) {
                        lowp float t_hit_431;
                        t_hit_431 = t_hit_422;
                        bool tmpvar_432;
                        lowp vec3 tmpvar_433;
                        tmpvar_433 = (sphereCenters[3] - origin_378);
                        lowp float tmpvar_434;
                        tmpvar_434 = dot (tmpvar_433, tmpvar_389);
                        if ((tmpvar_434 < 0.0)) {
                          tmpvar_432 = bool(0);
                        } else {
                          lowp float tmpvar_435;
                          tmpvar_435 = (dot (tmpvar_433, tmpvar_433) - (tmpvar_434 * tmpvar_434));
                          if ((tmpvar_435 > 0.64)) {
                            tmpvar_432 = bool(0);
                          } else {
                            lowp float tmpvar_436;
                            tmpvar_436 = sqrt((0.64 - tmpvar_435));
                            lowp float tmpvar_437;
                            tmpvar_437 = (tmpvar_434 - tmpvar_436);
                            lowp float tmpvar_438;
                            tmpvar_438 = (tmpvar_434 + tmpvar_436);
                            lowp float tmpvar_439;
                            if ((tmpvar_437 < 0.01)) {
                              tmpvar_439 = tmpvar_438;
                            } else {
                              tmpvar_439 = tmpvar_437;
                            };
                            if (((tmpvar_439 < t_hit_422) && (tmpvar_439 > 0.01))) {
                              t_hit_431 = tmpvar_439;
                              tmpvar_432 = bool(1);
                            } else {
                              tmpvar_432 = bool(0);
                            };
                          };
                        };
                        t_hit_392 = t_hit_431;
                        if (tmpvar_432) {
                          idx_402 = i_401;
                          intersected_403 = 1;
                        };
                        i_401 = 4;
                        if ((4 < numSpheres)) {
                          lowp float t_hit_440;
                          t_hit_440 = t_hit_431;
                          bool tmpvar_441;
                          lowp vec3 tmpvar_442;
                          tmpvar_442 = (sphereCenters[4] - origin_378);
                          lowp float tmpvar_443;
                          tmpvar_443 = dot (tmpvar_442, tmpvar_389);
                          if ((tmpvar_443 < 0.0)) {
                            tmpvar_441 = bool(0);
                          } else {
                            lowp float tmpvar_444;
                            tmpvar_444 = (dot (tmpvar_442, tmpvar_442) - (tmpvar_443 * tmpvar_443));
                            if ((tmpvar_444 > 0.64)) {
                              tmpvar_441 = bool(0);
                            } else {
                              lowp float tmpvar_445;
                              tmpvar_445 = sqrt((0.64 - tmpvar_444));
                              lowp float tmpvar_446;
                              tmpvar_446 = (tmpvar_443 - tmpvar_445);
                              lowp float tmpvar_447;
                              tmpvar_447 = (tmpvar_443 + tmpvar_445);
                              lowp float tmpvar_448;
                              if ((tmpvar_446 < 0.01)) {
                                tmpvar_448 = tmpvar_447;
                              } else {
                                tmpvar_448 = tmpvar_446;
                              };
                              if (((tmpvar_448 < t_hit_431) && (tmpvar_448 > 0.01))) {
                                t_hit_440 = tmpvar_448;
                                tmpvar_441 = bool(1);
                              } else {
                                tmpvar_441 = bool(0);
                              };
                            };
                          };
                          t_hit_392 = t_hit_440;
                          if (tmpvar_441) {
                            idx_402 = i_401;
                            intersected_403 = 1;
                          };
                          i_401 = 5;
                        };
                      };
                    };
                  };
                };
                i_400 = 0;
                while (true) {
                  bool tmp_449;
                  if ((i_400 >= 6)) {
                    break;
                  };
                  if ((i_400 >= numPlanes)) {
                    break;
                  };
                  lowp vec3 tmpvar_450;
                  tmpvar_450 = planeNormals[i_400];
                  tmp_449 = bool(0);
                  bool tmpvar_451;
                  if (enablePlaneBacksides) {
                    tmpvar_451 = bool(1);
                  } else {
                    tmpvar_451 = (dot (ray_direction_391, tmpvar_450) < 0.0);
                  };
                  if (tmpvar_451) {
                    lowp float t_hit_452;
                    t_hit_452 = t_hit_392;
                    bool tmpvar_453;
                    tmpvar_453 = bool(1);
                    bool tmpvar_454;
                    lowp vec3 tmpvar_455;
                    tmpvar_455 = (tmpvar_450 * planeOffsets[i_400]);
                    lowp float tmpvar_456;
                    tmpvar_456 = (((
                      (tmpvar_455.x + tmpvar_455.y)
                     + tmpvar_455.z) - dot (tmpvar_450, ray_origin_390)) / dot (tmpvar_450, ray_direction_391));
                    if (((tmpvar_456 < t_hit_392) && (tmpvar_456 > 0.01))) {
                      t_hit_452 = tmpvar_456;
                      tmpvar_454 = bool(1);
                      tmpvar_453 = bool(0);
                    };
                    if (tmpvar_453) {
                      tmpvar_454 = bool(0);
                      tmpvar_453 = bool(0);
                    };
                    t_hit_392 = t_hit_452;
                    tmp_449 = tmpvar_454;
                  };
                  if (tmp_449) {
                    normal_394 = tmpvar_450;
                    idx_402 = i_400;
                    intersected_403 = 2;
                  };
                  i_400++;
                };
                i_399 = 0;
                bool tmp_457;
                if ((0 < numLights)) {
                  vec3 tmpvar_458;
                  tmpvar_458 = lightPos[0];
                  vec2 tmpvar_459;
                  tmpvar_459 = lightSize[0];
                  tmp_457 = bool(0);
                  if (((tmpvar_459.x > 0.0) && (tmpvar_459.y > 0.0))) {
                    lowp float t_hit_460;
                    t_hit_460 = t_hit_392;
                    bool tmpvar_461;
                    tmpvar_461 = bool(1);
                    bool tmpvar_462;
                    vec3 tmpvar_463;
                    tmpvar_463 = (vec3(0.0, 1.0, 0.0) * tmpvar_458.y);
                    lowp float tmpvar_464;
                    tmpvar_464 = (((
                      (tmpvar_463.x + tmpvar_463.y)
                     + tmpvar_463.z) - origin_378.y) / tmpvar_389.y);
                    if (((tmpvar_464 < t_hit_392) && (tmpvar_464 > 0.01))) {
                      lowp vec3 tmpvar_465;
                      tmpvar_465 = (origin_378 + (tmpvar_389 * tmpvar_464));
                      float tmpvar_466;
                      tmpvar_466 = sqrt(dot (tmpvar_459, tmpvar_459));
                      if (((tmpvar_466 == 0.0) || ((
                        ((tmpvar_465.x < (tmpvar_458.x + (tmpvar_459.x * 0.5))) && (tmpvar_465.x > (tmpvar_458.x - (tmpvar_459.x * 0.5))))
                       && 
                        (tmpvar_465.z < (tmpvar_458.z + (tmpvar_459.y * 0.5)))
                      ) && (tmpvar_465.z > 
                        (tmpvar_458.z - (tmpvar_459.y * 0.5))
                      )))) {
                        t_hit_460 = tmpvar_464;
                        tmpvar_462 = bool(1);
                        tmpvar_461 = bool(0);
                      };
                    };
                    if (tmpvar_461) {
                      tmpvar_462 = bool(0);
                      tmpvar_461 = bool(0);
                    };
                    t_hit_392 = t_hit_460;
                    tmp_457 = tmpvar_462;
                  } else {
                    lowp float t_hit_467;
                    t_hit_467 = t_hit_392;
                    bool tmpvar_468;
                    lowp vec3 tmpvar_469;
                    tmpvar_469 = (tmpvar_458 - origin_378);
                    lowp float tmpvar_470;
                    tmpvar_470 = dot (tmpvar_469, tmpvar_389);
                    if ((tmpvar_470 < 0.0)) {
                      tmpvar_468 = bool(0);
                    } else {
                      lowp float tmpvar_471;
                      tmpvar_471 = (dot (tmpvar_469, tmpvar_469) - (tmpvar_470 * tmpvar_470));
                      if ((tmpvar_471 > 0.01)) {
                        tmpvar_468 = bool(0);
                      } else {
                        lowp float tmpvar_472;
                        tmpvar_472 = sqrt((0.01 - tmpvar_471));
                        lowp float tmpvar_473;
                        tmpvar_473 = (tmpvar_470 - tmpvar_472);
                        lowp float tmpvar_474;
                        tmpvar_474 = (tmpvar_470 + tmpvar_472);
                        lowp float tmpvar_475;
                        if ((tmpvar_473 < 0.01)) {
                          tmpvar_475 = tmpvar_474;
                        } else {
                          tmpvar_475 = tmpvar_473;
                        };
                        if (((tmpvar_475 < t_hit_392) && (tmpvar_475 > 0.01))) {
                          t_hit_467 = tmpvar_475;
                          tmpvar_468 = bool(1);
                        } else {
                          tmpvar_468 = bool(0);
                        };
                      };
                    };
                    t_hit_392 = t_hit_467;
                    tmp_457 = tmpvar_468;
                  };
                  if (tmp_457) {
                    idx_402 = i_399;
                    intersected_403 = 3;
                  };
                  i_399 = 1;
                  bool tmp_476;
                  if ((1 < numLights)) {
                    vec3 tmpvar_477;
                    tmpvar_477 = lightPos[1];
                    vec2 tmpvar_478;
                    tmpvar_478 = lightSize[1];
                    tmp_476 = bool(0);
                    if (((tmpvar_478.x > 0.0) && (tmpvar_478.y > 0.0))) {
                      lowp float t_hit_479;
                      t_hit_479 = t_hit_392;
                      bool tmpvar_480;
                      tmpvar_480 = bool(1);
                      bool tmpvar_481;
                      vec3 tmpvar_482;
                      tmpvar_482 = (vec3(0.0, 1.0, 0.0) * tmpvar_477.y);
                      lowp float tmpvar_483;
                      tmpvar_483 = (((
                        (tmpvar_482.x + tmpvar_482.y)
                       + tmpvar_482.z) - origin_378.y) / tmpvar_389.y);
                      if (((tmpvar_483 < t_hit_392) && (tmpvar_483 > 0.01))) {
                        lowp vec3 tmpvar_484;
                        tmpvar_484 = (origin_378 + (tmpvar_389 * tmpvar_483));
                        float tmpvar_485;
                        tmpvar_485 = sqrt(dot (tmpvar_478, tmpvar_478));
                        if (((tmpvar_485 == 0.0) || ((
                          ((tmpvar_484.x < (tmpvar_477.x + (tmpvar_478.x * 0.5))) && (tmpvar_484.x > (tmpvar_477.x - (tmpvar_478.x * 0.5))))
                         && 
                          (tmpvar_484.z < (tmpvar_477.z + (tmpvar_478.y * 0.5)))
                        ) && (tmpvar_484.z > 
                          (tmpvar_477.z - (tmpvar_478.y * 0.5))
                        )))) {
                          t_hit_479 = tmpvar_483;
                          tmpvar_481 = bool(1);
                          tmpvar_480 = bool(0);
                        };
                      };
                      if (tmpvar_480) {
                        tmpvar_481 = bool(0);
                        tmpvar_480 = bool(0);
                      };
                      t_hit_392 = t_hit_479;
                      tmp_476 = tmpvar_481;
                    } else {
                      lowp float t_hit_486;
                      t_hit_486 = t_hit_392;
                      bool tmpvar_487;
                      lowp vec3 tmpvar_488;
                      tmpvar_488 = (tmpvar_477 - origin_378);
                      lowp float tmpvar_489;
                      tmpvar_489 = dot (tmpvar_488, tmpvar_389);
                      if ((tmpvar_489 < 0.0)) {
                        tmpvar_487 = bool(0);
                      } else {
                        lowp float tmpvar_490;
                        tmpvar_490 = (dot (tmpvar_488, tmpvar_488) - (tmpvar_489 * tmpvar_489));
                        if ((tmpvar_490 > 0.01)) {
                          tmpvar_487 = bool(0);
                        } else {
                          lowp float tmpvar_491;
                          tmpvar_491 = sqrt((0.01 - tmpvar_490));
                          lowp float tmpvar_492;
                          tmpvar_492 = (tmpvar_489 - tmpvar_491);
                          lowp float tmpvar_493;
                          tmpvar_493 = (tmpvar_489 + tmpvar_491);
                          lowp float tmpvar_494;
                          if ((tmpvar_492 < 0.01)) {
                            tmpvar_494 = tmpvar_493;
                          } else {
                            tmpvar_494 = tmpvar_492;
                          };
                          if (((tmpvar_494 < t_hit_392) && (tmpvar_494 > 0.01))) {
                            t_hit_486 = tmpvar_494;
                            tmpvar_487 = bool(1);
                          } else {
                            tmpvar_487 = bool(0);
                          };
                        };
                      };
                      t_hit_392 = t_hit_486;
                      tmp_476 = tmpvar_487;
                    };
                    if (tmp_476) {
                      idx_402 = i_399;
                      intersected_403 = 3;
                    };
                    i_399 = 2;
                  };
                };
                position_393 = (origin_378 + (tmpvar_389 * t_hit_392));
                if ((intersected_403 == 1)) {
                  diffuseColor_395 = sphereColors[idx_402];
                  specularColor_396 = vec3(1.0, 1.0, 1.0);
                  reflectiveColor_397 = reflectiveColors[idx_402];
                  lowp vec3 tmpvar_495;
                  tmpvar_495 = normalize((position_393 - sphereCenters[idx_402]));
                  normal_394 = tmpvar_495;
                  lowp float tmpvar_496;
                  tmpvar_496 = dot (tmpvar_495, -(tmpvar_389));
                  if ((tmpvar_496 < 0.0)) {
                    normal_394 = -(tmpvar_495);
                  };
                } else {
                  if ((intersected_403 == 2)) {
                    if (enablePlaneMirrors) {
                      diffuseColor_395 = (planeColors[idx_402] * 0.01);
                      specularColor_396 = vec3(0.0, 0.0, 0.0);
                      reflectiveColor_397 = planeColors[idx_402];
                    } else {
                      diffuseColor_395 = planeColors[idx_402];
                      specularColor_396 = vec3(0.5, 0.5, 0.5);
                      reflectiveColor_397 = vec3(0.0, 0.0, 0.0);
                    };
                    lowp float tmpvar_497;
                    tmpvar_497 = dot (normal_394, -(tmpvar_389));
                    if ((tmpvar_497 < 0.0)) {
                      normal_394 = -(normal_394);
                    };
                  } else {
                    if ((intersected_403 == 3)) {
                      diffuseColor_395 = (lightIntensity[idx_402] / 25.0);
                      isLight_398 = bool(1);
                    };
                  };
                };
                normal_380 = normal_394;
                bounceDiffuseColor_387 = diffuseColor_395;
                bounceSpecularColor_386 = specularColor_396;
                bounceReflectiveColor_385 = reflectiveColor_397;
                lowp vec3 tmpvar_498;
                if (isLight_398) {
                  tmpvar_498 = diffuseColor_395;
                } else {
                  lowp vec3 point_499;
                  point_499 = position_393;
                  lowp vec3 ray_dir_500;
                  ray_dir_500 = tmpvar_389;
                  lowp vec3 normal_501;
                  normal_501 = normal_394;
                  vec3 diffuseColor_502;
                  diffuseColor_502 = diffuseColor_395;
                  vec3 specularColor_503;
                  specularColor_503 = specularColor_396;
                  highp int i_504;
                  lowp vec3 illuminationColor_505;
                  i_504 = 0;
                  while (true) {
                    highp int k_506;
                    bool inShade_507;
                    highp int areaShadowSamples_508;
                    lowp vec3 light_sum_509;
                    vec2 lightSpot_510;
                    vec2 lightSize_511;
                    vec3 lightIntensity_512;
                    vec3 lightPos_513;
                    if ((i_504 >= 2)) {
                      break;
                    };
                    if ((i_504 == numLights)) {
                      break;
                    };
                    lightPos_513 = lightPos[i_504];
                    lightIntensity_512 = lightIntensity[i_504];
                    lightSize_511 = lightSize[i_504];
                    lightSpot_510 = lightSpot[i_504];
                    areaShadowSamples_508 = 0;
                    inShade_507 = bool(0);
                    k_506 = 0;
                    while (true) {
                      vec3 testPos_514;
                      if ((k_506 >= 5)) {
                        break;
                      };
                      if (inShade_507) {
                        break;
                      };
                      if ((k_506 == 1)) {
                        break;
                      };
                      testPos_514 = lightPos_513;
                      if ((k_506 == 1)) {
                        testPos_514.x = (lightPos_513.x - (lightSize_511.x * 0.5));
                        testPos_514.z = (lightPos_513.z - (lightSize_511.y * 0.5));
                      } else {
                        if ((k_506 == 2)) {
                          testPos_514.x = (testPos_514.x + (lightSize_511.x * 0.5));
                          testPos_514.z = (testPos_514.z + (lightSize_511.y * 0.5));
                        } else {
                          if ((k_506 == 3)) {
                            testPos_514.x = (testPos_514.x + (lightSize_511.x * 0.5));
                            testPos_514.z = (testPos_514.z - (lightSize_511.y * 0.5));
                          } else {
                            if ((k_506 == 4)) {
                              testPos_514.x = (testPos_514.x - (lightSize_511.x * 0.5));
                              testPos_514.z = (testPos_514.z + (lightSize_511.y * 0.5));
                            };
                          };
                        };
                      };
                      lowp vec3 vec_to_light_515;
                      lowp vec3 incident_intensity_516;
                      lowp float spot_falloff_517;
                      vec_to_light_515 = (testPos_514 - point_499);
                      lowp float tmpvar_518;
                      tmpvar_518 = sqrt(dot (vec_to_light_515, vec_to_light_515));
                      lowp float tmpvar_519;
                      tmpvar_519 = (1.0/(((attenuation.x * 
                        (tmpvar_518 * tmpvar_518)
                      ) + (attenuation.y * tmpvar_518))));
                      lowp vec3 tmpvar_520;
                      tmpvar_520 = normalize(vec_to_light_515);
                      vec_to_light_515 = tmpvar_520;
                      spot_falloff_517 = 1.0;
                      if ((lightSpot_510.x > 0.0)) {
                        lowp float tmpvar_521;
                        if ((tmpvar_520.y > lightSpot_510.x)) {
                          tmpvar_521 = pow (tmpvar_520.y, lightSpot_510.y);
                        } else {
                          tmpvar_521 = 0.0;
                        };
                        spot_falloff_517 = tmpvar_521;
                      };
                      incident_intensity_516 = ((lightIntensity_512 * tmpvar_519) * spot_falloff_517);
                      lowp float tmpvar_522;
                      tmpvar_522 = sqrt(dot (incident_intensity_516, incident_intensity_516));
                      if ((tmpvar_522 > 0.01)) {
                        lowp vec3 ray_origin_523;
                        ray_origin_523 = point_499;
                        lowp vec3 ray_direction_524;
                        ray_direction_524 = tmpvar_520;
                        lowp float t_hit_525;
                        t_hit_525 = tmpvar_518;
                        bool tmpvar_526;
                        tmpvar_526 = bool(0);
                        highp int i_527;
                        highp int i_528;
                        i_528 = 0;
                        while (true) {
                          if ((i_528 >= 5)) {
                            break;
                          };
                          if ((i_528 == numSpheres)) {
                            break;
                          };
                          lowp float t_hit_529;
                          t_hit_529 = t_hit_525;
                          bool tmpvar_530;
                          lowp vec3 tmpvar_531;
                          tmpvar_531 = (sphereCenters[i_528] - ray_origin_523);
                          lowp float tmpvar_532;
                          tmpvar_532 = dot (tmpvar_531, ray_direction_524);
                          if ((tmpvar_532 < 0.0)) {
                            tmpvar_530 = bool(0);
                          } else {
                            lowp float tmpvar_533;
                            tmpvar_533 = (dot (tmpvar_531, tmpvar_531) - (tmpvar_532 * tmpvar_532));
                            if ((tmpvar_533 > 0.64)) {
                              tmpvar_530 = bool(0);
                            } else {
                              lowp float tmpvar_534;
                              tmpvar_534 = sqrt((0.64 - tmpvar_533));
                              lowp float tmpvar_535;
                              tmpvar_535 = (tmpvar_532 - tmpvar_534);
                              lowp float tmpvar_536;
                              tmpvar_536 = (tmpvar_532 + tmpvar_534);
                              lowp float tmpvar_537;
                              if ((tmpvar_535 < 0.01)) {
                                tmpvar_537 = tmpvar_536;
                              } else {
                                tmpvar_537 = tmpvar_535;
                              };
                              if (((tmpvar_537 < t_hit_525) && (tmpvar_537 > 0.01))) {
                                t_hit_529 = tmpvar_537;
                                tmpvar_530 = bool(1);
                              } else {
                                tmpvar_530 = bool(0);
                              };
                            };
                          };
                          t_hit_525 = t_hit_529;
                          if (tmpvar_530) {
                            tmpvar_526 = bool(1);
                            break;
                          };
                          i_528++;
                        };
                        if (!(tmpvar_526)) {
                          i_527 = 0;
                          while (true) {
                            if ((i_527 >= 6)) {
                              break;
                            };
                            if ((i_527 == numPlanes)) {
                              break;
                            };
                            vec3 normal_538;
                            normal_538 = planeNormals[i_527];
                            lowp float t_hit_539;
                            t_hit_539 = t_hit_525;
                            bool tmpvar_540;
                            tmpvar_540 = bool(1);
                            bool tmpvar_541;
                            vec3 tmpvar_542;
                            tmpvar_542 = (normal_538 * planeOffsets[i_527]);
                            lowp float tmpvar_543;
                            tmpvar_543 = (((
                              (tmpvar_542.x + tmpvar_542.y)
                             + tmpvar_542.z) - dot (normal_538, ray_origin_523)) / dot (normal_538, ray_direction_524));
                            if (((tmpvar_543 < t_hit_525) && (tmpvar_543 > 0.01))) {
                              t_hit_539 = tmpvar_543;
                              tmpvar_541 = bool(1);
                              tmpvar_540 = bool(0);
                            };
                            if (tmpvar_540) {
                              tmpvar_541 = bool(0);
                              tmpvar_540 = bool(0);
                            };
                            t_hit_525 = t_hit_539;
                            if (tmpvar_541) {
                              tmpvar_526 = bool(1);
                              break;
                            };
                            i_527++;
                          };
                          if (!(tmpvar_526)) {
                            tmpvar_526 = bool(1);
                          };
                        };
                        lowp float tmpvar_544;
                        tmpvar_544 = abs((t_hit_525 - tmpvar_518));
                        if ((tmpvar_544 < 0.001)) {
                          lowp vec3 tmpvar_545;
                          lowp float tmpvar_546;
                          tmpvar_546 = dot (normal_501, tmpvar_520);
                          if ((tmpvar_546 > 0.0)) {
                            tmpvar_545 = (incident_intensity_516 * ((diffuseColor_502 * 
                              max (0.0, dot (normal_501, tmpvar_520))
                            ) + (specularColor_503 * 
                              pow (max (0.0, dot ((
                                -(tmpvar_520)
                               - 
                                ((2.0 * dot (-(tmpvar_520), normal_501)) * normal_501)
                              ), -(ray_dir_500))), 32.0)
                            )));
                          } else {
                            tmpvar_545 = vec3(0.0, 0.0, 0.0);
                          };
                          light_sum_509 = (light_sum_509 + tmpvar_545);
                        } else {
                          inShade_507 = bool(1);
                        };
                      } else {
                        inShade_507 = bool(1);
                      };
                      areaShadowSamples_508++;
                      k_506++;
                    };
                    illuminationColor_505 = (illuminationColor_505 + (light_sum_509 / float(areaShadowSamples_508)));
                    i_504++;
                  };
                  tmpvar_498 = illuminationColor_505;
                };
                mirror_sample_color_384 = tmpvar_498;
                if (enableRefGI) {
                  lowp vec3 point_547;
                  point_547 = position_393;
                  lowp vec3 tmpvar_548;
                  highp int k_549;
                  lowp vec3 indirect_sampling_sum_550;
                  lowp mat3 transform_551;
                  float tmpvar_552;
                  tmpvar_552 = sqrt(dot (diffuseColor_395, diffuseColor_395));
                  if ((tmpvar_552 == 0.0)) {
                    tmpvar_548 = vec3(0.0, 0.0, 0.0);
                  } else {
                    lowp float tmpvar_553;
                    tmpvar_553 = abs(normal_394.x);
                    lowp float tmpvar_554;
                    tmpvar_554 = abs(normal_394.y);
                    if ((tmpvar_553 > tmpvar_554)) {
                      lowp vec3 tmpvar_555;
                      tmpvar_555.y = 0.0;
                      tmpvar_555.x = normal_394.z;
                      tmpvar_555.z = -(normal_394.x);
                      transform_551[2] = (tmpvar_555 / sqrt((
                        (normal_394.x * normal_394.x)
                       + 
                        (normal_394.z * normal_394.z)
                      )));
                    } else {
                      lowp vec3 tmpvar_556;
                      tmpvar_556.x = 0.0;
                      tmpvar_556.y = -(normal_394.z);
                      tmpvar_556.z = normal_394.y;
                      transform_551[2] = (tmpvar_556 / sqrt((
                        (normal_394.y * normal_394.y)
                       + 
                        (normal_394.z * normal_394.z)
                      )));
                    };
                    lowp vec3 b_557;
                    b_557 = transform_551[2];
                    transform_551[0] = ((normal_394.yzx * b_557.zxy) - (normal_394.zxy * b_557.yzx));
                    transform_551[1] = normal_394;
                    k_549 = 0;
                    while (true) {
                      vec3 indirectReflectiveColor_558;
                      vec3 indirectSpecularColor_559;
                      vec3 indirectDiffuseColor_560;
                      if ((k_549 >= 100)) {
                        break;
                      };
                      if ((k_549 >= indirectSamples)) {
                        break;
                      };
                      randomIncrement += 0.02;
                      lowp float tmpvar_561;
                      tmpvar_561 = fract((cos(
                        dot ((point_547.xy + randomIncrement), vec2(23.14069, 2.665144))
                      ) * 12345.68));
                      lowp float tmpvar_562;
                      tmpvar_562 = sqrt((1.0 - (tmpvar_561 * tmpvar_561)));
                      randomIncrement += 0.02;
                      lowp float tmpvar_563;
                      tmpvar_563 = (6.283186 * fract((
                        cos(dot ((point_547.yx + randomIncrement), vec2(23.14069, 2.665144)))
                       * 12345.68)));
                      lowp vec3 tmpvar_564;
                      tmpvar_564.x = (cos(tmpvar_563) * tmpvar_562);
                      tmpvar_564.y = tmpvar_561;
                      tmpvar_564.z = (sin(tmpvar_563) * tmpvar_562);
                      lowp vec3 tmpvar_565;
                      tmpvar_565 = (transform_551 * tmpvar_564);
                      lowp vec3 ray_origin_566;
                      ray_origin_566 = point_547;
                      lowp vec3 ray_direction_567;
                      ray_direction_567 = tmpvar_565;
                      lowp float t_hit_568;
                      t_hit_568 = 10.0;
                      lowp vec3 position_569;
                      lowp vec3 normal_570;
                      vec3 diffuseColor_571;
                      diffuseColor_571 = indirectDiffuseColor_560;
                      vec3 specularColor_572;
                      specularColor_572 = indirectSpecularColor_559;
                      vec3 reflectiveColor_573;
                      reflectiveColor_573 = indirectReflectiveColor_558;
                      bool isLight_574;
                      isLight_574 = bool(0);
                      highp int i_575;
                      highp int i_576;
                      highp int i_577;
                      highp int idx_578;
                      highp int intersected_579;
                      intersected_579 = 0;
                      idx_578 = 0;
                      i_577 = 0;
                      while (true) {
                        if ((i_577 >= 5)) {
                          break;
                        };
                        if ((i_577 >= numSpheres)) {
                          break;
                        };
                        lowp float t_hit_580;
                        t_hit_580 = t_hit_568;
                        bool tmpvar_581;
                        lowp vec3 tmpvar_582;
                        tmpvar_582 = (sphereCenters[i_577] - ray_origin_566);
                        lowp float tmpvar_583;
                        tmpvar_583 = dot (tmpvar_582, ray_direction_567);
                        if ((tmpvar_583 < 0.0)) {
                          tmpvar_581 = bool(0);
                        } else {
                          lowp float tmpvar_584;
                          tmpvar_584 = (dot (tmpvar_582, tmpvar_582) - (tmpvar_583 * tmpvar_583));
                          if ((tmpvar_584 > 0.64)) {
                            tmpvar_581 = bool(0);
                          } else {
                            lowp float tmpvar_585;
                            tmpvar_585 = sqrt((0.64 - tmpvar_584));
                            lowp float tmpvar_586;
                            tmpvar_586 = (tmpvar_583 - tmpvar_585);
                            lowp float tmpvar_587;
                            tmpvar_587 = (tmpvar_583 + tmpvar_585);
                            lowp float tmpvar_588;
                            if ((tmpvar_586 < 0.01)) {
                              tmpvar_588 = tmpvar_587;
                            } else {
                              tmpvar_588 = tmpvar_586;
                            };
                            if (((tmpvar_588 < t_hit_568) && (tmpvar_588 > 0.01))) {
                              t_hit_580 = tmpvar_588;
                              tmpvar_581 = bool(1);
                            } else {
                              tmpvar_581 = bool(0);
                            };
                          };
                        };
                        t_hit_568 = t_hit_580;
                        if (tmpvar_581) {
                          idx_578 = i_577;
                          intersected_579 = 1;
                        };
                        i_577++;
                      };
                      i_576 = 0;
                      while (true) {
                        bool tmp_589;
                        if ((i_576 >= 6)) {
                          break;
                        };
                        if ((i_576 >= numPlanes)) {
                          break;
                        };
                        lowp vec3 tmpvar_590;
                        tmpvar_590 = planeNormals[i_576];
                        tmp_589 = bool(0);
                        bool tmpvar_591;
                        if (enablePlaneBacksides) {
                          tmpvar_591 = bool(1);
                        } else {
                          tmpvar_591 = (dot (ray_direction_567, tmpvar_590) < 0.0);
                        };
                        if (tmpvar_591) {
                          lowp float t_hit_592;
                          t_hit_592 = t_hit_568;
                          bool tmpvar_593;
                          tmpvar_593 = bool(1);
                          bool tmpvar_594;
                          lowp vec3 tmpvar_595;
                          tmpvar_595 = (tmpvar_590 * planeOffsets[i_576]);
                          lowp float tmpvar_596;
                          tmpvar_596 = (((
                            (tmpvar_595.x + tmpvar_595.y)
                           + tmpvar_595.z) - dot (tmpvar_590, ray_origin_566)) / dot (tmpvar_590, ray_direction_567));
                          if (((tmpvar_596 < t_hit_568) && (tmpvar_596 > 0.01))) {
                            t_hit_592 = tmpvar_596;
                            tmpvar_594 = bool(1);
                            tmpvar_593 = bool(0);
                          };
                          if (tmpvar_593) {
                            tmpvar_594 = bool(0);
                            tmpvar_593 = bool(0);
                          };
                          t_hit_568 = t_hit_592;
                          tmp_589 = tmpvar_594;
                        };
                        if (tmp_589) {
                          normal_570 = tmpvar_590;
                          idx_578 = i_576;
                          intersected_579 = 2;
                        };
                        i_576++;
                      };
                      i_575 = 0;
                      while (true) {
                        bool tmp_597;
                        if ((i_575 >= 2)) {
                          break;
                        };
                        if ((i_575 >= numLights)) {
                          break;
                        };
                        vec3 tmpvar_598;
                        tmpvar_598 = lightPos[i_575];
                        vec2 tmpvar_599;
                        tmpvar_599 = lightSize[i_575];
                        tmp_597 = bool(0);
                        if (((tmpvar_599.x > 0.0) && (tmpvar_599.y > 0.0))) {
                          lowp float t_hit_600;
                          t_hit_600 = t_hit_568;
                          bool tmpvar_601;
                          tmpvar_601 = bool(1);
                          bool tmpvar_602;
                          vec3 tmpvar_603;
                          tmpvar_603 = (vec3(0.0, 1.0, 0.0) * tmpvar_598.y);
                          lowp float tmpvar_604;
                          tmpvar_604 = (((
                            (tmpvar_603.x + tmpvar_603.y)
                           + tmpvar_603.z) - ray_origin_566.y) / ray_direction_567.y);
                          if (((tmpvar_604 < t_hit_568) && (tmpvar_604 > 0.01))) {
                            lowp vec3 tmpvar_605;
                            tmpvar_605 = (ray_origin_566 + (ray_direction_567 * tmpvar_604));
                            float tmpvar_606;
                            tmpvar_606 = sqrt(dot (tmpvar_599, tmpvar_599));
                            if (((tmpvar_606 == 0.0) || ((
                              ((tmpvar_605.x < (tmpvar_598.x + (tmpvar_599.x * 0.5))) && (tmpvar_605.x > (tmpvar_598.x - (tmpvar_599.x * 0.5))))
                             && 
                              (tmpvar_605.z < (tmpvar_598.z + (tmpvar_599.y * 0.5)))
                            ) && (tmpvar_605.z > 
                              (tmpvar_598.z - (tmpvar_599.y * 0.5))
                            )))) {
                              t_hit_600 = tmpvar_604;
                              tmpvar_602 = bool(1);
                              tmpvar_601 = bool(0);
                            };
                          };
                          if (tmpvar_601) {
                            tmpvar_602 = bool(0);
                            tmpvar_601 = bool(0);
                          };
                          t_hit_568 = t_hit_600;
                          tmp_597 = tmpvar_602;
                        } else {
                          lowp float t_hit_607;
                          t_hit_607 = t_hit_568;
                          bool tmpvar_608;
                          lowp vec3 tmpvar_609;
                          tmpvar_609 = (tmpvar_598 - ray_origin_566);
                          lowp float tmpvar_610;
                          tmpvar_610 = dot (tmpvar_609, ray_direction_567);
                          if ((tmpvar_610 < 0.0)) {
                            tmpvar_608 = bool(0);
                          } else {
                            lowp float tmpvar_611;
                            tmpvar_611 = (dot (tmpvar_609, tmpvar_609) - (tmpvar_610 * tmpvar_610));
                            if ((tmpvar_611 > 0.01)) {
                              tmpvar_608 = bool(0);
                            } else {
                              lowp float tmpvar_612;
                              tmpvar_612 = sqrt((0.01 - tmpvar_611));
                              lowp float tmpvar_613;
                              tmpvar_613 = (tmpvar_610 - tmpvar_612);
                              lowp float tmpvar_614;
                              tmpvar_614 = (tmpvar_610 + tmpvar_612);
                              lowp float tmpvar_615;
                              if ((tmpvar_613 < 0.01)) {
                                tmpvar_615 = tmpvar_614;
                              } else {
                                tmpvar_615 = tmpvar_613;
                              };
                              if (((tmpvar_615 < t_hit_568) && (tmpvar_615 > 0.01))) {
                                t_hit_607 = tmpvar_615;
                                tmpvar_608 = bool(1);
                              } else {
                                tmpvar_608 = bool(0);
                              };
                            };
                          };
                          t_hit_568 = t_hit_607;
                          tmp_597 = tmpvar_608;
                        };
                        if (tmp_597) {
                          idx_578 = i_575;
                          intersected_579 = 3;
                        };
                        i_575++;
                      };
                      position_569 = (point_547 + (tmpvar_565 * t_hit_568));
                      if ((intersected_579 == 1)) {
                        diffuseColor_571 = sphereColors[idx_578];
                        specularColor_572 = vec3(1.0, 1.0, 1.0);
                        reflectiveColor_573 = reflectiveColors[idx_578];
                        lowp vec3 tmpvar_616;
                        tmpvar_616 = normalize((position_569 - sphereCenters[idx_578]));
                        normal_570 = tmpvar_616;
                        lowp float tmpvar_617;
                        tmpvar_617 = dot (tmpvar_616, -(tmpvar_565));
                        if ((tmpvar_617 < 0.0)) {
                          normal_570 = -(tmpvar_616);
                        };
                      } else {
                        if ((intersected_579 == 2)) {
                          if (enablePlaneMirrors) {
                            diffuseColor_571 = (planeColors[idx_578] * 0.01);
                            specularColor_572 = vec3(0.0, 0.0, 0.0);
                            reflectiveColor_573 = planeColors[idx_578];
                          } else {
                            diffuseColor_571 = planeColors[idx_578];
                            specularColor_572 = vec3(0.5, 0.5, 0.5);
                            reflectiveColor_573 = vec3(0.0, 0.0, 0.0);
                          };
                          lowp float tmpvar_618;
                          tmpvar_618 = dot (normal_570, -(tmpvar_565));
                          if ((tmpvar_618 < 0.0)) {
                            normal_570 = -(normal_570);
                          };
                        } else {
                          if ((intersected_579 == 3)) {
                            diffuseColor_571 = (lightIntensity[idx_578] / 25.0);
                            isLight_574 = bool(1);
                          };
                        };
                      };
                      indirectDiffuseColor_560 = diffuseColor_571;
                      indirectSpecularColor_559 = specularColor_572;
                      indirectReflectiveColor_558 = reflectiveColor_573;
                      lowp vec3 tmpvar_619;
                      if (isLight_574) {
                        tmpvar_619 = vec3(0.0, 0.0, 0.0);
                      } else {
                        lowp vec3 point_620;
                        point_620 = position_569;
                        lowp vec3 ray_dir_621;
                        ray_dir_621 = tmpvar_565;
                        lowp vec3 normal_622;
                        normal_622 = normal_570;
                        vec3 diffuseColor_623;
                        diffuseColor_623 = diffuseColor_571;
                        vec3 specularColor_624;
                        specularColor_624 = specularColor_572;
                        highp int i_625;
                        lowp vec3 illuminationColor_626;
                        i_625 = 0;
                        while (true) {
                          highp int k_627;
                          bool inShade_628;
                          highp int areaShadowSamples_629;
                          lowp vec3 light_sum_630;
                          vec2 lightSpot_631;
                          vec2 lightSize_632;
                          vec3 lightIntensity_633;
                          vec3 lightPos_634;
                          if ((i_625 >= 2)) {
                            break;
                          };
                          if ((i_625 == numLights)) {
                            break;
                          };
                          lightPos_634 = lightPos[i_625];
                          lightIntensity_633 = lightIntensity[i_625];
                          lightSize_632 = lightSize[i_625];
                          lightSpot_631 = lightSpot[i_625];
                          areaShadowSamples_629 = 0;
                          inShade_628 = bool(0);
                          k_627 = 0;
                          while (true) {
                            vec3 testPos_635;
                            if ((k_627 >= 5)) {
                              break;
                            };
                            if (inShade_628) {
                              break;
                            };
                            if ((k_627 == 1)) {
                              break;
                            };
                            testPos_635 = lightPos_634;
                            if ((k_627 == 1)) {
                              testPos_635.x = (lightPos_634.x - (lightSize_632.x * 0.5));
                              testPos_635.z = (lightPos_634.z - (lightSize_632.y * 0.5));
                            } else {
                              if ((k_627 == 2)) {
                                testPos_635.x = (testPos_635.x + (lightSize_632.x * 0.5));
                                testPos_635.z = (testPos_635.z + (lightSize_632.y * 0.5));
                              } else {
                                if ((k_627 == 3)) {
                                  testPos_635.x = (testPos_635.x + (lightSize_632.x * 0.5));
                                  testPos_635.z = (testPos_635.z - (lightSize_632.y * 0.5));
                                } else {
                                  if ((k_627 == 4)) {
                                    testPos_635.x = (testPos_635.x - (lightSize_632.x * 0.5));
                                    testPos_635.z = (testPos_635.z + (lightSize_632.y * 0.5));
                                  };
                                };
                              };
                            };
                            lowp vec3 vec_to_light_636;
                            lowp vec3 incident_intensity_637;
                            lowp float spot_falloff_638;
                            vec_to_light_636 = (testPos_635 - point_620);
                            lowp float tmpvar_639;
                            tmpvar_639 = sqrt(dot (vec_to_light_636, vec_to_light_636));
                            lowp float tmpvar_640;
                            tmpvar_640 = (1.0/(((attenuation.x * 
                              (tmpvar_639 * tmpvar_639)
                            ) + (attenuation.y * tmpvar_639))));
                            lowp vec3 tmpvar_641;
                            tmpvar_641 = normalize(vec_to_light_636);
                            vec_to_light_636 = tmpvar_641;
                            spot_falloff_638 = 1.0;
                            if ((lightSpot_631.x > 0.0)) {
                              lowp float tmpvar_642;
                              if ((tmpvar_641.y > lightSpot_631.x)) {
                                tmpvar_642 = pow (tmpvar_641.y, lightSpot_631.y);
                              } else {
                                tmpvar_642 = 0.0;
                              };
                              spot_falloff_638 = tmpvar_642;
                            };
                            incident_intensity_637 = ((lightIntensity_633 * tmpvar_640) * spot_falloff_638);
                            lowp float tmpvar_643;
                            tmpvar_643 = sqrt(dot (incident_intensity_637, incident_intensity_637));
                            if ((tmpvar_643 > 0.01)) {
                              lowp vec3 ray_origin_644;
                              ray_origin_644 = point_620;
                              lowp vec3 ray_direction_645;
                              ray_direction_645 = tmpvar_641;
                              lowp float t_hit_646;
                              t_hit_646 = tmpvar_639;
                              bool tmpvar_647;
                              tmpvar_647 = bool(0);
                              highp int i_648;
                              highp int i_649;
                              i_649 = 0;
                              while (true) {
                                if ((i_649 >= 5)) {
                                  break;
                                };
                                if ((i_649 == numSpheres)) {
                                  break;
                                };
                                lowp float t_hit_650;
                                t_hit_650 = t_hit_646;
                                bool tmpvar_651;
                                lowp vec3 tmpvar_652;
                                tmpvar_652 = (sphereCenters[i_649] - ray_origin_644);
                                lowp float tmpvar_653;
                                tmpvar_653 = dot (tmpvar_652, ray_direction_645);
                                if ((tmpvar_653 < 0.0)) {
                                  tmpvar_651 = bool(0);
                                } else {
                                  lowp float tmpvar_654;
                                  tmpvar_654 = (dot (tmpvar_652, tmpvar_652) - (tmpvar_653 * tmpvar_653));
                                  if ((tmpvar_654 > 0.64)) {
                                    tmpvar_651 = bool(0);
                                  } else {
                                    lowp float tmpvar_655;
                                    tmpvar_655 = sqrt((0.64 - tmpvar_654));
                                    lowp float tmpvar_656;
                                    tmpvar_656 = (tmpvar_653 - tmpvar_655);
                                    lowp float tmpvar_657;
                                    tmpvar_657 = (tmpvar_653 + tmpvar_655);
                                    lowp float tmpvar_658;
                                    if ((tmpvar_656 < 0.01)) {
                                      tmpvar_658 = tmpvar_657;
                                    } else {
                                      tmpvar_658 = tmpvar_656;
                                    };
                                    if (((tmpvar_658 < t_hit_646) && (tmpvar_658 > 0.01))) {
                                      t_hit_650 = tmpvar_658;
                                      tmpvar_651 = bool(1);
                                    } else {
                                      tmpvar_651 = bool(0);
                                    };
                                  };
                                };
                                t_hit_646 = t_hit_650;
                                if (tmpvar_651) {
                                  tmpvar_647 = bool(1);
                                  break;
                                };
                                i_649++;
                              };
                              if (!(tmpvar_647)) {
                                i_648 = 0;
                                while (true) {
                                  if ((i_648 >= 6)) {
                                    break;
                                  };
                                  if ((i_648 == numPlanes)) {
                                    break;
                                  };
                                  vec3 normal_659;
                                  normal_659 = planeNormals[i_648];
                                  lowp float t_hit_660;
                                  t_hit_660 = t_hit_646;
                                  bool tmpvar_661;
                                  tmpvar_661 = bool(1);
                                  bool tmpvar_662;
                                  vec3 tmpvar_663;
                                  tmpvar_663 = (normal_659 * planeOffsets[i_648]);
                                  lowp float tmpvar_664;
                                  tmpvar_664 = (((
                                    (tmpvar_663.x + tmpvar_663.y)
                                   + tmpvar_663.z) - dot (normal_659, ray_origin_644)) / dot (normal_659, ray_direction_645));
                                  if (((tmpvar_664 < t_hit_646) && (tmpvar_664 > 0.01))) {
                                    t_hit_660 = tmpvar_664;
                                    tmpvar_662 = bool(1);
                                    tmpvar_661 = bool(0);
                                  };
                                  if (tmpvar_661) {
                                    tmpvar_662 = bool(0);
                                    tmpvar_661 = bool(0);
                                  };
                                  t_hit_646 = t_hit_660;
                                  if (tmpvar_662) {
                                    tmpvar_647 = bool(1);
                                    break;
                                  };
                                  i_648++;
                                };
                                if (!(tmpvar_647)) {
                                  tmpvar_647 = bool(1);
                                };
                              };
                              lowp float tmpvar_665;
                              tmpvar_665 = abs((t_hit_646 - tmpvar_639));
                              if ((tmpvar_665 < 0.001)) {
                                lowp vec3 tmpvar_666;
                                lowp float tmpvar_667;
                                tmpvar_667 = dot (normal_622, tmpvar_641);
                                if ((tmpvar_667 > 0.0)) {
                                  tmpvar_666 = (incident_intensity_637 * ((diffuseColor_623 * 
                                    max (0.0, dot (normal_622, tmpvar_641))
                                  ) + (specularColor_624 * 
                                    pow (max (0.0, dot ((
                                      -(tmpvar_641)
                                     - 
                                      ((2.0 * dot (-(tmpvar_641), normal_622)) * normal_622)
                                    ), -(ray_dir_621))), 32.0)
                                  )));
                                } else {
                                  tmpvar_666 = vec3(0.0, 0.0, 0.0);
                                };
                                light_sum_630 = (light_sum_630 + tmpvar_666);
                              } else {
                                inShade_628 = bool(1);
                              };
                            } else {
                              inShade_628 = bool(1);
                            };
                            areaShadowSamples_629++;
                            k_627++;
                          };
                          illuminationColor_626 = (illuminationColor_626 + (light_sum_630 / float(areaShadowSamples_629)));
                          i_625++;
                        };
                        tmpvar_619 = (tmpvar_561 * illuminationColor_626);
                      };
                      indirect_sampling_sum_550 = (indirect_sampling_sum_550 + tmpvar_619);
                      k_549++;
                    };
                    tmpvar_548 = (((2.0 * indirect_sampling_sum_550) / float(indirectSamples)) * diffuseColor_395);
                  };
                  mirror_sample_color_384 = (tmpvar_498 + tmpvar_548);
                } else {
                  mirror_sample_color_384 = (mirror_sample_color_384 + (ambientLight * diffuseColor_395));
                };
                reflectionSum_383 = (reflectionSum_383 + (mirror_sample_color_384 * reflectiveColor_381));
                origin_378 = position_393;
                rayDir_379 = tmpvar_389;
                reflectiveColor_381 = (reflectiveColor_397 * reflectiveColor_381);
              };
              pixelColor_4 = (pixelColor_4 + reflectionSum_383);
            };
            pixelColor_4 = (mat3(0.59719, 0.076, 0.0284, 0.35458, 0.90834, 0.13383, 0.04823, 0.01566, 0.83777) * pixelColor_4);
            pixelColor_4 = (((pixelColor_4 * 
              (pixelColor_4 + 0.0245786)
            ) - 9.0537e-05) / ((pixelColor_4 * 
              ((0.983729 * pixelColor_4) + 0.432951)
            ) + 0.238081));
            pixelColor_4 = (mat3(1.60475, -0.10208, -0.00327, -0.53108, 1.10813, -0.07276, -0.07367, -0.00605, 1.07602) * pixelColor_4);
            lowp vec3 tmpvar_668;
            tmpvar_668 = clamp (pixelColor_4, 0.0, 1.0);
            pixelColor_4 = tmpvar_668;
            lowp vec4 tmpvar_669;
            tmpvar_669.w = 1.0;
            tmpvar_669.xyz = pow (tmpvar_668, vec3(0.45, 0.45, 0.45));
            fragColor = tmpvar_669;
          }
          
          
        </script>
        <script src="webgl-utils.js"></script>
        <script src='gl-matrix-min.js'></script>
        <script src='world-state.js'></script>
        <script src='raytracer.js'></script>
    </body>
</html>